(this["webpackJsonppiu-spy-web-2"]=this["webpackJsonppiu-spy-web-2"]||[]).push([[0],{213:function(e,a,t){e.exports=t(433)},218:function(e,a){Number.isNaN=Number.isNaN||function(e){return e!==e},"undefined"===typeof Math.sign&&(Math.sign=function(e){return e>0?1:e<0?-1:e}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var a=Object(this),t=a.length>>>0;if("function"!==typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],n=0;n<t;){var s=a[n];if(e.call(r,s,n,a))return n;n++}return-1},configurable:!0,writable:!0})},227:function(e,a,t){},239:function(e,a,t){},240:function(e,a,t){},241:function(e,a,t){},252:function(e,a,t){},253:function(e,a,t){},254:function(e,a,t){},255:function(e,a,t){},257:function(e,a,t){},264:function(e,a,t){},413:function(e,a,t){},414:function(e,a,t){},415:function(e,a,t){},416:function(e,a,t){},427:function(e,a,t){},430:function(e,a,t){},431:function(e,a,t){},432:function(e,a,t){},433:function(e,a,t){"use strict";t.r(a);t(214),t(217),t(218);var r=t(1),n=t.n(r),s=t(14),l=t.n(s),c=t(12),i=t(10),o=(t(227),t(41)),m=t(13),d=t.n(m),p=t(47),u=t.n(p),h=t(2),g=t.n(h);t(238),t(239);const E={path:"/leaderboard",sharedChart:{path:"/leaderboard/chart/:sharedChartId",getPath:e=>"/leaderboard/chart/".concat(e.sharedChartId)}},f={path:"/songs"},y={path:"/ranking",faq:{path:"/ranking/faq"}},v={path:"/tournaments"},b={path:"/profiles/:id",getPath:e=>"/profiles/".concat(e.id),compare:{path:"/profiles/:id/vs/:compareToId",getPath:e=>"/profiles/".concat(e.id,"/vs/").concat(e.compareToId)}},N={DEFAULT:"default",PROTAGONIST:"protagonist",RANK_ASC:"rankAsc",RANK_DESC:"rankDesc",PP_ASC:"ppAsc",PP_DESC:"ppDesc",NEW_SCORES_PLAYER:"newScoresPlayer",EASIEST_SONGS:"easiestSongs",HARDEST_SONGS:"hardestSongs"},S="SHOW_ALL",k="SHOW_BEST",P="SHOW_ONLY_RANK",O="SHOW_ONLY_NORANK",R=[1,28],x={STD:"Standard",SHORT:"Short",REMIX:"Remix",FULL:"Full"},C=g.a.values(x);var L=t(9),I=t(5),w=t.n(I);t(240),t(241);function A(){return n.a.createElement("div",{className:"loader"},n.a.createElement("svg",{width:"40",height:"12",viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:"#eee"},n.a.createElement("circle",{cx:"15",cy:"15",r:"15"},n.a.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})),n.a.createElement("circle",{cx:"60",cy:"15",r:"9",fillOpacity:"0.3"},n.a.createElement("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"0.5",to:"0.5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})),n.a.createElement("circle",{cx:"105",cy:"15",r:"15"},n.a.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"}))))}var _=t(75),D=t.n(_);const T=({url:e})=>B({url:e,method:"get"}),M=({url:e,body:a})=>B({url:e,method:"post",body:JSON.stringify(a),headers:{"Content-Type":"application/json;charset=utf-8"}}),F={},B=({url:e,method:a,body:t,headers:r})=>async(n,s)=>{try{const n=D.a.get("session");n&&(F.Session=n);const s=await fetch(e,{method:a,body:t,headers:{...F,...r},credentials:"include"});if(s.status>=200&&s.status<300){return await s.json()}{const e=await s.json();throw g.a.isObject(e)&&g.a.isString(e.error)?new Error(e.error):g.a.isString(e)?new Error(e):new Error("HTTP Status "+s.status)}}catch(l){return"Invalid session"===l.message&&n({type:"USER/RESET"}),Promise.reject(l)}},j="https://vps720616.ovh.net:5000",H="MOST_PLAYED/ERROR",G={isLoading:!1,data:[]};const U={isLoading:!1,data:[]};const K={isLoading:!1,data:[]};var W=t(437),V=t(76),q=t.n(V),Y=t(436),z=t(15),X=t.n(z);const J=e=>"string"===typeof e?X()(e).toDate():new Date(e),Q=(e,a)=>"SSS"===a?e-3e5:"SS"===a?e-15e4:"S"===a?e-1e5:e,Z=[{threshold:0,iconName:"0.png",color:"bronze"},{threshold:1e3,iconName:"1.png",color:"bronze"},{threshold:2e3,iconName:"2.png",color:"bronze"},{threshold:3e3,iconName:"3.png",color:"bronze"},{threshold:4e3,iconName:"4.png",color:"bronze"},{threshold:5e3,iconName:"5.png",color:"bronze"},{threshold:6250,iconName:"6.png",color:"bronze"},{threshold:7500,iconName:"7.png",color:"bronze"},{threshold:8750,iconName:"8.png",color:"bronze"},{threshold:1e4,iconName:"9.png",color:"silver"},{threshold:12e3,iconName:"10.png",color:"silver"},{threshold:14e3,iconName:"11.png",color:"silver"},{threshold:16e3,iconName:"12.png",color:"silver"},{threshold:18e3,iconName:"13.png",color:"silver"},{threshold:22e3,iconName:"14.png",color:"silver"},{threshold:26e3,iconName:"15.png",color:"silver"},{threshold:3e4,iconName:"16.png",color:"silver"},{threshold:35e3,iconName:"17.png",color:"silver"},{threshold:4e4,iconName:"18.png",color:"gold"},{threshold:5e4,iconName:"19.png",color:"gold"},{threshold:6e4,iconName:"20.png",color:"gold"},{threshold:7e4,iconName:"21.png",color:"gold"},{threshold:8e4,iconName:"22.png",color:"gold"},{threshold:1e5,iconName:"23.png",color:"gold"},{threshold:12e4,iconName:"24.png",color:"gold"},{threshold:14e4,iconName:"25.png",color:"gold"},{threshold:16e4,iconName:"26.png",color:"gold"},{threshold:18e4,iconName:"27.png",color:"green"}],$={F:.1,D:.2,"D+":.3,C:.3,"C+":.5,B:.5,"B+":.8,A:.8,"A+":1,S:1.1,SS:1.2,SSS:1.2},ee=(e,a)=>{if(!e.isBestGradeOnChart)return 0;if("COOP"===a.chartType)return 1e3*a.chartLevel*($[e.grade]||.8)/8;return a.chartLevel**2.31*($[e.grade]||.8)/9},ae=e=>e&&n.a.createElement("img",{className:e.color,src:"".concat(".","/ranks/").concat(e.iconName),alt:e.threshold});var te=t(18);const re={"500 \u043a\u043e\u043c\u0431\u043e":{icon:te.f,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 500+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:(e,a,t)=>({progress:100===t.progress||e.combo>=500?100:0})},"1000 \u043a\u043e\u043c\u0431\u043e":{icon:te.g,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 1000+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:(e,a,t)=>({progress:100===t.progress||e.combo>=1e3?100:0})},"2000 \u043a\u043e\u043c\u0431\u043e":{icon:te.h,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 2000+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:(e,a,t)=>({progress:100===t.progress||e.combo>=2e3?100:0})},"\u041c\u0430\u0441\u0442\u0435\u0440 \u0444\u0438\u043d\u0433\u0435\u0440\u0438\u043d\u0433\u0430":{icon:te.j,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c \u0432\u0441\u0435 Fingers \u0442\u0440\u0435\u043a\u0438",initialState:{progress:0,playedSongs:[],songsToPlay:["Monkey Fingers","Kimchi Fingers","Monkey Fingers 2","Money Fingers"]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.includes(a.song)?g.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"8-bit":{icon:te.i,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c Seize My Day, Tales of Pumpnia \u0438 Pumptris (8bit ver.)",initialState:{progress:0,playedSongs:[],songsToPlay:["Seize My Day","Tales of Pumpnia","Pumptris (8bit ver.)"]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.includes(a.song)?g.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"Love is...":{icon:te.c,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c \u0432\u0441\u0435 Love is a Danger Zone \u0442\u0440\u0435\u043a\u0438",initialState:{progress:0,playedSongs:[],songsToPlay:["Love is a Danger Zone","Love is a Danger Zone [SHORT]","Love is a Danger Zone (Cranky Mix)","Love is a Danger Zone 2","Love is a Danger Zone 2 [SHORT]","Love is a Danger Zone 2 [FULL]","Love is a Danger Zone 2 (D&G Ver.)","Love is a Danger Zone (try to B.P.M.)"]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.includes(a.song)?g.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"\u0423\u043b\u0438\u0442\u043a\u0430":{icon:te.k,description:"\u041c\u0430\u0441\u0442\u0435\u0440 \u0437\u0430\u043c\u0435\u0434\u043b\u0435\u043d\u0438\u0439: \u0441\u044b\u0433\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u0448\u0438\u0435 \u0447\u0430\u0440\u0442\u044b Twist of Fate, Karyawisata, Awakening \u0438 Moonlight",initialState:{progress:0,playedSongs:[],songsToPlay:[{song:"Twist of Fate (feat. Ruriling)",charts:["D20","S19"]},{song:"Karyawisata",charts:["S20","D16"]},{song:"Awakening",charts:["S19","D20"]},{song:"Moonlight",charts:["S19","D21"]}]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.some(e=>a.song===e.song&&e.charts.includes(a.chartLabel))?g.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"\u041a\u043e\u0440\u0438\u0447\u043d\u0435\u0432\u0430\u044f S":{icon:te.d,description:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c S, \u043d\u043e 5+ \u0431\u044d\u0434\u043e\u0432",resultFunction:(e,a,t)=>({progress:100===t.progress||0===e.miss&&e.bad>=5?100:0})},"\u041c\u044b \u0432\u044b\u0436\u0438\u0432\u0430\u043b\u0438 \u043a\u0430\u043a \u043c\u043e\u0433\u043b\u0438":{icon:te.b,description:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c B \u0438\u043b\u0438 \u043d\u0438\u0436\u0435, \u043d\u043e \u0443\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043b\u0430\u0439\u0444\u0431\u0430\u0440",resultFunction:(e,a,t)=>({progress:100===t.progress||["B+","C+","D+"].includes(e.grade)?100:0})},"\u041f\u0430\u0434\u043e\u0432\u044b\u0439 \u043c\u0438\u0441\u0441":{icon:te.l,description:"\u041a\u043e\u0433\u0434\u0430 \u043e\u0442 SSS \u0442\u0435\u0431\u044f \u0443\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043c\u0438\u0441\u0441\u044b \u0438\u0437-\u0437\u0430 \u043f\u043b\u043e\u0445\u043e\u0433\u043e \u043c\u043e\u0434\u0434\u0438\u043d\u0433\u0430 \u043f\u0430\u0434\u043e\u0432",resultFunction:(e,a,t)=>({progress:100===t.progress||e.miss>0&&0===e.bad&&0===e.good&&0===e.great?100:0})}},ne={progress:0};W.a.addLocale(q.a);const se=new W.a("ru-RU"),le={flavour:"long",gradation:Y.a,units:["day","week","month"]},ce=e=>{if(e.isExactDate)return e.dateObject.toLocaleDateString();{const a=void 0===e.isMyBest&&void 0===e.isMachineBest?"\u0441 my best \u0438\u043b\u0438 machine best":e.isMyBest?"\u0441 my best":e.isMachineBest?"\u0441 machine best":"\u0445\u0437 \u043e\u0442\u043a\u0443\u0434\u0430";return n.a.createElement("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"}},n.a.createElement("div",null,"\u0442\u043e\u0447\u043d\u0430\u044f \u0434\u0430\u0442\u0430 \u0432\u0437\u044f\u0442\u0438\u044f \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430"),n.a.createElement("div",null,"\u0441\u043a\u043e\u0440 \u0431\u044b\u043b \u0437\u0430\u043f\u0438\u0441\u0430\u043d ",a),n.a.createElement("div",null,"\u0434\u0430\u0442\u0430 \u0437\u0430\u043f\u0438\u0441\u0438: ",e.dateObject.toLocaleDateString()))}},ie=e=>{const a=X()().startOf("day").diff(X()(e).startOf("day"),"days"),t=X()(e).hour();return X()().hour()<5?a<=1?"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":se.format(e,le):0===a?t<5?"\u0432\u0447\u0435\u0440\u0430 \u043d\u043e\u0447\u044c\u044e":"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":1===a?"\u0432\u0447\u0435\u0440\u0430":se.format(e,le)},oe=e=>{const[a,t]=e?e.match(/(\D+)|(\d+)/g):[];return[a,t]},me={"?":0,F:1,D:2,"D+":3,C:4,"C+":5,B:6,"B+":7,A:8,"A+":9,S:10,SS:11,SSS:12},de=(e,a,t,r)=>{const n="?"!==e.grade?e.grade:0===(s=e).misses&&0===s.bads&&0===s.goods?0===s.greats?"SSS":"SS":s.grade;var s;if("undefined"===typeof e.recognition_notes)return{id:e.id,isUnknownPlayer:"PUMPITUP"===a[e.player].arcade_name,isIntermediateResult:!0,sharedChartId:e.shared_chart||r,playerId:e.player,nickname:a[e.player].nickname,nicknameArcade:a[e.player].arcade_name,date:e.gained,dateObject:J(e.gained),grade:n,isExactDate:!!e.exact_gain_date,score:e.score,scoreRaw:Q(e.score,n),isRank:!!e.rank_mode};let l={isUnknownPlayer:"PUMPITUP"===a[e.player].arcade_name,isIntermediateResult:!1,sharedChartId:e.shared_chart||r,id:e.id,playerId:e.player,nickname:a[e.player].nickname,nicknameArcade:a[e.player].arcade_name,originalChartMix:e.original_mix,originalChartLabel:e.original_label,originalScore:e.original_score,date:e.gained,dateObject:J(e.gained),grade:n,isExactDate:!!e.exact_gain_date,score:e.score,scoreRaw:Q(e.score,n),scoreIncrease:e.score_increase,calories:e.calories&&e.calories/1e3,perfect:e.perfects,great:e.greats,good:e.goods,bad:e.bads,miss:e.misses,combo:e.max_combo,mods:e.mods_list,isRank:!!e.rank_mode,isHJ:(e.mods_list||"").split(" ").includes("HJ"),isMachineBest:"machine_best"===e.recognition_notes,isMyBest:"personal_best"===e.recognition_notes};((e,a)=>{if(!a)return;const t=[e.perfect,e.great,e.good,e.bad,e.miss];let r=-1,n=0,s=0;for(let l=0;l<5;++l)g.a.isNumber(t[l])?s+=t[l]:(r=l,n++);1===n&&(e[["perfect","great","good","bad","miss"][r]]=a-s)})(l,t.maxTotalSteps);const c=10*Math.sqrt(l.perfect),i=c?Math.floor((100*c+85*l.great+60*l.good+20*l.bad+-25*l.miss)/(c+l.great+l.good+l.bad+l.miss)*100)/100:null,o=l.perfect?Math.floor((100*l.perfect+85*l.great+60*l.good+20*l.bad+-25*l.miss)/(l.perfect+l.great+l.good+l.bad+l.miss)*100)/100:null;return l.accuracy=i<0?0:100===o?100:i&&+i.toFixed(2),l.accuracyRaw=g.a.toNumber(l.accuracy),l},pe=(e,a,t)=>{const r=e.playerId,n=g.a.fromPairs(Array.from({length:28}).map((e,a)=>[a+1,[]]));a[r]={name:t[r].nickname,nameArcade:t[r].arcade_name,resultsByGrade:{},resultsByLevel:n,firstResultDate:e.dateObject,lastResultDate:e.dateObject,count:0,battleCount:0,countAcc:0,grades:{F:0,D:0,C:0,B:0,A:0,S:0,SS:0,SSS:0},sumAccuracy:0,rankingHistory:[],ratingHistory:[],lastPlace:null,lastBattleDate:0,region:t[r].region},a[r].achievements=g.a.flow(g.a.keys,g.a.map(e=>[e,{...re[e].initialState||ne}]),g.a.fromPairs)(re),a[r].exp=0},ue=(e,a,t)=>{const r=t[e.playerId];r.count++,e.accuracy&&(r.countAcc++,r.sumAccuracy+=e.accuracy),r.grades[e.grade.replace("+","")]++,"COOP"!==a.chartType&&e.isBestGradeOnChart&&(r.resultsByGrade[e.grade]=[...r.resultsByGrade[e.grade]||[],{result:e,chart:a}],r.resultsByLevel[a.chartLevel]=[...r.resultsByLevel[a.chartLevel]||[],{result:e,chart:a}]),e.isExactDate&&r.lastResultDate<e.dateObject&&(r.lastResultDate=e.dateObject),e.isExactDate&&r.firstResultDate>e.dateObject&&(r.firstResultDate=e.dateObject),r.achievements=g.a.mapValues.convert({cap:!1})((t,n)=>re[n].resultFunction(e,a,t,r),r.achievements),r.exp+=ee(e,a)},he=e=>e.scoreRaw/e.accuracy*100/(e.isRank?1.2:1);function ge({fetchList:e,title:a,renderRightSide:t}){const[s,l]=Object(r.useState)([]),[c,i]=Object(r.useState)(!1),o=t||(e=>n.a.createElement("div",{className:"playcount"},n.a.createElement(L.n,null),n.a.createElement("span",null,e.countplay)));return Object(r.useEffect)(()=>{i(!0),e().then(e=>{e.success&&l(e.data),i(!1)}).catch(()=>{i(!1)})},[e]),n.a.createElement("div",{className:"top-songs-list"},n.a.createElement("div",{className:"top-songs-header"},n.a.createElement("span",null,a)),c&&n.a.createElement(A,null),!c&&s.map((e,a)=>n.a.createElement("div",{key:e.id,className:"top-songs-item"},n.a.createElement("div",{className:w()("place","top-".concat(a+1),{best:a<3})},n.a.createElement("span",null,a+1,".")),n.a.createElement("div",{className:"song-name"},e.full_name),o(e))))}const Ee=e=>n.a.createElement("div",{className:"date"},n.a.createElement("span",null,e.last_play?ie(J(e.last_play)):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430"));var fe=Object(i.b)(null,{fetchMostPlayed:()=>async e=>{e({type:"MOST_PLAYED/LOADING"});try{const a=await e(T({url:"".concat(j,"/track-stats/most-played")}));return e({type:"MOST_PLAYED/SUCCESS",data:a}),a}catch(a){return e({type:H,error:a}),null}},fetchMostPlayedMonth:()=>async e=>{e({type:"MOST_PLAYED_MONTH/LOADING"});try{const a=await e(T({url:"".concat(j,"/track-stats/most-played-month")}));return e({type:"MOST_PLAYED_MONTH/SUCCESS",data:a}),a}catch(a){return e({type:"MOST_PLAYED_MONTH/ERROR",error:a}),null}},fetchLeastPlayed:()=>async e=>{e({type:"LEAST_PLAYED/LOADING"});try{const a=await e(T({url:"".concat(j,"/track-stats/most-time-not-played")}));return e({type:"LEAST_PLAYED/SUCCESS",data:a}),a}catch(a){return e({type:"LEAST_PLAYED/ERROR",error:a}),null}}})((function({fetchMostPlayed:e,fetchMostPlayedMonth:a,fetchLeastPlayed:t}){return n.a.createElement("div",{className:"songs-top-page"},n.a.createElement(ge,{fetchList:e,title:"\u0442\u043e\u043f \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0445 \u0442\u0440\u0435\u043a\u043e\u0432"}),n.a.createElement(ge,{fetchList:a,title:"\u0442\u043e\u043f \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0445 \u0442\u0440\u0435\u043a\u043e\u0432 \u0437\u0430 \u043c\u0435\u0441\u044f\u0446"}),n.a.createElement(ge,{fetchList:t,title:"\u0442\u0440\u0435\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u043e\u043b\u0433\u043e \u043d\u0435 \u0438\u0433\u0440\u0430\u043b\u0438",renderRightSide:Ee}),n.a.createElement("div",{className:"top-songs-list -placeholder"}))})),ye=t(22);t(252),t(253);class ve extends n.a.PureComponent{render(){const{active:e,onToggle:a,text:t}=this.props;return n.a.createElement("div",{className:w()("toggle-button",{active:e}),onClick:()=>a(!e)},t)}}class be extends n.a.Component{constructor(e){super(e),this.state={value:(g.a.isNil(e.value)?e.defaultValue:e.value)||""},g.a.bindAll(["handleChange","handleBlur","handleKeyPress"],this)}componentDidUpdate(e){e.value!==this.props.value&&this.setState({value:this.props.value})}handleChange(e){const a=e.target.value;this.setState({value:a},()=>this.props.onChange(a))}handleBlur(e){const{type:a}=this.props,{value:t}=this.state;if("number"===a){const a=Number(t);a>=Number(e.target.min)&&a<=Number(e.target.max)?this.props.onBlur(a,e):(this.setState({value:this.props.value}),this.props.onBlur(this.props.value,e))}}handleKeyPress(e){"Enter"===e.key&&this.handleBlur(e)}render(){const{className:e}=this.props;return n.a.createElement("input",Object.assign({},g.a.omit(["defaultValue","onChange"],this.props),{className:w()(e,"text-input"),value:this.state.value,onBlur:this.handleBlur,onKeyPress:this.handleKeyPress,onInput:this.handleChange,onChange:g.a.noop}))}}be.defaultProps={value:null,type:"text",onChange:g.a.noop,onBlur:g.a.noop};t(254);class Ne extends n.a.Component{constructor(){super(),this.onChange=e=>{this.props.onChange(e.target.checked)},this.id=g.a.uniqueId()}render(){return n.a.createElement("div",{className:"toggle-checkbox"},n.a.createElement("input",{type:"checkbox",className:"toggle-checkbox-cb",id:this.id,onChange:this.onChange,checked:this.props.checked}),n.a.createElement("label",{htmlFor:this.id,className:"toggle"},n.a.createElement("span",null)),this.props.children&&n.a.createElement("label",{htmlFor:this.id,className:"text-label"},this.props.children))}}t(255);class Se extends r.PureComponent{constructor(e){super(),this.state={open:e.defaultOpen||!1}}render(){const{children:e,title:a,className:t}=this.props,{open:r}=this.state;return n.a.createElement("div",{className:w()("collapsible-bar",t,{open:r})},n.a.createElement("div",{className:"header",onClick:()=>this.setState(e=>({open:!e.open}))},n.a.createElement("div",{className:"collapse-button"},n.a.createElement(L.g,null)),n.a.createElement("div",{className:"title"},a)),e&&n.a.createElement("div",{className:"collapsible-children"},e))}}var ke=t(187),Pe=t(168);t(257);const Oe={preventOverflow:{enabled:!0,padding:10,boundariesElement:"viewport"}},Re={right:"left",left:"right",top:"bottom",bottom:"top"},xe=e=>e&&Re[e.split("-")[0]];class Ce extends n.a.PureComponent{constructor(){super(),this.state={isVisible:!1},this.containerItemRef=n.a.createRef(),this.renderPopper=this.renderPopper.bind(this),this.toggleOverlayVisibility=this.toggleOverlayVisibility.bind(this)}hideOverlay(){this.setState({isVisible:!1})}toggleOverlayVisibility(){this.setState({isVisible:!this.state.isVisible})}handleClickOutside(e){e&&e.target.closest(".inner-popper-overlay")||this.hideOverlay()}renderPopper({ref:e,style:a,placement:t,arrowProps:r,scheduleUpdate:s,outOfBoundaries:l}){const{children:c,hideWhenOutOfBounds:i}=this.props;return n.a.createElement("div",{ref:e,style:a,"data-placement":t,className:w()("inner-popper-overlay","arrow-".concat(xe(t)),this.props.overlayClassName,{"out-of-bounds":l&&i})},n.a.createElement("div",{className:"arrow-hider"},n.a.createElement("div",{className:"arrow",ref:r.ref,style:r.style})),n.a.createElement("div",{className:"inner-popper-content"},c))}render(){const{placement:e,overlayItem:a}=this.props,{isVisible:t}=this.state;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"overlay-item",ref:this.containerItemRef,onClick:this.toggleOverlayVisibility},a),t&&l.a.createPortal(n.a.createElement(ke.a,{container:document.body,modifiers:Oe,placement:e,referenceElement:this.containerItemRef.current},this.renderPopper),document.body))}}Ce.defaultTypes={placement:"bottom"};var Le=Object(Pe.a)(Ce),Ie=t(108);function we({range:e,min:a,max:t,onChange:r}){return n.a.createElement(Ie.Range,{values:e,step:1,min:a,max:t,onChange:r,renderTrack:({props:r,children:s})=>n.a.createElement("div",{onMouseDown:r.onMouseDown,onTouchStart:r.onTouchStart,style:{...r.style,position:"relative",height:"10px",display:"flex",width:"100%"}},n.a.createElement("div",{ref:r.ref,style:{height:"6px",width:"100%",borderRadius:"3px",background:Object(Ie.getTrackBackground)({values:e,colors:["#ccc","#88d3ff","#ccc"],min:a,max:t}),alignSelf:"center"}},s)),renderThumb:({props:e,isDragged:a})=>n.a.createElement("div",Object.assign({},e,{style:{...e.style,height:"12px",width:"12px",borderRadius:"6px",backgroundColor:"#FFF",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0px 2px 3px #AAA"}}),n.a.createElement("div",{style:{height:"6px",width:"6px",borderRadius:"3px",backgroundColor:a?"#88d3ff":"#CCC"}}))})}function Ae({filterValue:e,onChange:a}){const t=g.a.getOr(R,"range",e),r=g.a.getOr(null,"type",e),s=g.a.getOr(C,"duration",e);let l="\u0444\u0438\u043b\u044c\u0442\u0440 \u0447\u0430\u0440\u0442\u043e\u0432";if(e){const e=r||"";l=t[0]===t[1]?"".concat(e).concat(t[0]):"".concat(e).concat(t[0]," - ").concat(e).concat(t[1]),l="\u0447\u0430\u0440\u0442\u044b: "+l,g.a.isEqual(s,C)||(l+=" ***")}const c=e=>{a({range:t,type:r,...e,duration:g.a.isEmpty(e.duration)?s:e.duration})};return n.a.createElement("div",null,n.a.createElement(Le,{overlayClassName:"chart-range-overlay-outer",overlayItem:n.a.createElement("button",{className:"filter-charts-button btn btn-sm btn-dark"},l)},n.a.createElement("div",{className:"chart-range-overlay"},n.a.createElement("div",{className:"buttons"},n.a.createElement(ve,{text:"Single",active:"S"===r,onToggle:e=>{c({type:e?"S":null})}}),n.a.createElement(ve,{text:"Double",active:"D"===r,onToggle:e=>{c({type:e?"D":null})}})),n.a.createElement(we,{range:t,min:R[0],max:R[1],onChange:e=>c({range:e})}),n.a.createElement("div",{className:"inputs"},n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>c({range:[Math.max(t[0]-1,R[0]),t[1]]})},n.a.createElement(L.e,null)),n.a.createElement(be,{type:"number",className:"form-control",min:R[0],max:Math.min(R[1],t[1]),value:t[0],onBlur:e=>{c({range:[e,t[1]]})}}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>{const e=Math.min(t[0]+1,R[1]);c({range:[e,t[1]<e?e:t[1]]})}},n.a.createElement(L.f,null)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>{const e=Math.max(t[1]-1,R[0]);c({range:[t[0]>e?e:t[0],e]})}},n.a.createElement(L.e,null)),n.a.createElement(be,{type:"number",className:"form-control",min:Math.max(R[0],t[0]),max:R[1],value:t[1],onBlur:e=>c({range:[t[0],e]})}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>c({range:[t[0],Math.min(t[1]+1,R[1])]})},n.a.createElement(L.f,null))),n.a.createElement("div",{className:"buttons-duration"},n.a.createElement(ve,{text:"Standard",active:s.includes(x.STD),onToggle:e=>{c({duration:e?[...s,x.STD]:g.a.without([x.STD],s)})}}),n.a.createElement(ve,{text:"Short",active:s.includes(x.SHORT),onToggle:e=>{c({duration:e?[...s,x.SHORT]:g.a.without([x.SHORT],s)})}}),n.a.createElement(ve,{text:"Remix",active:s.includes(x.REMIX),onToggle:e=>{c({duration:e?[...s,x.REMIX]:g.a.without([x.REMIX],s)})}}),n.a.createElement(ve,{text:"Full",active:s.includes(x.FULL),onToggle:e=>{c({duration:e?[...s,x.FULL]:g.a.without([x.FULL],s)})}})))))}var _e=t(40),De=t.n(_e),Te=t(77),Me=t.n(Te),Fe=t(169),Be=t.n(Fe);const je=(e,a)=>g.a.mapValues(e=>{const t=["A","A+","S","SS","SSS"];e.expRank=g.a.findLast(a=>a.threshold<=e.exp,Z),e.expRankNext=g.a.find(a=>a.threshold>e.exp,Z),e.progress={double:{SS:{},S:{},"A+":{},A:{}},single:{SS:{},S:{},"A+":{},A:{}}};const r={SSS:["SS","S","A+","A"],SS:["SS","S","A+","A"],S:["S","A+","A"],"A+":["A+","A"],A:["A"]};return e.accuracyPointsRaw=[],g.a.keys(e.resultsByLevel).forEach(a=>{e.resultsByLevel[a].forEach(n=>{!n.result.isRank&&n.result.accuracyRaw&&e.accuracyPointsRaw.push([g.a.toNumber(a),n.result.accuracyRaw,n.result.sharedChartId]);const s=n.result.grade,l=n.result.playerId,c=n.chart.results.filter(e=>e.playerId===l);if(c.length>1){if(c.sort((e,a)=>t.indexOf(a.grade)-t.indexOf(e.grade))[0].grade!==s)return}const i=r[s];i&&i.forEach(t=>{((a,t,r)=>{const n="S"===r||"SP"===r?e.progress.single:"D"===r||"DP"===r?e.progress.double:null;n&&(n[t][a]=n[t][a]?n[t][a]+1:1)})(a,t,n.chart.chartType)})})}),["single","double"].forEach(t=>{e.progress["".concat(t,"-bonus")]=0,g.a.keys(e.progress[t]).forEach(r=>{e.progress[t]["".concat(r,"-bonus")]=0,g.a.keys(e.progress[t][r]).forEach(n=>{const s=e.progress[t][r][n],l=(e=>Math.round(Math.min(e,1+e/20+.7*Math.sqrt(Math.max(e-1,0)))))(a.data["".concat(t,"sLevels")][n]),c=Math.min(1,s/l),i=(e=>30*(1+2**(e/4))/11)(n)*c;e.progress[t][r]["".concat(n,"-bonus")]=i,e.progress[t][r]["".concat(n,"-bonus-coef")]=c,e.progress[t][r]["".concat(n,"-min-number")]=l,e.progress[t][r]["".concat(n,"-achieved-number")]=s,i>=e.progress[t]["".concat(r,"-bonus")]&&(e.progress[t]["".concat(r,"-bonus")]=i,e.progress[t]["".concat(r,"-bonus-level")]=n,e.progress[t]["".concat(r,"-bonus-level-coef")]=c,e.progress[t]["".concat(r,"-bonus-level-min-number")]=l,e.progress[t]["".concat(r,"-bonus-level-achieved-number")]=s)}),e.progress["".concat(t,"-bonus")]+=e.progress[t]["".concat(r,"-bonus")]})}),e.progress.bonus=e.progress["double-bonus"]+e.progress["single-bonus"],e.achievementBonus=e.progress.bonus,e.accuracy=e.countAcc>0?Math.round(e.sumAccuracy/e.countAcc*100)/100:null,e},e),He=({profiles:e,sharedCharts:a,tracklist:t,battles:r,debug:n})=>{const s=(({profiles:e,sharedCharts:a})=>{const t={};for(const r in a){const n=a[r],s=n.results,l=Number(n.interpolatedDifficulty||n.chartLevel)**2.2/7.6;if(n.maxScore){const a=n.maxScore;for(const r of s)if(!r.isRank&&a){const s=Math.max(0,Math.min(1,r.scoreRaw/a-.3)/.7),c=s*l;t[r.id]={pp:{pp:c,k:s,maxScore:a,maxPP:l,ppPotential:l-c,ppRatio:c/l,ppFixed:Number(c.toFixed(1))}};const i=e[r.playerId];i&&(i.pp||(i.pp={scores:[],pp:0}),i.pp.scores.push({pp_:Number(c.toFixed(1)),s:n.song,l:n.chartLabel,pp:c,result:r,chart:n,K:s}))}}}for(const r in e){const a=e[r];a.pp?(a.pp.scores.sort((e,a)=>a.pp-e.pp),a.pp.pp=0,a.pp.scores.forEach((e,t)=>{a.pp.pp+=.95**t*e.pp}),a.rating=a.pp.pp):(a.pp={},a.rating=0)}return g.a.flow(g.a.values,g.a.orderBy(e=>e.rating,"desc"),e=>e.forEach((e,a)=>{e.ratingHistory.push({rating:e.rating,date:e.firstResultDate.getTime()}),e.rankingHistory.push({place:a+1,date:e.firstResultDate.getTime()})}))(e),t})({profiles:e=je(e,t),sharedCharts:a=(({sharedCharts:e,profiles:a,debug:t})=>g.a.mapValues(e=>{const r=e.results.map(r=>{const n=a[r.playerId];if(!n||!r.accuracy||r.isRank||g.a.size(n.accuracyPointsRaw)<50)return null;if(!n.accuracyPointsInterpolated){const e=g.a.maxBy(([e,a])=>a,n.accuracyPointsRaw)[1],a=g.a.maxBy(([e,a])=>e,g.a.filter(([a,t])=>t===e,n.accuracyPointsRaw))[0],t=n.accuracyPointsRaw.filter(([e,t])=>e>=a-1).map(([e,a])=>[30-e,101-a]),r=Be.a.logarithmic(t),s=e=>{const a=101-r.predict(30-e)[1];return Math.max(0,Math.min(a,100))},l=[];for(let n=1;n<=28;n+=.05)l.push([n,s(n)]);n.accuracyPointsInterpolated=l}const s=g.a.find(e=>e[1]<r.accuracyRaw,n.accuracyPointsInterpolated),l={interpolatedDifficulty:s&&s[0],weight:r.accuracyRaw>98?1-(r.accuracyRaw-98)/2:r.accuracyRaw<80?Math.max(0,(r.accuracyRaw-50)/30):1};return l.weight*=Math.min(1,Math.max(.1,(8-Math.abs(l.interpolatedDifficulty-e.chartLevel))/8)),t&&(r.interpolation=l),l}).filter(g.a.identity).reduce((e,a)=>a.interpolatedDifficulty?{diffSum:e.diffSum+a.interpolatedDifficulty*a.weight,weightSum:e.weightSum+a.weight}:e,{diffSum:0,weightSum:0});r.diffSum+=2*g.a.toNumber(e.chartLevel),r.weightSum+=2;const n=r.diffSum/r.weightSum;return{...e,interpolatedDifficulty:n}},e))({debug:n,sharedCharts:a,profiles:e})}),{logText:l}=(({battles:e,profiles:a,debug:t,resultInfo:r})=>{let n="";const s={},l=(e,a)=>"".concat(e.playerId,"vs").concat(a.playerId,"-").concat(e.sharedChartId,"-").concat(e.isRank),c={},i=e=>"".concat(e.playerId,"-").concat(e.sharedChartId,"-").concat(e.isRank);return e.forEach(([e,o,m])=>{const d=a[e.playerId],p=a[o.playerId],u=e.isRank?1.2:1;let h=null;m.maxScore&&(h=m.maxScore*u,Math.max(h,e.score,o.score)===h||e.isRank||e.isExactDate&&o.isExactDate||(h*=1.2),Math.max(h,e.score,o.score)!==h&&(h=Math.max(h,e.score,o.score)+1e4)),r[e.id]||(r[e.id]={}),r[o.id]||(r[o.id]={});const E=r[e.id],f=r[o.id];E.startingRating||(E.startingRating=d.rating),f.startingRating||(f.startingRating=p.rating),d.battleCount++,p.battleCount++;const y=d.rating,v=p.rating,b=10**(y/400),N=10**(v/400),S=b/(b+N),k=N/(b+N);let P,O,R=e.score,x=o.score;R===x?P=O=.5:h&&0!==R&&0!==x?(R=h/R-1,x=h/x-1,P=5*(x/(R+x)-.5)+.5,O=5*(R/(R+x)-.5)+.5):(P=R>x?1:x<R?0:.5,O=1-P),P=Math.max(0,Math.min(1,P)),O=Math.max(0,Math.min(1,O));const C=Math.max(0,Math.min(1,(y-700)/800)),L=Math.max(0,Math.min(1,(v-700)/800)),I=20+20*C,w=20+20*L,A=Number(m.interpolatedDifficulty||m.chartLevel),_=Math.max(1,Math.min(I,(A/25)**(5*(C-.5)+2.5)*I)),D=Math.max(1,Math.min(w,(A/25)**(5*(L-.5)+2.5)*w)),T=Math.min(_,D);let M=1;m.maxScore&&(e.grade.startsWith("SS")||0===e.miss&&0===e.bad)&&(o.grade.startsWith("SS")||0===o.miss&&0===o.bad)&&e.score/h>.98&&o.score/h>.98&&(M=Math.max(Math.min(1,Math.max(100-100*e.score/h,100-100*o.score/h)/2),0)**2);const F=T*M,B=T*M;let j=F*(P-S),H=B*(O-k);j=j<0&&"SSS"===e.grade?0:j,H=H<0&&"SSS"===o.grade?0:H;const G=l(e,o),U=l(o,e),K=s[G]||0,W=s[U]||0;s[G]=j,s[U]=H,d.rating=d.rating+j-K,p.rating=p.rating+H-W;const V=i(e),q=i(o);c[V]=(c[V]||0)+j-K,c[q]=(c[q]||0)+H-W,E.ratingDiff=c[V],E.ratingDiffLast=j-K,f.ratingDiff=c[q],f.ratingDiffLast=H-W,t&&(n+="".concat(m.chartLabel," - ").concat(m.song," (").concat(m.sharedChartId,") - ").concat(a[e.playerId].name," / ").concat(a[o.playerId].name,"\n- ").concat(e.score," / ").concat(o.score," (").concat(Math.floor(h)," (").concat(Math.floor(m.maxScore*u),")) - R ").concat(P.toFixed(2),"/").concat(O.toFixed(2)," E ").concat(S.toFixed(2)," / ").concat(k.toFixed(2),"\n- Rating ").concat(y.toFixed(2)," / ").concat(v.toFixed(2)," - ").concat(j.toFixed(2)," / ").concat(H.toFixed(2)," - K ").concat(F.toFixed(2)," ").concat(B.toFixed(2)).concat(1===M?"":" (coef ".concat(M.toFixed(2),")"),"\n- Base elo: ").concat(K.toFixed(2)," / ").concat(W.toFixed(2),"\n- Elo change: ").concat((j-K).toFixed(2)," / ").concat((H-W).toFixed(2),"\n- New base elo: ").concat(s[G].toFixed(2)," / ").concat(s[U].toFixed(2),"\n- RD: ").concat(c[V].toFixed(2)," / ").concat(c[q].toFixed(2),"\n")),d.rating=Math.max(100,d.rating),p.rating=Math.max(100,p.rating);const Y=g.a.flow(g.a.keys,g.a.map(e=>({id:e,rating:a[e].rating})),g.a.orderBy(["rating"],["desc"]))(a),z=e.dateObject>o.dateObject?e.dateObject:o.dateObject;Y.forEach((e,t)=>{a[e.id].lastPlace!==t+1&&(a[e.id].rankingHistory.push({place:t+1,date:z.getTime()}),a[e.id].lastPlace=t+1)});const X=g.a.last(d.ratingHistory),J=g.a.last(p.ratingHistory);X!==d.rating&&d.ratingHistory.push({rating:d.rating,date:z.getTime()}),J!==p.rating&&p.ratingHistory.push({rating:p.rating,date:z.getTime()})}),g.a.flow(g.a.keys,g.a.forEach(e=>{a[e].id=g.a.toInteger(e),a[e].accuracy=a[e].countAcc>0?Math.round(a[e].sumAccuracy/a[e].countAcc*100)/100:null,a[e].ratingRaw=a[e].rating,a[e].rating=Math.round(a[e].rating),a[e].rankingHistory=[...a[e].rankingHistory,{place:g.a.get("place",g.a.last(a[e].rankingHistory)),date:Date.now()}]}))(a),{logText:n}})({battles:r,profiles:e,resultInfo:s,debug:n});return{profiles:e,resultInfo:s,sharedCharts:a,logText:l}};let Ge=localStorage&&localStorage.getItem("debug");localStorage&&(window.debugOn=()=>{localStorage.setItem("debug",1),Ge=1},window.debugOff=()=>{localStorage.removeItem("debug"),Ge=0});const Ue=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET?"results/highscores/trusted":"results/highscores",Ke={rank:S},We={isLoading:!1,isLoadingRanking:!1,data:[],filter:Ke,players:{},profiles:{},results:[],resultInfo:{},sharedCharts:{}};const Ve=()=>async(e,a)=>{e({type:"TOP/LOADING"});try{const a=await e(T({url:"".concat(j,"/").concat(Ue)}));if(a.error)throw new Error(a.error);e(qe(a))}catch(t){console.log(t),e({type:"TOP/ERROR",error:t})}},qe=e=>async(a,t)=>{const{tracklist:r}=t(),{sharedCharts:n,mappedResults:s,profiles:l,battles:c}=((e,a)=>{const{players:t,results:r,shared_charts:n}=e,s=[],l=e=>"".concat(e.sharedChartId,"-").concat(e.playerId,"-").concat(e.isRank),c=e=>"".concat(e.sharedChartId,"-").concat(e.playerId),i={},o={},m={},d=[];let p={};for(let u of r){if(!t[u.player])continue;const e=u.shared_chart;if(!m[e]){const a=n[e],t=g.a.toUpper(a.chart_label),[r,s]=oe(t);m[e]={song:a.track_name,chartLabel:t,chartLevel:s,chartType:r,duration:a.duration,sharedChartId:e,maxTotalSteps:a.max_total_steps,results:[],allResultsIds:[]}}const a=m[e],r=de(u,t,a);s.push(r);const p=l(r),h=i[p];if(!h||h.score<r.score){if(h){const e=a.results.indexOf(h);-1!==e&&a.results.splice(e,1)}const e=g.a.sortedLastIndexBy(e=>-e.score,r,a.results);r.isUnknownPlayer&&0!==e||(a.results.splice(e,0,r),a.latestScoreDate=r.date,a.allResultsIds.push(r.playerId),i[p]=r),r.isUnknownPlayer||a.results.forEach(e=>{!e.isUnknownPlayer&&e.isRank===r.isRank&&e.playerId!==r.playerId&&r.score&&e.score&&d.push([r,e,a])})}if(!r.isIntermediateResult){const e=c(r),a=o[e];(!a||me[a.grade]<=me[r.grade])&&(a&&(a.isBestGradeOnChart=!1),r.isBestGradeOnChart=!0,o[e]=r)}}for(let u in m){const e=m[u];e.maxScore=null;for(let a of e.results){if(!a.isRank)if(a.accuracy){const t=he(a);e.maxScore<t&&(e.maxScore=t)}else e.maxScore&&e.maxScore<a.score&&(e.maxScore=a.score);a.isUnknownPlayer||a.isIntermediateResult||(p[a.playerId]||pe(a,p,t),ue(a,e,p))}}return{mappedResults:s,profiles:p,sharedCharts:m,battles:d}})(e);a({type:"TOP/SUCCESS",data:g.a.values(n),players:g.a.flow(g.a.toPairs,g.a.map(([e,a])=>({...a,id:g.a.toInteger(e)})))(e.players),results:s,profiles:l,sharedCharts:n,originalData:e});const i={sharedCharts:n,profiles:l,tracklist:r,battles:c,debug:Ge};let o;if(window.Worker){const e=new Me.a;o=await e.getProcessedProfiles(i),e.terminate()}else o=He(i);Ge&&console.log(o.logText),Ge&&console.log("Processed profiles:",Object.values(o.profiles).filter(e=>e.pp).sort((e,a)=>a.pp.pp-e.pp.pp)),a({type:"TOP/PROFILES_UPDATE",...o}),a(Je(o.profiles))},Ye=e=>({type:"TOP/SET_FILTER",filter:e}),ze=g.a.map("id"),Xe=g.a.flow(g.a.map(e=>[e.id,e.rating]),g.a.fromPairs),Je=e=>async(a,t)=>{try{const t=g.a.orderBy("ratingRaw","desc",g.a.values(e)),[r,n,s]=await Promise.all([d.a.getItem("lastChangedRanking_v3"),d.a.getItem("lastChangedRankingPoints_v3"),d.a.getItem("lastFetchedRanking_v3")]),l=ze(t),c=ze(s),i=ze(r),o=Xe(t),m=Xe(s);let p=Xe(n);g.a.isEqual(o,m)||(d.a.setItem("lastChangedRankingPoints_v3",s),p=m);let u=i;g.a.isEqual(l,c)||(d.a.setItem("lastChangedRanking_v3",s),u=c),a({type:"TOP/RANKING_CHANGE_SET",listNow:l,listPrev:u,rankingsPointsMap:p}),d.a.setItem("lastFetchedRanking_v3",t)}catch(r){console.warn("Cannot get ranking from local storage",r)}},Qe={presets:[],currentPreset:null,isLoading:!1},Ze=e=>e&&{...e,label:e.name,value:e.name};const $e=e=>({type:"PRESETS/LOAD_PRESETS",presets:e||[]}),ea=e=>({type:"PRESETS/SELECT_PRESET",currentPreset:e}),aa=()=>(e,a)=>{e({type:"PRESETS/LOADING_START"});const t=a().presets.currentPreset,r=g.a.get("name",t);return d.a.getItem("filterPresets").then(a=>{r&&g.a.find({name:r},a)?(e(ea(t)),e(Ye(t.filter))):e($e(a)),e({type:"PRESETS/LOADING_END"})})},ta=n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},n.a.createElement(L.m,null),"\u043f\u0440\u0435\u0441\u0435\u0442\u044b"),ra=()=>"\u043f\u0443\u0441\u0442\u043e",na={loadPresets:()=>(e,a)=>(e({type:"PRESETS/LOADING_START"}),d.a.getItem("filterPresets").then(a=>{e($e(a)),e({type:"PRESETS/LOADING_END"})})),savePreset:e=>(a,t)=>(a({type:"PRESETS/LOADING_START"}),d.a.getItem("filterPresets").then(r=>{const{filter:n}=t().top,s={name:e,filter:n};if(g.a.some({name:e},r)){if(window.confirm("Preset with this name already exists, replace it?")){const t=[...g.a.remove({name:e},r),s];a($e(t)),d.a.setItem("filterPresets",t)}}else{const e=[...r||[],s];a($e(e)),a(ea(s)),d.a.setItem("filterPresets",e)}a({type:"PRESETS/LOADING_END"})})),openPreset:aa,deletePreset:()=>(e,a)=>{e({type:"PRESETS/LOADING_START"});const t=g.a.get("name",a().presets.currentPreset);return d.a.getItem("filterPresets").then(a=>{if(g.a.find({name:t},a)&&window.confirm("Are you sure you want to delete selected preset?")){const r=g.a.remove({name:t},a);e($e(r)),d.a.setItem("filterPresets",r)}else e($e(a));e({type:"PRESETS/LOADING_END"})})},selectPreset:ea};class sa extends n.a.Component{constructor(...e){super(...e),this.state={},this.onChangeSelection=e=>{this.props.selectPreset(e.name)},this.onRewritePreset=()=>{const{currentPreset:e}=this.props;this.props.savePreset(e.name)},this.onSavePreset=()=>{const{name:e}=this.state;this.props.savePreset(e),this.setState({isAddingNew:!1})}}componentDidMount(){this.props.loadPresets()}render(){const{presets:e,currentPreset:a,isLoading:t}=this.props,{name:r,isAddingNew:s}=this.state;return n.a.createElement("div",null,n.a.createElement(Le,{overlayItem:ta},n.a.createElement("div",{className:"presets-control-overlay"},n.a.createElement(ye.a,{className:"select _margin-bottom",classNamePrefix:"select",placeholder:"\u043f\u0440\u0435\u0441\u0435\u0442\u044b...",options:e,value:a,onChange:this.props.selectPreset,noOptionsMessage:ra}),a&&n.a.createElement("div",{className:"buttons-presets _margin-bottom"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.props.openPreset,disabled:t},n.a.createElement(L.i,null)," \u043e\u0442\u043a\u0440\u044b\u0442\u044c"),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.onRewritePreset,disabled:t},n.a.createElement(L.r,null)," \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c"),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon",onClick:this.props.deletePreset,disabled:t},n.a.createElement(L.u,null)," \u0443\u0434\u0430\u043b\u0438\u0442\u044c")),!s&&n.a.createElement("div",{className:"buttons-presets _margin-bottom"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left _self-align-end",onClick:()=>this.setState({isAddingNew:!0}),disabled:t},n.a.createElement(L.o,null)," \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c")),s&&n.a.createElement("div",{className:"adding-new _margin-bottom"},n.a.createElement(be,{value:r,placeholder:"\u0438\u043c\u044f \u043f\u0440\u0435\u0441\u0435\u0442\u0430...",className:"form-control",onChange:e=>this.setState({name:e})}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:this.onSavePreset,disabled:!r||t},n.a.createElement(L.r,null)," \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:()=>this.setState({isAddingNew:!1}),disabled:t},"\u043e\u0442\u043c\u0435\u043d\u0430")))))}}var la=Object(i.b)(e=>({...e.presets}),na)(sa),ca=t(79),ia=t(50),oa=t.n(ia),ma=t(78),da=t.n(ma);var pa=({region:e})=>n.a.createElement("div",{className:"flag-img",style:{backgroundImage:"url(https://osu.ppy.sh/images/flags/".concat(e,".png)")}});W.a.addLocale(q.a);const ua=new W.a("ru-RU"),ha={flavour:"short",gradation:Y.a,units:["day","week","month"]},ga=e=>{const a=X()().startOf("day").diff(X()(e).startOf("day"),"days");return 0===a?"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":1===a?"\u0432\u0447\u0435\u0440\u0430":ua.format(e,ha).replace("\u043d\u0430\u0437\u0430\u0434","")},Ea=e=>({...e,results:g.a.flow(g.a.get("results"),g.a.toPairs,g.a.map(([a,t])=>{const r=g.a.find(e=>g.a.every(g.a.isNumber,[e.perfects,e.greats,e.goods,e.bads,e.misses]),t.results),n=r&&[r.perfects,r.greats,r.goods,r.bads,r.misses].reduce((e,a)=>e+a,0),[s,l]=oe(t.chart_label);return{song:t.track,sharedChartId:g.a.toNumber(a),chartLabel:t.chart_label,chartLevel:l,chartType:s,mix:t.mix,duration:t.duration,results:t.results.map((a,t)=>{let r={};if(n){const e=[a.perfects,a.greats,a.goods,a.bads,a.misses];let t=-1,s=0;1===e.filter((e,a)=>g.a.isNumber(e)?(s+=e,!1):(t=a,!0)).length&&(r[["perfect","great","good","bad","miss"][t]]=n-s)}return{id:a.id,playerId:a.player,nickname:e.players[a.player].nickname,nicknameArcade:e.players[a.player].arcade_name,originalChartMix:a.originalChartMix,originalChartLabel:a.originalChartLabel,originalScore:a.originalScore,date:a.gained,dateObject:new Date(a.gained),grade:a.grade,isExactDate:!!a.exact_gain_date,score:a.score,scoreIncrease:a.score_increase,calories:a.calories&&a.calories/1e3,perfect:a.perfects,great:a.greats,good:a.goods,bad:a.bads,miss:a.misses,combo:a.max_combo,mods:a.mods_list,isRank:!!a.rank_mode,isHJ:(a.mods_list||"").split(" ").includes("HJ"),...r}})}}),g.a.map(e=>({...e,latestScoreDate:e.results.reduce((e,a)=>a.date>e?a.date:e,e.results[0].date),results:e.results.map(a=>{const t=Math.sqrt(a.perfect)*g.a.toInteger(e.chartLevel)/2,r=t?Math.floor((100*t+60*a.great+30*a.good+-20*a.miss)/(t+a.great+a.good+a.bad+a.miss)*100)/100:null,n=a.perfect?Math.floor((100*a.perfect+60*a.great+30*a.good+-20*a.miss)/(a.perfect+a.great+a.good+a.bad+a.miss)*100)/100:null;return{...a,accuracy:r<0?0:100===n?100:r&&+r.toFixed(2),accuracyRaw:n,hasRankScore:g.a.some({playerId:a.playerId,isRank:!0},e.results)}})})),g.a.orderBy(["latestScoreDate","song","chartLevel"],["desc","asc","desc"]))(e)}),fa=(e,a,t=g.a.noop,n)=>{const[s,l]=Object(r.useState)(e),[c,i]=Object(r.useState)(e),o=Object(r.useRef)(a);Object(r.useEffect)(()=>{o.current!==a?(o.current=a,l(e),i(e)):e&&!g.a.isEqual(e,c)&&(l(c),i(e),t(c,e))},[e,t,c,s,a]);const m=Object(r.useCallback)(()=>{l(e),i(e)},[e]);return Object(r.useMemo)(()=>[c,s,m],[c,s,m])},ya=e=>Object(r.useCallback)(()=>{g.a.values(e).forEach(e=>e[2]())},[e]),va=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"];var ba=Object(i.b)(e=>({resultInfo:e.results.resultInfo,profiles:e.results.profiles}),null,null,{forwardRef:!0})(n.a.forwardRef(({res:e,chart:a,resultInfo:t,profiles:r,placeDifference:s,showProtagonistEloChange:l=!1,showProtagonistPpChange:i=!1,protagonistName:o=null,uniqueSelectedNames:m=[],leftProfile:d={},rightProfile:p={},isSocketView:u=!1},h)=>{const E=t[e.id]||{};let f=null;Ge?f=n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"debug-elo-info"}," ",E.startingRating&&Math.round(E.startingRating)," / ",E.ratingDiff>0?"+":"",E.ratingDiff&&Math.round(E.ratingDiff)," / ",E.pp&&E.pp.ppFixed,"pp")):e.nickname===o&&(l||i)&&(f=n.a.createElement(n.a.Fragment,null," / ",l&&E.ratingDiff&&n.a.createElement("span",null,"".concat(E.ratingDiff>0?"+":"").concat(Math.round(E.ratingDiff))),i&&E.pp&&n.a.createElement("span",null,E.pp.ppFixed,"pp")));const y=r[e.playerId]?n.a.createElement(pa,{region:r[e.playerId].region}):null,v=m.indexOf(e.nickname);return n.a.createElement("tr",{key:e.id,ref:h,className:w()({empty:!e.accuracy,latest:new Date(a.latestScoreDate)-new Date(e.date)<432e5,left:e.nickname===d.name,right:e.nickname===p.name}),style:v>-1?{background:va[v]+"3A",outline:"1px solid ".concat(va[v],"A0")}:{}},!u&&n.a.createElement("td",{className:"place"},e.isSecondOccurenceInResults?"":"#".concat(e.topPlace)),n.a.createElement("td",{className:"nickname",style:v>-1?{fontWeight:"bold"}:{}},n.a.createElement("div",{className:"nickname-container"},y,n.a.createElement("span",{className:"nickname-text"},n.a.createElement(c.c,{exact:!0,to:b.getPath({id:e.playerId})},e.nickname),!!s&&n.a.createElement("span",{className:"change-holder up"},n.a.createElement("span",null,s),n.a.createElement(L.b,null)),f),!u&&n.a.createElement("div",{className:"mods-container"},u&&e.mods&&e.mods.split(" ").filter(e=>e.includes("AV")).map(e=>n.a.createElement("div",{className:"mod av-mod"},n.a.createElement("div",{className:"av-text"},"AV"),n.a.createElement("div",{className:"av-number"},e.replace("AV","")))),u&&e.mods&&e.mods.split(" ").filter(e=>e.endsWith("X")).map(e=>n.a.createElement("div",{className:"mod x-mod"},n.a.createElement("div",{className:"x-number"},e))),e.isRank&&n.a.createElement("div",{className:"mod vj"},e.mods?"R":"R?"),e.isHJ&&n.a.createElement("div",{className:"mod hj"},"HJ")))),n.a.createElement("td",{className:"score"},n.a.createElement(Le,{overlayClassName:"score-overlay-outer",overlayItem:n.a.createElement("span",{className:"score-span"},e.scoreIncrease>.8*e.score&&"*",oa()(e.score).format("0,0")),placement:"top"},n.a.createElement("div",{className:"score-overlay"},Ge&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"result id: "),e.id),n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"player id: "),e.playerId)),n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u0438\u0433\u0440\u043e\u043a: "),n.a.createElement(c.c,{exact:!0,to:b.getPath({id:e.playerId})},e.nickname," (",e.nicknameArcade,")")),!!ee(e,a)&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},"\u043e\u043f\u044b\u0442: "),"+",oa()(ee(e,a)).format("0,0")),g.a.isNumber(E.startingRating)&&g.a.isNumber(E.ratingDiff)&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},"\u044d\u043b\u043e: ",E.startingRating.toFixed(0)," "),E.ratingDiff>=0?"+".concat(E.ratingDiff.toFixed(0)):E.ratingDiff.toFixed(0)),E.pp&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},"pp: "),n.a.createElement("span",null,E.pp.ppFixed,"pp")),!e.isExactDate&&n.a.createElement("div",{className:"warning"},n.a.createElement(L.h,null),"\u0440\u0435\u043a\u043e\u0440\u0434 \u0432\u0437\u044f\u0442 \u0441 my best. \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430"),!!e.isExactDate&&n.a.createElement(n.a.Fragment,null,!!e.mods&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043c\u043e\u0434\u044b: "),e.mods),!!e.calories&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043a\u043a\u0430\u043b: "),e.calories),!!e.scoreIncrease&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043f\u0440\u0438\u0440\u043e\u0441\u0442: "),"+",oa()(e.scoreIncrease).format("0,0")),e.originalChartMix&&n.a.createElement("div",null,n.a.createElement("div",{className:"warning"},n.a.createElement(L.h,null),"\u0431\u044b\u043b\u043e \u0441\u044b\u0433\u0440\u0430\u043d\u043e \u043d\u0430 ",e.originalChartMix),e.originalChartLabel&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0447\u0430\u0440\u0442: "),e.originalChartLabel),e.originalScore&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u043a\u043e\u0440: "),e.originalScore)),e.scoreIncrease>.8*e.score&&"* \u0441\u0430\u0439\u0442\u0440\u0438\u0434")))),n.a.createElement("td",{className:"grade"},n.a.createElement("div",{className:"img-holder"},e.grade&&"?"!==e.grade&&n.a.createElement("img",{src:"".concat(".","/grades/").concat(e.grade,".png"),alt:e.grade}),"?"===e.grade&&null)),u&&n.a.createElement("td",{className:w()("mods",{vj:e.isRank,hj:e.isHJ})},n.a.createElement("div",{className:"mods-container"},u&&e.mods&&e.mods.split(" ").filter(e=>e.includes("AV")).map(e=>n.a.createElement("div",{className:"av-mod"},n.a.createElement("div",{className:"av-text"},"AV"),n.a.createElement("div",{className:"av-number"},e.replace("AV","")))),u&&e.mods&&e.mods.split(" ").filter(e=>e.endsWith("X")).map(e=>n.a.createElement("div",{className:"x-mod"},n.a.createElement("div",{className:"x-number"},e))),e.isRank&&n.a.createElement("div",{className:"inner"},e.isExactDate?"R":"R?"),e.isHJ&&n.a.createElement("div",{className:"inner"},"HJ"))),n.a.createElement("td",{className:"number miss"},e.miss),n.a.createElement("td",{className:"number bad"},e.bad),n.a.createElement("td",{className:"number good"},e.good),n.a.createElement("td",{className:"number great"},e.great),n.a.createElement("td",{className:"number perfect"},e.perfect),n.a.createElement("td",{className:"combo"},e.combo,e.combo?"x":""),n.a.createElement("td",{className:"accuracy"},100===e.accuracy?100:e.accuracy?e.accuracy.toFixed(2):"",e.accuracy?"%":""),n.a.createElement("td",{className:w()("date",{latest:e.date===a.latestScoreDate})},u?ga(e.dateObject):n.a.createElement(da.a,{content:ce(e),tooltipClassName:"pumpking-tooltip"},ga(e.dateObject),e.isExactDate?"":"?")))})),Na=({type:e,level:a})=>n.a.createElement("div",{className:w()("chart-name",{single:"S"===e,singlep:"SP"===e,doublep:"DP"===e,double:"D"===e,coop:"COOP"===e})},n.a.createElement("span",{className:"chart-letter"},e),n.a.createElement("span",{className:"chart-number"},a));const Sa=n.a.forwardRef(({playersHiddenStatus:e={},sharedCharts:a={},chart:t,showHiddenPlayers:s=!1,showProtagonistEloChange:l=!1,showProtagonistPpChange:i=!1,uniqueSelectedNames:o=[],protagonistName:m=null,leftProfile:d={},rightProfile:p={},isSocketView:u=!1},h)=>{const[f,y]=Object(r.useState)(null),[v,b]=Object(r.useState)(!s);Object(r.useEffect)(()=>{b(!s)},[s]);const N=g.a.first(f)||t;Ge&&console.log(N,f);let S=1;const k=[];let P=0;const O=N.results.map((a,t)=>{const r=v&&(e[a.playerId]||!1),n=k.includes(a.nickname);return k.push(a.nickname),0===t?S=1:n||a.score===g.a.get([t-1,"score"],N.results)||(S+=1),r&&P++,{...a,topPlace:S,isSecondOccurenceInResults:n,isPlayerHidden:r}}),R=g.a.throttle(260,e=>{const a=g.a.drop(1,f);y(1===g.a.size(a)?null:a)}),x=g.a.throttle(260,e=>{g.a.isEmpty(O)&&y(null);const t=g.a.maxBy("date",O);if(!t)return;const r=t.playerId,n=a[e.sharedChartId].previousResults,s=g.a.findLast(e=>e.playerId===r&&e.isRank===t.isRank&&e.date<t.date,n),l=g.a.orderBy("score","desc",g.a.compact(g.a.map(e=>e.id===t.id?s:e,O))),c=g.a.maxBy("date",l),i={...e,latestScoreDate:c&&c.date,results:l};g.a.isEmpty(l)?y(null):y([i,...f||[e]])}),C=!g.a.isEmpty(f),I=g.a.countBy(a=>!e[a],N.eachResultPlayerIds).true,A=C?1+I-g.a.size(f):I,_=!(1===A&&1===I),D=N.interpolatedDifficulty||g.a.get("interpolatedDifficulty",a[N.sharedChartId]);return n.a.createElement("div",{className:"song-block",ref:h},n.a.createElement("div",{className:"song-name"},n.a.createElement(Na,{type:N.chartType,level:N.chartLevel}),u?n.a.createElement("div",{className:"song-name-text"},D?"(".concat(D.toFixed(1),") "):"",N.song):n.a.createElement("div",{className:"song-name-text"},n.a.createElement(c.c,{exact:!0,to:E.sharedChart.getPath({sharedChartId:N.sharedChartId})},N.song)," ",n.a.createElement("span",{className:"_grey-text"},"(",D&&D.toFixed(1),")")),!u&&n.a.createElement("div",{className:"youtube-link"},n.a.createElement("a",{href:"https://youtube.com/results?".concat(De.a.stringify({search_query:"".concat(N.song," ").concat(N.chartLabel).replace(/( -)|(- )/g," ")})),target:"_blank",rel:"noopener noreferrer"},n.a.createElement(L.v,null))),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"right-side-block"},P>0&&n.a.createElement("div",{className:w()("players-hidden-count _grey-text",{"_on-hover":!u})},"\u0441\u043a\u0440\u044b\u0442\u043e: ",P),(P>0||!v)&&!u&&n.a.createElement("div",{className:"globe-icon _on-hover",onClick:()=>b(!v)},n.a.createElement(L.k,null)),!u&&n.a.createElement("div",{className:w()("undo-result-button _on-hover",{active:C})},n.a.createElement(L.d,{className:w()("backward-btn",{disabled:!_}),onClick:()=>_&&x(N)}),n.a.createElement("span",{className:"number"},A,"/",I),n.a.createElement(L.j,{className:w()("forward-btn",{disabled:!C}),onClick:()=>C&&R(N)})))),n.a.createElement("div",{className:"charts"},!g.a.isEmpty(O)&&n.a.createElement("div",{className:"chart"},n.a.createElement("div",{className:"results"},n.a.createElement("table",null,n.a.createElement(ca.a,{enterAnimation:"fade",leaveAnimation:"fade",typeName:"tbody",maintainContainerHeight:!0,duration:250},O.map((e,a)=>{const t=e.nickname===m;if(e.isPlayerHidden&&!t||e.isUnknownPlayer&&0!==a)return null;let r,s;if(e.scoreIncrease&&e.date===N.latestScoreDate){const t=e.score-e.scoreIncrease;s=g.a.findLastIndex(e=>e.score>t,O),r=s-a}return n.a.createElement(ba,{key:e.isRank+"_"+e.nickname,chart:N,results:O,res:e,placeDifference:r,showProtagonistEloChange:l,showProtagonistPpChange:i,uniqueSelectedNames:o,protagonistName:m,leftProfile:d,rightProfile:p,isSocketView:u})})))))))});var ka=Object(i.b)((e,a)=>({sharedCharts:e.results.sharedCharts,playersHiddenStatus:a.playersHiddenStatus||e.preferences.data.playersHiddenStatus}),null,null,{forwardRef:!0})(Sa);const Pa=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET?"results/best/trusted":"results/best",Oa={isLoading:!1,data:null,lastUpdatedOn:null};const Ra=(e,a)=>({type:"SET_CHARTS",data:e,lastUpdatedOn:a}),xa=()=>async(e,a)=>{e({type:"CHARTS_LOADING"}),a().charts.data||await e(async(e,a)=>{const t=await d.a.getItem("resultsCache");t&&e(Ra(t.data,t.lastUpdatedOn))});const{data:t,lastUpdatedOn:r}=a().charts,n=r&&r.indexOf(".")>-1?r.slice(0,r.indexOf(".")):r,s=De.a.stringify({since:n}),l="".concat(j,"/").concat(Pa,"?").concat(s),{charts:c,lastUpdatedAt:i}=await e(T({url:l})),o={...t||{},...c};await e(((e,a)=>(t,r)=>{d.a.setItem("resultsCache",{data:e,lastUpdatedOn:a}),t(Ra(e,a))})(o,i));const m=a().players.data,{profiles:p,sharedCharts:u,battles:h}=((e,a)=>{const t=e=>"".concat(e.sharedChartId,"-").concat(e.playerId,"-").concat(e.isRank),r=e=>"".concat(e.sharedChartId,"-").concat(e.playerId),n={},s=[],l=[];let c={};for(let i in e){const s=e[i],o=s.chart,m=g.a.toUpper(o.chart_label),[d,p]=oe(m);n[i]={song:o.track_name,chartLabel:m,chartLevel:p,chartType:d,duration:o.duration,sharedChartId:i,maxTotalSteps:o.max_total_steps,results:[],previousResults:[],eachResultPlayerIds:[],latestScoreDate:g.a.last(s.results).gained,maxScore:null};const u={},h={};g.a.forEachRight(e=>{if(!a[e.player])return;const s=n[i],o=de(e,a,s,i),m=t(o),d=r(o),p=g.a.sortedLastIndexBy(e=>e.dateObject,o,l);if(l.splice(p,0,o),s.eachResultPlayerIds.push(o.id),(!h[d]||me[h[d].grade]<me[o.grade])&&(h[d]&&(h[d].isBestGradeOnChart=!1),o.isBestGradeOnChart=!0,h[d]=o),u[m])o.isIntermediateResult=!0,s.previousResults.push(o);else{const e=g.a.sortedIndexBy(e=>-e.score,o,s.results);if(s.results.splice(e,0,o),u[m]=o,!o.isRank)if(o.accuracy){const e=he(o);s.maxScore<e&&(s.maxScore=e)}else s.maxScore&&s.maxScore<o.score&&(s.maxScore=o.score);o.isUnknownPlayer||o.isIntermediateResult||(c[o.playerId]||pe(o,c,a),ue(o,s,c))}},e[i].results)}return l.forEach(e=>{if(!e.isUnknownPlayer){const a=n[e.sharedChartId];for(let t=0;t<a.results.length;t++){const r=a.results[t];if(e.dateObject<r.dateObject)break;!r.isUnknownPlayer&&r.isRank===e.isRank&&r.playerId!==e.playerId&&e.score&&r.score&&s.push([e,r,a])}}}),{profiles:c,sharedCharts:n,battles:s}})(o,m);e({type:"TOP/SUCCESS",data:g.a.values(u),players:g.a.flow(g.a.toPairs,g.a.map(([e,a])=>({...a,id:g.a.toInteger(e)})))(m),profiles:p,sharedCharts:u}),e({type:"CHARTS_LOADING_FINISH"});const{tracklist:E}=a(),f={sharedCharts:u,profiles:p,tracklist:E,battles:h,debug:Ge};let y;if(window.Worker){const e=new Me.a;y=await e.getProcessedProfiles(f),e.terminate()}else y=He(f);Ge&&console.log(y.logText),Ge&&console.log("Processed profiles:",Object.values(y.profiles).filter(e=>e.pp).sort((e,a)=>a.pp.pp-e.pp.pp)),e({type:"TOP/PROFILES_UPDATE",...y}),e(Je(y.profiles))};var Ca=t(25),La=t(170);const Ia=Object(Ca.a)(e=>e.results.players,e=>e.user.data.player.id,(e,a)=>g.a.flow(g.a.toPairs,g.a.map(([,{nickname:e,arcade_name:t,id:r,region:n}])=>({label:"".concat(e," (").concat(t,")"),value:e,isCurrentPlayer:a===r})),g.a.sortBy(e=>e.isCurrentPlayer?"!":g.a.toLower(e.label)))(e)),wa=Object(Ca.a)(e=>e.results.data,e=>e.results.sharedCharts,e=>e.results.filter,e=>e.results.resultInfo,e=>e.preferences.data,(e,a,t=Ke,r={},n)=>{const s=performance.now(),l=n.playersHiddenStatus,c=t.showHiddenFromPreferences,i=g.a.map("value",t.players),o=g.a.map("value",t.playersOr),m=g.a.map("value",t.playersNot),d=g.a.get("value",t.sortingType),p=g.a.get("value",t.rank)||S,u=[N.PROTAGONIST,N.RANK_ASC,N.RANK_DESC,N.PP_ASC,N.PP_DESC,N.NEW_SCORES_PLAYER].includes(d)?g.a.get("value",t.protagonist):null,h=g.a.map("value",t.excludeAntagonists),E=[g.a.orderBy([e=>g.a.max(g.a.map(e=>c||!l[e.playerId]?e.dateObject.getTime():0,e.results))],["desc"])],f=u?[g.a.orderBy([e=>g.a.max(g.a.map(e=>e.nickname===u?e.dateObject.getTime():0,e.results))],["desc"])]:E,y=[g.a.filter(e=>g.a.map("nickname",e.results).includes(u)),g.a.map(e=>{const a=g.a.findIndex({nickname:u},e.results),t=e.results[a].score,r=g.a.flow([g.a.take(a),g.a.uniqBy("nickname"),g.a.remove(e=>h.includes(e.nickname)||e.score===t)])(e.results),n=Math.sqrt(g.a.reduce((e,a)=>e+(a.score/t-.99)**2,0,r));return{...e,distanceFromProtagonist:n}}),g.a.orderBy(["distanceFromProtagonist"],["desc"])],v=(e,a="desc")=>[g.a.filter(e=>g.a.map("nickname",e.results).includes(u)),g.a.orderBy([t=>{const n=g.a.find({nickname:u},t.results),s=r[n.id]||{};return g.a.getOr("desc"===a?-1/0:1/0,e,s)}],[a])],b=e=>[g.a.filter(e=>g.a.map("nickname",e.results).includes(u)),g.a.orderBy([a=>{const t=g.a.find({nickname:u},a.results),n=r[t.id];return g.a.getOr("asc"===e?1/0:-1/0,"ratingDiff",n)}],[e])],x=(e="desc")=>[g.a.orderBy([e=>{const t=a[e.sharedChartId];return g.a.getOr(g.a.toNumber(e.chartLevel),"interpolatedDifficulty",t)}],[e])],L={[N.DEFAULT]:E,[N.NEW_SCORES_PLAYER]:f,[N.PROTAGONIST]:y,[N.RANK_ASC]:b("asc"),[N.RANK_DESC]:b("desc"),[N.PP_ASC]:v("pp.ppRatio","asc"),[N.PP_DESC]:v("pp.pp"),[N.EASIEST_SONGS]:x("asc"),[N.HARDEST_SONGS]:x("desc")}[d]||E,I=g.a.flow(g.a.compact([g.a.map(e=>{let a=null;const t=[],r=e.results.filter((e,r)=>{const n=!p||p===S||(p===P?e.isRank:p===O?!e.isRank:p!==k||!t.includes(e.playerId));p===k&&t.push(e.playerId);const s=(!e.isUnknownPlayer||0===r)&&n;return s&&(!a||a<e.date)&&(a=e.date),s},e.results);return{...e,latestScoreDate:a,results:r}}),t.chartRange&&(e=>((e,a)=>{const t=g.a.getOr(R,"range",e),r=g.a.getOr(null,"type",e),n=g.a.getOr(C,"duration",e);return g.a.filter(e=>!(n!==C&&!n.includes(e.duration))&&(e.chartLevel>=t[0]&&e.chartLevel<=t[1]&&(!r||e.chartType.startsWith(r))),a)})(t.chartRange,e)),(i.length||o.length||m.length)&&g.a.filter(e=>{const a=g.a.map("nickname",e.results);return(!i.length||g.a.every(e=>a.includes(e),i))&&(!o.length||g.a.some(e=>a.includes(e),o))&&(!m.length||!g.a.some(e=>a.includes(e),m))}),g.a.filter(e=>g.a.size(e.results)),...L,t.song&&(e=>Object(La.a)(e,t.song.trim(),{keys:["song"]}))]))(e);return console.log("Sorting took",performance.now()-s,"ms"),I}),Aa=Object(Ca.a)(e=>e.results.data,(e,a)=>a.match.params.sharedChartId,(e,a)=>{const t=g.a.toNumber(a);return e.filter(e=>e.sharedChartId===t)}),_a=[{label:"\u043e\u0442 \u043d\u043e\u0432\u044b\u0445 \u0441\u043a\u043e\u0440\u043e\u0432",value:N.DEFAULT},{label:"\u043e\u0442 \u043d\u043e\u0432\u044b\u0445 \u0441\u043a\u043e\u0440\u043e\u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430",value:N.NEW_SCORES_PLAYER},{label:"\u043e\u0442 \u0445\u0443\u0434\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (\u044d\u043b\u043e)",value:N.RANK_ASC},{label:"\u043e\u0442 \u043b\u0443\u0447\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (\u044d\u043b\u043e)",value:N.RANK_DESC},{label:"\u043e\u0442 \u0445\u0443\u0434\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (pp)",value:N.PP_ASC},{label:"\u043e\u0442 \u043b\u0443\u0447\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (pp)",value:N.PP_DESC},{label:"\u043e\u0442 \u043b\u0451\u0433\u043a\u0438\u0445 \u0447\u0430\u0440\u0442\u043e\u0432",value:N.EASIEST_SONGS},{label:"\u043e\u0442 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0447\u0430\u0440\u0442\u043e\u0432",value:N.HARDEST_SONGS}],Da=[{label:"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0441\u043a\u043e\u0440\u044b",value:S},{label:"\u043e\u0434\u0438\u043d \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043a\u043e\u0440 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430 (\u0440\u0430\u043d\u043a \u0438\u043b\u0438 \u043d\u0435\u0442)",value:k},{label:"\u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0440\u0430\u043d\u043a\u0435",value:P},{label:"\u0442\u043e\u043b\u044c\u043a\u043e \u0431\u0435\u0437 \u0440\u0430\u043d\u043a\u0430",value:O}],Ta={fetchChartsData:xa,setFilter:Ye,resetFilter:()=>({type:"TOP/RESET_FILTER"}),selectPreset:ea,openPreset:aa};class Ma extends r.Component{constructor(...e){super(...e),this.state={showItemsCount:20},this.setFilter=g.a.curry((e,a)=>{const t={...this.props.filter,[e]:a};this.props.setFilter(t),d.a.setItem("filter",t)}),this.resetFilter=()=>{this.props.resetFilter(),d.a.setItem("filter",Ke)},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()},this.onTypeSongName=g.a.debounce(300,e=>{this.setFilter("song",e)})}renderSimpleSearch(){const{isLoading:e,filter:a}=this.props;return n.a.createElement("div",{className:"simple-search"},n.a.createElement("div",{className:"song-name _margin-right _margin-bottom"},n.a.createElement(be,{value:a.song||"",placeholder:"\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0441\u043d\u0438...",className:"form-control",onChange:this.onTypeSongName})),n.a.createElement("div",{className:"chart-range _margin-right _margin-bottom"},n.a.createElement(Ae,{filterValue:a.chartRange,onChange:this.setFilter("chartRange")})),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"_flex-row _margin-bottom"},n.a.createElement(la,null),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.resetFilter},n.a.createElement(L.q,null)," \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b"),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(L.s,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")))}renderFilters(){const{players:e,filter:a}=this.props;return n.a.createElement("div",{className:"filters"},n.a.createElement("div",{className:"people-filters"},n.a.createElement("label",{className:"label"},"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0447\u0430\u0440\u0442\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u044b\u0433\u0440\u0430\u043b:"),n.a.createElement("div",{className:"players-block"},n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},"\u043a\u0430\u0436\u0434\u044b\u0439 \u0438\u0437 \u044d\u0442\u0438\u0445"),n.a.createElement(ye.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",isMulti:!0,options:e,value:g.a.getOr(null,"players",a),onChange:this.setFilter("players")})),n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},"\u0438 \u0445\u043e\u0442\u044c \u043e\u0434\u0438\u043d \u0438\u0437 \u044d\u0442\u0438\u0445"),n.a.createElement(ye.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",isMulti:!0,options:e,value:g.a.getOr(null,"playersOr",a),onChange:this.setFilter("playersOr")})),n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},"\u0438 \u043d\u0438\u043a\u0442\u043e \u0438\u0437 \u044d\u0442\u0438\u0445"),n.a.createElement(ye.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",isMulti:!0,options:e,value:g.a.getOr(null,"playersNot",a),onChange:this.setFilter("playersNot")})))),n.a.createElement("div",{className:"people-filters"},n.a.createElement("div",{className:"players-block"},n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0440\u0430\u043d\u043a:"),n.a.createElement(ye.a,{closeMenuOnSelect:!1,className:"select",classNamePrefix:"select",placeholder:"...",options:Da,value:g.a.getOr(null,"rank",a)||S,onChange:this.setFilter("rank")})))),n.a.createElement("div",null,n.a.createElement(Ne,{checked:g.a.getOr(!1,"showHiddenFromPreferences",a),onChange:this.setFilter("showHiddenFromPreferences")},"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0441\u043a\u0440\u044b\u0442\u044b\u0445 \u0438\u0433\u0440\u043e\u043a\u043e\u0432")))}renderSortings(){const{players:e,filter:a}=this.props;return n.a.createElement("div",{className:"sortings"},n.a.createElement("div",null,n.a.createElement("label",{className:"label"},"\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430:"),n.a.createElement(ye.a,{placeholder:"\u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0443",className:"select",classNamePrefix:"select",isClearable:!1,options:_a,value:g.a.getOr(_a[0],"sortingType",a),onChange:this.setFilter("sortingType")})),[N.PROTAGONIST,N.RANK_ASC,N.RANK_DESC,N.PP_ASC,N.PP_DESC,N.NEW_SCORES_PLAYER].includes(g.a.get("sortingType.value",a))&&n.a.createElement("div",null,n.a.createElement("label",{className:"label"},"\u0438\u0433\u0440\u043e\u043a:"),n.a.createElement(ye.a,{className:w()("select players",{"red-border":!g.a.get("protagonist",a)}),classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:e,value:g.a.getOr(null,"protagonist",a),onChange:this.setFilter("protagonist")})),[N.PROTAGONIST].includes(g.a.get("sortingType.value",a))&&n.a.createElement("div",null,n.a.createElement("label",{className:"label"},"\u043d\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0432 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0438:"),n.a.createElement(ye.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:e,isMulti:!0,value:g.a.getOr([],"excludeAntagonists",a),onChange:this.setFilter("excludeAntagonists")})))}render(){const{isLoading:e,isChartView:a,filteredData:t,error:r,filter:s,presets:l}=this.props,{showItemsCount:i}=this.state,o=t.length>i,m=g.a.slice(0,i,t),d=g.a.get("sortingType.value",s),p=[N.RANK_ASC,N.RANK_DESC].includes(d),u=[N.PP_ASC,N.PP_DESC].includes(d),h=[N.PROTAGONIST,N.RANK_ASC,N.RANK_DESC,N.PP_ASC,N.PP_DESC,N.NEW_SCORES_PLAYER].includes(d),f=g.a.get("protagonist.value",s),y=g.a.slice(0,va.length,g.a.uniq(g.a.compact([h&&f,...g.a.map("value",s.players),...g.a.map("value",s.playersOr)])));return n.a.createElement("div",{className:"leaderboard-page"},n.a.createElement("div",{className:"content"},a&&n.a.createElement("div",{className:"simple-search"},n.a.createElement(c.c,{exact:!0,to:E.path},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon"},n.a.createElement(L.c,null)," \u043a\u043e \u0432\u0441\u0435\u043c \u0447\u0430\u0440\u0442\u0430\u043c"))),!a&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"search-block"},this.renderSimpleSearch(),n.a.createElement(Se,{title:"\u0444\u0438\u043b\u044c\u0442\u0440\u044b"},this.renderFilters()),n.a.createElement(Se,{title:"\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430"},this.renderSortings())),!!l.length&&n.a.createElement("div",{className:"presets-buttons"},n.a.createElement("span",null,"\u043f\u0440\u0435\u0441\u0435\u0442\u044b:"),l.map(e=>n.a.createElement(ve,{key:e.name,text:e.name,className:"btn btn-sm btn-dark _margin-right",active:g.a.get("filter",e)===s,onToggle:()=>{this.props.selectPreset(e),this.props.openPreset()}})))),n.a.createElement("div",{className:"top-list"},e&&n.a.createElement(A,null),g.a.isEmpty(t)&&!e&&(r?r.message:"\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"),!e&&m.map((e,t)=>n.a.createElement(ka,{showHiddenPlayers:a||s.showHiddenFromPreferences,key:e.sharedChartId,chart:e,chartIndex:t,showProtagonistEloChange:p,showProtagonistPpChange:u,uniqueSelectedNames:y,protagonistName:f})),!e&&o&&n.a.createElement("button",{className:"btn btn-sm btn-primary",onClick:()=>this.setState(e=>({showItemsCount:e.showItemsCount+10}))},"show more..."))))}}var Fa=Object(i.b)((e,a)=>{const t=!!a.match.params.sharedChartId;return{isChartView:t,players:Ia(e),filteredData:t?Aa(e,a):wa(e),filter:t?Ke:e.results.filter,error:e.charts.error||e.tracklist.error,isLoading:e.charts.isLoading||e.tracklist.isLoading,presets:e.presets.presets}},Ta)(Ma);t(264);const Ba=e=>n.a.createElement("img",{src:"".concat(".","/grades/").concat(e,".png"),alt:e});function ja({ranking:e,isLoading:a,preferences:t,updatePreferences:r}){return n.a.createElement("div",{className:"ranking-list"},g.a.isEmpty(e)&&!a&&"\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",a&&n.a.createElement(A,null),!a&&n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{className:"place"}),n.a.createElement("th",{className:"change"}),n.a.createElement("th",{className:"exp-rank"},"rank"),n.a.createElement("th",{className:"name"},"name"),n.a.createElement("th",{className:"name name-piu"},"piu name"),n.a.createElement("th",{className:"rating"},"elo"),n.a.createElement("th",{className:"rating-change-cell"}),n.a.createElement("th",{className:"rating"},"pp"),n.a.createElement("th",{className:"grades sss"},Ba("SSS")),n.a.createElement("th",{className:"grades ss"},Ba("SS")),n.a.createElement("th",{className:"grades s"},Ba("S")),n.a.createElement("th",{className:"grades a"},Ba("A+")),n.a.createElement("th",{className:"grades b"},Ba("B")),n.a.createElement("th",{className:"grades c"},Ba("C")),n.a.createElement("th",{className:"grades d"},Ba("D")),n.a.createElement("th",{className:"grades f"},Ba("F")),n.a.createElement("th",{className:"playcount"},"scores"),n.a.createElement("th",{className:"accuracy"},"accuracy"),n.a.createElement("th",{className:"hide-col"}," "))),n.a.createElement("tbody",null,e.map((e,a)=>{const s=t.playersHiddenStatus[e.id];return s&&!t.showHiddenPlayersInRanking?null:n.a.createElement("tr",{className:w()("player",{"hidden-player":s}),key:e.name},n.a.createElement("td",{className:"place"},0===a?n.a.createElement(te.e,null):"#".concat(a+1)),n.a.createElement("td",{className:"change"},e.change>0&&n.a.createElement("div",{className:"change-holder up"},n.a.createElement("span",null,e.change),n.a.createElement(L.b,null)),e.change<0&&n.a.createElement("div",{className:"change-holder down"},n.a.createElement("span",null,-e.change),n.a.createElement(L.a,null)),!!e.change&&g.a.isString(e.change)&&n.a.createElement("div",{className:"change-holder text"},n.a.createElement("span",null,e.change))),n.a.createElement("td",{className:"exp-rank"},ae(e.expRank)),n.a.createElement("td",{className:"name"},n.a.createElement("div",{className:"name-container"},n.a.createElement(pa,{region:e.region}),n.a.createElement(c.c,{exact:!0,to:b.getPath({id:e.id})},e.name))),n.a.createElement("td",{className:"name name-piu"},n.a.createElement(c.c,{exact:!0,to:b.getPath({id:e.id})},e.nameArcade)),n.a.createElement("td",{className:"rating"},e.rating),n.a.createElement("td",{className:"rating-change-cell"},!!e.prevRating&&e.prevRating!==e.rating&&n.a.createElement("span",{className:w()("rating-change",{down:e.prevRating>e.rating,up:e.prevRating<e.rating})},e.prevRating<e.rating?"+":"",e.rating-e.prevRating)),n.a.createElement("td",{className:"rating secondary"},Math.round(e.pp.pp)),n.a.createElement("td",{className:"grades sss"},e.grades.SSS),n.a.createElement("td",{className:"grades ss"},e.grades.SS),n.a.createElement("td",{className:"grades s"},e.grades.S),n.a.createElement("td",{className:"grades a"},e.grades.A),n.a.createElement("td",{className:"grades b"},e.grades.B),n.a.createElement("td",{className:"grades c"},e.grades.C),n.a.createElement("td",{className:"grades d"},e.grades.D),n.a.createElement("td",{className:"grades f"},e.grades.F),n.a.createElement("td",{className:"playcount"},e.count),n.a.createElement("td",{className:"accuracy"},e.accuracy?"".concat(e.accuracy.toFixed(2),"%"):""),n.a.createElement("td",{className:"hide-col"},n.a.createElement(Ne,{onChange:()=>{r(g.a.set(["playersHiddenStatus",e.id],!s,t))},checked:!s})))}))))}function Ha(){return n.a.createElement("div",{className:"faq"},n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0440\u0435\u0439\u0442\u0438\u043d\u0433?"),n.a.createElement("div",{className:"answer"},"A: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f ",n.a.createElement("a",{href:"https://en.wikipedia.org/wiki/Elo_rating_system"},"\u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u042d\u043b\u043e"),", \u0448\u0438\u0440\u043e\u043a\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0439 \u0432 \u0448\u0430\u0445\u043c\u0430\u0442\u0430\u0445 \u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0438\u0433\u0440\u0430\u0445, \u0441\u043b\u0435\u0433\u043a\u0430 \u043c\u043e\u0434\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u043e\u0434 \u0443\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0433\u0440\u044b \u043d\u0430 \u043f\u0430\u043c\u043f\u0435. \u0421\u0440\u0435\u0434\u043d\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 - 1000. \u041a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442 \u041a \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u0443\u0440\u043e\u0432\u043d\u044f \u0447\u0430\u0440\u0442\u0430 (\u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0435 \u0447\u0430\u0440\u0442\u044b \u0441\u0438\u043b\u044c\u043d\u0435\u0435 \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0440\u0435\u0439\u0442\u0438\u043d\u0433). \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0447\u043a\u043e\u0432 \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u0437\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 (\u043c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0439 \u043e\u0442\u0440\u044b\u0432 \u043e\u0442 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u0438\u043a\u0430 \u043d\u0435 \u0434\u0430\u0441\u0442 \u0442\u0430\u043a \u043c\u043d\u043e\u0433\u043e \u043e\u0447\u043a\u043e\u0432 \u043a\u0430\u043a \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u043e\u0442\u0440\u044b\u0432).")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u0440\u0440 \u0438 \u0447\u0435\u043c \u043e\u043d\u043e \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u043e\u0442 \u044d\u043b\u043e?"),n.a.createElement("div",{className:"answer"},"A: \u0420\u0420 (performance points) - \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043e\u0447\u043a\u043e\u0432, \u0432\u0437\u044f\u0442\u0430\u044f \u0438\u0437 osu!. \u042d\u043b\u043e - \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0430, \u0432\u0437\u044f\u0442\u0430\u044f \u0438\u0437 \u0448\u0430\u0445\u043c\u0430\u0442. \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043e\u0442\u043b\u0438\u0447\u0438\u044f:",n.a.createElement("br",null),"\u0421 \u044d\u043b\u043e \u0442\u0432\u043e\u0438 \u043e\u0447\u043a\u0438 \u0437\u0430\u0432\u0438\u0441\u044f\u0442 \u043e\u0442 \u0434\u0440\u0443\u0433\u0438\u0445 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u043d\u0430 \u044d\u0442\u043e\u043c \u0447\u0430\u0440\u0442\u0435, \u0441 \u0440\u0440 \u0442\u0432\u043e\u0438 \u043e\u0447\u043a\u0438 \u0437\u0430\u0432\u0438\u0441\u044f\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0442\u044b \u0441\u044b\u0433\u0440\u0430\u0435\u0448\u044c \u0447\u0430\u0440\u0442.",n.a.createElement("br",null),"\u0421 \u044d\u043b\u043e \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u0442\u0435\u0440\u044f\u0442\u044c \u043e\u0447\u043a\u0438 \u0438\u043b\u0438 \u0437\u0430\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430 \u0438\u0445 \u043f\u043e\u0442\u0435\u0440\u044f\u0442\u044c, \u0441 \u0440\u0440 \u043c\u043e\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430\u0431\u0438\u0440\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u0447\u043a\u043e\u0432.",n.a.createElement("br",null),"\u0421 \u044d\u043b\u043e \u043d\u0430\u043c\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0449\u0435 \u043a\u043e\u0433\u043e-\u0442\u043e \u043e\u0431\u043e\u0433\u043d\u0430\u0442\u044c, \u0441 \u0440\u0440 \u043b\u044e\u0434\u0438 \u0440\u0435\u0434\u043a\u043e \u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f \u043c\u0435\u0441\u0442\u0430\u043c\u0438 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435.",n.a.createElement("br",null),"\u042d\u043b\u043e \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u0442\u043e \u043a\u043e\u0433\u043e \u043e\u0431\u044b\u0433\u0440\u044b\u0432\u0430\u0435\u0442 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0432\u0440\u0435\u043c\u044f, \u0430 \u0440\u0440 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u043a\u0442\u043e \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u043d\u043e \u0443\u0440\u043e\u0432\u043d\u0435 \u043f\u043e \u0441\u043a\u0438\u043b\u043b\u0443.",n.a.createElement("br",null),"\u0421\u0435\u0439\u0447\u0430\u0441 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043f\u043e \u042d\u043b\u043e. \u0420\u0420 \u0432\u044b\u0441\u0442\u0443\u043f\u0430\u0435\u0442 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0438\u043d\u0444\u044b \u0434\u043b\u044f \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0430, \u043f\u043b\u044e\u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u042d\u043b\u043e.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u042d\u043b\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0438\u0433\u0440 1 \u043d\u0430 1, \u043a\u0430\u043a \u043e\u043d\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043d\u0430 \u043f\u0430\u043c\u043f\u0435, \u0433\u0434\u0435 \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0447\u0430\u0440\u0442\u0435 \u0438\u0433\u0440\u0430\u0435\u0442 \u043c\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u043e\u0432?"),n.a.createElement("div",{className:"answer"},"A: \u0420\u0435\u043a\u043e\u0440\u0434\u044b \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0447\u0430\u0440\u0442\u0435 \u0434\u0435\u043b\u044f\u0442\u0441\u044f \u043d\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0438\u0433\u0440 1 \u043d\u0430 1. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c 3 \u0438\u0433\u0440\u043e\u043a\u0430: A, B, C; \u0442\u043e \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u0431\u044b\u043b\u043e 3 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0438\u0433\u0440\u044b: A vs B, A vs C, B vs C.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u0443\u043c\u043c\u0430 \u0440\u0440?"),n.a.createElement("div",{className:"answer"},"A: \u0421\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u0441\u0435 \u0441\u043a\u043e\u0440\u044b \u0438\u0433\u0440\u043e\u043a\u0430 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u043f\u043e \u0440\u0440. \u0417\u0430\u0442\u0435\u043c \u0432 \u043e\u0431\u0449\u0443\u044e \u0441\u0443\u043c\u043c\u0443 \u0440\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f 100% \u043e\u0442 \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u0441\u043a\u043e\u0440\u0430, 95% \u043e\u0442 \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u0441\u043a\u043e\u0440\u0430, 90% \u043e\u0442 \u0442\u0440\u0435\u0442\u044c\u0435\u0433\u043e, 86% \u043e\u0442 4-\u0433\u043e \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435. (\u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u043a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442\u0430 - 0.95^N). \u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u043d\u0430 \u043e\u0431\u0449\u0443\u044e \u0441\u0443\u043c\u043c\u0443 \u0440\u0440 \u0431\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0432\u043b\u0438\u044f\u044e\u0442 \u0441\u0430\u043c\u044b\u0435 \u043b\u0443\u0447\u0448\u0438\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u0430 \u0437\u0430 \u0432\u0441\u0451 \u0432\u0440\u0435\u043c\u044f, \u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0434\u043d\u044f\u0442\u044c \u0441\u0432\u043e\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0440, \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0435 \u0442\u043e\u043f\u043e\u0432\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b (\u0438 \u043f\u043e\u0434\u043d\u0438\u043c\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0441\u043a\u0438\u043b\u043b).")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043b\u0438 \u0440\u0435\u043a\u043e\u0440\u0434\u044b \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0414\u0430. \u041a\u0430\u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u043c\u043d\u043e\u0433\u043e \u0440\u0435\u043a\u043e\u0440\u0434\u043e\u0432, \u0432\u0437\u044f\u0442\u044b\u0445 \u0441 \u043c\u0430\u0448\u0438\u043d \u0431\u0435\u0441\u0442\u043e\u0432, \u0438 \u043c\u044b \u043d\u0435 \u0437\u043d\u0430\u0435\u043c \u043d\u0430\u0432\u0435\u0440\u043d\u044f\u043a\u0430, \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u043e\u043d\u0438 \u0438\u043b\u0438 \u043d\u0435\u0442. \u0415\u0441\u043b\u0438 \u0443 \u0438\u0433\u0440\u043e\u043a\u0430 \u0432 \u0442\u043e\u043f\u0435 \u0435\u0441\u0442\u044c \u0434\u0432\u0430 \u0441\u043a\u043e\u0440\u0430 - \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u0438 \u0431\u0435\u0437 \u0440\u0430\u043d\u043a\u0430, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u0442, \u0433\u0434\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u0447\u043a\u043e\u0432.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041f\u043e\u0447\u0435\u043c\u0443 \u043c\u0435\u043d\u044f \u043d\u0435\u0442 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0412 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043f\u043e\u043f\u0430\u0434\u0430\u044e\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u0435, \u0443 \u043a\u043e\u0433\u043e \u0435\u0441\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b 20 \u0438\u0433\u0440 1 \u043d\u0430 1. \u041f\u0435\u0440\u0432\u044b\u0435 20 \u0438\u0433\u0440 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0438\u0437\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0430.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041f\u043e\u0447\u0435\u043c\u0443 \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0446\u0435\u043d\u043e\u043a S-A-B \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 \u043e\u0431\u0449\u0438\u043c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e\u043c \u0441\u043a\u043e\u0440\u043e\u0432?"),n.a.createElement("div",{className:"answer"},"A: \u041d\u0435 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430 \u043e\u0446\u0435\u043d\u043a\u0430.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0415\u0441\u043b\u0438 \u0443 \u043c\u0435\u043d\u044f \u0435\u0441\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u043a\u043e\u0440\u0434\u043e\u0432 \u043d\u0430 \u0410, \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0410+, \u043a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0433\u0440\u0435\u0439\u0434\u043e\u0432 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0412 \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u043e\u043b\u043e\u043d\u043a\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043e\u0431\u0435 \u0431\u0443\u043a\u0432\u044b - \u0438 \u0442\u0440\u0435\u0441\u043d\u0443\u0442\u044b\u0435, \u0438 \u0441 \u0443\u0434\u0435\u0440\u0436\u0430\u043d\u043d\u044b\u043c \u043b\u0430\u0439\u0444\u043e\u043c. \u0422\u043e \u0435\u0441\u0442\u044c \u0438 \u0410, \u0438 \u0410+ \u0438\u0434\u0443\u0442 \u0432 \u043a\u043e\u043b\u043e\u043d\u043a\u0443 \u0410. \u0422\u043e\u0447\u043d\u043e \u0442\u0430\u043a \u0436\u0435 \u0434\u043b\u044f B, C, D.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0423\u0431\u0435\u0440\u0438 \u0430\u043a\u043a\u0443\u0440\u0430\u0441\u0438 \u0438\u0437 \u0442\u0430\u0431\u043b\u0438\u0446\u044b!"),n.a.createElement("div",{className:"answer"},"A: \u0413\u0440\u0435\u043c, \u044d\u0442\u043e \u0441\u0435\u043a\u0446\u0438\u044f \u0434\u043b\u044f \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432.")))}const Ga={playersHiddenStatus:{}},Ua={isLoading:!1,data:Ga,error:null};const Ka=Object(Ca.a)(e=>e.results.profiles,g.a.flow(g.a.values,g.a.orderBy(["ratingRaw"],["desc"]))),Wa={fetchChartsData:xa,updatePreferences:e=>async a=>{a({type:"PREFERENCES/CHANGE",data:e});try{await a(M({url:"".concat(j,"/profile/preferences"),body:{preferences:e}}))}catch(t){return null}}};class Va extends r.Component{constructor(...e){super(...e),this.onChangeHidingPlayers=()=>{const{preferences:e,updatePreferences:a}=this.props;a(g.a.set(["showHiddenPlayersInRanking"],!e.showHiddenPlayersInRanking,e))},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()}}render(){const{isLoading:e,ranking:a,error:t,preferences:r,updatePreferences:s}=this.props;return n.a.createElement("div",{className:"ranking-page"},n.a.createElement("div",{className:"content"},t&&t.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement(o.b,{exact:!0,path:y.path,render:()=>n.a.createElement(n.a.Fragment,null,n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.onChangeHidingPlayers},r.showHiddenPlayersInRanking?"\u0441\u043a\u0440\u044b\u0442\u044c \u043d\u0435\u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0445":"\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435\u0445"),n.a.createElement(c.b,{to:y.faq.path},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},n.a.createElement(L.p,null)," faq")),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(L.s,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c"))}),n.a.createElement(o.b,{exact:!0,path:y.faq.path,render:()=>n.a.createElement(c.b,{to:y.path},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon"},"\u043d\u0430\u0437\u0430\u0434"))})),n.a.createElement(o.b,{exact:!0,path:y.path,render:()=>n.a.createElement(ja,{ranking:a,isLoading:e,preferences:r,updatePreferences:s})}),n.a.createElement(o.b,{exact:!0,path:y.faq.path,component:Ha})))}}Va.defaultProps={ranking:[]};var qa=Object(i.b)(e=>({preferences:e.preferences.data,ranking:Ka(e),error:e.charts.error||e.tracklist.error,isLoading:e.charts.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}),Wa)(Object(o.g)(Va)),Ya=t(3),za=(t(413),t(183)),Xa=(t(414),Object(i.b)(e=>({charts:e.results.sharedCharts}),{fetchJson:T})(({playerId:e,charts:a,fetchJson:t})=>{const[s,l]=Object(r.useState)(!1),[i,o]=Object(r.useState)(10),[m,d]=Object(r.useState)([]);return Object(r.useEffect)(()=>{l(!0),t({url:"".concat(j,"/player/").concat(e,"/mostPlayed?limit=").concat(i)}).then(e=>{l(!1),e.success&&d(e.data)}).catch(()=>{l(!1)})},[e,i,t]),n.a.createElement("div",{className:"most-played"},s&&n.a.createElement(A,null),m.map(e=>{const t=a[e.shared_chart];return n.a.createElement("div",{className:"chart",key:e.shared_chart},n.a.createElement("div",{className:w()("chart-name",{single:"S"===t.chartType,singlep:"SP"===t.chartType,doublep:"DP"===t.chartType,double:"D"===t.chartType,coop:"COOP"===t.chartType})},n.a.createElement("span",{className:"chart-letter"},t.chartType),n.a.createElement("span",{className:"chart-number"},t.chartLevel)),n.a.createElement("div",{className:"song-name"},n.a.createElement(c.c,{exact:!0,to:E.sharedChart.getPath({sharedChartId:t.sharedChartId})},t.song)),n.a.createElement("div",{className:"date"},e.latestDate?ie(J(e.latestDate)):null),n.a.createElement("div",{className:"playcount"},n.a.createElement(L.n,null),n.a.createElement("span",null,e.count)))}),i===g.a.size(m)&&n.a.createElement("button",{className:"show-more btn btn-sm btn-dark btn-icon",onClick:()=>o(i+10)},n.a.createElement(za.a,null)," \u0431\u043e\u043b\u044c\u0448\u0435"))}));function Ja(){return n.a.createElement("div",{className:"faq-exp"},n.a.createElement("div",{className:"faq-header"},n.a.createElement("strong",null,"\u041e\u043f\u044b\u0442")," \u0438\u0433\u0440\u043e\u043a\u0430 \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0435 \u0441\u044b\u0433\u0440\u0430\u043d\u043d\u044b\u0445 \u043f\u0435\u0441\u0435\u043d \u0438 \u0447\u0430\u0440\u0442\u043e\u0432.",n.a.createElement("br",null),"\u0427\u0435\u043c \u0432\u044b\u0448\u0435 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0447\u0430\u0440\u0442\u0430 \u0438 \u0447\u0435\u043c \u043b\u0443\u0447\u0448\u0435 \u043e\u0446\u0435\u043d\u043a\u0430 \u043d\u0430 \u0447\u0430\u0440\u0442\u0435, \u0442\u0435\u043c \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u044b\u0442\u0430 \u043e\u043d \u0434\u0430\u0451\u0442.",n.a.createElement("br",null),"\u041f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0438 \u043d\u0430 \u0442\u0435\u0445 \u0436\u0435 \u0447\u0430\u0440\u0442\u0430\u0445 \u043d\u0435 \u0434\u0430\u044e\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u044b\u0442\u0430. \u0427\u0442\u043e\u0431\u044b \u043f\u043e\u0434\u043d\u0438\u043c\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c, \u0438\u0433\u0440\u0430\u0439 \u043d\u043e\u0432\u044b\u0435 \u0442\u0440\u0435\u043a\u0438 \u0438 \u0447\u0430\u0440\u0442\u044b."),n.a.createElement("div",{className:"faq-header"},"\u0421\u043f\u0438\u0441\u043e\u043a \u0443\u0440\u043e\u0432\u043d\u0435\u0439 \u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0439 \u043e\u043f\u044b\u0442 \u0434\u043b\u044f \u0438\u0445 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f:"),n.a.createElement("div",{className:"ranks-list"},Z.map(e=>n.a.createElement("div",{key:e.threshold,className:"rank"},n.a.createElement("div",{className:"exp-rank"},ae(e)),n.a.createElement("div",{className:"threshold"},e.threshold)))))}const Qa={},Za={isLoading:!1,filter:Qa};const $a=e=>({type:"PROFILES/SET_FILTER",filter:e}),et=()=>({type:"PROFILES/RESET_FILTER"}),at=(e,a)=>{const t=g.a.findIndex(e=>e.date>a[0],e),r=g.a.findLastIndex(e=>e.date<a[1],e);let n=t>0?e[t-1]:0===t?e[t]:g.a.last(e),s=r>-1?e[r]:g.a.first(e);n={...n,date:a[0]},s={...s,date:a[1]};return[n,...t>-1&&r>-1?e.slice(t,r+1):[],s]},tt={SSS:0,SS:0,S:0,"A+":0,A:0,B:0,C:0,D:0,F:0},rt=g.a.flow(g.a.flatMap(e=>g.a.flow(g.a.toPairs,g.a.map(([a,t])=>["".concat(e,"-").concat(a),t]))(tt)),g.a.fromPairs)(["S","D"]),nt=e=>Object(Ca.a)((a,t)=>g.a.toInteger(t.match.params[e]),e=>e.charts.isLoading||e.results.isLoadingRanking,e=>e.results.profiles,e=>e.profiles.filter,e=>e.tracklist.data,(e,a,t,r,n)=>{const s=t[e];if(g.a.isEmpty(s)||a)return null;const l=g.a.flow(g.a.get("resultsByLevel"),g.a.toPairs,g.a.map(([e,a])=>({x:g.a.toInteger(e),S:g.a.size(g.a.filter(e=>"S"===e.chart.chartType||"SP"===e.chart.chartType,a))/n.singlesLevels[e]*100,D:-g.a.size(g.a.filter(e=>"D"===e.chart.chartType||"DP"===e.chart.chartType,a))/n.doublesLevels[e]*100})))(s),c=g.a.flow(g.a.get("resultsByLevel"),g.a.toPairs,g.a.map(g.a.update("[1].result.grade",e=>e&&e.includes("+")&&"A+"!==e?e.replace("+",""):e)))(s),i=g.a.flow(g.a.map(([e,a])=>({x:g.a.toInteger(e),...tt,...g.a.omit("?",g.a.mapValues(g.a.size,g.a.groupBy("result.grade",a)))})),g.a.map(e=>{const a=g.a.pick(Object.keys(tt),e),t=g.a.sum(g.a.values(a));return{...e,gradesValues:a,...0===t?a:g.a.mapValues(e=>100*e/t,a)}}))(c),o=g.a.flow(g.a.map(([e,a])=>{const t=g.a.groupBy("result.grade",a),r=g.a.omit("?",g.a.mapValues(g.a.countBy(e=>"S"===e.chart.chartType||"SP"===e.chart.chartType?"S":"D"===e.chart.chartType||"DP"===e.chart.chartType?"D":"Other"),t)),s=g.a.reduce((a,[t,r])=>({...a,...g.a.flow(g.a.toPairs,g.a.map(([a,r])=>["".concat(a,"-").concat(t),"S"===a?r/n.singlesLevels[e]*100:-r/n.doublesLevels[e]*100]),g.a.fromPairs)(r)}),{},g.a.toPairs(r));return{x:g.a.toInteger(e),...rt,...s}}))(c),m=g.a.last(s.ratingHistory).date,d=g.a.last(s.rankingHistory).date,p=m>d?m:d,u=g.a.first(s.ratingHistory).date,h=X()(p).endOf("day"),E=[X()(u).startOf("day")/1e3/60/60/24,h/1e3/60/60/24],f=r.dayRange||[Math.max(E[0],E[1]-30),E[1]],y=[+X()(1e3*f[0]*60*60*24).startOf("day"),+X()(1e3*f[1]*60*60*24).endOf("day")],v=at(s.rankingHistory,y),b=at(s.ratingHistory,y),N=1+g.a.findIndex({id:e},g.a.orderBy(["ratingRaw"],["desc"],g.a.values(t)));return{...s,rank:N,minMaxRange:E,filterRange:f,levelsDistribution:l,gradesDistribution:i,gradesAndLevelsDistribution:o,placesChanges:v,ratingChanges:b}}),st=nt("id"),lt=Object(Ca.a)(e=>e.results.players,(e,a)=>g.a.toNumber(a.match.params.id),(e,a)=>g.a.flow(g.a.toPairs,g.a.map(([e,{nickname:a,arcade_name:t,id:r}])=>({label:"".concat(a," (").concat(t,")"),value:a,id:g.a.toNumber(r)})),g.a.remove(e=>e.id===a),g.a.sortBy(e=>g.a.toLower(e.label)))(e)),ct={fetchChartsData:xa,setProfilesFilter:$a,resetProfilesFilter:et};class it extends r.Component{constructor(...e){super(...e),this.state={isLevelGraphCombined:!0,showFaq:!1},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()},this.onChangeDayRange=e=>{const{filter:a}=this.props;this.props.setProfilesFilter({...a,dayRange:e})},this.onShowFaq=()=>{this.setState({showFaq:!0})},this.onHideFaq=()=>{this.setState({showFaq:!1})},this.circleShape=e=>n.a.createElement("circle",{key:e.key,cx:e.cx,cy:e.cy,r:4,fill:e.fill})}componentWillUnmount(){this.props.resetProfilesFilter()}renderRankingHistory(){const{profile:e}=this.props;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.g,{data:e.ratingChanges,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.c,{strokeDasharray:"3 3"}),n.a.createElement(Ya.m,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>J(e).toLocaleDateString()}),n.a.createElement(Ya.n,{allowDecimals:!1,domain:["dataMin - 100","dataMax + 100"],tickFormatter:Math.round,width:40}),n.a.createElement(Ya.h,{y:1e3,stroke:"white"}),n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,J(a[0].payload.date).toLocaleDateString()),a&&a[0]&&n.a.createElement("div",null,"Rating: ",Math.round(a[0].value))):null}),n.a.createElement(Ya.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderAccuracyPoints(e=!1){const{profile:a,sharedCharts:t}=this.props,r=g.a.groupBy(([,,e])=>{const a=t[e].chartType;return"D"===a||"DP"===a},a.accuracyPointsRaw);return e?n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.g,{margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.c,{strokeDasharray:"3 3"}),n.a.createElement(Ya.m,{dataKey:"[0]",type:"number",domain:[1,28],tickFormatter:e=>Math.round(e)}),n.a.createElement(Ya.n,{domain:[0,100],width:40}),n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,a[0].payload[0]),a&&a[0]&&n.a.createElement("div",null,"Acc: #",a[0].value)):null}),n.a.createElement(Ya.f,{data:a.accuracyPointsInterpolated,isAnimationActive:!1,dataKey:"[1]",stroke:"#88d3ff",strokeWidth:3,dot:!1}))):n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.k,{margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.c,{strokeDasharray:"3 3"}),n.a.createElement(Ya.m,{dataKey:"[0]",type:"number",domain:[1,28],tickFormatter:e=>Math.round(e),ticks:[1,3,5,7,9,11,13,15,17,19,21,23,25,27]}),n.a.createElement(Ya.n,{dataKey:"[1]",type:"number",domain:[0,100],width:40,tickFormatter:e=>Math.round(e)+"%"}),n.a.createElement(Ya.j,{data:r.true,shape:this.circleShape,fill:"#169c16"}),n.a.createElement(Ya.j,{data:r.false,shape:this.circleShape,fill:"#af2928"}),n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:a,label:r})=>{if(!a||!a[0]||!a[1])return null;const s=a[0].payload[2]&&t[a[0].payload[2]];return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",a[0].value),n.a.createElement("div",null,"Accuracy: ",a[1].value,"%"),s&&n.a.createElement("div",null,s.song," ",s.chartLabel," (",s.interpolatedDifficulty.toFixed(1),")"))}})))}renderPlaceHistory(){const{profile:e}=this.props;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.g,{data:e.placesChanges,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.c,{strokeDasharray:"3 3"}),n.a.createElement(Ya.m,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>J(e).toLocaleDateString()}),n.a.createElement(Ya.n,{allowDecimals:!1,domain:[1,e=>e<3?e+2:e+1],interval:0,reversed:!0,width:40}),n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,J(a[0].payload.date).toLocaleDateString()),a&&a[0]&&n.a.createElement("div",null,"Place: #",a[0].value)):null}),n.a.createElement(Ya.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderGrades(){const{profile:e}=this.props;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.b,{data:e.gradesDistribution,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",a[0].payload.x),g.a.filter(e=>e.value>0,a).map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name,": ",a[0].payload.gradesValues[e.name]))):null}),n.a.createElement(Ya.m,{dataKey:"x"}),n.a.createElement(Ya.n,{domain:[0,100],ticks:[0,50,100],tickFormatter:e=>"".concat(Math.round(e),"%"),width:40}),n.a.createElement(Ya.e,null),n.a.createElement(Ya.a,{dataKey:"SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"F",fill:"#774949",stackId:"stack"})))}renderGradesWithLevels(){const{profile:e,tracklist:a}=this.props;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:.74},n.a.createElement(Ya.b,{data:e.gradesAndLevelsDistribution,margin:{top:5,bottom:5,right:5,left:0},stackOffset:"sign"},n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:t,label:r})=>{if(!t||!t[0])return null;const s=g.a.filter(e=>0!==e.value&&e.dataKey.startsWith("D"),t),l=g.a.filter(e=>0!==e.value&&e.dataKey.startsWith("S"),t);return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),!!l.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Single:"),l.map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name.slice(2),": ",Math.round(Math.abs(e.value)),"% (",Math.round(a.singlesLevels[e.payload.x]*e.value/100),"/",a.singlesLevels[e.payload.x],")"))),!!s.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Double:"),s.map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name.slice(2),": ",Math.round(Math.abs(e.value)),"% (",Math.round(a.doublesLevels[e.payload.x]*-e.value/100),"/",a.doublesLevels[e.payload.x],")"))))}}),n.a.createElement(Ya.m,{dataKey:"x"}),n.a.createElement(Ya.n,{tickFormatter:e=>"".concat(Math.round(Math.abs(e)),"%"),width:40,domain:[e=>Math.min(e,-10),e=>Math.max(10,e)]}),n.a.createElement(Ya.a,{dataKey:"S-SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S-F",fill:"#774949",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"D-F",fill:"#774949",stackId:"stack"}),n.a.createElement(Ya.d,{value:"Double",offset:0,position:"insideBottomLeft"}),n.a.createElement(Ya.d,{value:"Single",offset:0,position:"insideTopLeft"}),n.a.createElement(Ya.h,{y:0,stroke:"#bbb"})))}renderLevels(){const{profile:e,tracklist:a}=this.props;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.b,{data:e.levelsDistribution,stackOffset:"sign",margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:t,label:r})=>{if(!t||!t[0])return null;const s=a.doublesLevels[t[0].payload.x],l=a.singlesLevels[t[0].payload.x];return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),l>0&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[1].color}},"Single: ",Math.abs(t[1].value).toFixed(1),"% (",Math.round(t[1].value*l/100),"/",l,")"),s>0&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[0].color}},"Double: ",Math.abs(t[0].value).toFixed(1),"% (",Math.round(Math.abs(t[0].value)*s/100),"/",s,")"))}}),n.a.createElement(Ya.m,{dataKey:"x"}),n.a.createElement(Ya.n,{tickFormatter:e=>Math.round(Math.abs(e))+"%",width:40,domain:[e=>Math.min(e,-10),e=>Math.max(10,e)]}),n.a.createElement(Ya.l,null),n.a.createElement(Ya.h,{y:0,stroke:"#555"}),n.a.createElement(Ya.e,null),n.a.createElement(Ya.a,{dataKey:"D",fill:"#169c16",stackId:"stack"}),n.a.createElement(Ya.a,{dataKey:"S",fill:"#af2928",stackId:"stack"})))}renderGradeBlock(e,a){const{profile:t}=this.props,r=t.progress[e],s="double"===e?"D":"S",l=Math.floor(100*(r["".concat(a,"-bonus-level-coef")]||0)),c=r["".concat(a,"-bonus-level-min-number")],i=r["".concat(a,"-bonus-level-achieved-number")],o=r["".concat(a,"-bonus-level")]?"".concat(s).concat(r["".concat(a,"-bonus-level")]):"?";return n.a.createElement("div",{className:"grade-block"},n.a.createElement("div",{className:"grade-letter"},n.a.createElement("img",{src:"".concat(".","/grades/").concat(a,".png"),alt:a})),n.a.createElement("div",{className:"grade-level"},o),n.a.createElement("div",{className:"grade-progress"},l,"% (",100===l?c:i,"/",c,")"),n.a.createElement("div",{className:w()("progress-background",{complete:100===l,zero:0===l}),style:{height:"".concat(l,"%")}}))}renderAchievement(e,a){const t=re[e].icon,r=re[e].description;return n.a.createElement(da.a,{key:e,content:n.a.createElement("div",null,r),tooltipClassName:"pumpking-tooltip achievement-tooltip"},n.a.createElement("div",{className:"ach-block"},t&&n.a.createElement("div",{className:"ach-icon"},n.a.createElement(t,null)),n.a.createElement("div",{className:"ach-name"},e),n.a.createElement("div",{className:w()("progress-background",{complete:100===a.progress,zero:0===a.progress}),style:{height:"".concat(Math.round(a.progress),"%")}})))}renderProfile(){const{profile:e,otherPlayers:a,filter:t}=this.props,{isLevelGraphCombined:r}=this.state,s=e.expRankNext?(e.exp-e.expRank.threshold)/(e.expRankNext.threshold-e.expRank.threshold):100;return n.a.createElement("div",{className:"profile"},n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"profile-name text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,e.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",e.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,e.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,e.lastResultDate?ie(e.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430")),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"text-with-header -select"},n.a.createElement("div",{className:"text-header"},"\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441"),n.a.createElement("div",null,n.a.createElement(ye.a,{closeMenuOnSelect:!0,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:a,onChange:a=>{this.props.history.push(b.compare.getPath({id:e.id,compareToId:a.id}))}})))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header _flex-row _align-center"},n.a.createElement("span",null,"\u043e\u043f\u044b\u0442"),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{onClick:this.onShowFaq,className:"_clickable"},n.a.createElement(L.p,{onClick:this.onShowFaq})),n.a.createElement(u.a,{ariaHideApp:!1,className:"Modal faq-modal",overlayClassName:"Overlay",isOpen:this.state.showFaq,onRequestClose:this.onHideFaq},n.a.createElement("div",{className:"close-btn",onClick:this.onHideFaq},n.a.createElement(L.t,null))," ",n.a.createElement(Ja,null))),n.a.createElement("div",{className:"exp-range"},n.a.createElement("div",{className:"rank exp-rank"},ae(e.expRank),e.expRank&&n.a.createElement("div",null,e.expRank.threshold)),n.a.createElement("div",{className:"exp-line-with-label"},n.a.createElement("div",{className:"exp-label"},e.expRankNext?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"taken-num"},Math.round(e.exp-e.expRank.threshold))," / ".concat(e.expRankNext.threshold-e.expRank.threshold)):null),n.a.createElement("div",{className:"exp-line"},n.a.createElement("div",{className:"taken",style:{width:Math.floor(100*s)+"%"}}),n.a.createElement("div",{className:"rest",style:{width:100-Math.ceil(100*s)+"%"}})),n.a.createElement("div",{className:"exp-label"},"total: ",n.a.createElement("span",{className:"taken-num"},Math.round(e.exp)))),e.expRankNext&&n.a.createElement("div",{className:"rank exp-rank"},ae(e.expRankNext),e.expRankNext&&n.a.createElement("div",null,e.expRankNext.threshold)))),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},r?n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u043e\u0446\u0435\u043d\u043a\u0438"),n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Ne,{className:"combine-toggle",checked:r,onChange:()=>this.setState(e=>({isLevelGraphCombined:!e.isLevelGraphCombined}))},"\u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438"))),n.a.createElement("div",{className:"chart-container single-double-labels"},this.renderGradesWithLevels())):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u0443\u0440\u043e\u0432\u043d\u0438"),n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Ne,{className:"combine-toggle",checked:r,onChange:()=>this.setState(e=>({isLevelGraphCombined:!e.isLevelGraphCombined}))},"\u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438"))),n.a.createElement("div",{className:"chart-container"},this.renderLevels())),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043e\u0446\u0435\u043d\u043a\u0438")),n.a.createElement("div",{className:"chart-container"},this.renderGrades()))))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u044d\u043b\u043e")),n.a.createElement("div",{className:"chart-container"},this.renderRankingHistory())),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043c\u0435\u0441\u0442\u043e \u0432 \u0442\u043e\u043f\u0435")),n.a.createElement("div",{className:"chart-container"},this.renderPlaceHistory()))),(()=>{const a=t.dayRange||e.filterRange,r=X()(1e3*a[0]*60*60*24).format("L"),s=X()(1e3*a[1]*60*60*24).format("L"),l=Math.max(a[0]-1,e.minMaxRange[0]),c=Math.min(a[0]+1,a[1]),i=Math.max(a[1]-1,a[0]),o=Math.min(a[1]+1,e.minMaxRange[1]);return n.a.createElement("div",{className:"range-container"},n.a.createElement(we,{range:a,min:e.minMaxRange[0],max:e.minMaxRange[1],onChange:this.onChangeDayRange}),n.a.createElement("div",{className:"range-controls _flex-row"},n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([l,a[1]])},n.a.createElement(L.e,null)),n.a.createElement("span",{className:"date-text"},r),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([c,a[1]])},n.a.createElement(L.f,null)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],i])},n.a.createElement(L.e,null)),n.a.createElement("span",{className:"date-text"},s),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],o])},n.a.createElement(L.f,null))))})())),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"chart-container"},this.renderAccuracyPoints())))),n.a.createElement("div",{className:"profile-section"})),n.a.createElement("div",{className:"profile-section progress-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"progress-blocks-single-double"},n.a.createElement("div",{className:"progress-block"},n.a.createElement("div",{className:"achievements-grades single"},this.renderGradeBlock("single","A"),this.renderGradeBlock("single","A+"),this.renderGradeBlock("single","S"),this.renderGradeBlock("single","SS"))),n.a.createElement("div",{className:"progress-block"},n.a.createElement("div",{className:"achievements-grades double"},this.renderGradeBlock("double","A"),this.renderGradeBlock("double","A+"),this.renderGradeBlock("double","S"),this.renderGradeBlock("double","SS")))),n.a.createElement("div",{className:"bonus-faq"},"* \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0430\u0447\u0438\u0432\u043a\u0438 \u043d\u0443\u0436\u043d\u043e \u0441\u044b\u0433\u0440\u0430\u0442\u044c \u043e\u043a\u043e\u043b\u043e 10% \u0432\u0441\u0435\u0445 \u0447\u0430\u0440\u0442\u043e\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u043b\u0435\u0432\u0435\u043b\u0430 \u043d\u0430 \u043d\u0443\u0436\u043d\u044b\u0439 \u0433\u0440\u0435\u0439\u0434")),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f")),n.a.createElement("div",{className:"achievements"},g.a.keys(e.achievements).map(a=>this.renderAchievement(a,e.achievements[a])))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0447\u0430\u0441\u0442\u043e \u0438\u0433\u0440\u0430\u0435\u043c\u044b\u0435 \u0447\u0430\u0440\u0442\u044b")),n.a.createElement(Xa,{playerId:e.id})))}render(){const{isLoading:e,profile:a,error:t}=this.props;return Ge&&console.log("profile:",a),n.a.createElement("div",{className:"profile-page"},n.a.createElement("div",{className:"content"},t&&t.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(L.s,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")),e&&n.a.createElement(A,null),!e&&g.a.isEmpty(a)&&n.a.createElement("div",{className:"profile"},"Profile not found"),!e&&!g.a.isEmpty(a)&&this.renderProfile()))}}it.defaultProps={profile:{}};var ot=Object(i.b)((e,a)=>({profile:st(e,a),otherPlayers:lt(e,a),tracklist:e.tracklist.data,filter:e.profiles.filter,error:e.charts.error||e.tracklist.error,sharedCharts:e.results.sharedCharts,isLoading:e.charts.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}),ct)(Object(o.g)(it)),mt=t(184);t(415);const dt={SINGLE_TWO:"SINGLE_TWO",SINGLE_FIVE:"SINGLE_FIVE",DOUBLE_TWO:"DOUBLE_TWO",DOUBLE_FIVE:"DOUBLE_FIVE",BOTH_TWO:"BOTH_TWO",BOTH_FIVE:"BOTH_FIVE"},pt=nt("id"),ut=nt("compareToId"),ht=Object(mt.a)()((e,a,t)=>{if(!e||!a)return{};let r=e.ratingChanges[0].rating,n=a.ratingChanges[0].rating;const s=g.a.flow(g.a.sortBy("date"),g.a.map(e=>(e.rating&&(r=e.rating),e.rating2&&(n=e.rating2),{rating1:r,rating2:n,date:e.date})),g.a.sortedUniqBy("date"))([...e.ratingChanges,...a.ratingChanges.map(e=>({date:e.date,rating2:e.rating}))]);r=e.placesChanges[0].place,n=a.placesChanges[0].place;const l=g.a.flow(g.a.sortBy("date"),g.a.map(e=>(e.place&&(r=e.place),e.place2&&(n=e.place2),{place1:r,place2:n,date:e.date})))([...e.placesChanges,...a.placesChanges.map(e=>({date:e.date,place2:e.place}))]),c=g.a.fromPairs(Array.from({length:28}).map((e,a)=>[a+1,{}]));return g.a.keys(c).forEach(r=>{const n=g.a.flow(g.a.map("chart"),g.a.uniqBy("sharedChartId"))([...e.resultsByLevel[r],...a.resultsByLevel[r]]),s={x:r,all:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}},double:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}},single:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}}};n.forEach(t=>{const r=t.results.findIndex(a=>a.playerId===e.id),n=t.results.findIndex(e=>e.playerId===a.id),l=t.chartType.startsWith("D")?s.double:s.single;r<0&&n<0?console.log("wtf?"):r<0?(s.all.p1notPlayed++,l.p1notPlayed++):n<0?(s.all.p2notPlayed++,l.p2notPlayed++):r<n?(s.all.p1win++,l.p1win++):n<r&&(s.all.p2win++,l.p2win++)});const l=e=>{const a=e.p1win+e.p2win||1;e.twoBars.p1win=e.p1win/a,e.twoBars.p2win=e.p2win/a};l(s.all),l(s.single),l(s.double);const i=(e,a)=>{e.p1win=e.p1win/a,e.p1notPlayed=e.p1notPlayed/a,e.p2win=e.p2win/a,e.p2notPlayed=e.p2notPlayed/a,e.notPlayed=1-e.p1win-e.p1notPlayed-e.p2win-e.p2notPlayed};i(s.all,t.chartLevels[r]),i(s.double,t.doublesLevels[r]),i(s.single,t.singlesLevels[r]),c[r]=s}),{ratingChanges:s,placesChanges:l,perLevelComparison:g.a.values(c)}}),gt={fetchChartsData:xa,setProfilesFilter:$a,resetProfilesFilter:et};class Et extends r.Component{constructor(...e){super(...e),this.state={isLevelGraphCombined:!0,compareBarsMode:dt.BOTH_TWO},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()},this.onChangeDayRange=e=>{const{filter:a}=this.props;this.props.setProfilesFilter({...a,dayRange:e})},this.rhMargin={top:5,bottom:5,right:5,left:0},this.rhXDomain=["dataMin","dataMax"],this.rhYDomain=["dataMin - 100","dataMax + 100"],this.rhXTickFormatter=e=>J(e).toLocaleDateString(),this.rhTooltip=({active:e,payload:a,label:t})=>{const{profile:r,profile2:s}=this.props,l=r.name,c=s.name;return a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,J(a[0].payload.date).toLocaleDateString()),a[1]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[1].color}},l,": ",Math.round(a[1].value)),a[0]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[0].color}},c,": ",Math.round(a[0].value))):null},this.circleShape=e=>n.a.createElement("circle",{key:e.key,cx:e.cx,cy:e.cy,r:4,fill:e.fill}),this.plcMargin={top:5,bottom:5,right:5,left:0},this.plcTooltip=({active:e,payload:a,label:t})=>{const{profile:r,profile2:s}=this.props,{compareBarsMode:l}=this.state,c=[dt.SINGLE_TWO,dt.DOUBLE_TWO,dt.BOTH_TWO].includes(l),i=r.name,o=s.name;if(!a||!a[0])return null;const m=(e,a)=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},a,": ",Math.round(100*g.a.get(e.dataKey,e.payload)),"%");return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",a[0].payload.x),m(a[0],"".concat(i," wins")),!c&&m(a[1],"".concat(o," has no score")),!c&&m(a[2],"Both have no score"),!c&&m(a[3],"".concat(i," has no score")),m(c?a[1]:a[4],"".concat(o," wins")))},this.plcXDomain=[0,1],this.plcXTicks=[0,.5,1],this.plcXFormatter=e=>"".concat(Math.round(100*e),"%")}renderRankingHistory(){const{combinedData:e}=this.props;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.g,{data:e.ratingChanges,margin:this.rhMargin},n.a.createElement(Ya.c,{strokeDasharray:"3 3"}),n.a.createElement(Ya.m,{dataKey:"date",type:"number",domain:this.rhXDomain,tickFormatter:this.rhXTickFormatter}),n.a.createElement(Ya.n,{allowDecimals:!1,domain:this.rhYDomain,tickFormatter:Math.round,width:40}),n.a.createElement(Ya.h,{y:1e3,stroke:"white"}),n.a.createElement(Ya.l,{isAnimationActive:!1,content:this.rhTooltip}),n.a.createElement(Ya.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating2",stroke:"#ffd388",strokeWidth:3,dot:!1}),n.a.createElement(Ya.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating1",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderAccuracyPoints(e=!1){const{profile:a,profile2:t}=this.props;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.k,{margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.c,{strokeDasharray:"3 3"}),n.a.createElement(Ya.m,{dataKey:"[0]",type:"number",domain:[1,28],tickFormatter:e=>Math.round(e),ticks:[1,3,5,7,9,11,13,15,17,19,21,23,25,27]}),n.a.createElement(Ya.n,{dataKey:"[1]",type:"number",domain:[0,100],width:40,tickFormatter:e=>Math.round(e)+"%"}),n.a.createElement(Ya.j,{shape:this.circleShape,data:(e?t:a).accuracyPointsRaw,fill:e?"#ffd388":"#88d3ff"})))}renderPlaceHistory(){const{combinedData:e,profile:a,profile2:t}=this.props,r=a.name,s=t.name;return n.a.createElement(Ya.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ya.g,{data:e.placesChanges,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ya.c,{strokeDasharray:"3 3"}),n.a.createElement(Ya.m,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>J(e).toLocaleDateString()}),n.a.createElement(Ya.n,{allowDecimals:!1,domain:[1,e=>e<3?e+2:e+1],interval:0,reversed:!0,width:40}),n.a.createElement(Ya.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,J(a[0].payload.date).toLocaleDateString()),a[1]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[1].color}},r,": #",a[1].value),a[0]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[0].color}},s,": #",a[0].value)):null}),n.a.createElement(Ya.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place2",stroke:"#ffd388",strokeWidth:3,dot:!1}),n.a.createElement(Ya.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place1",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderPerLevelComparison(){const{combinedData:e}=this.props,{compareBarsMode:a}=this.state;return n.a.createElement(Ya.i,{width:"100%",aspect:.7},n.a.createElement(Ya.b,{layout:"vertical",data:[...e.perLevelComparison],margin:this.plcMargin},n.a.createElement(Ya.l,{isAnimationActive:!1,content:this.plcTooltip}),n.a.createElement(Ya.n,{reversed:!0,dataKey:"x",type:"category",width:23}),n.a.createElement(Ya.m,{type:"number",domain:this.plcXDomain,ticks:this.plcXTicks,tickFormatter:this.plcXFormatter}),n.a.createElement(Ya.h,{x:.5,stroke:"#666"}),(e=>{switch(e){case dt.SINGLE_TWO:return[n.a.createElement(Ya.a,{key:"11",dataKey:"single.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"22",dataKey:"single.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case dt.SINGLE_FIVE:return[n.a.createElement(Ya.a,{key:"1",dataKey:"single.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"2",dataKey:"single.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"3",dataKey:"single.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"4",dataKey:"single.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"5",dataKey:"single.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case dt.DOUBLE_TWO:return[n.a.createElement(Ya.a,{key:"11",dataKey:"double.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"22",dataKey:"double.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case dt.DOUBLE_FIVE:return[n.a.createElement(Ya.a,{key:"1",dataKey:"double.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"2",dataKey:"double.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"3",dataKey:"double.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"4",dataKey:"double.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"5",dataKey:"double.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case dt.BOTH_TWO:return[n.a.createElement(Ya.a,{key:"11",dataKey:"all.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"22",dataKey:"all.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case dt.BOTH_FIVE:return[n.a.createElement(Ya.a,{key:"1",dataKey:"all.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"2",dataKey:"all.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"3",dataKey:"all.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"4",dataKey:"all.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ya.a,{key:"5",dataKey:"all.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];default:return null}})(a)))}renderProfile(){const{profile:e,profile2:a,filter:t,otherPlayers:r}=this.props,{compareBarsMode:s}=this.state;return n.a.createElement("div",{className:"profile"},n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"profile-name text-with-header blue"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,e.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",e.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,e.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,e.lastResultDate?ie(e.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430")),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"text-with-header -select"},n.a.createElement("div",{className:"text-header"},"\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441"),n.a.createElement("div",null,n.a.createElement(ye.a,{closeMenuOnSelect:!0,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:r,onChange:a=>{this.props.history.push(b.compare.getPath({id:e.id,compareToId:a.id}))}})))),n.a.createElement("div",{className:"profile-header right-align"},n.a.createElement("div",{className:"profile-name text-with-header orange"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,a.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",a.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,a.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,a.lastResultDate?ie(a.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430"))),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u043f\u043e\u0431\u0435\u0434\u044b \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"profile-sm-section-header flex"},(()=>{const e=[dt.SINGLE_TWO,dt.DOUBLE_TWO,dt.BOTH_TWO].includes(s);return n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Ne,{className:"combine-toggle",checked:!e,onChange:()=>this.setState(e=>({compareBarsMode:{[dt.SINGLE_TWO]:dt.SINGLE_FIVE,[dt.DOUBLE_TWO]:dt.DOUBLE_FIVE,[dt.BOTH_TWO]:dt.BOTH_FIVE,[dt.SINGLE_FIVE]:dt.SINGLE_TWO,[dt.DOUBLE_FIVE]:dt.DOUBLE_TWO,[dt.BOTH_FIVE]:dt.BOTH_TWO}[e.compareBarsMode]}))},"\u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e"),n.a.createElement("div",{className:"tabs-holder"},n.a.createElement(ve,{text:"\u0432\u0441\u0435",active:[dt.BOTH_TWO,dt.BOTH_FIVE].includes(s),onToggle:()=>{this.setState(a=>({compareBarsMode:e?dt.BOTH_TWO:dt.BOTH_FIVE}))}}),n.a.createElement(ve,{text:"\u0441\u0438\u043d\u0433\u043b\u044b",active:[dt.SINGLE_TWO,dt.SINGLE_FIVE].includes(s),onToggle:a=>{this.setState(a=>({compareBarsMode:e?dt.SINGLE_TWO:dt.SINGLE_FIVE}))}}),n.a.createElement(ve,{text:"\u0434\u0430\u0431\u043b\u044b",active:[dt.DOUBLE_TWO,dt.DOUBLE_FIVE].includes(s),onToggle:a=>{this.setState(a=>({compareBarsMode:e?dt.DOUBLE_TWO:dt.DOUBLE_FIVE}))}})))})()),n.a.createElement("div",{className:"chart-container"},this.renderPerLevelComparison())))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u044d\u043b\u043e")),n.a.createElement("div",{className:"chart-container"},this.renderRankingHistory())),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043c\u0435\u0441\u0442\u043e \u0432 \u0442\u043e\u043f\u0435")),n.a.createElement("div",{className:"chart-container"},this.renderPlaceHistory()))),(()=>{const a=t.dayRange||e.filterRange,r=X()(1e3*a[0]*60*60*24).format("L"),s=X()(1e3*a[1]*60*60*24).format("L"),l=Math.max(a[0]-1,e.minMaxRange[0]),c=Math.min(a[0]+1,a[1]),i=Math.max(a[1]-1,a[0]),o=Math.min(a[1]+1,e.minMaxRange[1]);return n.a.createElement("div",{className:"range-container"},n.a.createElement(we,{range:a,min:e.minMaxRange[0],max:e.minMaxRange[1],onChange:this.onChangeDayRange}),n.a.createElement("div",{className:"range-controls _flex-row"},n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([l,a[1]])},n.a.createElement(L.e,null)),n.a.createElement("span",{className:"date-text"},r),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([c,a[1]])},n.a.createElement(L.f,null)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],i])},n.a.createElement(L.e,null)),n.a.createElement("span",{className:"date-text"},s),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],o])},n.a.createElement(L.f,null))))})())),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"chart-container"},this.renderAccuracyPoints())))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"chart-container"},this.renderAccuracyPoints(!0)))))))}render(){const{isLoading:e,profile:a,error:t}=this.props;return Ge&&console.log("profile:",a),n.a.createElement("div",{className:"profile-compare-page"},n.a.createElement("div",{className:"content"},t&&t.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(L.s,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")),e&&n.a.createElement(A,null),!e&&g.a.isEmpty(a)&&n.a.createElement("div",{className:"profile"},"Profile not found"),!e&&!g.a.isEmpty(a)&&this.renderProfile()))}}Et.defaultProps={profile:{},profile2:{},combinedData:{}};var ft=Object(i.b)((e,a)=>{const t=pt(e,a),r=ut(e,a);return{profile:t,profile2:r,otherPlayers:lt(e,a),combinedData:ht(t,r,e.tracklist.data),tracklist:e.tracklist.data,filter:e.profiles.filter,error:e.charts.error||e.tracklist.error,isLoading:e.charts.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}},gt)(Object(o.g)(Et));t(416);const yt={isLoading:!1,data:null};const vt=()=>async e=>{e({type:"USER/LOADING"});try{const a=await e(T({url:"".concat(j,"/profile")}));return e({type:"USER/SUCCESS",data:a}),a}catch(a){return e({type:"USER/ERROR",error:a}),null}},bt={isLoading:!1,data:null,error:null};const Nt=e=>async a=>{a({type:"LOGIN/LOADING"});try{const t=await a(M({url:"".concat(j,"/login/google"),body:{token:e.tokenId}}));return D.a.set("session",t.session,{expires:30}),a({type:"LOGIN/SUCCESS",data:t}),a(vt()),t}catch(t){return a({type:"LOGIN/ERROR",error:t}),null}},St={login:Nt,logout:()=>async e=>{e({type:"LOGIN/LOADING"}),e({type:"USER/RESET"});try{const a=await e(M({url:"".concat(j,"/logout")}));return e({type:"LOGIN/SUCCESS",data:a}),a}catch(a){return e({type:"LOGIN/ERROR",error:a}),null}}};var kt=Object(i.b)(e=>({isLoadingLogin:e.login.isLoading,isLoadingUser:e.user.isLoading,user:e.user.data}),St)((function({isLoadingLogin:e,isLoadingUser:a,user:t,login:r,logout:s}){return n.a.createElement("header",{className:"top-bar"},n.a.createElement("nav",null,n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:E.path},"leaderboards")),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:y.path},"ranking")),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:v.path},"tournaments")),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:f.path},"songs")))),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"login-container"},n.a.createElement(c.c,{className:"player-info",exact:!0,to:b.getPath({id:g.a.get("player.id",t)})},g.a.getOr("","player.nickname",t)),n.a.createElement("button",{className:"btn btn-dark btn-icon btn-sm",onClick:s,disabled:e||a},n.a.createElement("span",null," logout"))))})),Pt=t(185),Ot=t(186),Rt=t.n(Ot);t(427);const xt={login:Nt};var Ct=Object(i.b)(e=>({isLoading:e.login.isLoading,error:e.login.error}),xt)((function({isLoading:e,error:a,login:t}){const[s,l]=Object(r.useState)(!1),c=e=>{e.error?console.log("Google login response error:",e):t(e)};return n.a.createElement("div",{className:"login-screen"},n.a.createElement("div",{className:"site-name"},"pumpking"),n.a.createElement("div",{className:"login-button"},n.a.createElement(Pt.GoogleLogin,{clientId:"197132042723-cmibep21qf6dald9l2l01rif7l5dtd4s.apps.googleusercontent.com",buttonText:"Login",onSuccess:c,onFailure:c,cookiePolicy:"single_host_origin",render:({onClick:a,disabled:t})=>n.a.createElement("button",{className:"btn btn-dark btn-icon btn-sm",onClick:a,disabled:t||e},n.a.createElement(L.l,null),n.a.createElement("span",null," login"))})),a&&n.a.createElement("div",{className:"error"},a.message),n.a.createElement("div",{className:"footer"},"By logging in, you agree to our"," ",s?n.a.createElement(Rt.a,{text:"\ud83e\udd21",className:"clown"}):n.a.createElement("span",{onClick:()=>l(!0),className:"link-style"},"Privacy Policy")))})),Lt=t(111),It=t.n(Lt);t(430),t(431);const wt="ACHIEVEMENT",At="RANK_UP",_t={popups:[]};const Dt={[wt]:({playerName:e,achievementName:a,progress:t})=>{const[s,l]=Object(r.useState)(t[0]);return Object(r.useEffect)(()=>{l(t[1])},[]),n.a.createElement("div",{className:"achievement-popup popup"},n.a.createElement("div",{className:"player"},n.a.createElement(te.a,null),n.a.createElement("span",null,e),n.a.createElement(te.a,null)),n.a.createElement("div",{className:"ach-holder"},((e,a)=>{const t=re[e].icon;return n.a.createElement("div",{className:"ach-block"},t&&n.a.createElement("div",{className:"ach-icon"},n.a.createElement(t,null)),n.a.createElement("div",{className:"ach-name"},e),n.a.createElement("div",{className:w()("progress-background",{complete:100===a,zero:0===a}),style:{height:"".concat(Math.round(a),"%")}}))})(a,s)),n.a.createElement("div",{className:"description"},re[a].description))},[At]:({playerName:e,place:[a,t],list:[s,l]})=>{const[c,i]=Object(r.useState)(a),[o,m]=Object(r.useState)(s);Object(r.useEffect)(()=>{m(l),i(t)},[]);const d=Math.min(0,Math.max(-60*(g.a.size(o)-7),-60*(c-4)));return n.a.createElement("div",{className:"rank-up-popup popup"},n.a.createElement("div",{className:"player"},n.a.createElement(te.a,null),n.a.createElement("span",null,e),n.a.createElement(te.a,null)),n.a.createElement("div",{className:"ranking-holder"},n.a.createElement("div",{className:"moving-list",style:{top:d}},n.a.createElement(ca.a,{duration:4500,delay:2e3,maintainContainerHeight:!0},o.map((e,a)=>n.a.createElement("div",{key:e.id,className:w()("player-block",{current:a===c-1})},((e,a)=>n.a.createElement("div",{className:"closest-player ".concat(a?"current-player":"")},n.a.createElement("div",{className:"place"},"#",e.place),n.a.createElement("div",{className:"name"},e.name),n.a.createElement("div",{className:"elo"},e.rating)))(e,a===c-1)))))))}},Tt={overlay:{backgroundColor:"rgba(0, 0, 0, 0.1)"},content:{top:null,bottom:null,left:null,right:null,position:null,borderRadius:null,padding:null,background:null,display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",transition:"2.5s opacity ease",opacity:1}},Mt={removePopup:({id:e})=>({type:"POPUPS/REMOVE",id:e})};var Ft=Object(i.b)(e=>({popups:e.popups.popups}),Mt)(({popups:e,removePopup:a})=>{const[t,s]=Object(r.useState)(null),l=Object(r.useRef)(null);Object(r.useEffect)(()=>{if(e.length>0){const t=e[0];s(t),t.persistent||setTimeout(()=>{t&&t.fadeOut?(l.current.style.opacity=0,setTimeout(()=>{s(null),a(t)},2500)):(s(null),a(t))},t.timeout||6e3)}else s(null)},[e,a]);const c=Object(r.useCallback)(()=>{t&&t.fadeIn&&(l.current.style.opacity=1)},[t]);let i=Tt,o=null;if(t){const e=Dt[t.type];o=e?n.a.createElement(e,t.parameters):n.a.createElement("div",null,JSON.stringify(t)),t.fadeIn&&(i=g.a.set("content.opacity",0,Tt))}return n.a.createElement("div",{className:"popups-holder"},n.a.createElement(u.a,{isOpen:!!t,contentRef:e=>l.current=e,onAfterOpen:c,style:i},o))});const Bt={isLoading:!1,data:null,error:null,fetchingParams:null};const jt=({player:e,profile:a,label:t,trackedData:s,isLeft:l=!1,preferences:c,topPlayersList:i,addPopup:o})=>{const m=g.a.getOr({},"playersHiddenStatus",c),d=(e,a)=>{if(!a||a===e)return null;const t=e-a;return n.a.createElement("span",{className:"change ".concat(t>=0?"pos":"neg")},t<0?t.toFixed(1):"+".concat(t.toFixed(1)))},p=i.filter(e=>!m[e.id]),u=g.a.findIndex({id:a.id},p),h=u<0?[]:p.slice(Math.max(0,u-2),Math.min(u+3,p.length));(({data:e,resetData:a,onChange:t=g.a.noop,isDataValid:n=g.a.identity,isDebugOn:s=!1})=>{const[l,c]=Object(r.useState)(e),[i,o]=Object(r.useState)(e),m=Object(r.useRef)(a);Object(r.useEffect)(()=>{m.current!==a?(m.current=a,c(e),o(e)):n(e)&&!g.a.isEqual(e,i)&&(c(i),o(e),t(i,e))},[e,t,i,l,a,n]);const d=Object(r.useCallback)(()=>{c(e),o(e)},[e]);Object(r.useMemo)(()=>[i,l,d],[i,l,d])})({data:i,resetData:a.name,isDataValid:Object(r.useCallback)(g.a.get("[0].rating"),[]),onChange:Object(r.useCallback)((e,t)=>{const r=g.a.get("place",g.a.find({id:a.id},e)),n=g.a.get("place",g.a.find({id:a.id},t));r&&n&&r>n&&o({type:At,fadeIn:!0,fadeOut:!0,timeout:7500,parameters:{playerName:a.name,place:[r,n],list:[e,t]}})},[o,a.id,a.name])});const[E,f]=oe(t);return n.a.createElement("div",{className:"player-container ".concat(l?"left":"right")},e&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"name-with-label"},n.a.createElement("div",{className:"name"},a.name||e),n.a.createElement("div",{className:"chart-label"},n.a.createElement(Na,{type:E,level:f}))),a.exp&&a.expRank&&n.a.createElement("div",{className:"exp exp-rank"},ae(a.expRank),(()=>{if(!a.expRank||!a.exp)return null;let e=a.expRankNext?(a.exp-a.expRank.threshold)/(a.expRankNext.threshold-a.expRank.threshold):1;const t=1-e;let r=0;return s.exp[1]&&(e=a.expRankNext?(s.exp[1]-a.expRank.threshold)/(a.expRankNext.threshold-a.expRank.threshold):1,r=1-t-e),n.a.createElement("div",{className:"exp-line"},n.a.createElement("div",{className:"taken",style:{width:Math.floor(100*e)+"%"}}),n.a.createElement("div",{className:"diff",style:{width:Math.ceil(100*r)+"%"}}),n.a.createElement("div",{className:"rest",style:{width:Math.ceil(100*t)+"%"}}))})()),s.exp[0]&&n.a.createElement("div",{className:"exp-text"},n.a.createElement("span",{className:"_grey-text"},"exp:"),n.a.createElement("span",null,Math.round(s.exp[0])),d(s.exp[0],s.exp[1])),s.elo[0]&&n.a.createElement("div",{className:"rating"},n.a.createElement("span",{className:"_grey-text"},"elo:"),n.a.createElement("span",null,Math.round(s.elo[0])),d(s.elo[0],s.elo[1])),s.pp[0]&&n.a.createElement("div",{className:"rating"},n.a.createElement("span",{className:"_grey-text"},"pp:"),n.a.createElement("span",null,Math.round(s.pp[0])),d(s.pp[0],s.pp[1])),n.a.createElement("div",{className:"closest-players"},g.a.map(e=>n.a.createElement("div",{className:"closest-player ".concat(a.id===e.id?"current-player":"")},n.a.createElement("div",{className:"place"},"#",e.place),n.a.createElement("div",{className:"name"},e.name),n.a.createElement("div",{className:"elo"},e.rating)),h))))},Ht=Object(Ca.a)(e=>e.results.profiles,g.a.flow(g.a.values,g.a.orderBy("ratingRaw","desc"),e=>e.map((e,a)=>({place:a+1,...g.a.pick(["id","name","rating"],e)})))),Gt={fetchTopPerSong:(e,a,t)=>{const r=De.a.stringify({song_name:e,charts:g.a.compact(g.a.uniq([a,t])).join(",")});return async e=>{e({type:"TOP_PER_SONG/LOADING",fetchingParams:r});try{const a=await e(T({url:"".concat(j,"/topPerSong?").concat(r)})),t=g.a.flow(Ea,g.a.get("results"))(a);return e({type:"TOP_PER_SONG/SUCCESS",data:t,fetchingParams:r}),t}catch(a){return e({type:"TOP_PER_SONG/ERROR",error:a,fetchingParams:r}),null}}},appendNewResults:e=>async(a,t)=>{const{originalData:r,sharedCharts:n}=t().results;if(!e)return a(Ve());a({type:"TOP/LOADING"});try{const t=await a(T({url:"".concat(j,"/").concat(Ue,"?").concat(De.a.stringify({start_date:e}))}));if(t.error)throw new Error(t.error);const s=g.a.filter(e=>{const a=n[e.shared_chart];if(!a)return!0;const t=g.a.find(a=>a.id===e.id||a.playerId===e.player&&a.isRank===!!e.rank_mode,a.results);return t?!(t.id===e.id||t.score>=e.score):!(1===e.player&&a.results[0].score>e.score)},t.results);if(console.log("Received results:",t,"; Will append:",s),g.a.isEmpty(s))a({type:"TOP/STOP_LOADING"});else{const e={players:t.players,results:[...r.results,...s],shared_charts:{...r.shared_charts,...t.shared_charts}};a(qe(e))}}catch(s){console.log(s),a({type:"TOP/ERROR",error:s})}},addPopup:({type:e,parameters:a,fadeIn:t,fadeOut:r,timeout:n,persistent:s})=>({type:"POPUPS/ADD",popupType:e,parameters:a,fadeIn:t,fadeOut:r,timeout:n,persistent:s}),fetchUserPreferences:e=>async a=>await a(T({url:"".concat(j,"/player/").concat(e,"/preferences")}))};var Ut=Object(i.b)(e=>({isLoading:e.topPerSong.isLoading,songTopData:e.topPerSong.data,error:e.topPerSong.error,profiles:e.results.profiles,topPlayersList:Ht(e),sharedCharts:e.results.sharedCharts}),Gt)((function({isLoading:e,fetchTopPerSong:a,fetchUserPreferences:t,appendNewResults:s,songTopData:l,error:c,profiles:i,topPlayersList:o,sharedCharts:m={},addPopup:d}){const[p,u]=Object(r.useState)(""),[h,E]=Object(r.useState)(""),[f,y]=Object(r.useState)(!1),[v,b]=Object(r.useState)(null),[N,S]=Object(r.useState)(null),[k,P]=Object(r.useState)(null),[O,R]=Object(r.useState)(null),[x,C]=Object(r.useState)(null),[L,I]=Object(r.useState)(""),[w,_]=Object(r.useState)(null),[D,T]=Object(r.useState)(null),M=Object(r.useRef)(null),F=Object(r.useRef)(null),B=Object(r.useRef)(null),j=Object(r.useRef)(null),H=Object(r.useRef)(null),G=Object(r.useMemo)(()=>!O||g.a.isEmpty(i)?{}:g.a.minBy(e=>It.a.get(e.nameArcade,O),g.a.values(i))||{},[O,i]),U=Object(r.useMemo)(()=>!x||g.a.isEmpty(i)?{}:g.a.minBy(e=>It.a.get(e.nameArcade,x),g.a.values(i))||{},[x,i]),K=e=>(a,t)=>{g.a.keys(a).forEach(r=>{a[r].progress!==t[r].progress&&d({type:wt,fadeIn:!0,fadeOut:!0,parameters:{playerName:e,achievementName:r,progress:[a[r].progress,t[r].progress]}})})},W={pp:fa(g.a.get("pp.pp",G),G.name),elo:fa(G.ratingRaw,G.name),exp:fa(G.exp,G.name),expRank:fa(G.expRank,G.name),achievements:fa(G.achievements,G.name,K(G.name))},V=ya(W),q={pp:fa(g.a.get("pp.pp",U),U.name),elo:fa(U.ratingRaw,U.name),exp:fa(U.exp,U.name),expRank:fa(U.expRank,U.name),achievements:fa(U.achievements,U.name,K(U.name))},Y=ya(q);Object(r.useEffect)(()=>{G.id&&t(G.id).then(e=>{_(e.preferences)})},[G.id,t]),Object(r.useEffect)(()=>{U.id&&t(U.id).then(e=>{T(e.preferences)})},[U.id,t]);const z=Object(r.useCallback)(()=>{b(!0),H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{b(!1),R(null),C(null),S(null),P(null),I(""),_(null),T(null)},31e4)},[]);Object(r.useEffect)(()=>{j.current=new WebSocket("ws://127.0.0.1:6789"),j.current.onerror=()=>{u("Cannot connect to websocket server, please reload the page")},j.current.onopen=e=>{y(!0)}},[]),Object(r.useEffect)(()=>{j.current.onmessage=e=>{z();try{const t=e&&e.data&&JSON.parse(e.data);if(console.log(t),"result_screen"===t.type){console.log("Resetting tracking because received result screen"),V(),Y();const e=t.data.track_name,r=g.a.get("left.chart_label",t.data),n=g.a.get("right.chart_label",t.data),l=g.a.get("left.result.player_name",t.data),c=g.a.get("right.result.player_name",t.data);R(l),C(c),S(r),P(n),I(e),s(t.data.gained),a(e,r,n)}else if("chart_selected"===t.type&&(E(t.data.error||""),(t.data.leftPlayer||t.data.rightPlayer)&&(R(t.data.leftPlayer),C(t.data.rightPlayer)),(t.data.leftLabel||t.data.rightLabel)&&(S(t.data.leftLabel),P(t.data.rightLabel),t.data.text))){const e=t.data.text;I(e),console.log("song name",e,L),L!==e&&a(e,t.data.leftLabel,t.data.rightLabel)}}catch(t){console.log("on message error",t),u("Error: ".concat(t.message))}}},[L,a,z,s,V,Y]),Object(r.useEffect)(()=>{if(M.current&&F.current)if(B.current){const e=F.current,a=B.current,t={w:M.current.clientWidth,h:M.current.clientHeight},r=t.w/(e.offsetWidth+a.offsetWidth),n=t.h/Math.max(e.offsetHeight,a.offsetHeight),s=t.w/Math.max(e.offsetWidth,a.offsetWidth),l=t.h/(e.offsetHeight+a.offsetHeight);Math.min(r,n)>Math.min(s,l)?(M.current.style.flexDirection="row",M.current.style.alignItems="center",M.current.style.transform="scale(".concat(r>n?.98*n:.98*r,")")):(M.current.style.flexDirection="column",M.current.style.alignItems="center",M.current.style.transform="scale(".concat(s>l?.98*l:.98*s,")"))}else{const e=F.current,a={w:M.current.clientWidth,h:M.current.clientHeight},t=a.w/e.offsetWidth,r=a.h/e.offsetHeight;M.current.style.transform="scale(".concat(t<r?.98*t:.98*r,")")}});const X=g.a.find({chartLabel:N},l),J=g.a.find({chartLabel:k},l),Q=g.a.uniq(g.a.compact([X,J]));return n.a.createElement("div",{className:"tracker-container"},n.a.createElement(Ft,null),n.a.createElement("div",{className:"sidebar"},n.a.createElement(jt,{player:O,profile:G,label:N,trackedData:W,preferences:w,topPlayersList:o,isLeft:!0,addPopup:d}),n.a.createElement(jt,{player:x,profile:U,label:k,trackedData:q,preferences:D,topPlayersList:o,addPopup:d})),n.a.createElement("div",{className:"results",ref:M},(c||p)&&n.a.createElement("div",{className:"error"},p,n.a.createElement("br",null),c&&c.message),f&&!O&&!x&&!h&&!e&&g.a.isEmpty(Q)&&(null===v?n.a.createElement("div",{className:"msg"},"Waiting for recognizer..."):v?n.a.createElement("div",{className:"msg"},"Waiting for chart select..."):n.a.createElement("div",{className:"offline msg"},"Recognizer is offline")),f&&(N||k)&&!h&&!e&&g.a.isEmpty(Q)&&"No results for this chart",e&&n.a.createElement(A,null),!e&&Q.map((e,a)=>{const t=g.a.omitBy(e=>!e,g.a.getOr({},"playersHiddenStatus",w)),r=g.a.omitBy(e=>!e,g.a.getOr({},"playersHiddenStatus",D)),s=Object.keys(t).reduce((e,a)=>({...e,[a]:t[a]&&r[a]}),{});return n.a.createElement(ka,{ref:0===a?F:B,playersHiddenStatus:s,key:e.sharedChartId,chart:e,leftProfile:G,rightProfile:U,isSocketView:!0})})))}));t(432);const Kt={isLoading:!1,data:{},error:null};function Wt(){const e=Object(i.c)(),[a,t]=Object(r.useState)(null),s=Object(i.d)(e=>e.tournament.data),l=Object(i.d)(e=>e.results.profiles),o=Object(i.d)(e=>e.tournament.isLoading),m=Object(i.d)(e=>g.a.get("player.id",e.user.data));if(Object(r.useEffect)(()=>{e(async e=>{e({type:"TOURNAMENT/LOADING"});try{const a=await e(T({url:"".concat(j,"/tournament/info")}));return e({type:"TOURNAMENT/SUCCESS",data:a}),a}catch(a){return e({type:"TOURNAMENT/ERROR",error:a}),null}})},[e]),Object(r.useEffect)(()=>{if(m&&!a&&g.a.get("brackets",s)){const e=g.a.find(e=>e.playerIds.includes(m),s.brackets);e&&t(e)}},[m,a,s]),o||g.a.isEmpty(l))return n.a.createElement(A,null);const{tournament:d,brackets:p}=s;if(!d)return null;const u=new Date(d.start_date),h=u.toLocaleString("default",{month:"long"}),f="".concat(u.getFullYear()," ").concat(h);return n.a.createElement("div",{className:"tournaments-page"},n.a.createElement("header",null,f),n.a.createElement("div",{className:"description"},n.a.createElement("div",{className:"labeled-item"},n.a.createElement("div",{className:"title"},"Start date:"),n.a.createElement("div",{className:"text"},new Date(d.start_date).toLocaleDateString())),n.a.createElement("div",{className:"labeled-item"},n.a.createElement("div",{className:"title"},"End date:"),n.a.createElement("div",{className:"text"},new Date(d.end_date).toLocaleDateString()))),n.a.createElement("div",{className:"brackets-title"},"Brackets:"),n.a.createElement("div",{className:"brackets"},p.map(e=>n.a.createElement("div",{key:e.name,className:w()("bracket",{active:e.name===g.a.get("name",a)}),onClick:()=>t(e)},n.a.createElement("div",{className:"bracket-name"},e.name),e.charts.map(e=>{const[a,t]=oe(e.label);return n.a.createElement("div",{className:"chart",key:e.sharedChartId},n.a.createElement(Na,{type:a,level:t})," ",e.trackName)})))),a&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"results-title"},"Results:"),n.a.createElement("div",{className:"results"},n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{className:"player-name"},"player"),n.a.createElement("th",{className:"total"},"total"),a.charts.map(e=>{const[a,t]=oe(e.label);return n.a.createElement("th",{colSpan:3,key:e.sharedChartId},n.a.createElement("div",{className:"chart-header"},n.a.createElement(Na,{type:a,level:t})," ",n.a.createElement(c.c,{exact:!0,to:E.sharedChart.getPath({sharedChartId:e.sharedChartId})},e.trackName)))}))),n.a.createElement("tbody",null,(()=>{const e=g.a.flow(g.a.groupBy("player_id"),g.a.mapValues(g.a.flow(g.a.map(e=>({...e,columnIndex:g.a.findIndex({sharedChartId:e.shared_chart},a.charts)})),g.a.groupBy("columnIndex"))))(a.scores),t=a.charts.map((a,t)=>({...a,maxScore:g.a.flow(g.a.values,g.a.flatMap(t),g.a.maxBy("score"),g.a.get("score"))(e)})),r=g.a.mapValues(g.a.flow(g.a.toPairs,g.a.map(([e,a])=>{const r=t[e].maxScore,n=g.a.flow(g.a.maxBy("score"),g.a.get("score"))(a),s=(n/r*100).toFixed(1);return[e,{playerName:a[0].player_name,playcount:a.length,score:n,percent:s,percentRaw:n/r}]}),e=>{const a=g.a.sumBy("[1].percentRaw",e);return{infoByIndex:g.a.fromPairs(e),totalPercentRaw:a,totalPercent:(100*a).toFixed(1)}}),e),s=g.a.flow(g.a.keys,g.a.orderBy(e=>r[e].totalPercentRaw,["desc"]))(r),c=g.a.remove(e=>s.includes(g.a.toString(e))||!l[e],a.playerIds);return[...s,...c].map(e=>{const t=r[e]||{},s=g.a.get("name",l[e])||t.playerName;return n.a.createElement("tr",{key:e},n.a.createElement("td",{className:"player-name"},s),n.a.createElement("td",{className:"total"},t.totalPercent||0),a.charts.map((e,a)=>{const r=t.infoByIndex&&t.infoByIndex[a];return n.a.createElement(n.a.Fragment,{key:a},n.a.createElement("td",null,r&&"".concat(r.percent,"%")),n.a.createElement("td",null,r&&oa()(r.score).format("0,0")),n.a.createElement("td",null,r&&r.playcount))}))})})())))))}const Vt={isLoading:!1,data:[]};const qt=()=>async e=>{e({type:"TRACKLIST/LOADING"});try{const a=await e(T({url:"".concat(j,"/tracklist/stats/XX")}));return e({type:"TRACKLIST/SUCCESS",data:a}),a}catch(a){return e({type:"TRACKLIST/ERROR",error:a}),null}},Yt={isLoading:!1,data:null,error:null};u.a.setAppElement("#root");var zt=function(){const e=Object(i.c)(),a=Object(i.d)(e=>e.user.data),t=Object(i.d)(e=>e.user.isLoading);return Object(r.useEffect)(()=>{Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET||(e(vt()),d.a.getItem("filter").then(a=>{a&&e(Ye({...g.a.omit("song",a),chartRange:a.chartRange&&{...a.chartRange,range:g.a.every(e=>e>=R[0]&&e<=R[1],a.chartRange.range)?a.chartRange.range:R}}))}).catch(e=>console.error("Cannot get filter from local storage",e)))},[e]),Object(r.useEffect)(()=>{!Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET&&a&&a.player&&Promise.all([e(async e=>{e({type:"PLAYERS/LOADING"});try{const a=await e(T({url:"".concat(j,"/players")}));return e({type:"PLAYERS/SUCCESS",data:a.players}),a.players}catch(a){return e({type:"PLAYERS/ERROR",error:a}),null}}),e(qt()),e(async e=>{e({type:"PREFERENCES/LOADING"});try{const a=await e(T({url:"".concat(j,"/profile/preferences")}));return e({type:"PREFERENCES/SUCCESS",data:a.preferences}),a}catch(a){return e({type:"PREFERENCES/ERROR",error:a}),null}})]).then(()=>{e(xa())})},[e,a]),Object(r.useEffect)(()=>{Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET&&e(qt()).then(()=>{e(Ve())})},[e]),t?n.a.createElement("div",{className:"container"},n.a.createElement(A,null)):Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET?n.a.createElement(Ut,null):a&&a.player?n.a.createElement("div",{className:"container"},n.a.createElement(kt,null),n.a.createElement(o.b,{exact:!0,path:"/",render:()=>n.a.createElement(o.a,{to:E.path})}),n.a.createElement(o.b,{exact:!0,path:E.path,component:Fa}),n.a.createElement(o.b,{exact:!0,path:E.sharedChart.path,component:Fa}),n.a.createElement(o.b,{path:y.path,component:qa}),n.a.createElement(o.b,{path:b.path},n.a.createElement(o.d,null,n.a.createElement(o.b,{path:b.path,exact:!0,component:ot}),n.a.createElement(o.b,{path:b.compare.path,exact:!0,component:ft}))),n.a.createElement(o.b,{path:f.path,component:fe}),n.a.createElement(o.b,{path:v.path,component:Wt})):n.a.createElement(Ct,null)},Xt=t(33),Jt=t(112),Qt=Object(Xt.c)({mostPlayed:function(e=G,a){switch(a.type){case"MOST_PLAYED/LOADING":return{...e,isLoading:!0};case H:return{...e,isLoading:!1,error:a.error};case"MOST_PLAYED/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},mostPlayedMonth:function(e=U,a){switch(a.type){case"MOST_PLAYED_MONTH/LOADING":return{...e,isLoading:!0};case"MOST_PLAYED_MONTH/ERROR":return{...e,isLoading:!1,error:a.error};case"MOST_PLAYED_MONTH/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},leastPlayed:function(e=K,a){switch(a.type){case"LEAST_PLAYED/LOADING":return{...e,isLoading:!0};case"LEAST_PLAYED/ERROR":return{...e,isLoading:!1,error:a.error};case"LEAST_PLAYED/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}}});const Zt=Object(Xt.c)({charts:function(e=Oa,a){switch(a.type){case"CHARTS_LOADING":return{...e,isLoading:!0};case"CHARTS_LOADING_FINISH":return{...e,isLoading:!1};case"SET_CHARTS":return{...e,data:a.data,lastUpdatedOn:a.lastUpdatedOn};case"RESET_CHARTS":return Oa;default:return e}},login:function(e=bt,a){switch(a.type){case"LOGIN/LOADING":return{...e,isLoading:!0,data:null,error:null};case"LOGIN/ERROR":return{...e,isLoading:!1,error:a.error,data:null};case"LOGIN/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},players:function(e=Yt,a){switch(a.type){case"PLAYERS/LOADING":return{...e,isLoading:!0,error:null};case"PLAYERS/ERROR":return{...e,isLoading:!1,error:a.error,data:{}};case"PLAYERS/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},popups:function(e=_t,a){switch(a.type){case"POPUPS/ADD":const t=g.a.uniqueId("popup");return{...e,popups:[...e.popups,{id:t,type:a.popupType,...g.a.pick(["parameters","fadeIn","fadeOut","timeout","persistent"],a)}]};case"POPUPS/REMOVE":return{...e,popups:g.a.remove({id:a.id},e.popups)};default:return e}},preferences:function(e=Ua,a){switch(a.type){case"PREFERENCES/LOADING":return{...e,isLoading:!0,error:null};case"PREFERENCES/ERROR":return{...e,isLoading:!1,error:a.error,data:Ga};case"PREFERENCES/SUCCESS":return{...e,isLoading:!1,data:g.a.merge(Ga,a.data)};case"PREFERENCES/CHANGE":return{data:a.data};default:return e}},presets:function(e=Qe,a){switch(a.type){case"PRESETS/LOAD_PRESETS":const t=g.a.find({name:g.a.get("name",e.currentPreset)},a.presets);return{...e,currentPreset:Ze(t)||null,presets:g.a.map(Ze,a.presets)};case"PRESETS/SELECT_PRESET":return{...e,currentPreset:Ze(a.currentPreset)};case"PRESETS/LOADING_START":return{...e,isLoading:!0};case"PRESETS/LOADING_END":return{...e,isLoading:!1};default:return e}},profiles:function(e=Za,a){switch(a.type){case"PROFILES/SET_FILTER":return{...e,filter:a.filter};case"PROFILES/RESET_FILTER":return{...e,filter:Qa};default:return e}},results:function(e=We,a){switch(a.type){case"TOP/LOADING":return{...e,isLoading:!0};case"TOP/STOP_LOADING":return{...e,isLoading:!1};case"TOP/ERROR":return{...e,isLoading:!1,error:a.error,data:We.data,players:We.players,profiles:We.profiles,results:We.results,sharedCharts:We.sharedCharts,scoreInfo:{}};case"TOP/SUCCESS":return{...e,isLoading:!1,isLoadingRanking:!0,data:a.data,players:a.players,profiles:a.profiles,results:a.results,sharedCharts:a.sharedCharts,originalData:a.originalData,scoreInfo:{}};case"TOP/PROFILES_UPDATE":return{...e,isLoadingRanking:!1,profiles:a.profiles,resultInfo:a.resultInfo,sharedCharts:a.sharedCharts,data:g.a.values(a.sharedCharts)};case"TOP/SET_FILTER":return{...e,filter:a.filter};case"TOP/RESET_FILTER":return{...e,filter:Ke};case"TOP/RANKING_CHANGE_SET":const t=!g.a.isEmpty(a.listPrev);return{...e,profiles:g.a.mapValues(e=>{const r={...e,prevRating:g.a.get(e.id,a.rankingsPointsMap)};return t?g.a.includes(r.id,a.listPrev)?g.a.includes(r.id,a.listNow)?{...r,change:g.a.indexOf(r.id,a.listPrev)-g.a.indexOf(r.id,a.listNow)}:{...r,change:"?"}:{...r,change:"NEW"}:r},e.profiles)};default:return e}},topPerSong:function(e=Bt,a){switch(a.type){case"TOP_PER_SONG/LOADING":return{...e,isLoading:!0,fetchingParams:a.fetchingParams,data:null,error:null};case"TOP_PER_SONG/ERROR":return a.fetchingParams===e.fetchingParams?{...e,isLoading:!1,error:a.error,data:null,fetchingParams:null}:e;case"TOP_PER_SONG/SUCCESS":return a.fetchingParams===e.fetchingParams?{...e,isLoading:!1,data:a.data,fetchingParams:null}:e;default:return e}},tournament:function(e=Kt,a){switch(a.type){case"TOURNAMENT/LOADING":return{...e,isLoading:!0,error:null};case"TOURNAMENT/ERROR":return{...e,isLoading:!1,error:a.error,data:{}};case"TOURNAMENT/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},tracklist:function(e=Vt,a){switch(a.type){case"TRACKLIST/LOADING":return{...e,isLoading:!0};case"TRACKLIST/ERROR":return{...e,isLoading:!1,error:a.error};case"TRACKLIST/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},trackStats:Qt,user:function(e=yt,a){switch(a.type){case"USER/LOADING":return{...e,isLoading:!0,data:null};case"USER/ERROR":return{...e,isLoading:!1,error:a.error,data:null};case"USER/SUCCESS":return{...e,isLoading:!1,data:a.data};case"USER/RESET":return yt;default:return e}}}),$t=Object(Xt.e)(Zt,(window.__REDUX_DEVTOOLS_EXTENSION__,Object(Xt.a)(Jt.a)));l.a.render(n.a.createElement(i.a,{store:$t},n.a.createElement(c.a,null,n.a.createElement(zt,null))),document.getElementById("root"))},77:function(e,a,t){var r=t(260),n=["getProcessedProfiles"];e.exports=function(){var e=new Worker(t.p+"59428aa818000367af89.worker.js",{name:"[hash].worker.js"});return r(e,n),e}}},[[213,1,2]]]);
//# sourceMappingURL=main.40d41742.chunk.js.map