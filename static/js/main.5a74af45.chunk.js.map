{"version":3,"sources":["utils/polyfills.js","constants/routes.js","constants/leaderboard.js","components/Shared/Overlay/Overlay.js","components/Shared/ToggleButton/ToggleButton.js","components/Shared/Loader/index.js","components/Shared/Input/Input.js","components/Shared/Toggle/Toggle.js","components/Shared/CollapsibleBar/index.js","components/Shared/Range/index.js","components/Leaderboard/ChartFilter.js","reducers/user/resetAction.js","utils/fetch.js","utils/exp.js","utils/achievements.js","utils/date.js","constants/env.js","reducers/ranking.js","reducers/profiles.js","constants/backend.js","reducers/results.js","reducers/presets.js","components/Leaderboard/PresetsControl.js","utils/leaderboards.js","utils/colors.js","reducers/selectors.js","components/Leaderboard/Leaderboard.js","components/Ranking/RankingList.js","components/Ranking/RankingFaq.js","components/Ranking/Ranking.js","components/Profile/MostPlayed.js","components/Profile/ExpFaq.js","components/Profile/Profile.js","reducers/user/index.js","reducers/login.js","components/Shared/TopBar/TopBar.js","components/LoginScreen/LoginScreen.js","reducers/tracklist.js","components/App.js","reducers/index.js","index.js"],"names":["Number","isNaN","value","Math","sign","x","Array","prototype","findIndex","Object","defineProperty","predicate","this","TypeError","o","len","length","thisArg","arguments","k","kValue","call","configurable","writable","routes","leaderboard","path","ranking","faq","profile","getPath","params","id","SORT","DEFAULT","PROTAGONIST","RANK_ASC","RANK_DESC","NEW_SCORES_PLAYER","CHART_MIN_MAX","DURATION","STD","SHORT","REMIX","FULL","DURATION_DEFAULT","_","values","POPPER_MODIFIERS","preventOverflow","enabled","padding","boundariesElement","PLACEMENT_ARROW_MAPPING","right","left","top","bottom","getArrowPlacement","placement","split","Overlay","state","isVisible","containerItemRef","React","createRef","renderPopper","bind","toggleOverlayVisibility","setState","event","target","closest","hideOverlay","ref","style","arrowProps","outOfBoundaries","scheduleUpdate","props","children","hideWhenOutOfBounds","data-placement","className","classNames","overlayClassName","overlayItem","Fragment","onClick","ReactDOM","createPortal","container","document","body","modifiers","referenceElement","current","PureComponent","defaultTypes","listensToClickOutside","ToggleButton","active","onToggle","text","Loader","width","height","viewBox","xmlns","fill","cx","cy","r","attributeName","from","to","begin","dur","calcMode","repeatCount","fillOpacity","Input","isNil","defaultValue","bindAll","prevProps","e","newValue","onChange","type","numericValue","min","max","onBlur","key","handleBlur","omit","onKeyPress","handleKeyPress","onInput","handleChange","noop","Component","defaultProps","Toggle","checked","uniqueId","htmlFor","CollapsibleBar","open","defaultOpen","title","Range","range","step","renderTrack","onMouseDown","onTouchStart","position","display","borderRadius","background","getTrackBackground","colors","alignSelf","renderThumb","isDragged","backgroundColor","justifyContent","alignItems","boxShadow","ChartFilter","filterValue","onChangeEx","getOr","duration","buttonText","t","isEqual","isEmpty","newMin","newMax","includes","without","RESET","resetUser","fetchJson","url","request","method","postJson","JSON","stringify","headers","defaultHeaders","async","dispatch","getState","session","cookies","get","response","fetch","credentials","status","json","error","isObject","isString","Error","message","Promise","reject","gradeValue","F","D","C","B","A","S","SS","SSS","getExp","result","chart","isBestGradeOnChart","chartType","chartLevel","grade","getRankImg","rank","color","src","process","iconName","alt","threshold","ranks","achievements","icon","GiRank1","description","resultFunction","progress","combo","GiRank2","GiRank3","GiSmokingFinger","initialState","playedSongs","songsToPlay","song","uniq","GiRetroController","GiLoveSong","Улитка","GiSnail","charts","some","songToPlay","chartLabel","GiPodiumSecond","miss","bad","GiLifeBar","GiWoodenPegleg","good","great","initialAchievementState","parseDate","textDate","moment","toDate","Date","localStorage","window","debugOn","setItem","debugOff","removeItem","DEBUG","getItem","SET_RANKINGS","RANKING_CHANGE_SET","map","flow","q","rating","fromPairs","SET_PROFILES","SET_FILTER","RESET_FILTER","defaultFilter","isLoading","data","filter","postProcessProfiles","profiles","tracklist","mapValues","neededGrades","expRank","findLast","exp","expRanks","expRankNext","find","double","single","gradeIncrementMap","keys","resultsByLevel","forEach","level","res","thisGrade","thisPlayerId","playerId","otherResults","results","sort","a","b","indexOf","gradeIncArray","gradeInc","l","g","prog","incrementLevel","number","minimumNumber","totalCharts","round","sqrt","getMinimumNumber","bonusCoefficientNumber","bonus","getBonusForLevel","accuracy","countAcc","sumAccuracy","HOST","LOADING","SUCCESS","ERROR","showRank","showRankAndNorank","players","sharedCharts","gradeComparator","guessGrade","misses","bads","goods","greats","mapResult","recognition_notes","isUnknownPlayer","player","arcade_name","isIntermediateResult","sharedChartId","shared_chart","nickname","nicknameArcade","date","gained","dateObject","isExactDate","exact_gain_date","score","isRank","rank_mode","_r","originalChartMix","original_mix","originalChartLabel","original_label","originalScore","original_score","scoreIncrease","score_increase","calories","perfect","perfects","max_combo","mods","mods_list","isHJ","isMachineBest","isMyBest","maxTotalSteps","infos","fixableIndex","absentNumbersCount","localStepSum","i","isNumber","tryFixIncompleteResult","acc","floor","accRaw","toFixed","accuracyRaw","getMaxScore","initializeProfile","name","nameArcade","resultsByGrade","lastResultDate","count","battleCount","grades","rankingHistory","ratingHistory","lastPlace","lastBattleDate","achName","getProfileInfoFromResult","replace","convert","cap","achState","processData","shared_charts","mappedResults","getTopResultId","getBestGradeResultId","topResults","bestGradeResults","battles","resRaw","sharedChart","label","toUpper","chart_label","match","track_name","max_total_steps","totalResultsCount","chartTop","push","topResultId","currentTopResult","oldScoreIndex","splice","newScoreIndex","sortedLastIndexBy","latestScoreDate","enemyResult","bestGradeResultId","currentBestGradeRes","chartId","maxScoreWithAccuracy","maxScoreResult","maxScore","dictChartElo","getDictChartEloId","enemyScore","dictRatingDiff","getDictRatingDiffId","p1","p2","scoreMultiplier","startingRating","r1","r2","R1","R2","E1","E2","S1","S2","kRating1","kRating2","maxK1","maxK2","kLevel1","kLevel2","kLevel","kMinimizer","startsWith","K1","K2","dr1","dr2","baseEloId1","baseEloId2","baseEloP1","baseEloP2","ratingDiffId1","ratingDiffId2","ratingDiff","ratingDiffLast","console","log","playersSorted","orderBy","battleDate","index","place","getTime","p1LastRating","last","p2LastRating","toInteger","ratingRaw","now","processBattles","fetchResults","toPairs","calculateRankingChanges","setFilter","getListOfNames","getMapOfRatings","all","localForage","lastChangedRanking","lastChangedRankingPoints","lastFetchedRanking","listNow","listLastFetched","listLastChanged","mapPointsNow","mapPointsLastFetched","rankingsPointsMap","listPrev","warn","SELECT_PRESET","LOAD_PRESETS","LOADING_START","LOADING_END","presets","currentPreset","itemToOption","item","reloadPresets","startLoading","endLoading","selectPreset","openPreset","then","noPresetsMessage","mapDispatchToProps","loadPresets","savePreset","newPreset","confirm","withoutOldPreset","remove","newPresets","deletePreset","PresetsControl","onChangeSelection","selected","onRewritePreset","onSavePreset","isAddingNew","classNamePrefix","placeholder","options","noOptionsMessage","disabled","connect","TimeAgo","addLocale","ru","timeAgo","timeStyle","flavour","gradation","convenient","units","tooltipFormatter","toLocaleDateString","resultType","undefined","flexDirection","getTimeAgo","dayDiff","startOf","diff","hour","format","colorsArray","playersSelector","createSelector","sortBy","it","toLower","filteredDataSelector","names","namesOr","playersOr","namesNot","playersNot","sortingType","protagonist","excludeAntagonists","defaultSorting","newScoresProtagonistSorting","protagonistSorting","row","protIndex","protScore","enemies","take","uniqBy","distanceFromProtagonist","reduce","dist","enemy","getScoreSorting","direction","Infinity","sortingFunctions","compact","chartRange","items","rows","filterCharts","showOnlyRank","occuredNames","alreadyOccured","rowNames","every","size","matchSorter","ANIMATION_DURATION","sortingOptions","resetFilter","Leaderboard","showItemsCount","chartOverrides","curry","onRefresh","onTypeSongName","debounce","onRedoLatestResult","throttle","overrides","drop","onUndoLatestResult","undoedResult","maxBy","undoedPlayerId","previousPlayerResult","newResults","latestScore","overrideChart","renderSimpleSearch","renderFilters","closeMenuOnSelect","isMulti","renderSortings","isClearable","render","filteredData","canShowMore","visibleData","slice","showProtagonistRatingChange","highlightProtagonist","protagonistName","uniqueSelectedNames","preset","chartOriginal","chartIndex","first","topPlace","occuredNicknames","isSecondOccurenceInResults","singlep","doublep","coop","href","rel","isActive","currentIndex","canUndo","enterAnimation","leaveAnimation","typeName","maintainContainerHeight","nameIndex","placeDifference","newIndex","prevScore","findLastIndex","empty","latest","fontWeight","vj","hj","content","tooltipClassName","numeral","exact","getGradeImg","RankingList","playerIndex","change","prevRating","down","up","RankingFaq","rankingSelector","Ranking","component","withRouter","useState","setLoading","limit","setLimit","setData","useEffect","success","catch","latestDate","ExpFaq","MIN_GRAPH_HEIGHT","defaultGradesDistribution","defaultGradesWithLevelsDistribution","flatMap","cutRange","array","startIndex","endIndex","firstElement","lastElement","profileSelector","levelsDistribution","y","singlesLevels","doublesLevels","gradesData","update","gradesDistribution","groupBy","pick","sum","gradesValues","gradesAndLevelsDistribution","groupedResults","counts","countBy","reduced","levelsData","lastTickRating","lastTickRanking","lastTick","firstTick","lastDay","endOf","minMaxRange","filterRange","dayRange","dayRangeMs","placesChanges","ratingChanges","setProfilesFilter","resetProfilesFilter","Profile","isLevelGraphCombined","showFaq","onChangeDayRange","onShowFaq","onHideFaq","componentWillUnmount","renderRankingHistory","minHeight","aspect","margin","strokeDasharray","dataKey","domain","tickFormatter","allowDecimals","stroke","isAnimationActive","payload","strokeWidth","dot","renderPlaceHistory","dataMax","interval","reversed","renderGrades","ticks","stackId","renderGradesWithLevels","stackOffset","doubleItems","singleItems","abs","dataMin","offset","renderLevels","totalD","totalS","renderGradeBlock","obj","typeLetter","progr","minNumber","currentNumber","levelString","complete","zero","renderAchievement","achievement","Icon","expProgress","ariaHideApp","isOpen","onRequestClose","ceil","MostPlayed","fetchUser","login","googleResponse","token","tokenId","set","expires","loginACs","logout","isLoadingLogin","isLoadingUser","user","isClown","setClown","onGoogleResponse","clientId","onSuccess","onFailure","cookiePolicy","fetchTracklist","rootReducer","combineReducers","action","hasPrevList","playerOriginal","store","createStore","__REDUX_DEVTOOLS_EXTENSION__","applyMiddleware","thunk","getElementById"],"mappings":"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AWmJ,EAAKC,MAChBC,IAAG,UAAKC,IAAL,kBAAqCH,EAAKI,UAC7CC,IAAKL,EAAKM,YAIDC,GAAQ,CACnB,CACED,UAAW,EACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,QACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,UAET,CACEK,UAAW,IACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,IACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,IACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,IACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,IACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,IACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,QAET,CACEK,UAAW,KACXF,SAAU,SACVH,MAAO,U,aChKEO,GAAe,CAC1B,qCAAa,CACXC,KAAMC,KACNC,YAAa,8KACbC,e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","file":"static/js/main.5a74af45.chunk.js","sourcesContent":["/* eslint-disable */\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isNaN\r\nNumber.isNaN =\r\n  Number.isNaN ||\r\n  function(value) {\r\n    return value !== value;\r\n  };\r\n\r\nif (typeof Math.sign === 'undefined') {\r\n  Math.sign = function(x) {\r\n    return x > 0 ? 1 : x < 0 ? -1 : x;\r\n  };\r\n}\r\n\r\n// https://tc39.github.io/ecma262/#sec-array.prototype.findindex\r\nif (!Array.prototype.findIndex) {\r\n  Object.defineProperty(Array.prototype, 'findIndex', {\r\n    value: function(predicate) {\r\n      // 1. Let O be ? ToObject(this value).\r\n      if (this == null) {\r\n        throw new TypeError('\"this\" is null or not defined');\r\n      }\r\n\r\n      var o = Object(this);\r\n\r\n      // 2. Let len be ? ToLength(? Get(O, \"length\")).\r\n      var len = o.length >>> 0;\r\n\r\n      // 3. If IsCallable(predicate) is false, throw a TypeError exception.\r\n      if (typeof predicate !== 'function') {\r\n        throw new TypeError('predicate must be a function');\r\n      }\r\n\r\n      // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\r\n      var thisArg = arguments[1];\r\n\r\n      // 5. Let k be 0.\r\n      var k = 0;\r\n\r\n      // 6. Repeat, while k < len\r\n      while (k < len) {\r\n        // a. Let Pk be ! ToString(k).\r\n        // b. Let kValue be ? Get(O, Pk).\r\n        // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).\r\n        // d. If testResult is true, return k.\r\n        var kValue = o[k];\r\n        if (predicate.call(thisArg, kValue, k, o)) {\r\n          return k;\r\n        }\r\n        // e. Increase k by 1.\r\n        k++;\r\n      }\r\n\r\n      // 7. Return -1.\r\n      return -1;\r\n    },\r\n    configurable: true,\r\n    writable: true,\r\n  });\r\n}\r\n","export const routes = {\r\n  leaderboard: {\r\n    path: `/leaderboard`,\r\n  },\r\n  ranking: {\r\n    path: `/ranking`,\r\n    faq: {\r\n      path: '/ranking/faq',\r\n    },\r\n  },\r\n  profile: {\r\n    path: `/profiles/:id`,\r\n    getPath: params => `/profiles/${params.id}`,\r\n  },\r\n};\r\n","import _ from 'lodash/fp';\r\n\r\nexport const SORT = {\r\n  DEFAULT: 'default',\r\n  PROTAGONIST: 'protagonist',\r\n  RANK_ASC: 'rankAsc',\r\n  RANK_DESC: 'rankDesc',\r\n  NEW_SCORES_PLAYER: 'newScoresPlayer',\r\n};\r\n\r\nexport const CHART_MIN_MAX = [1, 28];\r\nexport const DURATION = {\r\n  STD: 'Standard',\r\n  SHORT: 'Short',\r\n  REMIX: 'Remix',\r\n  FULL: 'Full',\r\n};\r\nexport const DURATION_DEFAULT = _.values(DURATION);\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport toBe from 'prop-types';\r\nimport { Popper } from 'react-popper';\r\nimport classNames from 'classnames';\r\nimport listensToClickOutside from 'react-onclickoutside';\r\n\r\nimport './overlay.scss';\r\n\r\nconst POPPER_MODIFIERS = {\r\n  preventOverflow: {\r\n    enabled: true,\r\n    padding: 10,\r\n    boundariesElement: 'viewport',\r\n  },\r\n};\r\n\r\nconst PLACEMENT_ARROW_MAPPING = {\r\n  right: 'left',\r\n  left: 'right',\r\n  top: 'bottom',\r\n  bottom: 'top',\r\n};\r\n\r\nconst getArrowPlacement = placement => {\r\n  return placement && PLACEMENT_ARROW_MAPPING[placement.split('-')[0]];\r\n};\r\n\r\nclass Overlay extends React.PureComponent {\r\n  static propTypes = {\r\n    placement: toBe.string,\r\n    overlayItem: toBe.any,\r\n    hideWhenOutOfBounds: toBe.bool,\r\n  };\r\n\r\n  static defaultTypes = {\r\n    placement: 'bottom',\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      isVisible: false,\r\n    };\r\n    this.containerItemRef = React.createRef();\r\n    this.renderPopper = this.renderPopper.bind(this);\r\n    this.toggleOverlayVisibility = this.toggleOverlayVisibility.bind(this);\r\n  }\r\n\r\n  hideOverlay() {\r\n    this.setState({\r\n      isVisible: false,\r\n    });\r\n  }\r\n\r\n  toggleOverlayVisibility() {\r\n    this.setState({\r\n      isVisible: !this.state.isVisible,\r\n    });\r\n  }\r\n\r\n  handleClickOutside(event) {\r\n    const preventHiding = event && event.target.closest('.inner-popper-overlay'); // prevent overlays from hiding when a modal is opened within overlay\r\n\r\n    if (!preventHiding) {\r\n      this.hideOverlay();\r\n    }\r\n  }\r\n\r\n  renderPopper({ ref, style, placement, arrowProps, scheduleUpdate, outOfBoundaries }) {\r\n    const { children, hideWhenOutOfBounds } = this.props;\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        style={style}\r\n        data-placement={placement}\r\n        className={classNames(\r\n          'inner-popper-overlay',\r\n          `arrow-${getArrowPlacement(placement)}`,\r\n          this.props.overlayClassName,\r\n          { 'out-of-bounds': outOfBoundaries && hideWhenOutOfBounds }\r\n        )}\r\n      >\r\n        <div className=\"arrow-hider\">\r\n          <div className=\"arrow\" ref={arrowProps.ref} style={arrowProps.style} />\r\n        </div>\r\n        <div\r\n          className=\"inner-popper-content\"\r\n          // ref={ref => this.setupPopperContentRef(scheduleUpdate, ref)}\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { placement, overlayItem } = this.props;\r\n    const { isVisible } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <div\r\n          className=\"overlay-item\"\r\n          ref={this.containerItemRef}\r\n          onClick={this.toggleOverlayVisibility}\r\n        >\r\n          {overlayItem}\r\n        </div>\r\n        {isVisible &&\r\n          ReactDOM.createPortal(\r\n            <Popper\r\n              container={document.body}\r\n              modifiers={POPPER_MODIFIERS}\r\n              placement={placement}\r\n              referenceElement={this.containerItemRef.current}\r\n            >\r\n              {this.renderPopper}\r\n            </Popper>,\r\n            document.body\r\n          )}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default listensToClickOutside(Overlay);\r\n","import React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nimport './toggle-button.scss';\r\n\r\nexport default class ToggleButton extends React.PureComponent {\r\n  static propTypes = {\r\n    text: toBe.string,\r\n    onToggle: toBe.func,\r\n    active: toBe.bool,\r\n  };\r\n\r\n  render() {\r\n    const { active, onToggle, text } = this.props;\r\n    return (\r\n      <div\r\n        className={classNames('toggle-button', { active: active })}\r\n        onClick={() => onToggle(!active)}\r\n      >\r\n        {text}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nimport './loader.scss';\r\n\r\nexport default function Loader() {\r\n  return (\r\n    <div className=\"loader\">\r\n      <svg\r\n        width=\"40\"\r\n        height=\"12\"\r\n        viewBox=\"0 0 120 30\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        fill=\"#eee\"\r\n      >\r\n        <circle cx=\"15\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"60\" cy=\"15\" r=\"9\" fillOpacity=\"0.3\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"9\"\r\n            to=\"9\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"9;15;9\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"0.5\"\r\n            to=\"0.5\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\".5;1;.5\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"105\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n      </svg>\r\n    </div>\r\n  );\r\n}\r\n","/* eslint-disable react/no-deprecated */\r\n// imports from vendor deps\r\nimport React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash/fp';\r\n\r\n// imports from styles\r\nexport default class Input extends React.Component {\r\n  static propTypes = {\r\n    value: toBe.any,\r\n    defaultValue: toBe.any,\r\n    onChange: toBe.func,\r\n    onBlur: toBe.func,\r\n    type: toBe.string,\r\n    className: toBe.string,\r\n    trimOnBlur: toBe.bool,\r\n  };\r\n\r\n  static defaultProps = {\r\n    value: null,\r\n    type: 'text',\r\n    onChange: _.noop,\r\n    onBlur: _.noop,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      value: (!_.isNil(props.value) ? props.value : props.defaultValue) || '',\r\n    };\r\n    _.bindAll(['handleChange', 'handleBlur', 'handleKeyPress'], this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.value !== this.props.value) {\r\n      this.setState({ value: this.props.value });\r\n    }\r\n  }\r\n\r\n  handleChange(e) {\r\n    const newValue = e.target.value;\r\n    this.setState({ value: newValue }, () => this.props.onChange(newValue));\r\n  }\r\n\r\n  handleBlur(e) {\r\n    const { type } = this.props;\r\n    const { value } = this.state;\r\n    if (type === 'number') {\r\n      const numericValue = Number(value);\r\n      if (numericValue >= Number(e.target.min) && numericValue <= Number(e.target.max)) {\r\n        this.props.onBlur(numericValue, e);\r\n      } else {\r\n        this.setState({ value: this.props.value });\r\n        this.props.onBlur(this.props.value, e);\r\n      }\r\n    }\r\n  }\r\n\r\n  handleKeyPress(e) {\r\n    if (e.key === 'Enter') {\r\n      this.handleBlur(e);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { className } = this.props;\r\n\r\n    // HACK: This component uses onInput instead of onChange\r\n    // because IE11 fails to call onChange events when you paste/cut using context menu (RMB)\r\n    // We're using onInput because it works fine, and because for text input\r\n    // there's no difference between how onChange and onInput work\r\n    return (\r\n      <input\r\n        {..._.omit(['defaultValue', 'onChange'], this.props)}\r\n        className={classNames(className, 'text-input')}\r\n        value={this.state.value}\r\n        onBlur={this.handleBlur}\r\n        onKeyPress={this.handleKeyPress}\r\n        onInput={this.handleChange}\r\n        onChange={_.noop} // Handled by onInput\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\n\r\nimport './toggle.scss';\r\n\r\n// imports from styles\r\nexport default class Toggle extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.id = _.uniqueId();\r\n  }\r\n\r\n  onChange = e => {\r\n    this.props.onChange(e.target.checked);\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"toggle-checkbox\">\r\n        <input\r\n          type=\"checkbox\"\r\n          className=\"toggle-checkbox-cb\"\r\n          id={this.id}\r\n          onChange={this.onChange}\r\n          checked={this.props.checked}\r\n        />\r\n        <label htmlFor={this.id} className=\"toggle\">\r\n          <span></span>\r\n        </label>\r\n        <label htmlFor={this.id} className=\"text-label\">\r\n          {this.props.children}\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { FaChevronRight } from 'react-icons/fa';\r\nimport classNames from 'classnames';\r\n\r\nimport './styles.scss';\r\n\r\nexport default class CollapsibleBar extends PureComponent {\r\n  static propTypes = {\r\n    className: toBe.string,\r\n    children: toBe.any,\r\n    title: toBe.any,\r\n    defaultOpen: toBe.bool,\r\n  };\r\n\r\n  constructor(props) {\r\n    super();\r\n    this.state = { open: props.defaultOpen || false };\r\n  }\r\n\r\n  render() {\r\n    const { children, title, className } = this.props;\r\n    const { open } = this.state;\r\n\r\n    return (\r\n      <div className={classNames('collapsible-bar', className, { open })}>\r\n        <div className=\"header\" onClick={() => this.setState(state => ({ open: !state.open }))}>\r\n          <div className=\"collapse-button\">\r\n            <FaChevronRight />\r\n          </div>\r\n          <div className=\"title\">{title}</div>\r\n        </div>\r\n        {children && <div className=\"collapsible-children\">{children}</div>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { Range as ReactRange, getTrackBackground } from 'react-range';\r\n\r\nexport default function Range({ range, min, max, onChange }) {\r\n  return (\r\n    <ReactRange\r\n      values={range}\r\n      step={1}\r\n      min={min}\r\n      max={max}\r\n      onChange={onChange}\r\n      renderTrack={({ props, children }) => (\r\n        <div\r\n          onMouseDown={props.onMouseDown}\r\n          onTouchStart={props.onTouchStart}\r\n          style={{\r\n            ...props.style,\r\n            position: 'relative',\r\n            height: '10px',\r\n            display: 'flex',\r\n            width: '100%',\r\n          }}\r\n        >\r\n          <div\r\n            ref={props.ref}\r\n            style={{\r\n              height: '6px',\r\n              width: '100%',\r\n              borderRadius: '3px',\r\n              background: getTrackBackground({\r\n                values: range,\r\n                colors: ['#ccc', '#88d3ff', '#ccc'],\r\n                min,\r\n                max,\r\n              }),\r\n              alignSelf: 'center',\r\n            }}\r\n          >\r\n            {children}\r\n          </div>\r\n        </div>\r\n      )}\r\n      renderThumb={({ props, isDragged }) => (\r\n        <div\r\n          {...props}\r\n          style={{\r\n            ...props.style,\r\n            height: '12px',\r\n            width: '12px',\r\n            borderRadius: '6px',\r\n            backgroundColor: '#FFF',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            boxShadow: '0px 2px 3px #AAA',\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              height: '6px',\r\n              width: '6px',\r\n              borderRadius: '3px',\r\n              backgroundColor: isDragged ? '#88d3ff' : '#CCC',\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n    />\r\n  );\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\nimport { FaCaretLeft, FaCaretRight } from 'react-icons/fa';\r\n\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Input from 'components/Shared/Input/Input';\r\nimport Range from 'components/Shared/Range';\r\n\r\nimport { CHART_MIN_MAX, DURATION_DEFAULT, DURATION } from 'constants/leaderboard';\r\n\r\nexport default function ChartFilter({ filterValue, onChange: onChangeEx }) {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filterValue);\r\n  const type = _.getOr(null, 'type', filterValue);\r\n  const duration = _.getOr(DURATION_DEFAULT, 'duration', filterValue);\r\n\r\n  let buttonText = 'фильтр чартов';\r\n  if (filterValue) {\r\n    const t = type || '';\r\n    buttonText = range[0] === range[1] ? `${t}${range[0]}` : `${t}${range[0]} - ${t}${range[1]}`;\r\n    buttonText = 'чарты: ' + buttonText;\r\n    if (!_.isEqual(duration, DURATION_DEFAULT)) {\r\n      buttonText += ' ***';\r\n      // buttonText += ` (${_.values(DURATION)\r\n      //   .filter(dur => duration.includes(dur))\r\n      //   .map(s => s.slice(0, 2))\r\n      //   .join('-')})`;\r\n    }\r\n  }\r\n\r\n  const onChange = value => {\r\n    onChangeEx({\r\n      range,\r\n      type,\r\n      ...value,\r\n      duration: _.isEmpty(value.duration) ? duration : value.duration,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Overlay\r\n        overlayClassName=\"chart-range-overlay-outer\"\r\n        overlayItem={\r\n          <button className=\"filter-charts-button btn btn-sm btn-dark\">{buttonText}</button>\r\n        }\r\n      >\r\n        <div className=\"chart-range-overlay\">\r\n          <div className=\"buttons\">\r\n            <ToggleButton\r\n              text=\"Single\"\r\n              active={type === 'S'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  type: active ? 'S' : null,\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Double\"\r\n              active={type === 'D'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  type: active ? 'D' : null,\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n          <Range\r\n            range={range}\r\n            min={CHART_MIN_MAX[0]}\r\n            max={CHART_MIN_MAX[1]}\r\n            onChange={r => onChange({ range: r })}\r\n          />\r\n          <div className=\"inputs\">\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  range: [Math.max(range[0] - 1, CHART_MIN_MAX[0]), range[1]],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={CHART_MIN_MAX[0]}\r\n              max={Math.min(CHART_MIN_MAX[1], range[1])}\r\n              value={range[0]}\r\n              onBlur={value => {\r\n                onChange({ range: [value, range[1]] });\r\n              }}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMin = Math.min(range[0] + 1, CHART_MIN_MAX[1]);\r\n                onChange({\r\n                  range: [newMin, range[1] < newMin ? newMin : range[1]],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n            <div className=\"_flex-fill\" />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMax = Math.max(range[1] - 1, CHART_MIN_MAX[0]);\r\n                onChange({\r\n                  range: [range[0] > newMax ? newMax : range[0], newMax],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={Math.max(CHART_MIN_MAX[0], range[0])}\r\n              max={CHART_MIN_MAX[1]}\r\n              value={range[1]}\r\n              onBlur={value => onChange({ range: [range[0], value] })}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  range: [range[0], Math.min(range[1] + 1, CHART_MIN_MAX[1])],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n          </div>\r\n          <div className=\"buttons-duration\">\r\n            <ToggleButton\r\n              text=\"Standard\"\r\n              active={duration.includes(DURATION.STD)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.STD]\r\n                    : _.without([DURATION.STD], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Short\"\r\n              active={duration.includes(DURATION.SHORT)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.SHORT]\r\n                    : _.without([DURATION.SHORT], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Remix\"\r\n              active={duration.includes(DURATION.REMIX)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.REMIX]\r\n                    : _.without([DURATION.REMIX], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Full\"\r\n              active={duration.includes(DURATION.FULL)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.FULL]\r\n                    : _.without([DURATION.FULL], duration),\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Overlay>\r\n    </div>\r\n  );\r\n}\r\n","export const RESET = `USER/RESET`;\r\nexport const resetUser = () => ({ type: RESET });\r\n","import _ from 'lodash/fp';\r\nimport cookies from 'browser-cookies';\r\n\r\nimport { resetUser } from 'reducers/user/resetAction';\r\n\r\nexport const fetchJson = ({ url }) => request({ url, method: 'get' });\r\nexport const postJson = ({ url, body }) =>\r\n  request({\r\n    url,\r\n    method: 'post',\r\n    body: JSON.stringify(body),\r\n    headers: {\r\n      'Content-Type': 'application/json;charset=utf-8',\r\n    },\r\n  });\r\n\r\nconst defaultHeaders = {};\r\n\r\nexport const request = ({ url, method, body, headers }) => async (dispatch, getState) => {\r\n  try {\r\n    const session = cookies.get('session');\r\n    if (session) {\r\n      defaultHeaders['Session'] = session;\r\n    }\r\n    const response = await fetch(url, {\r\n      method,\r\n      body,\r\n      headers: { ...defaultHeaders, ...headers },\r\n      credentials: 'include',\r\n    });\r\n    if (response.status >= 200 && response.status < 300) {\r\n      const data = await response.json();\r\n      return data;\r\n    } else {\r\n      const error = await response.json();\r\n      if (_.isObject(error) && _.isString(error.error)) {\r\n        throw new Error(error.error);\r\n      } else if (_.isString(error)) {\r\n        throw new Error(error);\r\n      } else {\r\n        throw new Error('HTTP Status ' + response.status);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    if (error.message === 'Invalid session') {\r\n      dispatch(resetUser());\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n","import React from 'react';\r\n\r\nexport const gradeValue = {\r\n  F: 0.1,\r\n  D: 0.2,\r\n  'D+': 0.3,\r\n  C: 0.3,\r\n  'C+': 0.5,\r\n  B: 0.5,\r\n  'B+': 0.8,\r\n  A: 0.8,\r\n  'A+': 1,\r\n  S: 1.1,\r\n  SS: 1.2,\r\n  SSS: 1.2,\r\n};\r\n\r\nexport const getExp = (result, chart) => {\r\n  if (!result.isBestGradeOnChart) {\r\n    return 0;\r\n  }\r\n  if (chart.chartType === 'COOP') {\r\n    return (chart.chartLevel * 1000 * (gradeValue[result.grade] || 0.8)) / 8;\r\n  }\r\n  const exp = (chart.chartLevel ** 2.31 * (gradeValue[result.grade] || 0.8)) / 9;\r\n  return exp;\r\n};\r\n\r\nexport const getRankImg = rank => (\r\n  <img\r\n    className={rank.color}\r\n    src={`${process.env.PUBLIC_URL}/ranks/${rank.iconName}`}\r\n    alt={rank.threshold}\r\n  />\r\n);\r\n\r\nexport const ranks = [\r\n  {\r\n    threshold: 0,\r\n    iconName: '0.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 1000,\r\n    iconName: '1.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 2000,\r\n    iconName: '2.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 3000,\r\n    iconName: '3.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 4000,\r\n    iconName: '4.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 5000,\r\n    iconName: '5.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 6250,\r\n    iconName: '6.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 7500,\r\n    iconName: '7.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 8750,\r\n    iconName: '8.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 10000,\r\n    iconName: '9.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 12000,\r\n    iconName: '10.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 14000,\r\n    iconName: '11.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 16000,\r\n    iconName: '12.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 18000,\r\n    iconName: '13.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 22000,\r\n    iconName: '14.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 26000,\r\n    iconName: '15.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 30000,\r\n    iconName: '16.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 35000,\r\n    iconName: '17.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 40000,\r\n    iconName: '18.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 50000,\r\n    iconName: '19.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 60000,\r\n    iconName: '20.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 70000,\r\n    iconName: '21.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 80000,\r\n    iconName: '22.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 100000,\r\n    iconName: '23.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 120000,\r\n    iconName: '24.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 140000,\r\n    iconName: '25.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 160000,\r\n    iconName: '26.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 180000,\r\n    iconName: '27.png',\r\n    color: 'green',\r\n  },\r\n];\r\n","import _ from 'lodash/fp';\r\n\r\nimport {\r\n  GiLoveSong,\r\n  GiLifeBar,\r\n  GiSmokingFinger,\r\n  GiSnail,\r\n  GiRetroController,\r\n  GiRank1,\r\n  GiRank2,\r\n  GiRank3,\r\n  GiWoodenPegleg,\r\n  GiPodiumSecond,\r\n} from 'react-icons/gi';\r\n\r\nexport const achievements = {\r\n  '500 комбо': {\r\n    icon: GiRank1,\r\n    description: 'Заработать 500+ комбо на любом чарте',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.combo >= 500 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  '1000 комбо': {\r\n    icon: GiRank2,\r\n    description: 'Заработать 1000+ комбо на любом чарте',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.combo >= 1000 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  '2000 комбо': {\r\n    icon: GiRank3,\r\n    description: 'Заработать 2000+ комбо на любом чарте',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.combo >= 2000 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  'Мастер фингеринга': {\r\n    icon: GiSmokingFinger,\r\n    description: 'Сыграть все Fingers треки',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: ['Monkey Fingers', 'Kimchi Fingers', 'Monkey Fingers 2', 'Money Fingers'],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.includes(chart.song)\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  '8-bit': {\r\n    icon: GiRetroController,\r\n    description: 'Сыграть Seize My Day, Tales of Pumpnia и Pumptris (8bit ver.)',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: ['Seize My Day', 'Tales of Pumpnia', 'Pumptris (8bit ver.)'],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.includes(chart.song)\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  'Love is...': {\r\n    icon: GiLoveSong,\r\n    description: 'Сыграть все Love is a Danger Zone треки',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: [\r\n        'Love is a Danger Zone',\r\n        'Love is a Danger Zone [SHORT]',\r\n        'Love is a Danger Zone (Cranky Mix)',\r\n        'Love is a Danger Zone 2',\r\n        'Love is a Danger Zone 2 [SHORT]',\r\n        'Love is a Danger Zone 2 [FULL]',\r\n        'Love is a Danger Zone 2 (D&G Ver.)',\r\n        'Love is a Danger Zone (try to B.P.M.)',\r\n      ],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.includes(chart.song)\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  Улитка: {\r\n    icon: GiSnail,\r\n    description:\r\n      'Мастер замедлений: сыграть старшие чарты Twist of Fate, Karyawisata, Awakening и Moonlight',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: [\r\n        { song: 'Twist of Fate (feat. Ruriling)', charts: ['D20', 'S19'] },\r\n        { song: 'Karyawisata', charts: ['S20', 'D16'] },\r\n        { song: 'Awakening', charts: ['S19', 'D20'] },\r\n        { song: 'Moonlight', charts: ['S19', 'D21'] },\r\n      ],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.some(\r\n        songToPlay => chart.song === songToPlay.song && songToPlay.charts.includes(chart.chartLabel)\r\n      )\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  'Коричневая S': {\r\n    icon: GiPodiumSecond,\r\n    description: 'Получить S, но 5+ бэдов',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.miss === 0 && result.bad >= 5 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  'Мы выживали как могли': {\r\n    icon: GiLifeBar,\r\n    description: 'Получить B или ниже, но удержать лайфбар',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress:\r\n          state.progress === 100 ? 100 : ['B+', 'C+', 'D+'].includes(result.grade) ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  'Падовый мисс': {\r\n    icon: GiWoodenPegleg,\r\n    description: 'Когда от SSS тебя удерживают только миссы из-за плохого моддинга падов',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress:\r\n          state.progress === 100\r\n            ? 100\r\n            : result.miss > 0 && result.bad === 0 && result.good === 0 && result.great === 0\r\n            ? 100\r\n            : 0,\r\n      };\r\n    },\r\n  },\r\n};\r\n\r\nexport const initialAchievementState = {\r\n  progress: 0,\r\n};\r\n","import moment from 'moment';\r\n\r\nexport const parseDate = textDate => {\r\n  if (typeof textDate === 'string') {\r\n    return moment(textDate, 'YYYY-MM-DD HH:mm:ss').toDate();\r\n  } else {\r\n    return new Date(textDate);\r\n  }\r\n};\r\n","if (localStorage) {\r\n  window.debugOn = () => {\r\n    localStorage.setItem('debug', 1);\r\n  };\r\n  window.debugOff = () => {\r\n    localStorage.removeItem('debug');\r\n  };\r\n}\r\n\r\nexport const DEBUG = localStorage && localStorage.getItem('debug');\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\n\r\nimport { DEBUG } from 'constants/env';\r\n\r\nconst SET_RANKINGS = `RANKINGS/SET_RANKINGS`;\r\nconst RANKING_CHANGE_SET = `RANKINGS/RANKING_CHANGE_SET`;\r\n\r\nexport default function reducer(state = {}, action) {\r\n  switch (action.type) {\r\n    case SET_RANKINGS:\r\n      return {\r\n        ...state,\r\n        data: action.ranking,\r\n      };\r\n    case RANKING_CHANGE_SET:\r\n      const hasPrevList = !_.isEmpty(action.listPrev);\r\n      return {\r\n        ...state,\r\n        data: _.map(playerOriginal => {\r\n          const player = {\r\n            ...playerOriginal,\r\n            prevRating: _.get(playerOriginal.id, action.rankingsPointsMap),\r\n          };\r\n          if (!hasPrevList) {\r\n            return player; // First time opening this thing and we didn't have any previous data\r\n          }\r\n          if (!_.includes(player.id, action.listPrev)) {\r\n            return { ...player, change: 'NEW' };\r\n          } else if (!_.includes(player.id, action.listNow)) {\r\n            // Should NEVER happen, idk if this is possible\r\n            return { ...player, change: '?' };\r\n          } else {\r\n            return {\r\n              ...player,\r\n              change: _.indexOf(player.id, action.listPrev) - _.indexOf(player.id, action.listNow),\r\n            };\r\n          }\r\n        }, state.data),\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const processBattles = ({ battles, profiles }) => {\r\n  const dictChartElo = {};\r\n  const getDictChartEloId = (score, enemyScore) =>\r\n    `${score.playerId}vs${enemyScore.playerId}-${score.sharedChartId}-${score.isRank}`;\r\n  const dictRatingDiff = {};\r\n  const getDictRatingDiffId = score => `${score.playerId}-${score.sharedChartId}-${score.isRank}`;\r\n  battles.forEach(([score, enemyScore, song]) => {\r\n    // For each battle\r\n    const p1 = profiles[score.playerId];\r\n    const p2 = profiles[enemyScore.playerId];\r\n\r\n    const scoreMultiplier = score.isRank ? 1.2 : 1;\r\n    let maxScore = null;\r\n    if (song.maxScore) {\r\n      maxScore = song.maxScore * scoreMultiplier;\r\n      if (\r\n        Math.max(maxScore, score.score, enemyScore.score) !== maxScore &&\r\n        !score.isRank &&\r\n        (!score.isExactDate || !enemyScore.isExactDate)\r\n      ) {\r\n        maxScore *= 1.2;\r\n        // Rank from machine best wasn't recognized most likely.\r\n        // Increasing max score by 20% is fine\r\n      }\r\n      if (Math.max(maxScore, score.score, enemyScore.score) !== maxScore) {\r\n        // If calculated max score isn't max score anyway, use current scores as max + cherry on top\r\n        maxScore = Math.max(maxScore, score.score, enemyScore.score) + 10000;\r\n      }\r\n    }\r\n    // Rating at the start of battle for this score\r\n    if (!score.startingRating) score.startingRating = p1.rating;\r\n    if (!enemyScore.startingRating) enemyScore.startingRating = p2.rating;\r\n\r\n    // Counting the number of battles\r\n    p1.battleCount++;\r\n    p2.battleCount++;\r\n\r\n    // This is one match between two players\r\n    //// Elo formula\r\n    // const r1 = score.startingRating;\r\n    // const r2 = enemyScore.startingRating;\r\n    const r1 = p1.rating;\r\n    const r2 = p2.rating;\r\n    const R1 = 10 ** (r1 / 400);\r\n    const R2 = 10 ** (r2 / 400);\r\n    const E1 = R1 / (R1 + R2);\r\n    const E2 = R2 / (R1 + R2);\r\n    let A = score.score;\r\n    let B = enemyScore.score;\r\n    let S1, S2;\r\n    if (A === B) {\r\n      S1 = S2 = 0.5;\r\n    } else if (maxScore && A !== 0 && B !== 0) {\r\n      A = maxScore / A - 1;\r\n      B = maxScore / B - 1;\r\n      S1 = (B / (A + B) - 0.5) * 5 + 0.5;\r\n      S2 = (A / (A + B) - 0.5) * 5 + 0.5;\r\n    } else {\r\n      S1 = A > B ? 1 : B < A ? 0 : 0.5;\r\n      S2 = 1 - S1;\r\n    }\r\n    S1 = Math.max(0, Math.min(1, S1)); // Set strict boundaries to [0, 1]\r\n    S2 = Math.max(0, Math.min(1, S2));\r\n\r\n    const kRating1 = Math.max(0, Math.min(1, (r1 - 700) / 800));\r\n    const kRating2 = Math.max(0, Math.min(1, (r2 - 700) / 800));\r\n    const maxK1 = 30 + 20 * kRating1;\r\n    const maxK2 = 30 + 20 * kRating2;\r\n    const kLevel1 = Math.max(\r\n      1,\r\n      Math.min(maxK1, (song.chartLevel / 25) ** ((kRating1 - 0.5) * 5 + 2.5) * maxK1)\r\n    );\r\n    const kLevel2 = Math.max(\r\n      1,\r\n      Math.min(maxK2, (song.chartLevel / 25) ** ((kRating2 - 0.5) * 5 + 2.5) * maxK2)\r\n    );\r\n    const kLevel = Math.min(kLevel1, kLevel2);\r\n\r\n    // When YOU vs ENEMY both have SS/SSS, and both scores are very close to SSS, this battle will NOT affect ELO too much\r\n    let kMinimizer = 1;\r\n    const kDropCutoff = 0.98; // Score is 98% of max score or higher -- K will be lower\r\n    if (\r\n      song.maxScore &&\r\n      (score.grade.startsWith('SS') || (score.miss === 0 && score.bad === 0)) &&\r\n      (enemyScore.grade.startsWith('SS') || (enemyScore.miss === 0 && enemyScore.bad === 0)) &&\r\n      score.score / maxScore > kDropCutoff &&\r\n      enemyScore.score / maxScore > kDropCutoff\r\n    ) {\r\n      kMinimizer =\r\n        Math.max(\r\n          Math.min(\r\n            1,\r\n            Math.max(\r\n              100 - (100 * score.score) / maxScore,\r\n              100 - (100 * enemyScore.score) / maxScore\r\n            ) /\r\n              (100 - kDropCutoff * 100)\r\n          ),\r\n          0\r\n        ) ** 2;\r\n    }\r\n\r\n    const K1 = kLevel * kMinimizer;\r\n    const K2 = kLevel * kMinimizer;\r\n    let dr1 = K1 * (S1 - E1);\r\n    let dr2 = K2 * (S2 - E2);\r\n    // Do not decrease rating if you have SSS - RIP zero-sum algorithm\r\n    dr1 = dr1 < 0 && score.grade === 'SSS' ? 0 : dr1;\r\n    dr2 = dr2 < 0 && enemyScore.grade === 'SSS' ? 0 : dr2;\r\n    // Recording this value for display\r\n    const baseEloId1 = getDictChartEloId(score, enemyScore);\r\n    const baseEloId2 = getDictChartEloId(enemyScore, score);\r\n    const baseEloP1 = dictChartElo[baseEloId1] || 0;\r\n    const baseEloP2 = dictChartElo[baseEloId2] || 0;\r\n    dictChartElo[baseEloId1] = dr1;\r\n    dictChartElo[baseEloId2] = dr2;\r\n\r\n    // Change rating as a result of this battle\r\n    p1.rating = p1.rating + dr1 - baseEloP1;\r\n    p2.rating = p2.rating + dr2 - baseEloP2;\r\n\r\n    const ratingDiffId1 = getDictRatingDiffId(score);\r\n    const ratingDiffId2 = getDictRatingDiffId(enemyScore);\r\n    dictRatingDiff[ratingDiffId1] = (dictRatingDiff[ratingDiffId1] || 0) + dr1 - baseEloP1;\r\n    dictRatingDiff[ratingDiffId2] = (dictRatingDiff[ratingDiffId2] || 0) + dr2 - baseEloP2;\r\n\r\n    score.ratingDiff = dictRatingDiff[ratingDiffId1];\r\n    score.ratingDiffLast = dr1 - baseEloP1;\r\n\r\n    enemyScore.ratingDiff = dictRatingDiff[ratingDiffId2];\r\n    enemyScore.ratingDiffLast = dr2 - baseEloP2;\r\n\r\n    if (DEBUG) {\r\n      // if (score.sharedChartId === 5292) {\r\n      // if (song.song === 'Club Night') {\r\n      // if (score.nickname === 'Liza' || enemyScore.nickname === 'Liza') {\r\n      // if (!song.maxScore) {\r\n      console.log(\r\n        `${song.chartLabel} - ${song.song} (${song.sharedChartId}) - ${\r\n          profiles[score.playerId].name\r\n        } / ${profiles[enemyScore.playerId].name}\r\n- ${score.score} / ${enemyScore.score} (${Math.floor(maxScore)} (${Math.floor(\r\n          song.maxScore * scoreMultiplier\r\n        )})) - R ${S1.toFixed(2)}/${S2.toFixed(2)} E ${E1.toFixed(2)} / ${E2.toFixed(2)}\r\n- Rating ${r1.toFixed(2)} / ${r2.toFixed(2)} - ${dr1.toFixed(2)} / ${dr2.toFixed(\r\n          2\r\n        )} - K ${K1.toFixed(2)} ${K2.toFixed(2)}${\r\n          kMinimizer === 1 ? '' : ` (coef ${kMinimizer.toFixed(2)})`\r\n        }\r\n- Base elo: ${baseEloP1.toFixed(2)} / ${baseEloP2.toFixed(2)}\r\n- Elo change: ${(dr1 - baseEloP1).toFixed(2)} / ${(dr2 - baseEloP2).toFixed(2)}\r\n- New base elo: ${dictChartElo[baseEloId1].toFixed(2)} / ${dictChartElo[baseEloId2].toFixed(2)}\r\n- RD: ${dictRatingDiff[ratingDiffId1].toFixed(2)} / ${dictRatingDiff[ratingDiffId2].toFixed(2)}`\r\n      );\r\n    }\r\n    // Rating floor\r\n    p1.rating = Math.max(100, p1.rating);\r\n    p2.rating = Math.max(100, p2.rating);\r\n\r\n    const playersSorted = _.flow(\r\n      _.keys,\r\n      _.map(id => ({ id, rating: profiles[id].rating })),\r\n      _.orderBy(['rating'], ['desc'])\r\n    )(profiles);\r\n    const battleDate =\r\n      score.dateObject > enemyScore.dateObject ? score.dateObject : enemyScore.dateObject;\r\n    playersSorted.forEach((player, index) => {\r\n      const lastPlace = profiles[player.id].lastPlace;\r\n      if (lastPlace !== index + 1) {\r\n        profiles[player.id].rankingHistory.push({\r\n          place: index + 1,\r\n          date: battleDate.getTime(),\r\n        });\r\n        profiles[player.id].lastPlace = index + 1;\r\n      }\r\n    });\r\n\r\n    const p1LastRating = _.last(p1.ratingHistory);\r\n    const p2LastRating = _.last(p2.ratingHistory);\r\n    if (p1LastRating !== p1.rating) {\r\n      p1.ratingHistory.push({\r\n        rating: p1.rating,\r\n        date: battleDate.getTime(),\r\n      });\r\n    }\r\n    if (p2LastRating !== p2.rating) {\r\n      p2.ratingHistory.push({\r\n        rating: p2.rating,\r\n        date: battleDate.getTime(),\r\n      });\r\n    }\r\n  });\r\n\r\n  _.flow(\r\n    _.keys,\r\n    _.forEach(key => {\r\n      profiles[key].id = _.toInteger(key);\r\n      profiles[key].accuracy =\r\n        profiles[key].countAcc > 0\r\n          ? Math.round((profiles[key].sumAccuracy / profiles[key].countAcc) * 100) / 100\r\n          : null;\r\n      profiles[key].ratingRaw = profiles[key].rating;\r\n      profiles[key].rating = Math.round(profiles[key].rating);\r\n      profiles[key].rankingHistory = [\r\n        ...profiles[key].rankingHistory,\r\n        { place: _.get('place', _.last(profiles[key].rankingHistory)), date: Date.now() },\r\n      ];\r\n    })\r\n  )(profiles);\r\n};\r\n\r\nexport const setRankingsAction = ranking => ({\r\n  type: SET_RANKINGS,\r\n  ranking,\r\n});\r\n\r\nconst getListOfNames = _.map('id');\r\nconst getMapOfRatings = _.flow(\r\n  _.map(q => [q.id, q.rating]),\r\n  _.fromPairs\r\n);\r\nexport const setRankings = ranking => {\r\n  return async (dispatch, getState) => {\r\n    dispatch(setRankingsAction(ranking));\r\n    try {\r\n      const [lastChangedRanking, lastChangedRankingPoints, lastFetchedRanking] = await Promise.all([\r\n        localForage.getItem('lastChangedRanking_v3'),\r\n        localForage.getItem('lastChangedRankingPoints_v3'),\r\n        localForage.getItem('lastFetchedRanking_v3'),\r\n      ]);\r\n      const listNow = getListOfNames(ranking);\r\n      const listLastFetched = getListOfNames(lastFetchedRanking);\r\n      const listLastChanged = getListOfNames(lastChangedRanking);\r\n      const mapPointsNow = getMapOfRatings(ranking);\r\n      const mapPointsLastFetched = getMapOfRatings(lastFetchedRanking);\r\n      const mapPointsLastChanged = getMapOfRatings(lastChangedRankingPoints);\r\n\r\n      let rankingsPointsMap = mapPointsLastChanged;\r\n      // console.log(listNow, listLastFetched, listLastChanged);\r\n      // console.log(mapPointsNow, mapPointsLastFetched, mapPointsLastChanged);\r\n      if (!_.isEqual(mapPointsNow, mapPointsLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRankingPoints_v3', lastFetchedRanking);\r\n        rankingsPointsMap = mapPointsLastFetched;\r\n      }\r\n      let listPrev = listLastChanged;\r\n      if (!_.isEqual(listNow, listLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRanking_v3', lastFetchedRanking);\r\n        listPrev = listLastFetched;\r\n      }\r\n      dispatch({\r\n        type: RANKING_CHANGE_SET,\r\n        listNow,\r\n        listPrev,\r\n        rankingsPointsMap,\r\n      });\r\n      localForage.setItem('lastFetchedRanking_v3', ranking);\r\n    } catch (error) {\r\n      console.warn('Cannot get ranking from local storage', error);\r\n    }\r\n  };\r\n};\r\n","import _ from 'lodash/fp';\r\n\r\nimport { ranks as expRanks } from 'utils/exp';\r\n\r\nconst SET_PROFILES = `PROFILES/SET_PROFILES`;\r\nconst SET_FILTER = `PROFILES/SET_FILTER`;\r\nconst RESET_FILTER = `PROFILES/RESET_FILTER`;\r\n\r\nexport const defaultFilter = {};\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n  filter: defaultFilter,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case SET_PROFILES:\r\n      return {\r\n        ...state,\r\n        data: action.data,\r\n      };\r\n    case SET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: action.filter,\r\n      };\r\n    case RESET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: defaultFilter,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const postProcessProfiles = (profiles, tracklist) => {\r\n  const getBonusForLevel = level => (30 * (1 + 2 ** (level / 4))) / 11;\r\n  const getMinimumNumber = totalCharts =>\r\n    Math.round(\r\n      Math.min(totalCharts, 1 + totalCharts / 20 + Math.sqrt(Math.max(totalCharts - 1, 0)) * 0.7)\r\n    );\r\n\r\n  const newProfiles = _.mapValues(profile => {\r\n    const neededGrades = ['A', 'A+', 'S', 'SS', 'SSS'];\r\n    profile.expRank = _.findLast(rank => rank.threshold <= profile.exp, expRanks);\r\n    profile.expRankNext = _.find(rank => rank.threshold > profile.exp, expRanks);\r\n    profile.progress = {\r\n      double: {\r\n        SS: {},\r\n        S: {},\r\n        'A+': {},\r\n        A: {},\r\n      },\r\n      single: {\r\n        SS: {},\r\n        S: {},\r\n        'A+': {},\r\n        A: {},\r\n      },\r\n    };\r\n    const gradeIncrementMap = {\r\n      SSS: ['SS', 'S', 'A+', 'A'],\r\n      SS: ['SS', 'S', 'A+', 'A'],\r\n      S: ['S', 'A+', 'A'],\r\n      'A+': ['A+', 'A'],\r\n      A: ['A'],\r\n    };\r\n    const incrementLevel = (l, g, chartType) => {\r\n      const prog =\r\n        chartType === 'S' || chartType === 'SP'\r\n          ? profile.progress.single\r\n          : chartType === 'D' || chartType === 'DP'\r\n          ? profile.progress.double\r\n          : null;\r\n      if (prog) {\r\n        prog[g][l] = prog[g][l] ? prog[g][l] + 1 : 1;\r\n      }\r\n    };\r\n    _.keys(profile.resultsByLevel).forEach(level => {\r\n      profile.resultsByLevel[level].forEach(res => {\r\n        const thisGrade = res.result.grade;\r\n        const thisPlayerId = res.result.playerId;\r\n        const otherResults = res.chart.results.filter(r => r.playerId === thisPlayerId);\r\n        if (otherResults.length > 1) {\r\n          const sortedResults = otherResults.sort(\r\n            (a, b) => neededGrades.indexOf(b.grade) - neededGrades.indexOf(a.grade)\r\n          );\r\n          if (sortedResults[0].grade !== thisGrade) {\r\n            return; // Don't do anything when we have a different result with better grade\r\n          }\r\n        }\r\n        const gradeIncArray = gradeIncrementMap[thisGrade];\r\n        if (gradeIncArray) {\r\n          gradeIncArray.forEach(gradeInc => {\r\n            incrementLevel(level, gradeInc, res.chart.chartType);\r\n          });\r\n        }\r\n      });\r\n    });\r\n    ['single', 'double'].forEach(chartType => {\r\n      profile.progress[`${chartType}-bonus`] = 0;\r\n      _.keys(profile.progress[chartType]).forEach(grade => {\r\n        profile.progress[chartType][`${grade}-bonus`] = 0;\r\n        _.keys(profile.progress[chartType][grade]).forEach(level => {\r\n          const number = profile.progress[chartType][grade][level];\r\n          const totalCharts = tracklist.data[`${chartType}sLevels`][level];\r\n          const minimumNumber = getMinimumNumber(totalCharts);\r\n          const bonusCoefficientNumber = Math.min(1, number / minimumNumber);\r\n          const rawBonus = getBonusForLevel(level);\r\n          const bonus = rawBonus * bonusCoefficientNumber;\r\n          profile.progress[chartType][grade][`${level}-bonus`] = bonus;\r\n          profile.progress[chartType][grade][`${level}-bonus-coef`] = bonusCoefficientNumber;\r\n          profile.progress[chartType][grade][`${level}-min-number`] = minimumNumber;\r\n          profile.progress[chartType][grade][`${level}-achieved-number`] = number;\r\n          if (bonus >= profile.progress[chartType][`${grade}-bonus`]) {\r\n            profile.progress[chartType][`${grade}-bonus`] = bonus;\r\n            profile.progress[chartType][`${grade}-bonus-level`] = level;\r\n            profile.progress[chartType][`${grade}-bonus-level-coef`] = bonusCoefficientNumber;\r\n            profile.progress[chartType][`${grade}-bonus-level-min-number`] = minimumNumber;\r\n            profile.progress[chartType][`${grade}-bonus-level-achieved-number`] = number;\r\n          }\r\n        });\r\n        profile.progress[`${chartType}-bonus`] += profile.progress[chartType][`${grade}-bonus`];\r\n      });\r\n    });\r\n    profile.progress.bonus = profile.progress['double-bonus'] + profile.progress['single-bonus'];\r\n    profile.rating = 850 + profile.progress.bonus;\r\n    profile.accuracy =\r\n      profile.countAcc > 0\r\n        ? Math.round((profile.sumAccuracy / profile.countAcc) * 100) / 100\r\n        : null;\r\n    return profile;\r\n  }, profiles);\r\n  return newProfiles;\r\n};\r\n\r\nexport const setProfiles = data => ({\r\n  type: SET_PROFILES,\r\n  data,\r\n});\r\n\r\nexport const setProfilesFilter = filter => ({\r\n  type: SET_FILTER,\r\n  filter,\r\n});\r\n\r\nexport const resetProfilesFilter = () => ({\r\n  type: RESET_FILTER,\r\n});\r\n\r\nexport const calculateProfileData = profileId => (dispatch, getState) => {};\r\n","// export const HOST = 'http://localhost:5000';\r\nexport const HOST = 'https://vps720616.ovh.net:5000';\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\n\r\nimport { fetchJson } from 'utils/fetch';\r\nimport { getExp } from 'utils/exp';\r\nimport { achievements, initialAchievementState } from 'utils/achievements';\r\nimport { parseDate } from 'utils/date';\r\n\r\nimport { processBattles } from './ranking';\r\nimport { postProcessProfiles } from './profiles';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `TOP/LOADING`;\r\nconst SUCCESS = `TOP/SUCCESS`;\r\nconst ERROR = `TOP/ERROR`;\r\nconst SET_FILTER = `TOP/SET_FILTER`;\r\nconst RESET_FILTER = `TOP/RESET_FILTER`;\r\nconst RANKING_CHANGE_SET = `TOP/RANKING_CHANGE_SET`;\r\n\r\nexport const defaultFilter = { showRank: true, showRankAndNorank: true };\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n  filter: defaultFilter,\r\n  players: {},\r\n  profiles: {},\r\n  results: [],\r\n  sharedCharts: {},\r\n};\r\n\r\nexport const gradeComparator = {\r\n  '?': 0,\r\n  F: 1,\r\n  D: 2,\r\n  'D+': 3,\r\n  C: 4,\r\n  'C+': 5,\r\n  B: 6,\r\n  'B+': 7,\r\n  A: 8,\r\n  'A+': 9,\r\n  S: 10,\r\n  SS: 11,\r\n  SSS: 12,\r\n};\r\n\r\nconst tryFixIncompleteResult = (result, maxTotalSteps) => {\r\n  if (!maxTotalSteps) {\r\n    return;\r\n  }\r\n  const infos = [result.perfect, result.great, result.good, result.bad, result.miss];\r\n  let fixableIndex = -1,\r\n    absentNumbersCount = 0,\r\n    localStepSum = 0;\r\n  for (let i = 0; i < 5; ++i) {\r\n    if (!_.isNumber(infos[i])) {\r\n      fixableIndex = i;\r\n      absentNumbersCount++;\r\n    } else {\r\n      localStepSum += infos[i];\r\n    }\r\n  }\r\n  if (absentNumbersCount === 1) {\r\n    result[['perfect', 'great', 'good', 'bad', 'miss'][fixableIndex]] =\r\n      maxTotalSteps - localStepSum;\r\n  }\r\n};\r\n\r\nconst guessGrade = result => {\r\n  if (result.misses === 0 && result.bads === 0 && result.goods === 0) {\r\n    if (result.greats === 0) {\r\n      return 'SSS';\r\n    } else {\r\n      return 'SS';\r\n    }\r\n  }\r\n  return result.grade;\r\n};\r\n\r\nconst mapResult = (res, players, chart) => {\r\n  if (typeof res.recognition_notes === 'undefined') {\r\n    // Short result, minimum info, only for ELO calculation\r\n    // Will be replaced with better result later\r\n    return {\r\n      isUnknownPlayer: players[res.player].arcade_name === 'PUMPITUP',\r\n      isIntermediateResult: true,\r\n      sharedChartId: res.shared_chart,\r\n      playerId: res.player,\r\n      nickname: players[res.player].nickname,\r\n      nicknameArcade: players[res.player].arcade_name,\r\n      date: res.gained,\r\n      dateObject: parseDate(res.gained),\r\n      grade: res.grade,\r\n      isExactDate: !!res.exact_gain_date,\r\n      score: res.score,\r\n      isRank: !!res.rank_mode,\r\n    };\r\n  }\r\n  // Full best result\r\n  let _r = {\r\n    isUnknownPlayer: players[res.player].arcade_name === 'PUMPITUP',\r\n    isIntermediateResult: false,\r\n    sharedChartId: res.shared_chart,\r\n    id: res.id,\r\n    playerId: res.player,\r\n    nickname: players[res.player].nickname,\r\n    nicknameArcade: players[res.player].arcade_name,\r\n    originalChartMix: res.original_mix,\r\n    originalChartLabel: res.original_label,\r\n    originalScore: res.original_score,\r\n    date: res.gained,\r\n    dateObject: parseDate(res.gained),\r\n    grade: res.grade !== '?' ? res.grade : guessGrade(res),\r\n    isExactDate: !!res.exact_gain_date,\r\n    score: res.score,\r\n    scoreIncrease: res.score_increase,\r\n    calories: res.calories && res.calories / 1000,\r\n    perfect: res.perfects,\r\n    great: res.greats,\r\n    good: res.goods,\r\n    bad: res.bads,\r\n    miss: res.misses,\r\n    combo: res.max_combo,\r\n    mods: res.mods_list,\r\n    isRank: !!res.rank_mode,\r\n    isHJ: (res.mods_list || '').split(' ').includes('HJ'),\r\n    isMachineBest: res.recognition_notes === 'machine_best',\r\n    isMyBest: res.recognition_notes === 'personal_best',\r\n  };\r\n\r\n  tryFixIncompleteResult(_r, chart.maxTotalSteps);\r\n\r\n  const perfects = Math.sqrt(_r.perfect) * 10;\r\n  const acc = perfects\r\n    ? Math.floor(\r\n        ((perfects * 100 + _r.great * 60 + _r.good * 30 + _r.miss * -20) /\r\n          (perfects + _r.great + _r.good + _r.bad + _r.miss)) *\r\n          100\r\n      ) / 100\r\n    : null;\r\n  const accRaw = _r.perfect\r\n    ? Math.floor(\r\n        ((_r.perfect * 100 + _r.great * 60 + _r.good * 30 + _r.miss * -20) /\r\n          (_r.perfect + _r.great + _r.good + _r.bad + _r.miss)) *\r\n          100\r\n      ) / 100\r\n    : null;\r\n\r\n  _r.accuracy = acc < 0 ? 0 : accRaw === 100 ? 100 : acc && +acc.toFixed(2);\r\n  _r.accuracyRaw = accRaw;\r\n  return _r;\r\n};\r\n\r\nconst getMaxScore = score => {\r\n  return ((score.score / score.accuracyRaw) * 100) / (score.isRank ? 1.2 : 1);\r\n};\r\n\r\nconst initializeProfile = (result, profiles) => {\r\n  const id = result.playerId;\r\n  const resultsByLevel = _.fromPairs(Array.from({ length: 28 }).map((x, i) => [i + 1, []]));\r\n  profiles[id] = {\r\n    name: result.nickname,\r\n    nameArcade: result.nicknameArcade,\r\n    resultsByGrade: {},\r\n    resultsByLevel,\r\n    lastResultDate: result.dateObject,\r\n    count: 0,\r\n    battleCount: 0,\r\n    countAcc: 0,\r\n    grades: { F: 0, D: 0, C: 0, B: 0, A: 0, S: 0, SS: 0, SSS: 0 },\r\n    sumAccuracy: 0,\r\n    rankingHistory: [],\r\n    ratingHistory: [],\r\n    lastPlace: null,\r\n    lastBattleDate: 0,\r\n  };\r\n  profiles[id].achievements = _.flow(\r\n    _.keys,\r\n    _.map(achName => [\r\n      achName,\r\n      { ...(achievements[achName].initialState || initialAchievementState) },\r\n    ]),\r\n    _.fromPairs\r\n  )(achievements);\r\n  profiles[id].exp = 0;\r\n};\r\n\r\nconst getProfileInfoFromResult = (result, chart, profiles) => {\r\n  const profile = profiles[result.playerId];\r\n\r\n  profile.count++;\r\n  if (result.accuracy) {\r\n    profile.countAcc++;\r\n    profile.sumAccuracy += result.accuracy;\r\n  }\r\n  profile.grades[result.grade.replace('+', '')]++;\r\n\r\n  if (chart.chartType !== 'COOP' && result.isBestGradeOnChart) {\r\n    profile.resultsByGrade[result.grade] = [\r\n      ...(profile.resultsByGrade[result.grade] || []),\r\n      { result, chart },\r\n    ];\r\n    profile.resultsByLevel[chart.chartLevel] = [\r\n      ...(profile.resultsByLevel[chart.chartLevel] || []),\r\n      { result, chart },\r\n    ];\r\n  }\r\n  if (result.isExactDate && profile.lastResultDate < result.dateObject) {\r\n    profile.lastResultDate = result.dateObject;\r\n  }\r\n  profile.achievements = _.mapValues.convert({ cap: false })((achState, achName) => {\r\n    return achievements[achName].resultFunction(result, chart, achState, profile);\r\n  }, profile.achievements);\r\n  profile.exp += getExp(result, chart);\r\n};\r\n\r\nconst processData = (data, tracklist) => {\r\n  const { players, results, shared_charts } = data;\r\n  //// Initialization\r\n  // Init for TOP\r\n  const mappedResults = [];\r\n  const getTopResultId = result => `${result.sharedChartId}-${result.playerId}-${result.isRank}`;\r\n  const getBestGradeResultId = result => `${result.sharedChartId}-${result.playerId}`;\r\n  const topResults = {}; // Temp object\r\n  const bestGradeResults = {}; // Temp object\r\n  const top = {}; // Main top scores pbject\r\n\r\n  // Battles for ELO calculation\r\n  const battles = [];\r\n  // Profiles for every player\r\n  let profiles = {};\r\n\r\n  // Loop 1\r\n  for (let resRaw of results) {\r\n    const sharedChartId = resRaw.shared_chart;\r\n    // Initialize Song\r\n    if (!top[sharedChartId]) {\r\n      const sharedChart = shared_charts[sharedChartId];\r\n      const label = _.toUpper(sharedChart.chart_label);\r\n      const [chartType, chartLevel] = label.match(/(\\D+)|(\\d+)/g);\r\n      top[sharedChartId] = {\r\n        song: sharedChart.track_name,\r\n        chartLabel: label,\r\n        chartLevel,\r\n        chartType,\r\n        duration: sharedChart.duration,\r\n        sharedChartId: sharedChartId,\r\n        maxTotalSteps: sharedChart.max_total_steps,\r\n        results: [],\r\n        totalResultsCount: 0,\r\n      };\r\n    }\r\n\r\n    // Getting current chart and result (mapped)\r\n    const chartTop = top[sharedChartId];\r\n    const result = mapResult(resRaw, players, chartTop);\r\n    mappedResults.push(result);\r\n\r\n    // Inserting result into TOP\r\n    const topResultId = getTopResultId(result);\r\n    const currentTopResult = topResults[topResultId];\r\n    if (!currentTopResult || currentTopResult.score < result.score) {\r\n      let oldScoreIndex = -1;\r\n      if (currentTopResult) {\r\n        oldScoreIndex = chartTop.results.indexOf(currentTopResult);\r\n        chartTop.results.splice(oldScoreIndex, 1);\r\n      }\r\n      const newScoreIndex = _.sortedLastIndexBy(r => -r.score, result, chartTop.results);\r\n      if (!result.isUnknownPlayer || newScoreIndex === 0) {\r\n        chartTop.results.splice(newScoreIndex, 0, result);\r\n        chartTop.latestScoreDate = result.date;\r\n      }\r\n      chartTop.totalResultsCount++;\r\n      topResults[topResultId] = result;\r\n\r\n      if (!result.isUnknownPlayer) {\r\n        chartTop.results.forEach(enemyResult => {\r\n          if (\r\n            !enemyResult.isUnknownPlayer &&\r\n            enemyResult.isRank === result.isRank &&\r\n            enemyResult.playerId !== result.playerId &&\r\n            result.score &&\r\n            enemyResult.score\r\n          ) {\r\n            battles.push([result, enemyResult, chartTop]);\r\n          }\r\n        });\r\n      }\r\n    }\r\n    // Getting best grade of player on this chart\r\n    if (!result.isIntermediateResult) {\r\n      const bestGradeResultId = getBestGradeResultId(result);\r\n      const currentBestGradeRes = bestGradeResults[bestGradeResultId];\r\n      if (\r\n        !currentBestGradeRes ||\r\n        gradeComparator[currentBestGradeRes.grade] <= gradeComparator[result.grade]\r\n      ) {\r\n        // Using <= here, so newer scores always win and rewrite old scores\r\n        currentBestGradeRes && (currentBestGradeRes.isBestGradeOnChart = false);\r\n        result.isBestGradeOnChart = true;\r\n        bestGradeResults[bestGradeResultId] = result;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Loop 2, when the TOP is already set up\r\n  for (let chartId in top) {\r\n    const chart = top[chartId];\r\n    chart.maxScoreWithAccuracy = 0;\r\n    for (let result of chart.results) {\r\n      if (result.accuracyRaw && chart.maxScoreWithAccuracy < result.score) {\r\n        chart.maxScoreResult = result;\r\n        chart.maxScoreWithAccuracy = result.score;\r\n      }\r\n      // Getting some info about players\r\n      if (!result.isUnknownPlayer && !result.isIntermediateResult) {\r\n        if (!profiles[result.playerId]) {\r\n          initializeProfile(result, profiles);\r\n        }\r\n        getProfileInfoFromResult(result, chart, profiles);\r\n      }\r\n    }\r\n    if (chart.maxScoreWithAccuracy) {\r\n      chart.maxScore = getMaxScore(chart.maxScoreResult, chart);\r\n    }\r\n  }\r\n\r\n  // Calculate Progress achievements and bonus for starting Elo\r\n  profiles = postProcessProfiles(profiles, tracklist);\r\n  // Calculate ELO\r\n  processBattles({ battles, profiles });\r\n\r\n  return { mappedResults, profiles, sharedCharts: top };\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n        data: initialState.data,\r\n        players: initialState.players,\r\n        profiles: initialState.profiles,\r\n        results: initialState.results,\r\n        sharedCharts: initialState.sharedCharts,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n        players: action.players,\r\n        profiles: action.profiles,\r\n        results: action.results,\r\n        sharedCharts: action.sharedCharts,\r\n      };\r\n    case SET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: action.filter,\r\n      };\r\n    case RESET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: defaultFilter,\r\n      };\r\n    case RANKING_CHANGE_SET:\r\n      const hasPrevList = !_.isEmpty(action.listPrev);\r\n      return {\r\n        ...state,\r\n        profiles: _.mapValues(playerOriginal => {\r\n          const player = {\r\n            ...playerOriginal,\r\n            prevRating: _.get(playerOriginal.id, action.rankingsPointsMap),\r\n          };\r\n          if (!hasPrevList) {\r\n            return player; // First time opening this thing and we didn't have any previous data\r\n          }\r\n          if (!_.includes(player.id, action.listPrev)) {\r\n            return { ...player, change: 'NEW' };\r\n          } else if (!_.includes(player.id, action.listNow)) {\r\n            // Should NEVER happen, idk if this is possible\r\n            return { ...player, change: '?' };\r\n          } else {\r\n            return {\r\n              ...player,\r\n              change: _.indexOf(player.id, action.listPrev) - _.indexOf(player.id, action.listNow),\r\n            };\r\n          }\r\n        }, state.profiles),\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchResults = () => {\r\n  return async (dispatch, getState) => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(\r\n        fetchJson({\r\n          url: `${HOST}/results/highscores`,\r\n        })\r\n      );\r\n      if (data.error) {\r\n        throw new Error(data.error);\r\n      }\r\n      const { tracklist } = getState();\r\n      const { sharedCharts, mappedResults, profiles } = processData(data, tracklist);\r\n\r\n      dispatch({\r\n        type: SUCCESS,\r\n        data: _.values(sharedCharts),\r\n        players: _.flow(\r\n          _.toPairs,\r\n          _.map(([id, player]) => ({ ...player, id: _.toInteger(id) }))\r\n        )(data.players),\r\n        results: mappedResults,\r\n        profiles,\r\n        sharedCharts,\r\n      });\r\n      dispatch(calculateRankingChanges(profiles));\r\n    } catch (error) {\r\n      console.log(error);\r\n      dispatch({ type: ERROR, error });\r\n    }\r\n  };\r\n};\r\n\r\nexport const setFilter = filter => ({\r\n  type: SET_FILTER,\r\n  filter,\r\n});\r\n\r\nexport const resetFilter = () => ({\r\n  type: RESET_FILTER,\r\n});\r\n\r\nconst getListOfNames = _.map('id');\r\nconst getMapOfRatings = _.flow(\r\n  _.map(q => [q.id, q.rating]),\r\n  _.fromPairs\r\n);\r\n\r\nexport const calculateRankingChanges = profiles => {\r\n  return async (dispatch, getState) => {\r\n    try {\r\n      const ranking = _.orderBy('ratingRaw', 'desc', _.values(profiles));\r\n      const [lastChangedRanking, lastChangedRankingPoints, lastFetchedRanking] = await Promise.all([\r\n        localForage.getItem('lastChangedRanking_v3'),\r\n        localForage.getItem('lastChangedRankingPoints_v3'),\r\n        localForage.getItem('lastFetchedRanking_v3'),\r\n      ]);\r\n      const listNow = getListOfNames(ranking);\r\n      const listLastFetched = getListOfNames(lastFetchedRanking);\r\n      const listLastChanged = getListOfNames(lastChangedRanking);\r\n      const mapPointsNow = getMapOfRatings(ranking);\r\n      const mapPointsLastFetched = getMapOfRatings(lastFetchedRanking);\r\n      const mapPointsLastChanged = getMapOfRatings(lastChangedRankingPoints);\r\n\r\n      let rankingsPointsMap = mapPointsLastChanged;\r\n      // console.log(listNow, listLastFetched, listLastChanged);\r\n      // console.log(mapPointsNow, mapPointsLastFetched, mapPointsLastChanged);\r\n      if (!_.isEqual(mapPointsNow, mapPointsLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRankingPoints_v3', lastFetchedRanking);\r\n        rankingsPointsMap = mapPointsLastFetched;\r\n      }\r\n      let listPrev = listLastChanged;\r\n      if (!_.isEqual(listNow, listLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRanking_v3', lastFetchedRanking);\r\n        listPrev = listLastFetched;\r\n      }\r\n      dispatch({\r\n        type: RANKING_CHANGE_SET,\r\n        listNow,\r\n        listPrev,\r\n        rankingsPointsMap,\r\n      });\r\n      localForage.setItem('lastFetchedRanking_v3', ranking);\r\n    } catch (error) {\r\n      console.warn('Cannot get ranking from local storage', error);\r\n    }\r\n  };\r\n};\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\n\r\nimport { setFilter } from 'reducers/results';\r\n\r\nconst SELECT_PRESET = `PRESETS/SELECT_PRESET`;\r\nconst LOAD_PRESETS = `PRESETS/LOAD_PRESETS`;\r\nconst LOADING_START = `PRESETS/LOADING_START`;\r\nconst LOADING_END = `PRESETS/LOADING_END`;\r\n\r\nconst initialState = {\r\n  presets: [],\r\n  currentPreset: null,\r\n  isLoading: false,\r\n};\r\n\r\nconst itemToOption = item =>\r\n  item && {\r\n    ...item,\r\n    label: item.name,\r\n    value: item.name,\r\n  };\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOAD_PRESETS:\r\n      const currentPreset = _.find({ name: _.get('name', state.currentPreset) }, action.presets);\r\n      return {\r\n        ...state,\r\n        currentPreset: itemToOption(currentPreset) || null,\r\n        presets: _.map(itemToOption, action.presets),\r\n      };\r\n    case SELECT_PRESET:\r\n      return {\r\n        ...state,\r\n        currentPreset: itemToOption(action.currentPreset),\r\n      };\r\n    case LOADING_START:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case LOADING_END:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nconst reloadPresets = presets => ({ type: LOAD_PRESETS, presets: presets || [] });\r\n\r\nconst startLoading = () => ({\r\n  type: LOADING_START,\r\n});\r\n\r\nconst endLoading = () => ({\r\n  type: LOADING_END,\r\n});\r\n\r\nexport const selectPreset = currentPreset => ({\r\n  type: SELECT_PRESET,\r\n  currentPreset,\r\n});\r\n\r\nexport const loadPresets = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    dispatch(reloadPresets(presets));\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const savePreset = name => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const { filter } = getState().top;\r\n    const newPreset = { name, filter };\r\n    if (!_.some({ name }, presets)) {\r\n      const newPresets = [...(presets || []), newPreset];\r\n      dispatch(reloadPresets(newPresets));\r\n      dispatch(selectPreset(newPreset));\r\n      localForage.setItem('filterPresets', newPresets);\r\n    } else if (window.confirm('Preset with this name already exists, replace it?')) {\r\n      const withoutOldPreset = _.remove({ name }, presets);\r\n      const newPresets = [...withoutOldPreset, newPreset];\r\n      dispatch(reloadPresets(newPresets));\r\n      localForage.setItem('filterPresets', newPresets);\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const openPreset = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  const currentPreset = getState().presets.currentPreset;\r\n  const name = _.get('name', currentPreset);\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const preset = name && _.find({ name }, presets);\r\n    if (preset) {\r\n      dispatch(selectPreset(currentPreset));\r\n      dispatch(setFilter(currentPreset.filter));\r\n    } else {\r\n      // Preset not found for some reason, update list\r\n      dispatch(reloadPresets(presets));\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const deletePreset = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  const name = _.get('name', getState().presets.currentPreset);\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const preset = _.find({ name }, presets);\r\n    if (preset && window.confirm('Are you sure you want to delete selected preset?')) {\r\n      const withoutOldPreset = _.remove({ name }, presets);\r\n      dispatch(reloadPresets(withoutOldPreset));\r\n      localForage.setItem('filterPresets', withoutOldPreset);\r\n    } else {\r\n      // Preset not found for some reason, update list\r\n      dispatch(reloadPresets(presets));\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { FaLayerGroup, FaFolderOpen, FaSave, FaPlus, FaTrashAlt } from 'react-icons/fa';\r\nimport Select from 'react-select';\r\n\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport Input from 'components/Shared/Input/Input';\r\n\r\nimport { loadPresets, savePreset, selectPreset, openPreset, deletePreset } from 'reducers/presets';\r\n\r\nconst overlayItem = (\r\n  <button className=\"btn btn-sm btn-dark btn-icon _margin-right\">\r\n    <FaLayerGroup />\r\n    пресеты\r\n  </button>\r\n);\r\n\r\nconst noPresetsMessage = () => 'пусто';\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    ...state.presets,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  loadPresets,\r\n  savePreset,\r\n  openPreset,\r\n  deletePreset,\r\n  selectPreset,\r\n};\r\n\r\nclass PresetsControl extends React.Component {\r\n  state = {};\r\n\r\n  componentDidMount() {\r\n    this.props.loadPresets();\r\n  }\r\n\r\n  onChangeSelection = selected => {\r\n    this.props.selectPreset(selected.name);\r\n  };\r\n\r\n  onRewritePreset = () => {\r\n    const { currentPreset } = this.props;\r\n    this.props.savePreset(currentPreset.name);\r\n  };\r\n\r\n  onSavePreset = () => {\r\n    const { name } = this.state;\r\n    this.props.savePreset(name);\r\n    this.setState({ isAddingNew: false });\r\n  };\r\n\r\n  render() {\r\n    const { presets, currentPreset, isLoading } = this.props;\r\n    const { name, isAddingNew } = this.state;\r\n    return (\r\n      <div>\r\n        <Overlay overlayItem={overlayItem}>\r\n          <div className=\"presets-control-overlay\">\r\n            <Select\r\n              className=\"select _margin-bottom\"\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"пресеты...\"\r\n              options={presets}\r\n              value={currentPreset}\r\n              onChange={this.props.selectPreset}\r\n              noOptionsMessage={noPresetsMessage}\r\n            />\r\n            {currentPreset && (\r\n              <div className=\"buttons-presets _margin-bottom\">\r\n                <div className=\"_flex-fill\" />\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n                  onClick={this.props.openPreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaFolderOpen /> открыть\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n                  onClick={this.onRewritePreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaSave /> перезаписать\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon\"\r\n                  onClick={this.props.deletePreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaTrashAlt /> удалить\r\n                </button>\r\n              </div>\r\n            )}\r\n            {!isAddingNew && (\r\n              <div className=\"buttons-presets _margin-bottom\">\r\n                <div className=\"_flex-fill\" />\r\n\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left _self-align-end\"\r\n                  onClick={() => this.setState({ isAddingNew: true })}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaPlus /> добавить\r\n                </button>\r\n              </div>\r\n            )}\r\n            {isAddingNew && (\r\n              <div className=\"adding-new _margin-bottom\">\r\n                <Input\r\n                  value={name}\r\n                  placeholder=\"имя пресета...\"\r\n                  className=\"form-control\"\r\n                  onChange={name => this.setState({ name })}\r\n                />\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left\"\r\n                  onClick={this.onSavePreset}\r\n                  disabled={!name || isLoading}\r\n                >\r\n                  <FaSave /> сохранить\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left\"\r\n                  onClick={() => this.setState({ isAddingNew: false })}\r\n                  disabled={isLoading}\r\n                >\r\n                  отмена\r\n                </button>\r\n              </div>\r\n            )}\r\n            {/* <div>\r\n              <Toggle\r\n                checked={false}\r\n                onToggle={active => {\r\n                  localForage.setItem('showTabs', active);\r\n                }}\r\n              >\r\n                показывать табы с пресетами\r\n              </Toggle>\r\n            </div> */}\r\n          </div>\r\n        </Overlay>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(PresetsControl);\r\n","import React from 'react';\r\nimport TimeAgo from 'javascript-time-ago';\r\nimport ru from 'javascript-time-ago/locale/ru';\r\nimport { convenient } from 'javascript-time-ago/gradation';\r\nimport moment from 'moment';\r\n\r\nTimeAgo.addLocale(ru);\r\nconst timeAgo = new TimeAgo('ru-RU');\r\n\r\nconst timeStyle = {\r\n  flavour: 'long',\r\n  gradation: convenient,\r\n  units: ['day', 'week', 'month'],\r\n};\r\nexport const tooltipFormatter = result => {\r\n  if (!result.isExactDate) {\r\n    const resultType =\r\n      result.isMyBest === undefined && result.isMachineBest === undefined\r\n        ? 'с my best или machine best'\r\n        : result.isMyBest\r\n        ? 'с my best'\r\n        : result.isMachineBest\r\n        ? 'с machine best'\r\n        : 'хз откуда';\r\n    return (\r\n      <div style={{ display: 'flex', alignItems: 'center', flexDirection: 'column' }}>\r\n        <div>точная дата взятия неизвестна</div>\r\n        <div>скор был записан {resultType}</div>\r\n        <div>дата записи: {result.dateObject.toLocaleDateString()}</div>\r\n      </div>\r\n    );\r\n  } else {\r\n    return result.dateObject.toLocaleDateString();\r\n  }\r\n};\r\n\r\nexport const getTimeAgo = date => {\r\n  const dayDiff = moment()\r\n    .startOf('day')\r\n    .diff(moment(date).startOf('day'), 'days');\r\n  const hour = moment(date).hour();\r\n  return dayDiff === 0\r\n    ? hour < 5\r\n      ? 'вчера ночью'\r\n      : 'сегодня'\r\n    : dayDiff === 1\r\n    ? 'вчера'\r\n    : timeAgo.format(date, timeStyle);\r\n};\r\n","export const colorsArray = [\r\n  '#4DB3FF',\r\n  '#80B300',\r\n  '#FF6655',\r\n  '#FF99E6',\r\n  '#33FFCC',\r\n  '#e633c8',\r\n  '#dbe812',\r\n  '#FF1A66',\r\n  '#991AFF',\r\n  '#E6B333',\r\n  '#1AB399',\r\n  '#4D8066',\r\n  '#CC9999',\r\n  '#00E680',\r\n  '#809980',\r\n  '#E6FF80',\r\n  '#1AFF33',\r\n  '#999933',\r\n  '#E6331A',\r\n  '#CCCC00',\r\n  '#66E64D',\r\n  '#4D80CC',\r\n  '#9900B3',\r\n  '#4DB380',\r\n  '#FF4D4D',\r\n];\r\n","import _ from 'lodash/fp';\r\nimport { createSelector } from 'reselect';\r\nimport matchSorter from 'match-sorter';\r\n\r\nimport { SORT, CHART_MIN_MAX, DURATION_DEFAULT } from 'constants/leaderboard';\r\n\r\nexport const playersSelector = createSelector(\r\n  state => state.results.players,\r\n  _.flow(\r\n    _.toPairs,\r\n    _.map(([id, { nickname, arcade_name }]) => ({\r\n      label: `${nickname} (${arcade_name})`,\r\n      value: nickname,\r\n    })),\r\n    _.sortBy(it => _.toLower(it.label))\r\n  )\r\n);\r\n\r\nconst filterCharts = (filter, rows) => {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filter);\r\n  const type = _.getOr(null, 'type', filter);\r\n  const duration = _.getOr(DURATION_DEFAULT, 'duration', filter);\r\n\r\n  return _.filter(row => {\r\n    if (duration !== DURATION_DEFAULT && !duration.includes(row.duration)) {\r\n      return false;\r\n    }\r\n    return (\r\n      row.chartLevel >= range[0] &&\r\n      row.chartLevel <= range[1] &&\r\n      (!type || row.chartType.startsWith(type))\r\n    );\r\n  }, rows);\r\n};\r\n\r\nconst getFilteredData = (data, filter) => {\r\n  // const start = performance.now();\r\n  const names = _.map('value', filter.players);\r\n  const namesOr = _.map('value', filter.playersOr);\r\n  const namesNot = _.map('value', filter.playersNot);\r\n  const sortingType = _.get('value', filter.sortingType);\r\n  const protagonist = _.get('value', filter.protagonist);\r\n  const excludeAntagonists = _.map('value', filter.excludeAntagonists);\r\n\r\n  const defaultSorting = [_.orderBy(['latestScoreDate'], ['desc'])];\r\n  const newScoresProtagonistSorting = !protagonist\r\n    ? defaultSorting\r\n    : [\r\n        _.orderBy(\r\n          [\r\n            song =>\r\n              _.max(\r\n                _.map(\r\n                  res => (res.nickname === protagonist ? res.dateObject.getTime() : 0),\r\n                  song.results\r\n                )\r\n              ),\r\n          ],\r\n          ['desc']\r\n        ),\r\n      ];\r\n  const protagonistSorting = [\r\n    _.filter(row => _.map('nickname', row.results).includes(protagonist)),\r\n    _.map(row => {\r\n      const protIndex = _.findIndex({ nickname: protagonist }, row.results);\r\n      const protScore = row.results[protIndex].score;\r\n      const enemies = _.flow([\r\n        _.take(protIndex),\r\n        _.uniqBy('nickname'),\r\n        _.remove(res => excludeAntagonists.includes(res.nickname) || res.score === protScore),\r\n      ])(row.results);\r\n      const distance = Math.sqrt(\r\n        _.reduce((dist, enemy) => dist + (enemy.score / protScore - 0.99) ** 2, 0, enemies)\r\n      );\r\n      return {\r\n        ...row,\r\n        distanceFromProtagonist: distance,\r\n      };\r\n    }),\r\n    _.orderBy(['distanceFromProtagonist'], ['desc']),\r\n  ];\r\n  const getScoreSorting = direction => [\r\n    _.filter(row => _.map('nickname', row.results).includes(protagonist)),\r\n    _.orderBy(\r\n      [\r\n        row => {\r\n          return _.getOr(\r\n            direction === 'asc' ? Infinity : -Infinity,\r\n            'ratingDiff',\r\n            _.find({ nickname: protagonist }, row.results)\r\n          );\r\n        },\r\n      ],\r\n      [direction]\r\n    ),\r\n  ];\r\n  const sortingFunctions =\r\n    {\r\n      [SORT.DEFAULT]: defaultSorting,\r\n      [SORT.NEW_SCORES_PLAYER]: newScoresProtagonistSorting,\r\n      [SORT.PROTAGONIST]: protagonistSorting,\r\n      [SORT.RANK_ASC]: getScoreSorting('asc'),\r\n      [SORT.RANK_DESC]: getScoreSorting('desc'),\r\n    }[sortingType] || defaultSorting;\r\n\r\n  const result = _.flow(\r\n    _.compact([\r\n      _.map(row => ({\r\n        ...row,\r\n        results: row.results.filter(\r\n          (res, index) => !res.isUnknownPlayer || index === 0,\r\n          row.results\r\n        ),\r\n      })),\r\n      filter.chartRange && (items => filterCharts(filter.chartRange, items)),\r\n      !filter.showRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => !res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        filter.showOnlyRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        !filter.showOnlyRank &&\r\n        !filter.showRankAndNorank &&\r\n        _.map(row => {\r\n          const occuredNames = [];\r\n          return {\r\n            ...row,\r\n            results: _.filter(res => {\r\n              const alreadyOccured = occuredNames.includes(res.nickname);\r\n              occuredNames.push(res.nickname);\r\n              return !alreadyOccured;\r\n            }, row.results),\r\n          };\r\n        }),\r\n      (names.length || namesOr.length || namesNot.length) &&\r\n        _.filter(row => {\r\n          const rowNames = _.map('nickname', row.results);\r\n          return (\r\n            (!names.length || _.every(name => rowNames.includes(name), names)) &&\r\n            (!namesOr.length || _.some(name => rowNames.includes(name), namesOr)) &&\r\n            (!namesNot.length || !_.some(name => rowNames.includes(name), namesNot))\r\n          );\r\n        }),\r\n      _.filter(row => _.size(row.results)),\r\n      ...sortingFunctions,\r\n      filter.song && (items => matchSorter(items, filter.song, { keys: ['song'] })),\r\n    ])\r\n  )(data);\r\n  // console.log('Elapsed:', performance.now() - start);\r\n  return result;\r\n};\r\n\r\nexport const filteredDataSelector = createSelector(\r\n  state => state.results.data,\r\n  state => state.results.filter,\r\n  getFilteredData\r\n);\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport _ from 'lodash/fp';\r\nimport Select from 'react-select';\r\nimport classNames from 'classnames';\r\nimport numeral from 'numeral';\r\nimport localForage from 'localforage';\r\nimport { NavLink } from 'react-router-dom';\r\nimport Tooltip from 'react-responsive-ui/modules/Tooltip';\r\nimport {\r\n  FaRedoAlt,\r\n  FaExclamationTriangle,\r\n  FaSearch,\r\n  FaYoutube,\r\n  FaAngleDoubleUp,\r\n  FaBackward,\r\n  FaForward,\r\n} from 'react-icons/fa';\r\nimport FlipMove from 'react-flip-move';\r\n\r\n// styles\r\nimport './leaderboard.scss';\r\n\r\n// components\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Loader from 'components/Shared/Loader';\r\nimport Input from 'components/Shared/Input/Input';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\nimport CollapsibleBar from 'components/Shared/CollapsibleBar';\r\nimport ChartFilter from './ChartFilter';\r\nimport PresetsControl from './PresetsControl';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\nimport { SORT } from 'constants/leaderboard';\r\nimport { DEBUG } from 'constants/env';\r\n\r\n// reducers\r\nimport { fetchResults, setFilter, resetFilter, defaultFilter } from 'reducers/results';\r\nimport { selectPreset, openPreset } from 'reducers/presets';\r\n\r\n// utils\r\nimport { getExp } from 'utils/exp';\r\nimport { tooltipFormatter, getTimeAgo } from 'utils/leaderboards';\r\nimport { colorsArray } from 'utils/colors';\r\nimport { playersSelector, filteredDataSelector } from 'reducers/selectors';\r\n\r\n// code\r\nconst ANIMATION_DURATION = 250;\r\nconst sortingOptions = [\r\n  {\r\n    label: 'от новых скоров',\r\n    value: SORT.DEFAULT,\r\n  },\r\n  {\r\n    label: 'от новых скоров конкретного игрока',\r\n    value: SORT.NEW_SCORES_PLAYER,\r\n  },\r\n  // {\r\n  //   label: 'отставанию от остальных',\r\n  //   value: SORT.PROTAGONIST,\r\n  // },\r\n  // ...(DEBUG\r\n  //   ? [\r\n  {\r\n    label: 'от худших результатов',\r\n    value: SORT.RANK_ASC,\r\n  },\r\n  {\r\n    label: 'от лучших результатов',\r\n    value: SORT.RANK_DESC,\r\n  },\r\n  //   ]\r\n  // : []),\r\n];\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    players: playersSelector(state),\r\n    results: state.results.results,\r\n    filteredData: filteredDataSelector(state),\r\n    data: state.results.data,\r\n    filter: state.results.filter,\r\n    error: state.results.error || state.tracklist.error,\r\n    isLoading: state.results.isLoading || state.tracklist.isLoading,\r\n    presets: state.presets.presets,\r\n    currentPreset: state.presets.currentPreset,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n  setFilter,\r\n  resetFilter,\r\n  selectPreset,\r\n  openPreset,\r\n};\r\n\r\nclass Leaderboard extends Component {\r\n  static propTypes = {\r\n    match: toBe.object,\r\n    data: toBe.array,\r\n    error: toBe.object,\r\n    results: toBe.array,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  state = { showItemsCount: 20, chartOverrides: {} };\r\n\r\n  setFilter = _.curry((name, value) => {\r\n    const filter = { ...this.props.filter, [name]: value };\r\n    this.props.setFilter(filter);\r\n    localForage.setItem('filter', filter);\r\n  });\r\n\r\n  resetFilter = () => {\r\n    this.props.resetFilter();\r\n    this.setState({ chartOverrides: {} });\r\n    localForage.setItem('filter', defaultFilter);\r\n  };\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    this.setState({ chartOverrides: {} });\r\n    !isLoading && this.props.fetchResults();\r\n  };\r\n\r\n  onTypeSongName = _.debounce(300, value => {\r\n    this.setFilter('song', value);\r\n  });\r\n\r\n  onRedoLatestResult = _.throttle(ANIMATION_DURATION + 10, chart => {\r\n    const overrides = _.drop(1, this.state.chartOverrides[chart.sharedChartId]);\r\n    this.setState(state => ({\r\n      chartOverrides: {\r\n        ...state.chartOverrides,\r\n        [chart.sharedChartId]: _.size(overrides) === 1 ? null : overrides,\r\n      },\r\n    }));\r\n  });\r\n\r\n  onUndoLatestResult = _.throttle(ANIMATION_DURATION + 10, chart => {\r\n    if (_.isEmpty(chart.results)) {\r\n      this.setState(state => ({\r\n        chartOverrides: _.omit(chart.sharedChartId, state.chartOverrides),\r\n      }));\r\n    }\r\n    const undoedResult = _.maxBy('date', chart.results);\r\n    if (!undoedResult) return;\r\n\r\n    const { results } = this.props;\r\n    const undoedPlayerId = undoedResult.playerId;\r\n    const previousPlayerResult = _.findLast(\r\n      res =>\r\n        res.playerId === undoedPlayerId &&\r\n        res.sharedChartId === chart.sharedChartId &&\r\n        res.isRank === undoedResult.isRank &&\r\n        res.date < undoedResult.date,\r\n      results\r\n    );\r\n    const newResults = _.orderBy(\r\n      'score',\r\n      'desc',\r\n      _.compact(_.map(res => (res === undoedResult ? previousPlayerResult : res), chart.results))\r\n    );\r\n    const latestScore = _.maxBy('date', newResults);\r\n    const overrideChart = {\r\n      ...chart,\r\n      latestScoreDate: latestScore && latestScore.date,\r\n      results: newResults,\r\n    };\r\n    if (_.isEmpty(newResults)) {\r\n      this.setState(state => ({\r\n        chartOverrides: {\r\n          ...state.chartOverrides,\r\n          [chart.sharedChartId]: null,\r\n        },\r\n      }));\r\n    } else {\r\n      this.setState(state => ({\r\n        chartOverrides: {\r\n          ...state.chartOverrides,\r\n          [chart.sharedChartId]: [\r\n            overrideChart,\r\n            ...(state.chartOverrides[chart.sharedChartId] || [chart]),\r\n          ],\r\n        },\r\n      }));\r\n    }\r\n  });\r\n\r\n  renderSimpleSearch() {\r\n    const { isLoading, filter } = this.props;\r\n    return (\r\n      <div className=\"simple-search\">\r\n        <div className=\"song-name _margin-right _margin-bottom\">\r\n          <Input\r\n            value={filter.song || ''}\r\n            placeholder=\"название песни...\"\r\n            className=\"form-control\"\r\n            onChange={this.onTypeSongName}\r\n          />\r\n        </div>\r\n        <div className=\"chart-range _margin-right _margin-bottom\">\r\n          <ChartFilter filterValue={filter.chartRange} onChange={this.setFilter('chartRange')} />\r\n        </div>\r\n        <div className=\"_flex-fill\" />\r\n        <div className=\"_flex-row _margin-bottom\">\r\n          <PresetsControl />\r\n          <button className=\"btn btn-sm btn-dark btn-icon _margin-right\" onClick={this.resetFilter}>\r\n            <FaRedoAlt /> сбросить фильтры\r\n          </button>\r\n          <button\r\n            disabled={isLoading}\r\n            className=\"btn btn-sm btn-dark btn-icon\"\r\n            onClick={this.onRefresh}\r\n          >\r\n            <FaSearch /> обновить\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderFilters() {\r\n    const { players, filter } = this.props;\r\n\r\n    return (\r\n      <div className=\"filters\">\r\n        <div className=\"people-filters\">\r\n          <label className=\"label\">показывать чарты, которые сыграл:</label>\r\n          <div className=\"players-block\">\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">каждый из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'players', filter)}\r\n                onChange={this.setFilter('players')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и хоть один из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersOr', filter)}\r\n                onChange={this.setFilter('playersOr')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и никто из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersNot', filter)}\r\n                onChange={this.setFilter('playersNot')}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Toggle\r\n            checked={_.getOr(false, 'showRank', filter)}\r\n            onChange={this.setFilter('showRank')}\r\n          >\r\n            показывать скоры на ранке\r\n          </Toggle>\r\n        </div>\r\n        {_.get('showRank', filter) && (\r\n          <>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showOnlyRank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showOnlyRank', value);\r\n                  if (_.get('showRankAndNorank', filter)) {\r\n                    this.setFilter('showRankAndNorank', false);\r\n                  }\r\n                }}\r\n              >\r\n                <strong>только</strong> на ранке\r\n              </Toggle>\r\n            </div>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showRankAndNorank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showRankAndNorank', value);\r\n                  if (_.get('showOnlyRank', filter)) {\r\n                    this.setFilter('showOnlyRank', false);\r\n                  }\r\n                }}\r\n              >\r\n                показывать лучшие скоры с ранком и без\r\n              </Toggle>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderSortings() {\r\n    const { players, filter } = this.props;\r\n    return (\r\n      <div className=\"sortings\">\r\n        <div>\r\n          <label className=\"label\">сортировка:</label>\r\n          <Select\r\n            placeholder=\"выберите сортировку\"\r\n            className=\"select\"\r\n            classNamePrefix=\"select\"\r\n            isClearable={false}\r\n            options={sortingOptions}\r\n            value={_.getOr(sortingOptions[0], 'sortingType', filter)}\r\n            onChange={this.setFilter('sortingType')}\r\n          />\r\n        </div>\r\n        {[SORT.PROTAGONIST, SORT.RANK_ASC, SORT.RANK_DESC, SORT.NEW_SCORES_PLAYER].includes(\r\n          _.get('sortingType.value', filter)\r\n        ) && (\r\n          <div>\r\n            <label className=\"label\">игрок:</label>\r\n            <Select\r\n              className={classNames('select players', {\r\n                'red-border': !_.get('protagonist', filter),\r\n              })}\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"игроки...\"\r\n              options={players}\r\n              value={_.getOr(null, 'protagonist', filter)}\r\n              onChange={this.setFilter('protagonist')}\r\n            />\r\n          </div>\r\n        )}\r\n        {[SORT.PROTAGONIST].includes(_.get('sortingType.value', filter)) && (\r\n          <div>\r\n            <label className=\"label\">не учитывать в сравнении:</label>\r\n            <Select\r\n              closeMenuOnSelect={false}\r\n              className=\"select players\"\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"игроки...\"\r\n              options={players}\r\n              isMulti\r\n              value={_.getOr([], 'excludeAntagonists', filter)}\r\n              onChange={this.setFilter('excludeAntagonists')}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, filteredData, error, filter } = this.props;\r\n    const { showItemsCount, chartOverrides } = this.state;\r\n    const canShowMore = filteredData.length > showItemsCount;\r\n    const visibleData = _.slice(0, showItemsCount, filteredData);\r\n\r\n    const showProtagonistRatingChange = [SORT.PROTAGONIST, SORT.RANK_ASC, SORT.RANK_DESC].includes(\r\n      _.get('sortingType.value', filter)\r\n    );\r\n    const highlightProtagonist = [\r\n      SORT.PROTAGONIST,\r\n      SORT.RANK_ASC,\r\n      SORT.RANK_DESC,\r\n      SORT.NEW_SCORES_PLAYER,\r\n    ].includes(_.get('sortingType.value', filter));\r\n    const protagonistName = _.get('protagonist.value', filter);\r\n    const uniqueSelectedNames = _.slice(\r\n      0,\r\n      colorsArray.length,\r\n      _.uniq(\r\n        _.compact([\r\n          highlightProtagonist && protagonistName,\r\n          ..._.map('value', filter.players),\r\n          ..._.map('value', filter.playersOr),\r\n        ])\r\n      )\r\n    );\r\n\r\n    return (\r\n      <div className=\"leaderboard-page\">\r\n        <div className=\"content\">\r\n          <div className=\"search-block\">\r\n            {this.renderSimpleSearch()}\r\n            <CollapsibleBar title=\"фильтры\">{this.renderFilters()}</CollapsibleBar>\r\n            <CollapsibleBar title=\"сортировка\">{this.renderSortings()}</CollapsibleBar>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          {!!this.props.presets.length && (\r\n            <div className=\"presets-buttons\">\r\n              <span>пресеты:</span>\r\n              {this.props.presets.map(preset => (\r\n                <ToggleButton\r\n                  key={preset.name}\r\n                  text={preset.name}\r\n                  className=\"btn btn-sm btn-dark _margin-right\"\r\n                  active={_.get('filter', preset) === this.props.filter}\r\n                  onToggle={() => {\r\n                    this.props.selectPreset(preset);\r\n                    this.props.openPreset();\r\n                  }}\r\n                ></ToggleButton>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <div className=\"top-list\">\r\n            {_.isEmpty(filteredData) && !isLoading && (error ? error.message : 'ничего не найдено')}\r\n            {!isLoading &&\r\n              visibleData.map((chartOriginal, chartIndex) => {\r\n                const overrides = chartOverrides[chartOriginal.sharedChartId];\r\n                const chart = _.first(overrides) || chartOriginal;\r\n                if (DEBUG) console.log(chart);\r\n                let topPlace = 1;\r\n                const occuredNicknames = [];\r\n                const results = chart.results.map((res, index) => {\r\n                  const isSecondOccurenceInResults = occuredNicknames.includes(res.nickname);\r\n                  occuredNicknames.push(res.nickname);\r\n                  if (index === 0) {\r\n                    topPlace = 1;\r\n                  } else if (\r\n                    !isSecondOccurenceInResults &&\r\n                    res.score !== _.get([index - 1, 'score'], chart.results)\r\n                  ) {\r\n                    topPlace += 1;\r\n                  }\r\n                  return {\r\n                    ...res,\r\n                    topPlace,\r\n                    isSecondOccurenceInResults,\r\n                  };\r\n                });\r\n                return (\r\n                  <div className=\"song-block\" key={chart.song + chart.chartLabel}>\r\n                    <div className=\"song-name\">\r\n                      <div\r\n                        className={classNames('chart-name', {\r\n                          single: chart.chartType === 'S',\r\n                          singlep: chart.chartType === 'SP',\r\n                          doublep: chart.chartType === 'DP',\r\n                          double: chart.chartType === 'D',\r\n                          coop: chart.chartType === 'COOP',\r\n                        })}\r\n                      >\r\n                        <span className=\"chart-letter\">{chart.chartType}</span>\r\n                        <span className=\"chart-number\">{chart.chartLevel}</span>\r\n                      </div>\r\n                      <div>{chart.song}</div>\r\n                      <div className=\"youtube-link\">\r\n                        <a\r\n                          href={`https://youtube.com/results?search_query=${chart.song\r\n                            .replace(/ /g, '+')\r\n                            .replace(/-/g, '')}+${chart.chartLabel}`}\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                        >\r\n                          <FaYoutube />\r\n                        </a>\r\n                      </div>\r\n                      <div className=\"_flex-fill\" />\r\n                      {(() => {\r\n                        const isActive = !_.isEmpty(overrides);\r\n                        const currentIndex = isActive\r\n                          ? 1 + chart.totalResultsCount - _.size(overrides)\r\n                          : chart.totalResultsCount;\r\n                        const canUndo = !(currentIndex === 1 && chart.totalResultsCount === 1);\r\n                        return (\r\n                          <div\r\n                            className={classNames('undo-result-button', {\r\n                              active: isActive,\r\n                            })}\r\n                          >\r\n                            <FaBackward\r\n                              className={classNames('backward-btn', { disabled: !canUndo })}\r\n                              onClick={() => canUndo && this.onUndoLatestResult(chart)}\r\n                            />\r\n                            <span className=\"number\">\r\n                              {currentIndex}/{chart.totalResultsCount}\r\n                            </span>\r\n                            <FaForward\r\n                              className={classNames('forward-btn', { disabled: !isActive })}\r\n                              onClick={() => isActive && this.onRedoLatestResult(chart)}\r\n                            />\r\n                          </div>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                    <div className=\"charts\">\r\n                      {!_.isEmpty(results) && (\r\n                        <div className=\"chart\">\r\n                          <div className=\"results\">\r\n                            <table>\r\n                              {chartIndex === 0 && (\r\n                                <thead>\r\n                                  <tr>\r\n                                    <th className=\"place\"></th>\r\n                                    <th className=\"nickname\"></th>\r\n                                    <th className=\"judge\"></th>\r\n                                    <th className=\"score\">score</th>\r\n                                    <th className=\"grade\"></th>\r\n                                    <th className=\"number\">miss</th>\r\n                                    <th className=\"number\">bad</th>\r\n                                    <th className=\"number\">good</th>\r\n                                    <th className=\"number\">great</th>\r\n                                    <th className=\"number\">perfect</th>\r\n                                    <th className=\"combo\">combo</th>\r\n                                    <th className=\"accuracy\">accuracy</th>\r\n                                    <th className=\"date\"></th>\r\n                                  </tr>\r\n                                </thead>\r\n                              )}\r\n                              <FlipMove\r\n                                enterAnimation=\"fade\"\r\n                                leaveAnimation=\"fade\"\r\n                                typeName=\"tbody\"\r\n                                maintainContainerHeight\r\n                                duration={ANIMATION_DURATION}\r\n                              >\r\n                                {results.map((res, index) => {\r\n                                  if (res.isUnknownPlayer && index !== 0) {\r\n                                    return null;\r\n                                  }\r\n                                  const nameIndex = uniqueSelectedNames.indexOf(res.nickname);\r\n                                  let placeDifference, newIndex;\r\n                                  if (res.scoreIncrease && res.date === chart.latestScoreDate) {\r\n                                    const prevScore = res.score - res.scoreIncrease;\r\n                                    newIndex = _.findLastIndex(\r\n                                      res => res.score > prevScore,\r\n                                      results\r\n                                    );\r\n                                    placeDifference = newIndex - index;\r\n                                  }\r\n                                  return (\r\n                                    <tr\r\n                                      key={res.isRank + '_' + res.nickname}\r\n                                      className={classNames({\r\n                                        empty: !res.isExactDate,\r\n                                        latest: res.date === chart.latestScoreDate,\r\n                                      })}\r\n                                    >\r\n                                      <td className=\"place\">\r\n                                        {res.isSecondOccurenceInResults ? '' : `#${res.topPlace}`}\r\n                                      </td>\r\n                                      <td\r\n                                        className=\"nickname\"\r\n                                        style={\r\n                                          nameIndex > -1\r\n                                            ? { fontWeight: 'bold', color: colorsArray[nameIndex] }\r\n                                            : {}\r\n                                        }\r\n                                      >\r\n                                        {res.nickname}\r\n                                        {!!placeDifference && (\r\n                                          <span className=\"change-holder up\">\r\n                                            <span>{placeDifference}</span>\r\n                                            <FaAngleDoubleUp />\r\n                                          </span>\r\n                                        )}\r\n                                        {DEBUG && (\r\n                                          <span>\r\n                                            {' '}\r\n                                            {res.startingRating &&\r\n                                              Math.round(res.startingRating)}{' '}\r\n                                            {res.ratingDiff && Math.round(res.ratingDiff)}{' '}\r\n                                            {res.ratingDiffLast && Math.round(res.ratingDiffLast)}\r\n                                          </span>\r\n                                        )}\r\n                                        {!DEBUG &&\r\n                                          showProtagonistRatingChange &&\r\n                                          res.nickname === protagonistName &&\r\n                                          res.ratingDiff && (\r\n                                            <span>\r\n                                              {` (${res.ratingDiff > 0 ? '+' : ''}${Math.round(\r\n                                                res.ratingDiff\r\n                                              )})`}\r\n                                            </span>\r\n                                          )}\r\n                                        {_.get('sortingType.value', filter) === SORT.PROTAGONIST &&\r\n                                          res.nickname === protagonistName &&\r\n                                          chart.distanceFromProtagonist > 0 && (\r\n                                            <span className=\"protagonist-diff\">\r\n                                              {' '}\r\n                                              -{(chart.distanceFromProtagonist * 100).toFixed(1)}%\r\n                                            </span>\r\n                                          )}\r\n                                      </td>\r\n                                      <td\r\n                                        className={classNames('judge', {\r\n                                          vj: res.isRank,\r\n                                          hj: res.isHJ,\r\n                                        })}\r\n                                      >\r\n                                        {res.isRank && (\r\n                                          <div className=\"inner\">\r\n                                            {res.isExactDate ? (\r\n                                              'VJ'\r\n                                            ) : (\r\n                                              <Tooltip\r\n                                                content={\r\n                                                  <div>\r\n                                                    наличие ранка на этом результате было угадано,\r\n                                                    основываясь на скоре\r\n                                                  </div>\r\n                                                }\r\n                                                tooltipClassName=\"pumpking-tooltip\"\r\n                                              >\r\n                                                VJ?\r\n                                              </Tooltip>\r\n                                            )}\r\n                                          </div>\r\n                                        )}\r\n                                        {res.isHJ && <div className=\"inner\">HJ</div>}\r\n                                      </td>\r\n                                      <td className=\"score\">\r\n                                        <Overlay\r\n                                          overlayClassName=\"score-overlay-outer\"\r\n                                          overlayItem={\r\n                                            <span className=\"score-span\">\r\n                                              {/* {res.scoreIncrease > res.score * 0.8 && <FaPlus />} */}\r\n                                              {res.scoreIncrease > res.score * 0.8 && '*'}\r\n                                              {numeral(res.score).format('0,0')}\r\n                                            </span>\r\n                                          }\r\n                                          placement=\"top\"\r\n                                        >\r\n                                          <div className=\"score-overlay\">\r\n                                            {DEBUG && (\r\n                                              <>\r\n                                                <div>\r\n                                                  <span className=\"_grey\">result id: </span>\r\n                                                  {res.id}\r\n                                                </div>\r\n                                                <div>\r\n                                                  <span className=\"_grey\">player id: </span>\r\n                                                  {res.playerId}\r\n                                                </div>\r\n                                              </>\r\n                                            )}\r\n                                            <div>\r\n                                              <span className=\"_grey\">игрок: </span>\r\n                                              <NavLink\r\n                                                exact\r\n                                                to={routes.profile.getPath({ id: res.playerId })}\r\n                                              >\r\n                                                {res.nickname} ({res.nicknameArcade})\r\n                                              </NavLink>\r\n                                            </div>\r\n                                            <div>\r\n                                              <span className=\"_grey\">опыт: </span>+\r\n                                              {numeral(getExp(res, chart)).format('0,0')}\r\n                                            </div>\r\n                                            {_.isNumber(res.startingRating) &&\r\n                                              _.isNumber(res.ratingDiff) && (\r\n                                                <div>\r\n                                                  <span className=\"_grey\">\r\n                                                    эло: {res.startingRating.toFixed(0)}{' '}\r\n                                                  </span>\r\n                                                  {res.ratingDiff >= 0\r\n                                                    ? `+${res.ratingDiff.toFixed(0)}`\r\n                                                    : res.ratingDiff.toFixed(0)}\r\n                                                </div>\r\n                                              )}\r\n                                            {!res.isExactDate && (\r\n                                              <div className=\"warning\">\r\n                                                <FaExclamationTriangle />\r\n                                                рекорд взят с my best. часть данных недоступна\r\n                                              </div>\r\n                                            )}\r\n                                            {!!res.isExactDate && (\r\n                                              <>\r\n                                                {!!res.mods && (\r\n                                                  <div>\r\n                                                    <span className=\"_grey\">моды: </span>\r\n                                                    {res.mods}\r\n                                                  </div>\r\n                                                )}\r\n                                                {!!res.calories && (\r\n                                                  <div>\r\n                                                    <span className=\"_grey\">ккал: </span>\r\n                                                    {res.calories}\r\n                                                  </div>\r\n                                                )}\r\n                                                {!!res.scoreIncrease && (\r\n                                                  <div>\r\n                                                    <span className=\"_grey\">прирост: </span>+\r\n                                                    {numeral(res.scoreIncrease).format('0,0')}\r\n                                                  </div>\r\n                                                )}\r\n                                                {res.originalChartMix && (\r\n                                                  <div>\r\n                                                    <div className=\"warning\">\r\n                                                      <FaExclamationTriangle />\r\n                                                      было сыграно на {res.originalChartMix}\r\n                                                    </div>\r\n                                                    {res.originalChartLabel && (\r\n                                                      <div>\r\n                                                        <span className=\"_grey\">\r\n                                                          оригинальный чарт:{' '}\r\n                                                        </span>\r\n                                                        {res.originalChartLabel}\r\n                                                      </div>\r\n                                                    )}\r\n                                                    {res.originalScore && (\r\n                                                      <div>\r\n                                                        <span className=\"_grey\">\r\n                                                          оригинальный скор:{' '}\r\n                                                        </span>\r\n                                                        {res.originalScore}\r\n                                                      </div>\r\n                                                    )}\r\n                                                  </div>\r\n                                                )}\r\n                                                {res.scoreIncrease > res.score * 0.8 && '* сайтрид'}\r\n                                              </>\r\n                                            )}\r\n                                          </div>\r\n                                        </Overlay>\r\n                                      </td>\r\n                                      <td className=\"grade\">\r\n                                        <div className=\"img-holder\">\r\n                                          {res.grade && res.grade !== '?' && (\r\n                                            <img\r\n                                              src={`${process.env.PUBLIC_URL}/grades/${res.grade}.png`}\r\n                                              alt={res.grade}\r\n                                            />\r\n                                          )}\r\n                                          {res.grade === '?' && null}\r\n                                        </div>\r\n                                      </td>\r\n                                      <td className=\"number miss\">{res.miss}</td>\r\n                                      <td className=\"number bad\">{res.bad}</td>\r\n                                      <td className=\"number good\">{res.good}</td>\r\n                                      <td className=\"number great\">{res.great}</td>\r\n                                      <td className=\"number perfect\">{res.perfect}</td>\r\n                                      <td className=\"combo\">\r\n                                        {res.combo}\r\n                                        {res.combo ? 'x' : ''}\r\n                                      </td>\r\n                                      <td className=\"accuracy\">\r\n                                        {res.accuracy}\r\n                                        {res.accuracy ? '%' : ''}\r\n                                      </td>\r\n                                      <td\r\n                                        className={classNames('date', {\r\n                                          latest: res.date === chart.latestScoreDate,\r\n                                        })}\r\n                                      >\r\n                                        <Tooltip\r\n                                          content={tooltipFormatter(res)}\r\n                                          tooltipClassName=\"pumpking-tooltip\"\r\n                                        >\r\n                                          {getTimeAgo(res.dateObject)}\r\n                                          {res.isExactDate ? '' : '?'}\r\n                                        </Tooltip>\r\n                                      </td>\r\n                                    </tr>\r\n                                  );\r\n                                })}\r\n                              </FlipMove>\r\n                            </table>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            {!isLoading && canShowMore && (\r\n              <button\r\n                className=\"btn btn-sm btn-primary\"\r\n                onClick={() =>\r\n                  this.setState(state => ({ showItemsCount: state.showItemsCount + 10 }))\r\n                }\r\n              >\r\n                show more...\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Leaderboard);\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\n// import numeral from 'numeral';\r\nimport classNames from 'classnames';\r\nimport { GiQueenCrown } from 'react-icons/gi';\r\nimport { FaAngleDoubleUp, FaAngleDoubleDown } from 'react-icons/fa';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nimport { routes } from 'constants/routes';\r\n\r\nimport Loader from 'components/Shared/Loader';\r\n\r\nimport { getRankImg } from 'utils/exp';\r\n\r\nconst getGradeImg = grade => (\r\n  <img src={`${process.env.PUBLIC_URL}/grades/${grade}.png`} alt={grade} />\r\n);\r\n\r\nexport default function RankingList({ ranking, isLoading }) {\r\n  return (\r\n    <div className=\"ranking-list\">\r\n      {_.isEmpty(ranking) && !isLoading && 'ничего не найдено'}\r\n      {isLoading && <Loader />}\r\n      {!isLoading && (\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th className=\"place\"></th>\r\n              <th className=\"change\"></th>\r\n              <th className=\"exp-rank\">rank</th>\r\n              <th className=\"name\">name</th>\r\n              <th className=\"name2\">piu name</th>\r\n              <th className=\"rating\">elo</th>\r\n              <th className=\"rating-change-cell\"></th>\r\n              {/* <th className=\"total-score\">total score</th> */}\r\n              <th className=\"grades sss\">{getGradeImg('SSS')}</th>\r\n              <th className=\"grades ss\">{getGradeImg('SS')}</th>\r\n              <th className=\"grades s\">{getGradeImg('S')}</th>\r\n              <th className=\"grades a\">{getGradeImg('A+')}</th>\r\n              <th className=\"grades b\">{getGradeImg('B')}</th>\r\n              <th className=\"grades c\">{getGradeImg('C')}</th>\r\n              <th className=\"grades d\">{getGradeImg('D')}</th>\r\n              <th className=\"grades f\">{getGradeImg('F')}</th>\r\n              <th className=\"playcount\">scores</th>\r\n              {/* <th className=\"calories\">kcal</th> */}\r\n              <th className=\"accuracy\">accuracy</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {ranking.map((player, playerIndex) => {\r\n              return (\r\n                <tr className=\"player\" key={player.name}>\r\n                  <td className=\"place\">\r\n                    {playerIndex === 0 ? <GiQueenCrown /> : `#${playerIndex + 1}`}\r\n                  </td>\r\n                  <td className=\"change\">\r\n                    {player.change > 0 && (\r\n                      <div className=\"change-holder up\">\r\n                        <span>{player.change}</span>\r\n                        <FaAngleDoubleUp />\r\n                      </div>\r\n                    )}\r\n                    {player.change < 0 && (\r\n                      <div className=\"change-holder down\">\r\n                        <span>{-player.change}</span>\r\n                        <FaAngleDoubleDown />\r\n                      </div>\r\n                    )}\r\n                    {!!player.change && _.isString(player.change) && (\r\n                      <div className=\"change-holder text\">\r\n                        <span>{player.change}</span>\r\n                      </div>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"exp-rank\">{getRankImg(player.expRank)}</td>\r\n                  <td className=\"name\">\r\n                    <NavLink exact to={routes.profile.getPath({ id: player.id })}>\r\n                      {player.name}\r\n                    </NavLink>\r\n                  </td>\r\n                  <td className=\"name\">\r\n                    <NavLink exact to={routes.profile.getPath({ id: player.id })}>\r\n                      {player.nameArcade}\r\n                    </NavLink>\r\n                  </td>\r\n                  <td className=\"rating\">{player.rating}</td>\r\n                  <td className=\"rating-change-cell\">\r\n                    {!!player.prevRating && player.prevRating !== player.rating && (\r\n                      <span\r\n                        className={classNames('rating-change', {\r\n                          down: player.prevRating > player.rating,\r\n                          up: player.prevRating < player.rating,\r\n                        })}\r\n                      >\r\n                        {player.prevRating < player.rating ? '+' : ''}\r\n                        {player.rating - player.prevRating}\r\n                      </span>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"grades sss\">{player.grades.SSS}</td>\r\n                  <td className=\"grades ss\">{player.grades.SS}</td>\r\n                  <td className=\"grades s\">{player.grades.S}</td>\r\n                  <td className=\"grades a\">{player.grades.A}</td>\r\n                  <td className=\"grades b\">{player.grades.B}</td>\r\n                  <td className=\"grades c\">{player.grades.C}</td>\r\n                  <td className=\"grades d\">{player.grades.D}</td>\r\n                  <td className=\"grades f\">{player.grades.F}</td>\r\n                  <td className=\"playcount\">{player.count}</td>\r\n                  <td className=\"accuracy\">\r\n                    {player.accuracy ? `${player.accuracy.toFixed(2)}%` : ''}\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function RankingFaq() {\r\n  return (\r\n    <div className=\"faq\">\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Как считается рейтинг?</div>\r\n        <div className=\"answer\">\r\n          A: Используется <a href=\"https://en.wikipedia.org/wiki/Elo_rating_system\">рейтинг Эло</a>,\r\n          широко используемый в шахматах и других играх, слегка модицированный под условия игры на\r\n          пампе. Средний рейтинг - 1000. Коэффициент К зависит от уровня чарта (более сложные чарты\r\n          сильнее влияют на рейтинг). Количество очков влияет на заработанный рейтинг (маленький\r\n          отрыв от противника не даст так много очков как большой отрыв).\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Система Эло используется для игр 1 на 1, как она используется на пампе, где на одном\r\n          чарте играет много игроков?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: Рекорды на одном чарте делятся на несколько игр 1 на 1. Если есть 3 игрока: A, B, C; то\r\n          считается, что было 3 отдельные игры: A vs B, A vs C, B vs C.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Учитываются ли рекорды на ранке в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: Да. Как минимум потому что у нас есть много рекордов, взятых с машин бестов, и мы не\r\n          знаем наверняка, на ранке они или нет. Если у игрока в топе есть два скора - на ранке и\r\n          без ранка, используется тот, где больше очков.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Почему меня нет в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: В таблицу попадают только те, у кого есть хотя бы 20 игр 1 на 1. Первые 20 игр\r\n          используются для определения изначального рейтинга.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Почему суммарное количество оценок S-A-B не совпадает с общим количеством скоров?\r\n        </div>\r\n        <div className=\"answer\">A: Не для каждого результата известна оценка.</div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Если у меня есть несколько рекордов на А, несколько на А+, как считается суммарное\r\n          количество грейдов в таблице?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: В каждой колонке учитываются обе буквы - и треснутые, и с удержанным лайфом. То есть и\r\n          А, и А+ идут в колонку А. Точно так же для B, C, D.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Убери аккураси из таблицы!</div>\r\n        <div className=\"answer\">A: Грем, это секция для вопросов.</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch, FaQuestionCircle } from 'react-icons/fa';\r\nimport { Link, Route, withRouter } from 'react-router-dom';\r\nimport { createSelector } from 'reselect';\r\nimport _ from 'lodash/fp';\r\n\r\n// styles\r\nimport './ranking.scss';\r\n\r\n// components\r\nimport RankingList from './RankingList';\r\nimport RankingFaq from './RankingFaq';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\n\r\n// reducers\r\nimport { fetchResults } from 'reducers/results';\r\n\r\n// utils\r\n\r\n// code\r\nconst rankingSelector = createSelector(\r\n  state => state.results.profiles,\r\n  _.flow(\r\n    _.values,\r\n    _.orderBy(['ratingRaw'], ['desc'])\r\n  )\r\n);\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    ranking: rankingSelector(state),\r\n    error: state.results.error || state.tracklist.error,\r\n    isLoading: state.results.isLoading || state.tracklist.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n};\r\n\r\nclass Ranking extends Component {\r\n  static propTypes = {\r\n    ranking: toBe.array,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    ranking: [],\r\n  };\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchResults();\r\n  };\r\n\r\n  render() {\r\n    const { isLoading, ranking, error } = this.props;\r\n\r\n    return (\r\n      <div className=\"ranking-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.path}\r\n              render={() => (\r\n                <>\r\n                  <Link to={routes.ranking.faq.path}>\r\n                    <button className=\"btn btn-sm btn-dark btn-icon _margin-right\">\r\n                      <FaQuestionCircle /> faq\r\n                    </button>\r\n                  </Link>\r\n                  <button\r\n                    disabled={isLoading}\r\n                    className=\"btn btn-sm btn-dark btn-icon\"\r\n                    onClick={this.onRefresh}\r\n                  >\r\n                    <FaSearch /> обновить\r\n                  </button>\r\n                </>\r\n              )}\r\n            />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.faq.path}\r\n              render={() => (\r\n                <Link to={routes.ranking.path}>\r\n                  <button className=\"btn btn-sm btn-dark btn-icon\">назад</button>\r\n                </Link>\r\n              )}\r\n            />\r\n          </div>\r\n          <Route\r\n            exact\r\n            path={routes.ranking.path}\r\n            render={() => <RankingList ranking={ranking} isLoading={isLoading} />}\r\n          />\r\n          <Route exact path={routes.ranking.faq.path} component={RankingFaq} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(Ranking));\r\n","import React, { useState, useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash/fp';\r\nimport { FaPlay } from 'react-icons/fa';\r\nimport { MdExpandMore } from 'react-icons/md';\r\n\r\nimport { fetchJson } from 'utils/fetch';\r\nimport { getTimeAgo } from 'utils/leaderboards';\r\nimport { parseDate } from 'utils/date';\r\n\r\nimport Loader from 'components/Shared/Loader';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nimport './most-played.scss';\r\n\r\nexport default connect(\r\n  state => ({ charts: state.results.sharedCharts }),\r\n  { fetchJson }\r\n)(({ playerId, charts, fetchJson }) => {\r\n  const [isLoading, setLoading] = useState(false);\r\n  const [limit, setLimit] = useState(10);\r\n  const [data, setData] = useState([]);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    fetchJson({\r\n      url: `${HOST}/player/${playerId}/mostPlayed?limit=${limit}`,\r\n    })\r\n      .then(result => {\r\n        setLoading(false);\r\n        if (result.success) {\r\n          setData(result.data);\r\n        }\r\n      })\r\n      .catch(() => {\r\n        setLoading(false);\r\n      });\r\n  }, [playerId, limit, fetchJson]);\r\n\r\n  return (\r\n    <div className=\"most-played\">\r\n      {isLoading && <Loader />}\r\n      {data.map(item => {\r\n        const chart = charts[item.shared_chart];\r\n        return (\r\n          <div className=\"chart\" key={item.shared_chart}>\r\n            <div\r\n              className={classNames('chart-name', {\r\n                single: chart.chartType === 'S',\r\n                singlep: chart.chartType === 'SP',\r\n                doublep: chart.chartType === 'DP',\r\n                double: chart.chartType === 'D',\r\n                coop: chart.chartType === 'COOP',\r\n              })}\r\n            >\r\n              <span className=\"chart-letter\">{chart.chartType}</span>\r\n              <span className=\"chart-number\">{chart.chartLevel}</span>\r\n            </div>\r\n            <div className=\"song-name\">{chart.song}</div>\r\n            <div className=\"date\">\r\n              {item.latestDate ? getTimeAgo(parseDate(item.latestDate)) : null}\r\n            </div>\r\n            <div className=\"playcount\">\r\n              <FaPlay />\r\n              <span>{item.count}</span>\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n      {limit === _.size(data) && (\r\n        <button\r\n          className=\"show-more btn btn-sm btn-dark btn-icon\"\r\n          onClick={() => setLimit(limit + 10)}\r\n        >\r\n          <MdExpandMore /> больше\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\n","import React from 'react';\r\n\r\nimport { ranks, getRankImg } from 'utils/exp';\r\n\r\nexport default function ExpFaq() {\r\n  return (\r\n    <div className=\"faq-exp\">\r\n      <div className=\"faq-header\">\r\n        <strong>Опыт</strong> игрока основывается на количестве сыгранных песен и чартов.\r\n        <br />\r\n        Чем выше уровень чарта и чем лучше оценка на чарте, тем больше опыта он даёт.\r\n        <br />\r\n        Повторные попытки на тех же чартах не дают больше опыта. Чтобы поднимать свой уровень, играй\r\n        новые треки и чарты.\r\n      </div>\r\n      <div className=\"faq-header\">Список уровней и необходимый опыт для их получения:</div>\r\n      <div className=\"ranks-list\">\r\n        {ranks.map(rank => (\r\n          <div key={rank.threshold} className=\"rank\">\r\n            <div className=\"exp-rank\">{getRankImg(rank)}</div>\r\n            <div className=\"threshold\">{rank.threshold}</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch, FaQuestionCircle, FaTimes } from 'react-icons/fa';\r\nimport { withRouter } from 'react-router-dom';\r\nimport classNames from 'classnames';\r\nimport ReactModal from 'react-modal';\r\nimport Tooltip from 'react-responsive-ui/modules/Tooltip';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  LineChart,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip as RechartsTooltip,\r\n  ReferenceLine,\r\n  CartesianGrid,\r\n  Line,\r\n  Legend,\r\n  ResponsiveContainer,\r\n  Label,\r\n} from 'recharts';\r\nimport { createSelector } from 'reselect';\r\nimport _ from 'lodash/fp';\r\nimport moment from 'moment';\r\n\r\n// styles\r\nimport './profile.scss';\r\n\r\n// constants\r\n\r\n// components\r\nimport Range from 'components/Shared/Range';\r\nimport Loader from 'components/Shared/Loader';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\nimport MostPlayed from './MostPlayed';\r\nimport ExpFaq from './ExpFaq';\r\n\r\n// reducers\r\nimport { fetchResults } from 'reducers/results';\r\nimport { setProfilesFilter, resetProfilesFilter } from 'reducers/profiles';\r\n\r\n// utils\r\nimport { parseDate } from 'utils/date';\r\nimport { getTimeAgo } from 'utils/leaderboards';\r\nimport { achievements } from 'utils/achievements';\r\nimport { getRankImg } from 'utils/exp';\r\n\r\n// code\r\nconst MIN_GRAPH_HEIGHT = undefined;\r\nconst defaultGradesDistribution = {\r\n  SSS: 0,\r\n  SS: 0,\r\n  S: 0,\r\n  'A+': 0,\r\n  A: 0,\r\n  B: 0,\r\n  C: 0,\r\n  D: 0,\r\n  F: 0,\r\n};\r\nconst defaultGradesWithLevelsDistribution = _.flow(\r\n  _.flatMap(type => {\r\n    return _.flow(\r\n      _.toPairs,\r\n      _.map(([grade, value]) => [`${type}-${grade}`, value])\r\n    )(defaultGradesDistribution);\r\n  }),\r\n  _.fromPairs\r\n)(['S', 'D']);\r\n\r\nconst cutRange = (array, range) => {\r\n  const startIndex = _.findIndex(item => item.date > range[0], array);\r\n  const endIndex = _.findLastIndex(item => item.date < range[1], array);\r\n  let firstElement =\r\n    startIndex > 0 ? array[startIndex - 1] : startIndex === 0 ? array[startIndex] : _.last(array);\r\n  let lastElement = endIndex > -1 ? array[endIndex] : _.first(array);\r\n  firstElement = { ...firstElement, date: range[0] };\r\n  lastElement = { ...lastElement, date: range[1] };\r\n  const middleElements =\r\n    startIndex > -1 && endIndex > -1 ? array.slice(startIndex, endIndex + 1) : [];\r\n\r\n  return [firstElement, ...middleElements, lastElement];\r\n};\r\nconst profileSelector = createSelector(\r\n  (state, props) => _.toInteger(props.match.params.id),\r\n  state => state.results.profiles,\r\n  state => state.profiles.filter,\r\n  state => state.tracklist.data,\r\n  (id, profiles, filter, tracklist) => {\r\n    const profile = profiles[id];\r\n    if (_.isEmpty(profile)) {\r\n      return null;\r\n    }\r\n    const levelsDistribution = _.flow(\r\n      _.get('resultsByLevel'),\r\n      _.toPairs,\r\n      _.map(([x, y]) => ({\r\n        x: _.toInteger(x),\r\n        S:\r\n          (_.size(_.filter(res => res.chart.chartType === 'S' || res.chart.chartType === 'SP', y)) /\r\n            tracklist.singlesLevels[x]) *\r\n          100,\r\n        D:\r\n          (-_.size(\r\n            _.filter(res => res.chart.chartType === 'D' || res.chart.chartType === 'DP', y)\r\n          ) /\r\n            tracklist.doublesLevels[x]) *\r\n          100,\r\n      }))\r\n    )(profile);\r\n    const gradesData = _.flow(\r\n      _.get('resultsByLevel'),\r\n      _.toPairs,\r\n      _.map(\r\n        _.update('[1].result.grade', grade =>\r\n          grade && grade.includes('+') && grade !== 'A+' ? grade.replace('+', '') : grade\r\n        )\r\n      )\r\n    )(profile);\r\n    const gradesDistribution = _.flow(\r\n      _.map(([x, y]) => ({\r\n        x: _.toInteger(x),\r\n        ...defaultGradesDistribution,\r\n        ..._.omit('?', _.mapValues(_.size, _.groupBy('result.grade', y))),\r\n      })),\r\n      _.map(item => {\r\n        const grades = _.pick(Object.keys(defaultGradesDistribution), item);\r\n        const sum = _.sum(_.values(grades));\r\n        return {\r\n          ...item,\r\n          gradesValues: grades,\r\n          ...(sum === 0 ? grades : _.mapValues(value => (100 * value) / sum, grades)),\r\n        };\r\n      })\r\n    )(gradesData);\r\n    const gradesAndLevelsDistribution = _.flow(\r\n      _.map(([x, y]) => {\r\n        const groupedResults = _.groupBy('result.grade', y);\r\n        const counts = _.omit(\r\n          '?',\r\n          _.mapValues(\r\n            _.countBy(res => {\r\n              return res.chart.chartType === 'S' || res.chart.chartType === 'SP'\r\n                ? 'S'\r\n                : res.chart.chartType === 'D' || res.chart.chartType === 'DP'\r\n                ? 'D'\r\n                : 'Other';\r\n            }),\r\n            groupedResults\r\n          )\r\n        );\r\n        const reduced = _.reduce(\r\n          (acc, [grade, levelsData]) => {\r\n            const accData = _.flow(\r\n              _.toPairs,\r\n              _.map(([type, count]) => [\r\n                `${type}-${grade}`,\r\n                type === 'S'\r\n                  ? (count / tracklist.singlesLevels[x]) * 100\r\n                  : (-count / tracklist.doublesLevels[x]) * 100,\r\n              ]),\r\n              _.fromPairs\r\n            )(levelsData);\r\n            return { ...acc, ...accData };\r\n          },\r\n          {},\r\n          _.toPairs(counts)\r\n        );\r\n\r\n        return {\r\n          x: _.toInteger(x),\r\n          ...defaultGradesWithLevelsDistribution,\r\n          ...reduced,\r\n        };\r\n      })\r\n    )(gradesData);\r\n    const lastTickRating = _.last(profile.ratingHistory).date;\r\n    const lastTickRanking = _.last(profile.rankingHistory).date;\r\n    const lastTick = lastTickRating > lastTickRanking ? lastTickRating : lastTickRanking; // End graph at either point\r\n    const firstTick = _.first(profile.ratingHistory).date; // Start graph from the first battle of this player\r\n    const lastDay = moment(lastTick).endOf('day');\r\n    const firstDay = moment(firstTick).startOf('day');\r\n    const minMaxRange = [firstDay / 1000 / 60 / 60 / 24, lastDay / 1000 / 60 / 60 / 24];\r\n\r\n    const filterRange = filter.dayRange || [\r\n      Math.max(minMaxRange[0], minMaxRange[1] - 30),\r\n      minMaxRange[1],\r\n    ];\r\n    const dayRangeMs = [\r\n      +moment(filterRange[0] * 1000 * 60 * 60 * 24).startOf('day'),\r\n      +moment(filterRange[1] * 1000 * 60 * 60 * 24).endOf('day'),\r\n    ];\r\n    const placesChanges = cutRange(profile.rankingHistory, dayRangeMs);\r\n    const ratingChanges = cutRange(profile.ratingHistory, dayRangeMs);\r\n    const rank = 1 + _.findIndex({ id }, _.orderBy(['ratingRaw'], ['desc'], _.values(profiles)));\r\n    return {\r\n      ...profile,\r\n      rank,\r\n      minMaxRange,\r\n      filterRange,\r\n      levelsDistribution,\r\n      gradesDistribution,\r\n      gradesAndLevelsDistribution,\r\n      placesChanges,\r\n      ratingChanges,\r\n    };\r\n  }\r\n);\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    profile: profileSelector(state, props),\r\n    tracklist: state.tracklist.data,\r\n    filter: state.profiles.filter,\r\n    error: state.results.error || state.tracklist.error,\r\n    isLoading: state.results.isLoading || state.tracklist.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n  setProfilesFilter,\r\n  resetProfilesFilter,\r\n};\r\n\r\nclass Profile extends Component {\r\n  static propTypes = {\r\n    profile: toBe.object,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    profile: {},\r\n  };\r\n\r\n  state = {\r\n    isLevelGraphCombined: true,\r\n    showFaq: false,\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    this.props.resetProfilesFilter();\r\n  }\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchResults();\r\n  };\r\n\r\n  onChangeDayRange = range => {\r\n    const { filter } = this.props;\r\n    this.props.setProfilesFilter({\r\n      ...filter,\r\n      dayRange: range,\r\n    });\r\n  };\r\n\r\n  onShowFaq = () => {\r\n    this.setState({ showFaq: true });\r\n  };\r\n\r\n  onHideFaq = () => {\r\n    this.setState({ showFaq: false });\r\n  };\r\n\r\n  renderRankingHistory() {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart data={profile.ratingChanges} margin={{ top: 5, bottom: 5, right: 5, left: 0 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"date\"\r\n            type=\"number\"\r\n            domain={['dataMin', 'dataMax']}\r\n            tickFormatter={value => parseDate(value).toLocaleDateString()}\r\n          />\r\n          <YAxis\r\n            allowDecimals={false}\r\n            domain={['dataMin - 100', 'dataMax + 100']}\r\n            tickFormatter={Math.round}\r\n            width={40}\r\n          />\r\n          <ReferenceLine y={1000} stroke=\"white\" />\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>{parseDate(payload[0].payload.date).toLocaleDateString()}</div>\r\n                  {payload && payload[0] && <div>Rating: {Math.round(payload[0].value)}</div>}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <Line\r\n            type=\"monotone\"\r\n            isAnimationActive={false}\r\n            dataKey=\"rating\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderPlaceHistory() {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart data={profile.placesChanges} margin={{ top: 5, bottom: 5, right: 5, left: 0 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"date\"\r\n            type=\"number\"\r\n            domain={['dataMin', 'dataMax']}\r\n            tickFormatter={value => parseDate(value).toLocaleDateString()}\r\n          />\r\n          <YAxis\r\n            allowDecimals={false}\r\n            domain={[1, dataMax => (dataMax < 3 ? dataMax + 2 : dataMax + 1)]}\r\n            interval={0}\r\n            reversed\r\n            width={40}\r\n          />\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>{parseDate(payload[0].payload.date).toLocaleDateString()}</div>\r\n                  {payload && payload[0] && <div>Place: #{payload[0].value}</div>}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <Line\r\n            isAnimationActive={false}\r\n            type=\"stepAfter\"\r\n            dataKey=\"place\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGrades() {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <BarChart\r\n          data={profile.gradesDistribution}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {_.filter(item => item.value > 0, payload).map(item => (\r\n                    <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                      {item.name}: {payload[0].payload.gradesValues[item.name]}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis\r\n            domain={[0, 100]}\r\n            ticks={[0, 50, 100]}\r\n            tickFormatter={x => `${Math.round(x)}%`}\r\n            width={40}\r\n          />\r\n          <Legend />\r\n          <Bar dataKey=\"SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"F\" fill=\"#774949\" stackId=\"stack\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGradesWithLevels() {\r\n    const { profile, tracklist } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={0.74}>\r\n        <BarChart\r\n          data={profile.gradesAndLevelsDistribution}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n          stackOffset=\"sign\"\r\n        >\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              const doubleItems = _.filter(\r\n                item => item.value !== 0 && item.dataKey.startsWith('D'),\r\n                payload\r\n              );\r\n              const singleItems = _.filter(\r\n                item => item.value !== 0 && item.dataKey.startsWith('S'),\r\n                payload\r\n              );\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {!!singleItems.length && (\r\n                    <>\r\n                      <div>Single:</div>\r\n                      {singleItems.map(item => (\r\n                        <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                          {item.name.slice(2)}: {Math.round(Math.abs(item.value))}% (\r\n                          {Math.round((tracklist.singlesLevels[item.payload.x] * item.value) / 100)}\r\n                          /{tracklist.singlesLevels[item.payload.x]})\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                  {!!doubleItems.length && (\r\n                    <>\r\n                      <div>Double:</div>\r\n                      {doubleItems.map(item => (\r\n                        <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                          {item.name.slice(2)}: {Math.round(Math.abs(item.value))}% (\r\n                          {Math.round(\r\n                            (tracklist.doublesLevels[item.payload.x] * -item.value) / 100\r\n                          )}\r\n                          /{tracklist.doublesLevels[item.payload.x]})\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis\r\n            tickFormatter={x => `${Math.round(Math.abs(x))}%`}\r\n            width={40}\r\n            domain={[dataMin => Math.min(dataMin, -10), dataMax => Math.max(10, dataMax)]}\r\n          />\r\n          <Bar dataKey=\"S-SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-F\" fill=\"#774949\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-F\" fill=\"#774949\" stackId=\"stack\" />\r\n          <Label value=\"Double\" offset={0} position=\"insideBottomLeft\" />\r\n          <Label value=\"Single\" offset={0} position=\"insideTopLeft\" />\r\n          <ReferenceLine y={0} stroke=\"#bbb\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderLevels() {\r\n    const { profile, tracklist } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <BarChart\r\n          data={profile.levelsDistribution}\r\n          stackOffset=\"sign\"\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              const totalD = tracklist.doublesLevels[payload[0].payload.x];\r\n              const totalS = tracklist.singlesLevels[payload[0].payload.x];\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {totalS > 0 && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[1].color }}>\r\n                      Single: {Math.abs(payload[1].value).toFixed(1)}% (\r\n                      {Math.round((payload[1].value * totalS) / 100)}/{totalS})\r\n                    </div>\r\n                  )}\r\n                  {totalD > 0 && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[0].color }}>\r\n                      Double: {Math.abs(payload[0].value).toFixed(1)}% (\r\n                      {Math.round((Math.abs(payload[0].value) * totalD) / 100)}/{totalD})\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis\r\n            tickFormatter={x => Math.round(Math.abs(x)) + '%'}\r\n            width={40}\r\n            domain={[dataMin => Math.min(dataMin, -10), dataMax => Math.max(10, dataMax)]}\r\n          />\r\n          <RechartsTooltip />\r\n          <ReferenceLine y={0} stroke=\"#555\" />\r\n          <Legend />\r\n          <Bar dataKey=\"D\" fill=\"#169c16\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S\" fill=\"#af2928\" stackId=\"stack\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGradeBlock(type, grade) {\r\n    const { profile } = this.props;\r\n    const obj = profile.progress[type];\r\n    const typeLetter = type === 'double' ? 'D' : 'S';\r\n    const progr = Math.floor((obj[`${grade}-bonus-level-coef`] || 0) * 100);\r\n    const minNumber = obj[`${grade}-bonus-level-min-number`];\r\n    const currentNumber = obj[`${grade}-bonus-level-achieved-number`];\r\n    const levelString = obj[`${grade}-bonus-level`]\r\n      ? `${typeLetter}${obj[`${grade}-bonus-level`]}`\r\n      : '?';\r\n    return (\r\n      <div className=\"grade-block\">\r\n        <div className=\"grade-letter\">\r\n          <img src={`${process.env.PUBLIC_URL}/grades/${grade}.png`} alt={grade} />\r\n        </div>\r\n        <div className=\"grade-level\">{levelString}</div>\r\n        <div className=\"grade-progress\">\r\n          {progr}% ({progr === 100 ? minNumber : currentNumber}/{minNumber})\r\n        </div>\r\n        <div className=\"grade-progress\">бонус: +{Math.floor(obj[`${grade}-bonus`])}</div>\r\n        <div\r\n          className={classNames('progress-background', {\r\n            complete: progr === 100,\r\n            zero: progr === 0,\r\n          })}\r\n          style={{\r\n            height: `${progr}%`,\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderAchievement(achName, achievement) {\r\n    const Icon = achievements[achName].icon;\r\n    const description = achievements[achName].description;\r\n    return (\r\n      <Tooltip\r\n        key={achName}\r\n        content={<div>{description}</div>}\r\n        tooltipClassName=\"pumpking-tooltip achievement-tooltip\"\r\n      >\r\n        <div className=\"ach-block\">\r\n          {Icon && (\r\n            <div className=\"ach-icon\">\r\n              <Icon />\r\n            </div>\r\n          )}\r\n          <div className=\"ach-name\">{achName}</div>\r\n          <div\r\n            className={classNames('progress-background', {\r\n              complete: achievement.progress === 100,\r\n              zero: achievement.progress === 0,\r\n            })}\r\n            style={{\r\n              height: `${Math.round(achievement.progress)}%`,\r\n            }}\r\n          />\r\n        </div>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, profile, error, filter } = this.props;\r\n    const { isLevelGraphCombined } = this.state;\r\n\r\n    if (_.isEmpty(profile)) {\r\n      return null;\r\n    }\r\n\r\n    const expProgress = profile.expRankNext\r\n      ? (profile.exp - profile.expRank.threshold) /\r\n        (profile.expRankNext.threshold - profile.expRank.threshold)\r\n      : 100;\r\n    return (\r\n      <div className=\"profile-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            {/* <div className=\"beta\">страница в бета-версии</div> */}\r\n            <button\r\n              disabled={isLoading}\r\n              className=\"btn btn-sm btn-dark btn-icon\"\r\n              onClick={this.onRefresh}\r\n            >\r\n              <FaSearch /> обновить\r\n            </button>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          {!isLoading && (\r\n            <div className=\"profile\">\r\n              <div className=\"profile-header\">\r\n                <div className=\"profile-name text-with-header\">\r\n                  <div className=\"text-header\">игрок</div>\r\n                  <div>{profile.name}</div>\r\n                </div>\r\n                <div className=\"text-with-header\">\r\n                  <div className=\"text-header\">ранк</div>\r\n                  <div>#{profile.rank}</div>\r\n                </div>\r\n                <div className=\"text-with-header\">\r\n                  <div className=\"text-header\">эло</div>\r\n                  <div>{profile.rating}</div>\r\n                </div>\r\n                <div className=\"text-with-header\">\r\n                  <div className=\"text-header\">последняя игра</div>\r\n                  <div>\r\n                    {profile.lastResultDate ? getTimeAgo(profile.lastResultDate) : 'никогда'}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section\">\r\n                <div className=\"profile-sm-section-header _flex-row _align-center\">\r\n                  <span>опыт</span>\r\n                  <div className=\"_flex-fill\" />\r\n                  <div onClick={this.onShowFaq} className=\"_clickable\">\r\n                    <FaQuestionCircle onClick={this.onShowFaq} />\r\n                  </div>\r\n                  <ReactModal\r\n                    ariaHideApp={false}\r\n                    className=\"Modal faq-modal\"\r\n                    overlayClassName=\"Overlay\"\r\n                    isOpen={this.state.showFaq}\r\n                    onRequestClose={this.onHideFaq}\r\n                  >\r\n                    <div className=\"close-btn\" onClick={this.onHideFaq}>\r\n                      <FaTimes />\r\n                    </div>{' '}\r\n                    <ExpFaq />\r\n                  </ReactModal>\r\n                </div>\r\n                <div className=\"exp-range\">\r\n                  <div className=\"rank exp-rank\">\r\n                    {getRankImg(profile.expRank)}\r\n                    {profile.expRank && <div>{profile.expRank.threshold}</div>}\r\n                  </div>\r\n                  <div className=\"exp-line-with-label\">\r\n                    <div className=\"exp-label\">\r\n                      {profile.expRankNext ? (\r\n                        <>\r\n                          <span className=\"taken-num\">\r\n                            {Math.round(profile.exp - profile.expRank.threshold)}\r\n                          </span>\r\n                          {` / ${profile.expRankNext.threshold - profile.expRank.threshold}`}\r\n                        </>\r\n                      ) : null}\r\n                    </div>\r\n                    <div className=\"exp-line\">\r\n                      <div\r\n                        className=\"taken\"\r\n                        style={{ width: Math.floor(100 * expProgress) + '%' }}\r\n                      ></div>\r\n                      <div\r\n                        className=\"rest\"\r\n                        style={{ width: 100 - Math.ceil(100 * expProgress) + '%' }}\r\n                      ></div>\r\n                    </div>\r\n                    <div className=\"exp-label\">\r\n                      total: <span className=\"taken-num\">{Math.round(profile.exp)}</span>\r\n                    </div>\r\n                  </div>\r\n                  {profile.expRankNext && (\r\n                    <div className=\"rank exp-rank\">\r\n                      {getRankImg(profile.expRankNext)}\r\n                      {profile.expRankNext && <div>{profile.expRankNext.threshold}</div>}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section-horizontal-container\">\r\n                <div className=\"profile-section\">\r\n                  <div className=\"profile-section-content\">\r\n                    {!isLevelGraphCombined ? (\r\n                      <>\r\n                        <div className=\"profile-section-2\">\r\n                          <div className=\"profile-sm-section-header flex\">\r\n                            <span>уровни</span>\r\n                            <div className=\"toggle-holder\">\r\n                              <Toggle\r\n                                className=\"combine-toggle\"\r\n                                checked={isLevelGraphCombined}\r\n                                onChange={() =>\r\n                                  this.setState(state => ({\r\n                                    isLevelGraphCombined: !state.isLevelGraphCombined,\r\n                                  }))\r\n                                }\r\n                              >\r\n                                объединить графики\r\n                              </Toggle>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"chart-container\">{this.renderLevels()}</div>\r\n                        </div>\r\n                        <div className=\"profile-section-2\">\r\n                          <div className=\"profile-sm-section-header\">\r\n                            <span>оценки</span>\r\n                          </div>\r\n                          <div className=\"chart-container\">{this.renderGrades()}</div>\r\n                        </div>\r\n                      </>\r\n                    ) : (\r\n                      <div className=\"profile-section-2\">\r\n                        <div className=\"profile-sm-section-header flex\">\r\n                          <span>оценки</span>\r\n                          <div className=\"toggle-holder\">\r\n                            <Toggle\r\n                              className=\"combine-toggle\"\r\n                              checked={isLevelGraphCombined}\r\n                              onChange={() =>\r\n                                this.setState(state => ({\r\n                                  isLevelGraphCombined: !state.isLevelGraphCombined,\r\n                                }))\r\n                              }\r\n                            >\r\n                              объединить графики\r\n                            </Toggle>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"chart-container single-double-labels\">\r\n                          {this.renderGradesWithLevels()}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"profile-section\">\r\n                  <div className=\"profile-section-content\">\r\n                    <div className=\"profile-section-2\">\r\n                      <div className=\"profile-sm-section-header\">\r\n                        <span>эло</span>\r\n                      </div>\r\n                      <div className=\"chart-container\">{this.renderRankingHistory()}</div>\r\n                    </div>\r\n                    <div className=\"profile-section-2\">\r\n                      <div className=\"profile-sm-section-header\">\r\n                        <span>место в топе</span>\r\n                      </div>\r\n                      <div className=\"chart-container\">{this.renderPlaceHistory()}</div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"range-container\">\r\n                    <Range\r\n                      range={filter.dayRange || profile.filterRange}\r\n                      min={profile.minMaxRange[0]}\r\n                      max={profile.minMaxRange[1]}\r\n                      onChange={this.onChangeDayRange}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section progress-section\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>достижения по уровням</span>\r\n                </div>\r\n                <div className=\"progress-blocks-single-double\">\r\n                  <div className=\"progress-block\">\r\n                    <div className=\"achievements-grades single\">\r\n                      {this.renderGradeBlock('single', 'A')}\r\n                      {this.renderGradeBlock('single', 'A+')}\r\n                      {this.renderGradeBlock('single', 'S')}\r\n                      {this.renderGradeBlock('single', 'SS')}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"progress-block\">\r\n                    <div className=\"achievements-grades double\">\r\n                      {this.renderGradeBlock('double', 'A')}\r\n                      {this.renderGradeBlock('double', 'A+')}\r\n                      {this.renderGradeBlock('double', 'S')}\r\n                      {this.renderGradeBlock('double', 'SS')}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"bonus-faq\">\r\n                  * суммарный бонус (+{Math.round(profile.progress.bonus)}) добавляется к стартовому\r\n                  Эло\r\n                  <br />* для получения ачивки нужно сыграть около 10% всех чартов данного левела на\r\n                  нужный грейд\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>достижения</span>\r\n                </div>\r\n                <div className=\"achievements\">\r\n                  {_.keys(profile.achievements).map(achName =>\r\n                    this.renderAchievement(achName, profile.achievements[achName])\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>часто играемые чарты</span>\r\n                </div>\r\n                <MostPlayed playerId={profile.id} />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(Profile));\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\nimport { RESET } from './resetAction';\r\n\r\nconst LOADING = `USER/LOADING`;\r\nconst SUCCESS = `USER/SUCCESS`;\r\nconst ERROR = `USER/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: null,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n        data: null,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n        data: null,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    case RESET:\r\n      return initialState;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchUser = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/profile` }));\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n\r\nexport { resetUser } from './resetAction';\r\n","import cookies from 'browser-cookies';\r\n\r\nimport { postJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nimport { fetchUser, resetUser } from 'reducers/user';\r\n\r\nconst LOADING = `LOGIN/LOADING`;\r\nconst SUCCESS = `LOGIN/SUCCESS`;\r\nconst ERROR = `LOGIN/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: null,\r\n  error: null,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n        data: null,\r\n        error: null,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n        data: null,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const login = googleResponse => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(\r\n        postJson({\r\n          url: `${HOST}/login/google`,\r\n          body: { token: googleResponse.tokenId },\r\n        })\r\n      );\r\n      cookies.set('session', data.session, { expires: 30 });\r\n      dispatch({ type: SUCCESS, data });\r\n      dispatch(fetchUser());\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n\r\nexport const logout = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    dispatch(resetUser());\r\n    try {\r\n      const data = await dispatch(\r\n        postJson({\r\n          url: `${HOST}/logout`,\r\n        })\r\n      );\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { NavLink } from 'react-router-dom';\r\nimport _ from 'lodash/fp';\r\n\r\nimport './top-bar.scss';\r\n\r\n// routes\r\nimport { routes } from 'constants/routes';\r\n\r\n// reducers\r\nimport * as loginACs from 'reducers/login';\r\n\r\n// redux\r\nconst mapStateToProps = state => {\r\n  return {\r\n    isLoadingLogin: state.login.isLoading,\r\n    isLoadingUser: state.user.isLoading,\r\n    user: state.user.data,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  login: loginACs.login,\r\n  logout: loginACs.logout,\r\n};\r\n\r\nfunction TopBar({ isLoadingLogin, isLoadingUser, user, login, logout }) {\r\n  return (\r\n    <header className=\"top-bar\">\r\n      <nav>\r\n        <ul>\r\n          <li>\r\n            <NavLink exact to={routes.leaderboard.path}>\r\n              leaderboard\r\n            </NavLink>\r\n          </li>\r\n          <li>\r\n            <NavLink exact to={routes.ranking.path}>\r\n              ranking\r\n            </NavLink>\r\n          </li>\r\n        </ul>\r\n      </nav>\r\n      <div className=\"_flex-fill\" />\r\n      <div className=\"login-container\">\r\n        <div className=\"player-info\">{_.getOr('', 'player.nickname', user)}</div>\r\n        <button\r\n          className=\"btn btn-dark btn-icon btn-sm\"\r\n          onClick={logout}\r\n          disabled={isLoadingLogin || isLoadingUser}\r\n        >\r\n          <span> logout</span>\r\n        </button>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(TopBar);\r\n","import React, { useState } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { GoogleLogin } from 'react-google-login';\r\nimport { FaGoogle } from 'react-icons/fa';\r\nimport Emoji from 'react-emoji-render';\r\n\r\nimport './login-screen.scss';\r\n\r\n// reducers\r\nimport * as loginACs from 'reducers/login';\r\n\r\n// redux\r\nconst mapStateToProps = state => {\r\n  return {\r\n    isLoading: state.login.isLoading,\r\n    error: state.login.error,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  login: loginACs.login,\r\n};\r\n\r\nfunction LoginScreen({ isLoading, error, login }) {\r\n  const [isClown, setClown] = useState(false);\r\n  const onGoogleResponse = res => {\r\n    if (res.error) {\r\n      console.log('Google login response error:', res);\r\n    } else {\r\n      login(res);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-screen\">\r\n      <div className=\"site-name\">pumpking</div>\r\n      <div className=\"login-button\">\r\n        <GoogleLogin\r\n          clientId=\"197132042723-cmibep21qf6dald9l2l01rif7l5dtd4s.apps.googleusercontent.com\"\r\n          buttonText=\"Login\"\r\n          onSuccess={onGoogleResponse}\r\n          onFailure={onGoogleResponse}\r\n          cookiePolicy={'single_host_origin'}\r\n          render={({ onClick, disabled }) => (\r\n            <button\r\n              className=\"btn btn-dark btn-icon btn-sm\"\r\n              onClick={onClick}\r\n              disabled={disabled || isLoading}\r\n            >\r\n              <FaGoogle />\r\n              <span> login</span>\r\n            </button>\r\n          )}\r\n        />\r\n      </div>\r\n      {error && <div className=\"error\">{error.message}</div>}\r\n      <div className=\"footer\">\r\n        By logging in, you agree to our{' '}\r\n        {isClown ? (\r\n          <Emoji text=\"🤡\" className=\"clown\" />\r\n        ) : (\r\n          <span onClick={() => setClown(true)} className=\"link-style\">\r\n            Privacy Policy\r\n          </span>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(LoginScreen);\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `TRACKLIST/LOADING`;\r\nconst SUCCESS = `TRACKLIST/SUCCESS`;\r\nconst ERROR = `TRACKLIST/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchTracklist = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/tracklist/stats/XX` }));\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import React, { useEffect } from 'react';\r\nimport { Route, Redirect } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport localForage from 'localforage';\r\nimport _ from 'lodash/fp';\r\n\r\nimport 'react-responsive-ui/style.css';\r\nimport './App.scss';\r\n\r\nimport { routes } from 'constants/routes';\r\nimport { CHART_MIN_MAX } from 'constants/leaderboard';\r\n\r\nimport Leaderboard from 'components/Leaderboard/Leaderboard';\r\nimport Ranking from 'components/Ranking/Ranking';\r\nimport Profile from 'components/Profile/Profile';\r\nimport TopBar from 'components/Shared/TopBar/TopBar';\r\nimport Loader from 'components/Shared/Loader';\r\nimport LoginScreen from 'components/LoginScreen/LoginScreen';\r\n\r\nimport { fetchResults, setFilter } from 'reducers/results';\r\nimport { fetchTracklist } from 'reducers/tracklist';\r\nimport { fetchUser } from 'reducers/user';\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    data: state.user.data,\r\n    isLoading: state.user.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  setFilter,\r\n  fetchResults,\r\n  fetchTracklist,\r\n  fetchUser,\r\n};\r\n\r\nfunction App(props) {\r\n  const { fetchUser, fetchTracklist, fetchResults, setFilter, data, isLoading } = props;\r\n\r\n  useEffect(() => {\r\n    localForage\r\n      .getItem('filter')\r\n      .then(filter => {\r\n        if (filter) {\r\n          setFilter({\r\n            ...filter,\r\n            chartRange: filter.chartRange && {\r\n              ...filter.chartRange,\r\n              range: _.every(\r\n                r => r >= CHART_MIN_MAX[0] && r <= CHART_MIN_MAX[1],\r\n                filter.chartRange.range\r\n              )\r\n                ? filter.chartRange.range\r\n                : CHART_MIN_MAX,\r\n            },\r\n          });\r\n        }\r\n      })\r\n      .catch(error => console.error('Cannot get filter from local storage', error));\r\n    fetchUser();\r\n  }, [fetchUser, fetchTracklist, fetchResults, setFilter]);\r\n\r\n  useEffect(() => {\r\n    if (data && data.player) {\r\n      fetchTracklist().then(() => {\r\n        fetchResults();\r\n      });\r\n    }\r\n  }, [data, fetchResults, fetchTracklist]);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"container\">\r\n        <Loader />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!data || !data.player) {\r\n    return <LoginScreen />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <TopBar />\r\n      <Route exact path=\"/\" render={() => <Redirect to={routes.leaderboard.path} />} />\r\n      <Route path={routes.leaderboard.path} component={Leaderboard} />\r\n      <Route path={routes.ranking.path} component={Ranking} />\r\n      <Route path={routes.profile.path} component={Profile} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(App);\r\n","import { combineReducers, createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport _ from 'lodash/fp';\r\n\r\nimport tracklist from 'reducers/tracklist';\r\nimport ranking from 'reducers/ranking';\r\nimport profiles from 'reducers/profiles';\r\nimport presets from 'reducers/presets';\r\nimport results from 'reducers/results';\r\nimport user from 'reducers/user';\r\nimport login from 'reducers/login';\r\n\r\nconst rootReducer = combineReducers({\r\n  login,\r\n  presets,\r\n  profiles,\r\n  ranking,\r\n  tracklist,\r\n  results,\r\n  user,\r\n});\r\n\r\nexport const store = createStore(\r\n  rootReducer,\r\n  window.__REDUX_DEVTOOLS_EXTENSION__ && process.env.NODE_ENV === 'development'\r\n    ? compose(\r\n        applyMiddleware(thunk),\r\n        window.__REDUX_DEVTOOLS_EXTENSION__({\r\n          stateSanitizer: state => ({\r\n            ...state,\r\n            results: {\r\n              ...state.results,\r\n              data: `big array, ${_.size(state.results.data)}`,\r\n              results: `big array, ${_.size(state.results.results)}`,\r\n              sharedCharts: 'big object',\r\n              profiles: _.mapValues(\r\n                pl => ({\r\n                  ...pl,\r\n                  resultsByGrade: '...',\r\n                  resultsByLevel: '...',\r\n                  rankingHistory: '...',\r\n                  ratingHistory: '...',\r\n                }),\r\n                state.results.profiles\r\n              ),\r\n            },\r\n          }),\r\n        })\r\n      )\r\n    : applyMiddleware(thunk)\r\n);\r\n","import 'promise-polyfill';\r\nimport 'whatwg-fetch';\r\nimport 'utils/polyfills';\r\n\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { HashRouter } from 'react-router-dom';\r\nimport { Provider } from 'react-redux';\r\n\r\nimport './index.scss';\r\nimport App from 'components/App';\r\n\r\nimport { store } from 'reducers';\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <HashRouter>\r\n      <App />\r\n    </HashRouter>\r\n  </Provider>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}