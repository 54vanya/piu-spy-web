(this["webpackJsonppiu-spy-web-2"]=this["webpackJsonppiu-spy-web-2"]||[]).push([[0],{214:function(e,a,t){e.exports=t(436)},219:function(e,a){Number.isNaN=Number.isNaN||function(e){return e!==e},"undefined"===typeof Math.sign&&(Math.sign=function(e){return e>0?1:e<0?-1:e}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var a=Object(this),t=a.length>>>0;if("function"!==typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],n=0;n<t;){var s=a[n];if(e.call(r,s,n,a))return n;n++}return-1},configurable:!0,writable:!0})},228:function(e,a,t){},240:function(e,a,t){},241:function(e,a,t){},242:function(e,a,t){},253:function(e,a,t){},254:function(e,a,t){},255:function(e,a,t){},256:function(e,a,t){},259:function(e,a,t){},266:function(e,a,t){},415:function(e,a,t){},416:function(e,a,t){},417:function(e,a,t){},418:function(e,a,t){},419:function(e,a,t){},430:function(e,a,t){},433:function(e,a,t){},434:function(e,a,t){},435:function(e,a,t){},436:function(e,a,t){"use strict";t.r(a);t(215),t(218),t(219);var r=t(1),n=t.n(r),s=t(14),l=t.n(s),c=t(12),i=t(10),o=(t(228),{LEADERBOARDS:"\u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u044b",RANKING:"\u0440\u0430\u043d\u043a\u0438\u043d\u0433",TOURNAMENTS:"\u0442\u0443\u0440\u043d\u0438\u0440\u044b",SONGS:"\u0442\u0440\u0435\u043a\u0438",LOGOUT:"\u0432\u044b\u0439\u0442\u0438",FILTERS:"\u0444\u0438\u043b\u044c\u0442\u0440\u044b",SORTING:"\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430",PRESETS:"\u043f\u0440\u0435\u0441\u0435\u0442\u044b",PRESETS_PLACEHOLDER:"\u043f\u0440\u0435\u0441\u0435\u0442\u044b...",RESET_FILTERS:"\u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b",REFRESH:"\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c",FILTER_CHARTS:"\u0444\u0438\u043b\u044c\u0442\u0440 \u0447\u0430\u0440\u0442\u043e\u0432",CHARTS:"\u0447\u0430\u0440\u0442\u044b",SONG_NAME_PLACEHOLDER:"\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0441\u043d\u0438...",PLAYERS_PLACEHOLDER:"\u0438\u0433\u0440\u043e\u043a\u0438...",OPEN:"\u043e\u0442\u043a\u0440\u044b\u0442\u044c",OVERWRITE:"\u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c",DELETE:"\u0443\u0434\u0430\u043b\u0438\u0442\u044c",ADD:"\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c",SAVE:"\u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",CANCEL:"\u043e\u0442\u043c\u0435\u043d\u0430",EMPTY:"\u043f\u0443\u0441\u0442\u043e",SHOW_PRESETS_TABS:"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0442\u0430\u0431\u044b \u0441 \u043f\u0440\u0435\u0441\u0435\u0442\u0430\u043c\u0438",PRESET_NAME_PLACEHOLDER:"\u0438\u043c\u044f \u043f\u0440\u0435\u0441\u0435\u0442\u0430...",SHOW_CHARTS_PLAYED_BY:"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0447\u0430\u0440\u0442\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u044b\u0433\u0440\u0430\u043b:",EACH_OF_THESE:"\u043a\u0430\u0436\u0434\u044b\u0439 \u0438\u0437 \u044d\u0442\u0438\u0445",AND_ANY_OF_THESE:"\u0438 \u0445\u043e\u0442\u044c \u043e\u0434\u0438\u043d \u0438\u0437 \u044d\u0442\u0438\u0445",AND_NONE_OF_THESE:"\u0438 \u043d\u0438\u043a\u0442\u043e \u0438\u0437 \u044d\u0442\u0438\u0445",SHOW_RANK:"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0440\u0430\u043d\u043a:",RANK_FILTER_SHOW_ALL:"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0441\u043a\u043e\u0440\u044b",RANK_FILTER_SHOW_BEST:"\u043e\u0434\u0438\u043d \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043a\u043e\u0440 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430 (\u0440\u0430\u043d\u043a \u0438\u043b\u0438 \u043d\u0435\u0442)",RANK_FILTER_SHOW_RANK:"\u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0440\u0430\u043d\u043a\u0435",RANK_FILTER_SHOW_NORANK:"\u0442\u043e\u043b\u044c\u043a\u043e \u0431\u0435\u0437 \u0440\u0430\u043d\u043a\u0430",SHOW_HIDDEN_PLAYERS:"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0441\u043a\u0440\u044b\u0442\u044b\u0445 \u0438\u0433\u0440\u043e\u043a\u043e\u0432",SORTING_LABEL:"\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430:",SORTING_PLACEHOLDER:"\u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0443",PLAYER_LABEL:"\u0438\u0433\u0440\u043e\u043a:",EXCLUDE_FROM_COMPARISON:"\u043d\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0432 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0438:",NEW_TO_OLD_SCORES:"\u043e\u0442 \u043d\u043e\u0432\u044b\u0445 \u0441\u043a\u043e\u0440\u043e\u0432",NEW_TO_OLD_SCORES_OF_A_PLAYER:"\u043e\u0442 \u043d\u043e\u0432\u044b\u0445 \u0441\u043a\u043e\u0440\u043e\u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430",SCORE_DIFFERENCE:"\u043e\u0442\u0441\u0442\u0430\u0432\u0430\u043d\u0438\u044e \u043e\u0442 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445",WORST_TO_BEST_BY_ELO:"\u043e\u0442 \u0445\u0443\u0434\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (\u044d\u043b\u043e)",BEST_TO_WORST_BY_ELO:"\u043e\u0442 \u043b\u0443\u0447\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (\u044d\u043b\u043e)",WORST_TO_BEST_BY_PP:"\u043e\u0442 \u0445\u0443\u0434\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (pp)",BEST_TO_WORST_BY_PP:"\u043e\u0442 \u043b\u0443\u0447\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 (pp)",EASY_TO_HARD_CHARTS:"\u043e\u0442 \u043b\u0451\u0433\u043a\u0438\u0445 \u0447\u0430\u0440\u0442\u043e\u0432",HARD_TO_EASY_CHARTS:"\u043e\u0442 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0447\u0430\u0440\u0442\u043e\u0432",SHOW_ALL_SCORES:"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0441\u043a\u043e\u0440\u044b",BEST_SCORE:"\u043e\u0434\u0438\u043d \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043a\u043e\u0440 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430 (\u0440\u0430\u043d\u043a \u0438\u043b\u0438 \u043d\u0435\u0442)",RANK_ONLY:"\u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0440\u0430\u043d\u043a\u0435",ONLY_NO_RANK:"\u0442\u043e\u043b\u044c\u043a\u043e \u0431\u0435\u0437 \u0440\u0430\u043d\u043a\u0430",PLAYER:"\u0438\u0433\u0440\u043e\u043a",EXP:"\u043e\u043f\u044b\u0442",ELO:"\u044d\u043b\u043e",PP:"pp",MODS:"\u043c\u043e\u0434\u044b",CCAL:"\u043a\u043a\u0430\u043b",SCORE_INCREASE:"\u043f\u0440\u0438\u0440\u043e\u0441\u0442",ORIGINAL_MIX:"\u0431\u044b\u043b\u043e \u0441\u044b\u0433\u0440\u0430\u043d\u043e \u043d\u0430",ORIGINAL_CHART:"\u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0447\u0430\u0440\u0442:",ORIGINAL_SCORE:"\u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u043a\u043e\u0440:",SIGHTREAD:"* \u0441\u0430\u0439\u0442\u0440\u0438\u0434",MY_BEST_SCORE_WARNING:"\u0440\u0435\u043a\u043e\u0440\u0434 \u0432\u0437\u044f\u0442 \u0441 my best. \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430",BACK_TO_ALL_CHARTS:"\u043a\u043e \u0432\u0441\u0435\u043c \u0447\u0430\u0440\u0442\u0430\u043c",NO_RESULTS:"\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",SHOW_MORE:"\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435",HIDDEN:"\u0441\u043a\u0440\u044b\u0442\u043e",DOUBLES:"\u0434\u0430\u0431\u043b\u044b",SINGLES:"\u0441\u0438\u043d\u0433\u043b\u044b",UNPLAYED:"\u043d\u0435 \u0441\u044b\u0433\u0440\u0430\u043d\u043e",BACK_BUTTON:"\u043d\u0430\u0437\u0430\u0434",LEVEL_PLACEHOLDER:"\u0443\u0440\u043e\u0432\u0435\u043d\u044c..."}),m={...o,DOUBLES:"doubles",SINGLES:"singles",UNPLAYED:"unplayed",BACK_BUTTON:"back",LEVEL_PLACEHOLDER:"level..."};const d=navigator.language.includes("ru")?o:m,p=n.a.createContext(d);p.displayName="Language";const u=()=>Object(r.useContext)(p);var h=t(15),E=t(13),g=t.n(E),f=t(48),y=t.n(f),N=t(2),v=t.n(N);t(239),t(240);const b={path:"/leaderboard",sharedChart:{path:"/leaderboard/chart/:sharedChartId",getPath:e=>"/leaderboard/chart/".concat(e.sharedChartId)}},S={path:"/songs"},O={path:"/ranking",faq:{path:"/ranking/faq"}},R={path:"/tournaments"},k={path:"/profiles/:id",getPath:e=>"/profiles/".concat(e.id),resultsByLevel:{path:"/profiles/:id/levels",getPath:e=>"/profiles/".concat(e.id,"/levels"),level:{path:"/profiles/:id/levels/:level",getPath:e=>"/profiles/".concat(e.id,"/levels/").concat(e.level)}},compare:{path:"/profiles/:id/vs/:compareToId",getPath:e=>"/profiles/".concat(e.id,"/vs/").concat(e.compareToId)}},P={DEFAULT:"default",PROTAGONIST:"protagonist",RANK_ASC:"rankAsc",RANK_DESC:"rankDesc",PP_ASC:"ppAsc",PP_DESC:"ppDesc",NEW_SCORES_PLAYER:"newScoresPlayer",EASIEST_SONGS:"easiestSongs",HARDEST_SONGS:"hardestSongs"},L="SHOW_ALL",_="SHOW_BEST",C="SHOW_ONLY_RANK",A="SHOW_ONLY_NORANK",x=[1,28],T={STD:"Standard",SHORT:"Short",REMIX:"Remix",FULL:"Full"},I=v.a.values(T);var D=t(9),w=t(5),M=t.n(w);t(241),t(242);function F(){return n.a.createElement("div",{className:"loader"},n.a.createElement("svg",{width:"40",height:"12",viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:"#eee"},n.a.createElement("circle",{cx:"15",cy:"15",r:"15"},n.a.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})),n.a.createElement("circle",{cx:"60",cy:"15",r:"9",fillOpacity:"0.3"},n.a.createElement("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"0.5",to:"0.5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})),n.a.createElement("circle",{cx:"105",cy:"15",r:"15"},n.a.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"}))))}var B=t(75),H=t.n(B);const j=({url:e})=>K({url:e,method:"get"}),G=({url:e,body:a})=>K({url:e,method:"post",body:JSON.stringify(a),headers:{"Content-Type":"application/json;charset=utf-8"}}),U={},K=({url:e,method:a,body:t,headers:r})=>async(n,s)=>{try{const n=H.a.get("session");n&&(U.Session=n);const s=await fetch(e,{method:a,body:t,headers:{...U,...r},credentials:"include"});if(s.status>=200&&s.status<300){return await s.json()}{const e=await s.json();throw v.a.isObject(e)&&v.a.isString(e.error)?new Error(e.error):v.a.isString(e)?new Error(e):new Error("HTTP Status "+s.status)}}catch(l){return"Invalid session"===l.message&&n({type:"USER/RESET"}),Promise.reject(l)}},W="https://vps720616.ovh.net:5000",V="MOST_PLAYED/ERROR",Y={isLoading:!1,data:[]};const q={isLoading:!1,data:[]};const z={isLoading:!1,data:[]};var X=t(440),J=t(76),Q=t.n(J),Z=t(439),$=t(16),ee=t.n($);const ae=e=>"string"===typeof e?ee()(e).toDate():new Date(e),te=(e,a)=>"SSS"===a?e-3e5:"SS"===a?e-15e4:"S"===a?e-1e5:e,re=[{threshold:0,iconName:"0.png",color:"bronze"},{threshold:1e3,iconName:"1.png",color:"bronze"},{threshold:2e3,iconName:"2.png",color:"bronze"},{threshold:3e3,iconName:"3.png",color:"bronze"},{threshold:4e3,iconName:"4.png",color:"bronze"},{threshold:5e3,iconName:"5.png",color:"bronze"},{threshold:6250,iconName:"6.png",color:"bronze"},{threshold:7500,iconName:"7.png",color:"bronze"},{threshold:8750,iconName:"8.png",color:"bronze"},{threshold:1e4,iconName:"9.png",color:"silver"},{threshold:12e3,iconName:"10.png",color:"silver"},{threshold:14e3,iconName:"11.png",color:"silver"},{threshold:16e3,iconName:"12.png",color:"silver"},{threshold:18e3,iconName:"13.png",color:"silver"},{threshold:22e3,iconName:"14.png",color:"silver"},{threshold:26e3,iconName:"15.png",color:"silver"},{threshold:3e4,iconName:"16.png",color:"silver"},{threshold:35e3,iconName:"17.png",color:"silver"},{threshold:4e4,iconName:"18.png",color:"gold"},{threshold:5e4,iconName:"19.png",color:"gold"},{threshold:6e4,iconName:"20.png",color:"gold"},{threshold:7e4,iconName:"21.png",color:"gold"},{threshold:8e4,iconName:"22.png",color:"gold"},{threshold:1e5,iconName:"23.png",color:"gold"},{threshold:12e4,iconName:"24.png",color:"gold"},{threshold:14e4,iconName:"25.png",color:"gold"},{threshold:16e4,iconName:"26.png",color:"gold"},{threshold:18e4,iconName:"27.png",color:"green"}],ne={F:.1,D:.2,"D+":.3,C:.3,"C+":.5,B:.5,"B+":.8,A:.8,"A+":1,S:1.1,SS:1.2,SSS:1.2},se=(e,a)=>{if(!e.isBestGradeOnChart)return 0;if("COOP"===a.chartType)return 1e3*a.chartLevel*(ne[e.grade]||.8)/8;return a.chartLevel**2.31*(ne[e.grade]||.8)/9},le=e=>e&&n.a.createElement("img",{className:e.color,src:"".concat(".","/ranks/").concat(e.iconName),alt:e.threshold});var ce=t(19);const ie={"500 \u043a\u043e\u043c\u0431\u043e":{icon:ce.f,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 500+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:(e,a,t)=>({progress:100===t.progress||e.combo>=500?100:0})},"1000 \u043a\u043e\u043c\u0431\u043e":{icon:ce.g,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 1000+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:(e,a,t)=>({progress:100===t.progress||e.combo>=1e3?100:0})},"2000 \u043a\u043e\u043c\u0431\u043e":{icon:ce.h,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 2000+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:(e,a,t)=>({progress:100===t.progress||e.combo>=2e3?100:0})},"\u041c\u0430\u0441\u0442\u0435\u0440 \u0444\u0438\u043d\u0433\u0435\u0440\u0438\u043d\u0433\u0430":{icon:ce.j,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c \u0432\u0441\u0435 Fingers \u0442\u0440\u0435\u043a\u0438",initialState:{progress:0,playedSongs:[],songsToPlay:["Monkey Fingers","Kimchi Fingers","Monkey Fingers 2","Money Fingers"]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.includes(a.song)?v.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"8-bit":{icon:ce.i,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c Seize My Day, Tales of Pumpnia \u0438 Pumptris (8bit ver.)",initialState:{progress:0,playedSongs:[],songsToPlay:["Seize My Day","Tales of Pumpnia","Pumptris (8bit ver.)"]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.includes(a.song)?v.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"Love is...":{icon:ce.c,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c \u0432\u0441\u0435 Love is a Danger Zone \u0442\u0440\u0435\u043a\u0438",initialState:{progress:0,playedSongs:[],songsToPlay:["Love is a Danger Zone","Love is a Danger Zone [SHORT]","Love is a Danger Zone (Cranky Mix)","Love is a Danger Zone 2","Love is a Danger Zone 2 [SHORT]","Love is a Danger Zone 2 [FULL]","Love is a Danger Zone 2 (D&G Ver.)","Love is a Danger Zone (try to B.P.M.)"]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.includes(a.song)?v.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"\u0423\u043b\u0438\u0442\u043a\u0430":{icon:ce.k,description:"\u041c\u0430\u0441\u0442\u0435\u0440 \u0437\u0430\u043c\u0435\u0434\u043b\u0435\u043d\u0438\u0439: \u0441\u044b\u0433\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u0448\u0438\u0435 \u0447\u0430\u0440\u0442\u044b Twist of Fate, Karyawisata, Awakening \u0438 Moonlight",initialState:{progress:0,playedSongs:[],songsToPlay:[{song:"Twist of Fate (feat. Ruriling)",charts:["D20","S19"]},{song:"Karyawisata",charts:["S20","D16"]},{song:"Awakening",charts:["S19","D20"]},{song:"Moonlight",charts:["S19","D21"]}]},resultFunction:(e,a,t)=>{const r=t.songsToPlay.some(e=>a.song===e.song&&e.charts.includes(a.chartLabel))?v.a.uniq([...t.playedSongs,a.song]):t.playedSongs;return{playedSongs:r,songsToPlay:t.songsToPlay,progress:100*r.length/t.songsToPlay.length}}},"\u041a\u043e\u0440\u0438\u0447\u043d\u0435\u0432\u0430\u044f S":{icon:ce.d,description:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c S, \u043d\u043e 5+ \u0431\u044d\u0434\u043e\u0432",resultFunction:(e,a,t)=>({progress:100===t.progress||0===e.miss&&e.bad>=5?100:0})},"\u041c\u044b \u0432\u044b\u0436\u0438\u0432\u0430\u043b\u0438 \u043a\u0430\u043a \u043c\u043e\u0433\u043b\u0438":{icon:ce.b,description:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c B \u0438\u043b\u0438 \u043d\u0438\u0436\u0435, \u043d\u043e \u0443\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043b\u0430\u0439\u0444\u0431\u0430\u0440",resultFunction:(e,a,t)=>({progress:100===t.progress||["B+","C+","D+"].includes(e.grade)?100:0})},"\u041f\u0430\u0434\u043e\u0432\u044b\u0439 \u043c\u0438\u0441\u0441":{icon:ce.l,description:"\u041a\u043e\u0433\u0434\u0430 \u043e\u0442 SSS \u0442\u0435\u0431\u044f \u0443\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043c\u0438\u0441\u0441\u044b \u0438\u0437-\u0437\u0430 \u043f\u043b\u043e\u0445\u043e\u0433\u043e \u043c\u043e\u0434\u0434\u0438\u043d\u0433\u0430 \u043f\u0430\u0434\u043e\u0432",resultFunction:(e,a,t)=>({progress:100===t.progress||e.miss>0&&0===e.bad&&0===e.good&&0===e.great?100:0})}},oe={progress:0};X.a.addLocale(Q.a);const me=new X.a("ru-RU"),de={flavour:"long",gradation:Z.a,units:["day","week","month"]},pe=e=>{if(e.isExactDate)return e.dateObject.toLocaleDateString();{const a=void 0===e.isMyBest&&void 0===e.isMachineBest?"\u0441 my best \u0438\u043b\u0438 machine best":e.isMyBest?"\u0441 my best":e.isMachineBest?"\u0441 machine best":"\u0445\u0437 \u043e\u0442\u043a\u0443\u0434\u0430";return n.a.createElement("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"}},n.a.createElement("div",null,"\u0442\u043e\u0447\u043d\u0430\u044f \u0434\u0430\u0442\u0430 \u0432\u0437\u044f\u0442\u0438\u044f \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430"),n.a.createElement("div",null,"\u0441\u043a\u043e\u0440 \u0431\u044b\u043b \u0437\u0430\u043f\u0438\u0441\u0430\u043d ",a),n.a.createElement("div",null,"\u0434\u0430\u0442\u0430 \u0437\u0430\u043f\u0438\u0441\u0438: ",e.dateObject.toLocaleDateString()))}},ue=e=>{const a=ee()().startOf("day").diff(ee()(e).startOf("day"),"days"),t=ee()(e).hour();return ee()().hour()<5?a<=1?"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":me.format(e,de):0===a?t<5?"\u0432\u0447\u0435\u0440\u0430 \u043d\u043e\u0447\u044c\u044e":"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":1===a?"\u0432\u0447\u0435\u0440\u0430":me.format(e,de)},he=e=>{const[a,t]=e?e.match(/(\D+)|(\d+)/g):[];return[a,t]},Ee={"?":0,F:1,D:2,"D+":3,C:4,"C+":5,B:6,"B+":7,A:8,"A+":9,S:10,SS:11,SSS:12},ge=(e,a,t,r)=>{const n="?"!==e.grade?e.grade:0===(s=e).misses&&0===s.bads&&0===s.goods?0===s.greats?"SSS":"SS":s.grade;var s;if("undefined"===typeof e.recognition_notes)return{id:e.id,isUnknownPlayer:"PUMPITUP"===a[e.player].arcade_name,isIntermediateResult:!0,sharedChartId:e.shared_chart||r,playerId:e.player,nickname:a[e.player].nickname,nicknameArcade:a[e.player].arcade_name,date:e.gained,dateObject:ae(e.gained),grade:n,isExactDate:!!e.exact_gain_date,score:e.score,scoreRaw:te(e.score,n),isRank:!!e.rank_mode};let l={isUnknownPlayer:"PUMPITUP"===a[e.player].arcade_name,isIntermediateResult:!1,sharedChartId:e.shared_chart||r,id:e.id,playerId:e.player,nickname:a[e.player].nickname,nicknameArcade:a[e.player].arcade_name,originalChartMix:e.original_mix,originalChartLabel:e.original_label,originalScore:e.original_score,date:e.gained,dateObject:ae(e.gained),grade:n,isExactDate:!!e.exact_gain_date,score:e.score,scoreRaw:te(e.score,n),scoreIncrease:e.score_increase,calories:e.calories&&e.calories/1e3,perfect:e.perfects,great:e.greats,good:e.goods,bad:e.bads,miss:e.misses,combo:e.max_combo,mods:e.mods_list,isRank:!!e.rank_mode,isHJ:(e.mods_list||"").split(" ").includes("HJ"),isMachineBest:"machine_best"===e.recognition_notes,isMyBest:"personal_best"===e.recognition_notes};((e,a)=>{if(!a)return;const t=[e.perfect,e.great,e.good,e.bad,e.miss];let r=-1,n=0,s=0;for(let l=0;l<5;++l)v.a.isNumber(t[l])?s+=t[l]:(r=l,n++);1===n&&(e[["perfect","great","good","bad","miss"][r]]=a-s)})(l,t.maxTotalSteps);const c=10*Math.sqrt(l.perfect),i=c?Math.floor((100*c+85*l.great+60*l.good+20*l.bad+-25*l.miss)/(c+l.great+l.good+l.bad+l.miss)*100)/100:null,o=l.perfect?Math.floor((100*l.perfect+85*l.great+60*l.good+20*l.bad+-25*l.miss)/(l.perfect+l.great+l.good+l.bad+l.miss)*100)/100:null;return l.accuracy=i<0?0:100===o?100:i&&+i.toFixed(2),l.accuracyRaw=v.a.toNumber(l.accuracy),l},fe=(e,a,t)=>{const r=e.playerId,n=v.a.fromPairs(Array.from({length:28}).map((e,a)=>[a+1,[]]));a[r]={name:t[r].nickname,nameArcade:t[r].arcade_name,resultsByGrade:{},resultsByLevel:n,firstResultDate:e.dateObject,lastResultDate:e.dateObject,count:0,battleCount:0,countAcc:0,grades:{F:0,D:0,C:0,B:0,A:0,S:0,SS:0,SSS:0},sumAccuracy:0,rankingHistory:[],ratingHistory:[],lastPlace:null,lastBattleDate:0,region:t[r].region},a[r].achievements=v.a.flow(v.a.keys,v.a.map(e=>[e,{...ie[e].initialState||oe}]),v.a.fromPairs)(ie),a[r].exp=0},ye=(e,a,t)=>{const r=t[e.playerId];r.count++,e.accuracy&&(r.countAcc++,r.sumAccuracy+=e.accuracy),r.grades[e.grade.replace("+","")]++,"COOP"!==a.chartType&&e.isBestGradeOnChart&&(r.resultsByGrade[e.grade]=[...r.resultsByGrade[e.grade]||[],{result:e,chart:a}],r.resultsByLevel[a.chartLevel]=[...r.resultsByLevel[a.chartLevel]||[],{result:e,chart:a}]),e.isExactDate&&r.lastResultDate<e.dateObject&&(r.lastResultDate=e.dateObject),e.isExactDate&&r.firstResultDate>e.dateObject&&(r.firstResultDate=e.dateObject),r.achievements=v.a.mapValues.convert({cap:!1})((t,n)=>ie[n].resultFunction(e,a,t,r),r.achievements),r.exp+=se(e,a)},Ne=e=>e.scoreRaw/e.accuracy*100/(e.isRank?1.2:1);function ve({fetchList:e,title:a,renderRightSide:t}){const[s,l]=Object(r.useState)([]),[c,i]=Object(r.useState)(!1),o=t||(e=>n.a.createElement("div",{className:"playcount"},n.a.createElement(D.p,null),n.a.createElement("span",null,e.countplay)));return Object(r.useEffect)(()=>{i(!0),e().then(e=>{e.success&&l(e.data),i(!1)}).catch(()=>{i(!1)})},[e]),n.a.createElement("div",{className:"top-songs-list"},n.a.createElement("div",{className:"top-songs-header"},n.a.createElement("span",null,a)),c&&n.a.createElement(F,null),!c&&s.map((e,a)=>n.a.createElement("div",{key:e.id,className:"top-songs-item"},n.a.createElement("div",{className:M()("place","top-".concat(a+1),{best:a<3})},n.a.createElement("span",null,a+1,".")),n.a.createElement("div",{className:"song-name"},e.full_name),o(e))))}const be=e=>n.a.createElement("div",{className:"date"},n.a.createElement("span",null,e.last_play?ue(ae(e.last_play)):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430"));var Se=Object(i.b)(null,{fetchMostPlayed:()=>async e=>{e({type:"MOST_PLAYED/LOADING"});try{const a=await e(j({url:"".concat(W,"/track-stats/most-played")}));return e({type:"MOST_PLAYED/SUCCESS",data:a}),a}catch(a){return e({type:V,error:a}),null}},fetchMostPlayedMonth:()=>async e=>{e({type:"MOST_PLAYED_MONTH/LOADING"});try{const a=await e(j({url:"".concat(W,"/track-stats/most-played-month")}));return e({type:"MOST_PLAYED_MONTH/SUCCESS",data:a}),a}catch(a){return e({type:"MOST_PLAYED_MONTH/ERROR",error:a}),null}},fetchLeastPlayed:()=>async e=>{e({type:"LEAST_PLAYED/LOADING"});try{const a=await e(j({url:"".concat(W,"/track-stats/most-time-not-played")}));return e({type:"LEAST_PLAYED/SUCCESS",data:a}),a}catch(a){return e({type:"LEAST_PLAYED/ERROR",error:a}),null}}})((function({fetchMostPlayed:e,fetchMostPlayedMonth:a,fetchLeastPlayed:t}){return n.a.createElement("div",{className:"songs-top-page"},n.a.createElement(ve,{fetchList:e,title:"\u0442\u043e\u043f \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0445 \u0442\u0440\u0435\u043a\u043e\u0432"}),n.a.createElement(ve,{fetchList:a,title:"\u0442\u043e\u043f \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0445 \u0442\u0440\u0435\u043a\u043e\u0432 \u0437\u0430 \u043c\u0435\u0441\u044f\u0446"}),n.a.createElement(ve,{fetchList:t,title:"\u0442\u0440\u0435\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u043e\u043b\u0433\u043e \u043d\u0435 \u0438\u0433\u0440\u0430\u043b\u0438",renderRightSide:be}),n.a.createElement("div",{className:"top-songs-list -placeholder"}))})),Oe=t(23);t(253),t(254);class Re extends n.a.PureComponent{render(){const{active:e,onToggle:a,text:t}=this.props;return n.a.createElement("div",{className:M()("toggle-button",{active:e}),onClick:()=>a(!e)},t)}}class ke extends n.a.Component{constructor(e){super(e),this.state={value:(v.a.isNil(e.value)?e.defaultValue:e.value)||""},v.a.bindAll(["handleChange","handleBlur","handleKeyPress"],this)}componentDidUpdate(e){e.value!==this.props.value&&this.setState({value:this.props.value})}handleChange(e){const a=e.target.value;this.setState({value:a},()=>this.props.onChange(a))}handleBlur(e){const{type:a}=this.props,{value:t}=this.state;if("number"===a){const a=Number(t);a>=Number(e.target.min)&&a<=Number(e.target.max)?this.props.onBlur(a,e):(this.setState({value:this.props.value}),this.props.onBlur(this.props.value,e))}}handleKeyPress(e){"Enter"===e.key&&this.handleBlur(e)}render(){const{className:e}=this.props;return n.a.createElement("input",Object.assign({},v.a.omit(["defaultValue","onChange"],this.props),{className:M()(e,"text-input"),value:this.state.value,onBlur:this.handleBlur,onKeyPress:this.handleKeyPress,onInput:this.handleChange,onChange:v.a.noop}))}}ke.defaultProps={value:null,type:"text",onChange:v.a.noop,onBlur:v.a.noop};t(255);class Pe extends n.a.Component{constructor(){super(),this.onChange=e=>{this.props.onChange(e.target.checked)},this.id=v.a.uniqueId()}render(){return n.a.createElement("div",{className:"toggle-checkbox"},n.a.createElement("input",{type:"checkbox",className:"toggle-checkbox-cb",id:this.id,onChange:this.onChange,checked:this.props.checked}),n.a.createElement("label",{htmlFor:this.id,className:"toggle"},n.a.createElement("span",null)),this.props.children&&n.a.createElement("label",{htmlFor:this.id,className:"text-label"},this.props.children))}}t(256);class Le extends r.PureComponent{constructor(e){super(),this.state={open:e.defaultOpen||!1}}render(){const{children:e,title:a,className:t}=this.props,{open:r}=this.state;return n.a.createElement("div",{className:M()("collapsible-bar",t,{open:r})},n.a.createElement("div",{className:"header",onClick:()=>this.setState(e=>({open:!e.open}))},n.a.createElement("div",{className:"collapse-button"},n.a.createElement(D.i,null)),n.a.createElement("div",{className:"title"},a)),e&&n.a.createElement("div",{className:"collapsible-children"},e))}}var _e=t(188),Ce=t(169);t(259);const Ae={preventOverflow:{enabled:!0,padding:10,boundariesElement:"viewport"}},xe={right:"left",left:"right",top:"bottom",bottom:"top"},Te=e=>e&&xe[e.split("-")[0]];class Ie extends n.a.PureComponent{constructor(){super(),this.state={isVisible:!1},this.containerItemRef=n.a.createRef(),this.renderPopper=this.renderPopper.bind(this),this.toggleOverlayVisibility=this.toggleOverlayVisibility.bind(this)}hideOverlay(){this.setState({isVisible:!1})}toggleOverlayVisibility(){this.setState({isVisible:!this.state.isVisible})}handleClickOutside(e){e&&e.target.closest(".inner-popper-overlay")||this.hideOverlay()}renderPopper({ref:e,style:a,placement:t,arrowProps:r,scheduleUpdate:s,outOfBoundaries:l}){const{children:c,hideWhenOutOfBounds:i}=this.props;return n.a.createElement("div",{ref:e,style:a,"data-placement":t,className:M()("inner-popper-overlay","arrow-".concat(Te(t)),this.props.overlayClassName,{"out-of-bounds":l&&i})},n.a.createElement("div",{className:"arrow-hider"},n.a.createElement("div",{className:"arrow",ref:r.ref,style:r.style})),n.a.createElement("div",{className:"inner-popper-content"},c))}render(){const{placement:e,overlayItem:a}=this.props,{isVisible:t}=this.state;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"overlay-item",ref:this.containerItemRef,onClick:this.toggleOverlayVisibility},a),t&&l.a.createPortal(n.a.createElement(_e.a,{container:document.body,modifiers:Ae,placement:e,referenceElement:this.containerItemRef.current},this.renderPopper),document.body))}}Ie.defaultTypes={placement:"bottom"};var De=Object(Ce.a)(Ie),we=t(107);function Me({range:e,min:a,max:t,onChange:r}){return n.a.createElement(we.Range,{values:e,step:1,min:a,max:t,onChange:r,renderTrack:({props:r,children:s})=>n.a.createElement("div",{onMouseDown:r.onMouseDown,onTouchStart:r.onTouchStart,style:{...r.style,position:"relative",height:"10px",display:"flex",width:"100%"}},n.a.createElement("div",{ref:r.ref,style:{height:"6px",width:"100%",borderRadius:"3px",background:Object(we.getTrackBackground)({values:e,colors:["#ccc","#88d3ff","#ccc"],min:a,max:t}),alignSelf:"center"}},s)),renderThumb:({props:e,isDragged:a})=>n.a.createElement("div",Object.assign({},e,{style:{...e.style,height:"12px",width:"12px",borderRadius:"6px",backgroundColor:"#FFF",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0px 2px 3px #AAA"}}),n.a.createElement("div",{style:{height:"6px",width:"6px",borderRadius:"3px",backgroundColor:a?"#88d3ff":"#CCC"}}))})}function Fe({filterValue:e,onChange:a}){const t=v.a.getOr(x,"range",e),r=v.a.getOr(null,"type",e),s=v.a.getOr(I,"duration",e),l=u();let c=l.FILTER_CHARTS;if(e){const e=r||"";c=t[0]===t[1]?"".concat(e).concat(t[0]):"".concat(e).concat(t[0]," - ").concat(e).concat(t[1]),c=l.CHARTS+": "+c,v.a.isEqual(s,I)||(c+=" ***")}const i=e=>{a({range:t,type:r,...e,duration:v.a.isEmpty(e.duration)?s:e.duration})};return n.a.createElement("div",null,n.a.createElement(De,{overlayClassName:"chart-range-overlay-outer",overlayItem:n.a.createElement("button",{className:"filter-charts-button btn btn-sm btn-dark"},c)},n.a.createElement("div",{className:"chart-range-overlay"},n.a.createElement("div",{className:"buttons"},n.a.createElement(Re,{text:"Single",active:"S"===r,onToggle:e=>{i({type:e?"S":null})}}),n.a.createElement(Re,{text:"Double",active:"D"===r,onToggle:e=>{i({type:e?"D":null})}})),n.a.createElement(Me,{range:t,min:x[0],max:x[1],onChange:e=>i({range:e})}),n.a.createElement("div",{className:"inputs"},n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>i({range:[Math.max(t[0]-1,x[0]),t[1]]})},n.a.createElement(D.f,null)),n.a.createElement(ke,{type:"number",className:"form-control",min:x[0],max:Math.min(x[1],t[1]),value:t[0],onBlur:e=>{i({range:[e,t[1]]})}}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>{const e=Math.min(t[0]+1,x[1]);i({range:[e,t[1]<e?e:t[1]]})}},n.a.createElement(D.g,null)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>{const e=Math.max(t[1]-1,x[0]);i({range:[t[0]>e?e:t[0],e]})}},n.a.createElement(D.f,null)),n.a.createElement(ke,{type:"number",className:"form-control",min:Math.max(x[0],t[0]),max:x[1],value:t[1],onBlur:e=>i({range:[t[0],e]})}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>i({range:[t[0],Math.min(t[1]+1,x[1])]})},n.a.createElement(D.g,null))),n.a.createElement("div",{className:"buttons-duration"},n.a.createElement(Re,{text:"Standard",active:s.includes(T.STD),onToggle:e=>{i({duration:e?[...s,T.STD]:v.a.without([T.STD],s)})}}),n.a.createElement(Re,{text:"Short",active:s.includes(T.SHORT),onToggle:e=>{i({duration:e?[...s,T.SHORT]:v.a.without([T.SHORT],s)})}}),n.a.createElement(Re,{text:"Remix",active:s.includes(T.REMIX),onToggle:e=>{i({duration:e?[...s,T.REMIX]:v.a.without([T.REMIX],s)})}}),n.a.createElement(Re,{text:"Full",active:s.includes(T.FULL),onToggle:e=>{i({duration:e?[...s,T.FULL]:v.a.without([T.FULL],s)})}})))))}var Be=t(41),He=t.n(Be),je=t(77),Ge=t.n(je),Ue=t(170),Ke=t.n(Ue);const We=(e,a)=>v.a.mapValues(e=>{const t=["A","A+","S","SS","SSS"];e.expRank=v.a.findLast(a=>a.threshold<=e.exp,re),e.expRankNext=v.a.find(a=>a.threshold>e.exp,re),e.progress={double:{SS:{},S:{},"A+":{},A:{}},single:{SS:{},S:{},"A+":{},A:{}}};const r={SSS:["SS","S","A+","A"],SS:["SS","S","A+","A"],S:["S","A+","A"],"A+":["A+","A"],A:["A"]};return e.accuracyPointsRaw=[],v.a.keys(e.resultsByLevel).forEach(a=>{e.resultsByLevel[a].forEach(n=>{!n.result.isRank&&n.result.accuracyRaw&&e.accuracyPointsRaw.push([v.a.toNumber(a),n.result.accuracyRaw,n.result.sharedChartId]);const s=n.result.grade,l=n.result.playerId,c=n.chart.results.filter(e=>e.playerId===l);if(c.length>1){if(c.sort((e,a)=>t.indexOf(a.grade)-t.indexOf(e.grade))[0].grade!==s)return}const i=r[s];i&&i.forEach(t=>{((a,t,r)=>{const n="S"===r||"SP"===r?e.progress.single:"D"===r||"DP"===r?e.progress.double:null;n&&(n[t][a]=n[t][a]?n[t][a]+1:1)})(a,t,n.chart.chartType)})})}),["single","double"].forEach(t=>{e.progress["".concat(t,"-bonus")]=0,v.a.keys(e.progress[t]).forEach(r=>{e.progress[t]["".concat(r,"-bonus")]=0,v.a.keys(e.progress[t][r]).forEach(n=>{const s=e.progress[t][r][n],l=(e=>Math.round(Math.min(e,1+e/20+.7*Math.sqrt(Math.max(e-1,0)))))(a.data["".concat(t,"sLevels")][n]),c=Math.min(1,s/l),i=(e=>30*(1+2**(e/4))/11)(n)*c;e.progress[t][r]["".concat(n,"-bonus")]=i,e.progress[t][r]["".concat(n,"-bonus-coef")]=c,e.progress[t][r]["".concat(n,"-min-number")]=l,e.progress[t][r]["".concat(n,"-achieved-number")]=s,i>=e.progress[t]["".concat(r,"-bonus")]&&(e.progress[t]["".concat(r,"-bonus")]=i,e.progress[t]["".concat(r,"-bonus-level")]=n,e.progress[t]["".concat(r,"-bonus-level-coef")]=c,e.progress[t]["".concat(r,"-bonus-level-min-number")]=l,e.progress[t]["".concat(r,"-bonus-level-achieved-number")]=s)}),e.progress["".concat(t,"-bonus")]+=e.progress[t]["".concat(r,"-bonus")]})}),e.progress.bonus=e.progress["double-bonus"]+e.progress["single-bonus"],e.achievementBonus=e.progress.bonus,e.accuracy=e.countAcc>0?Math.round(e.sumAccuracy/e.countAcc*100)/100:null,e},e),Ve=({profiles:e,sharedCharts:a,tracklist:t,battles:r,debug:n})=>{const s=(({profiles:e,sharedCharts:a})=>{const t={};for(const r in a){const n=a[r],s=n.results,l=Number(n.interpolatedDifficulty||n.chartLevel)**2.2/7.6;if(n.maxScore){const a=n.maxScore;for(const r of s)if(!r.isRank&&a){const s=Math.max(0,Math.min(1,r.scoreRaw/a-.3)/.7),c=s*l;t[r.id]={pp:{pp:c,k:s,maxScore:a,maxPP:l,ppPotential:l-c,ppRatio:c/l,ppFixed:Number(c.toFixed(1))}};const i=e[r.playerId];i&&(i.pp||(i.pp={scores:[],pp:0}),i.pp.scores.push({pp_:Number(c.toFixed(1)),s:n.song,l:n.chartLabel,pp:c,result:r,chart:n,K:s}))}}}for(const r in e){const a=e[r];a.pp?(a.pp.scores.sort((e,a)=>a.pp-e.pp),a.pp.pp=0,a.pp.scores.forEach((e,t)=>{a.pp.pp+=.95**t*e.pp}),a.rating=a.pp.pp):(a.pp={},a.rating=0)}return v.a.flow(v.a.values,v.a.orderBy(e=>e.rating,"desc"),e=>e.forEach((e,a)=>{e.ratingHistory.push({rating:e.rating,date:e.firstResultDate.getTime()}),e.rankingHistory.push({place:a+1,date:e.firstResultDate.getTime()})}))(e),t})({profiles:e=We(e,t),sharedCharts:a=(({sharedCharts:e,profiles:a,debug:t})=>v.a.mapValues(e=>{const r=e.results.map(r=>{const n=a[r.playerId];if(!n||!r.accuracy||r.isRank||v.a.size(n.accuracyPointsRaw)<50)return null;if(!n.accuracyPointsInterpolated){const e=v.a.maxBy(([e,a])=>a,n.accuracyPointsRaw)[1],a=v.a.maxBy(([e,a])=>e,v.a.filter(([a,t])=>t===e,n.accuracyPointsRaw))[0],t=n.accuracyPointsRaw.filter(([e,t])=>e>=a-1).map(([e,a])=>[30-e,101-a]),r=Ke.a.logarithmic(t),s=e=>{const a=101-r.predict(30-e)[1];return Math.max(0,Math.min(a,100))},l=[];for(let n=1;n<=28;n+=.05)l.push([n,s(n)]);n.accuracyPointsInterpolated=l}const s=v.a.find(e=>e[1]<r.accuracyRaw,n.accuracyPointsInterpolated),l={interpolatedDifficulty:s&&s[0],weight:r.accuracyRaw>98?1-(r.accuracyRaw-98)/2:r.accuracyRaw<80?Math.max(0,(r.accuracyRaw-50)/30):1};return l.weight*=Math.min(1,Math.max(.1,(8-Math.abs(l.interpolatedDifficulty-e.chartLevel))/8)),t&&(r.interpolation=l),l}).filter(v.a.identity).reduce((e,a)=>a.interpolatedDifficulty?{diffSum:e.diffSum+a.interpolatedDifficulty*a.weight,weightSum:e.weightSum+a.weight}:e,{diffSum:0,weightSum:0});r.diffSum+=2*v.a.toNumber(e.chartLevel),r.weightSum+=2;const n=r.diffSum/r.weightSum;return{...e,interpolatedDifficulty:n}},e))({debug:n,sharedCharts:a,profiles:e})}),{logText:l}=(({battles:e,profiles:a,debug:t,resultInfo:r})=>{let n="";const s={},l=(e,a)=>"".concat(e.playerId,"vs").concat(a.playerId,"-").concat(e.sharedChartId,"-").concat(e.isRank),c={},i=e=>"".concat(e.playerId,"-").concat(e.sharedChartId,"-").concat(e.isRank);return e.forEach(([e,o,m])=>{const d=a[e.playerId],p=a[o.playerId],u=e.isRank?1.2:1;let h=null;m.maxScore&&(h=m.maxScore*u,Math.max(h,e.score,o.score)===h||e.isRank||e.isExactDate&&o.isExactDate||(h*=1.2),Math.max(h,e.score,o.score)!==h&&(h=Math.max(h,e.score,o.score)+1e4)),r[e.id]||(r[e.id]={}),r[o.id]||(r[o.id]={});const E=r[e.id],g=r[o.id];E.startingRating||(E.startingRating=d.rating),g.startingRating||(g.startingRating=p.rating),d.battleCount++,p.battleCount++;const f=d.rating,y=p.rating,N=10**(f/400),b=10**(y/400),S=N/(N+b),O=b/(N+b);let R,k,P=e.score,L=o.score;P===L?R=k=.5:h&&0!==P&&0!==L?(P=h/P-1,L=h/L-1,R=5*(L/(P+L)-.5)+.5,k=5*(P/(P+L)-.5)+.5):(R=P>L?1:L<P?0:.5,k=1-R),R=Math.max(0,Math.min(1,R)),k=Math.max(0,Math.min(1,k));const _=Math.max(0,Math.min(1,(f-700)/800)),C=Math.max(0,Math.min(1,(y-700)/800)),A=20+20*_,x=20+20*C,T=Number(m.interpolatedDifficulty||m.chartLevel),I=Math.max(1,Math.min(A,(T/25)**(5*(_-.5)+2.5)*A)),D=Math.max(1,Math.min(x,(T/25)**(5*(C-.5)+2.5)*x)),w=Math.min(I,D);let M=1;m.maxScore&&(e.grade.startsWith("SS")||0===e.miss&&0===e.bad)&&(o.grade.startsWith("SS")||0===o.miss&&0===o.bad)&&e.score/h>.98&&o.score/h>.98&&(M=Math.max(Math.min(1,Math.max(100-100*e.score/h,100-100*o.score/h)/2),0)**2);const F=w*M,B=w*M;let H=F*(R-S),j=B*(k-O);H=H<0&&"SSS"===e.grade?0:H,j=j<0&&"SSS"===o.grade?0:j;const G=l(e,o),U=l(o,e),K=s[G]||0,W=s[U]||0;s[G]=H,s[U]=j,d.rating=d.rating+H-K,p.rating=p.rating+j-W;const V=i(e),Y=i(o);c[V]=(c[V]||0)+H-K,c[Y]=(c[Y]||0)+j-W,E.ratingDiff=c[V],E.ratingDiffLast=H-K,g.ratingDiff=c[Y],g.ratingDiffLast=j-W,t&&(n+="".concat(m.chartLabel," - ").concat(m.song," (").concat(m.sharedChartId,") - ").concat(a[e.playerId].name," / ").concat(a[o.playerId].name,"\n- ").concat(e.score," / ").concat(o.score," (").concat(Math.floor(h)," (").concat(Math.floor(m.maxScore*u),")) - R ").concat(R.toFixed(2),"/").concat(k.toFixed(2)," E ").concat(S.toFixed(2)," / ").concat(O.toFixed(2),"\n- Rating ").concat(f.toFixed(2)," / ").concat(y.toFixed(2)," - ").concat(H.toFixed(2)," / ").concat(j.toFixed(2)," - K ").concat(F.toFixed(2)," ").concat(B.toFixed(2)).concat(1===M?"":" (coef ".concat(M.toFixed(2),")"),"\n- Base elo: ").concat(K.toFixed(2)," / ").concat(W.toFixed(2),"\n- Elo change: ").concat((H-K).toFixed(2)," / ").concat((j-W).toFixed(2),"\n- New base elo: ").concat(s[G].toFixed(2)," / ").concat(s[U].toFixed(2),"\n- RD: ").concat(c[V].toFixed(2)," / ").concat(c[Y].toFixed(2),"\n")),d.rating=Math.max(100,d.rating),p.rating=Math.max(100,p.rating);const q=v.a.flow(v.a.keys,v.a.map(e=>({id:e,rating:a[e].rating})),v.a.orderBy(["rating"],["desc"]))(a),z=e.dateObject>o.dateObject?e.dateObject:o.dateObject;q.forEach((e,t)=>{a[e.id].lastPlace!==t+1&&(a[e.id].rankingHistory.push({place:t+1,date:z.getTime()}),a[e.id].lastPlace=t+1)});const X=v.a.last(d.ratingHistory),J=v.a.last(p.ratingHistory);X!==d.rating&&d.ratingHistory.push({rating:d.rating,date:z.getTime()}),J!==p.rating&&p.ratingHistory.push({rating:p.rating,date:z.getTime()})}),v.a.flow(v.a.keys,v.a.forEach(e=>{a[e].id=v.a.toInteger(e),a[e].accuracy=a[e].countAcc>0?Math.round(a[e].sumAccuracy/a[e].countAcc*100)/100:null,a[e].ratingRaw=a[e].rating,a[e].rating=Math.round(a[e].rating),a[e].rankingHistory=[...a[e].rankingHistory,{place:v.a.get("place",v.a.last(a[e].rankingHistory)),date:Date.now()}]}))(a),{logText:n}})({battles:r,profiles:e,resultInfo:s,debug:n});return{profiles:e,resultInfo:s,sharedCharts:a,logText:l}};let Ye=localStorage&&localStorage.getItem("debug");localStorage&&(window.debugOn=()=>{localStorage.setItem("debug",1),Ye=1},window.debugOff=()=>{localStorage.removeItem("debug"),Ye=0});const qe=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET?"results/highscores/trusted":"results/highscores",ze={rank:L},Xe={isLoading:!1,isLoadingRanking:!1,data:[],filter:ze,players:{},profiles:{},results:[],resultInfo:{},sharedCharts:{}};const Je=()=>async(e,a)=>{e({type:"TOP/LOADING"});try{const a=await e(j({url:"".concat(W,"/").concat(qe)}));if(a.error)throw new Error(a.error);e(Qe(a))}catch(t){console.log(t),e({type:"TOP/ERROR",error:t})}},Qe=e=>async(a,t)=>{const{tracklist:r}=t(),{sharedCharts:n,mappedResults:s,profiles:l,battles:c}=((e,a)=>{const{players:t,results:r,shared_charts:n}=e,s=[],l=e=>"".concat(e.sharedChartId,"-").concat(e.playerId,"-").concat(e.isRank),c=e=>"".concat(e.sharedChartId,"-").concat(e.playerId),i={},o={},m={},d=[];let p={};for(let u of r){if(!t[u.player])continue;const e=u.shared_chart;if(!m[e]){const a=n[e],t=v.a.toUpper(a.chart_label),[r,s]=he(t);m[e]={song:a.track_name,chartLabel:t,chartLevel:s,chartType:r,duration:a.duration,sharedChartId:e,maxTotalSteps:a.max_total_steps,results:[],allResultsIds:[]}}const a=m[e],r=ge(u,t,a);s.push(r);const p=l(r),h=i[p];if(!h||h.score<r.score){if(h){const e=a.results.indexOf(h);-1!==e&&a.results.splice(e,1)}const e=v.a.sortedLastIndexBy(e=>-e.score,r,a.results);r.isUnknownPlayer&&0!==e||(a.results.splice(e,0,r),a.latestScoreDate=r.date,a.allResultsIds.push(r.playerId),i[p]=r),r.isUnknownPlayer||a.results.forEach(e=>{!e.isUnknownPlayer&&e.isRank===r.isRank&&e.playerId!==r.playerId&&r.score&&e.score&&d.push([r,e,a])})}if(!r.isIntermediateResult){const e=c(r),a=o[e];(!a||Ee[a.grade]<=Ee[r.grade])&&(a&&(a.isBestGradeOnChart=!1),r.isBestGradeOnChart=!0,o[e]=r)}}for(let u in m){const e=m[u];e.maxScore=null;for(let a of e.results){if(!a.isRank)if(a.accuracy){const t=Ne(a);e.maxScore<t&&(e.maxScore=t)}else e.maxScore&&e.maxScore<a.score&&(e.maxScore=a.score);a.isUnknownPlayer||a.isIntermediateResult||(p[a.playerId]||fe(a,p,t),ye(a,e,p))}}return{mappedResults:s,profiles:p,sharedCharts:m,battles:d}})(e);a({type:"TOP/SUCCESS",data:v.a.values(n),players:v.a.flow(v.a.toPairs,v.a.map(([e,a])=>({...a,id:v.a.toInteger(e)})))(e.players),results:s,profiles:l,sharedCharts:n,originalData:e});const i={sharedCharts:n,profiles:l,tracklist:r,battles:c,debug:Ye};let o;if(window.Worker){const e=new Ge.a;o=await e.getProcessedProfiles(i),e.terminate()}else o=Ve(i);Ye&&console.log(o.logText),Ye&&console.log("Processed profiles:",Object.values(o.profiles).filter(e=>e.pp).sort((e,a)=>a.pp.pp-e.pp.pp)),a({type:"TOP/PROFILES_UPDATE",...o}),a(aa(o.profiles))},Ze=e=>({type:"TOP/SET_FILTER",filter:e}),$e=v.a.map("id"),ea=v.a.flow(v.a.map(e=>[e.id,e.rating]),v.a.fromPairs),aa=e=>async(a,t)=>{try{const t=v.a.orderBy("ratingRaw","desc",v.a.values(e)),[r,n,s]=await Promise.all([g.a.getItem("lastChangedRanking_v3"),g.a.getItem("lastChangedRankingPoints_v3"),g.a.getItem("lastFetchedRanking_v3")]),l=$e(t),c=$e(s),i=$e(r),o=ea(t),m=ea(s);let d=ea(n);v.a.isEqual(o,m)||(g.a.setItem("lastChangedRankingPoints_v3",s),d=m);let p=i;v.a.isEqual(l,c)||(g.a.setItem("lastChangedRanking_v3",s),p=c),a({type:"TOP/RANKING_CHANGE_SET",listNow:l,listPrev:p,rankingsPointsMap:d}),g.a.setItem("lastFetchedRanking_v3",t)}catch(r){console.warn("Cannot get ranking from local storage",r)}},ta={presets:[],currentPreset:null,isLoading:!1},ra=e=>e&&{...e,label:e.name,value:e.name};const na=e=>({type:"PRESETS/LOAD_PRESETS",presets:e||[]}),sa=e=>({type:"PRESETS/SELECT_PRESET",currentPreset:e}),la=()=>(e,a)=>{e({type:"PRESETS/LOADING_START"});const t=a().presets.currentPreset,r=v.a.get("name",t);return g.a.getItem("filterPresets").then(a=>{r&&v.a.find({name:r},a)?(e(sa(t)),e(Ze(t.filter))):e(na(a)),e({type:"PRESETS/LOADING_END"})})},ca={loadPresets:()=>(e,a)=>(e({type:"PRESETS/LOADING_START"}),g.a.getItem("filterPresets").then(a=>{e(na(a)),e({type:"PRESETS/LOADING_END"})})),savePreset:e=>(a,t)=>(a({type:"PRESETS/LOADING_START"}),g.a.getItem("filterPresets").then(r=>{const{filter:n}=t().top,s={name:e,filter:n};if(v.a.some({name:e},r)){if(window.confirm("Preset with this name already exists, replace it?")){const t=[...v.a.remove({name:e},r),s];a(na(t)),g.a.setItem("filterPresets",t)}}else{const e=[...r||[],s];a(na(e)),a(sa(s)),g.a.setItem("filterPresets",e)}a({type:"PRESETS/LOADING_END"})})),openPreset:la,deletePreset:()=>(e,a)=>{e({type:"PRESETS/LOADING_START"});const t=v.a.get("name",a().presets.currentPreset);return g.a.getItem("filterPresets").then(a=>{if(v.a.find({name:t},a)&&window.confirm("Are you sure you want to delete selected preset?")){const r=v.a.remove({name:t},a);e(na(r)),g.a.setItem("filterPresets",r)}else e(na(a));e({type:"PRESETS/LOADING_END"})})},selectPreset:sa};class ia extends n.a.Component{constructor(...e){super(...e),this.state={},this.onChangeSelection=e=>{this.props.selectPreset(e.name)},this.onRewritePreset=()=>{const{currentPreset:e}=this.props;this.props.savePreset(e.name)},this.onSavePreset=()=>{const{name:e}=this.state;this.props.savePreset(e),this.setState({isAddingNew:!1})}}componentDidMount(){this.props.loadPresets()}render(){const{presets:e,currentPreset:a,isLoading:t}=this.props,{name:r,isAddingNew:s}=this.state,l=this.context;return n.a.createElement("div",null,n.a.createElement(De,{overlayItem:n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},n.a.createElement(D.o,null),l.PRESETS)},n.a.createElement("div",{className:"presets-control-overlay"},n.a.createElement(Oe.a,{className:"select _margin-bottom",classNamePrefix:"select",placeholder:l.PRESETS_PLACEHOLDER,options:e,value:a,onChange:this.props.selectPreset,noOptionsMessage:()=>l.EMPTY}),a&&n.a.createElement("div",{className:"buttons-presets _margin-bottom"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.props.openPreset,disabled:t},n.a.createElement(D.k,null)," ",l.OPEN),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.onRewritePreset,disabled:t},n.a.createElement(D.t,null)," ",l.OVERWRITE),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon",onClick:this.props.deletePreset,disabled:t},n.a.createElement(D.w,null)," ",l.DELETE)),!s&&n.a.createElement("div",{className:"buttons-presets _margin-bottom"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left _self-align-end",onClick:()=>this.setState({isAddingNew:!0}),disabled:t},n.a.createElement(D.q,null)," ",l.ADD)),s&&n.a.createElement("div",{className:"adding-new _margin-bottom"},n.a.createElement(ke,{value:r,placeholder:l.PRESET_NAME_PLACEHOLDER,className:"form-control",onChange:e=>this.setState({name:e})}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:this.onSavePreset,disabled:!r||t},n.a.createElement(D.t,null)," ",l.SAVE),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:()=>this.setState({isAddingNew:!1}),disabled:t},l.CANCEL)))))}}ia.contextType=p;var oa=Object(i.b)(e=>({...e.presets}),ca)(ia),ma=t(79),da=t(42),pa=t.n(da),ua=t(78),ha=t.n(ua);var Ea=({region:e})=>n.a.createElement("div",{className:"flag-img",style:{backgroundImage:"url(https://osu.ppy.sh/images/flags/".concat(e,".png)")}});var ga=({grade:e})=>e&&"?"!==e?n.a.createElement("img",{src:"".concat(".","/grades/").concat(e,".png"),alt:e}):null;X.a.addLocale(Q.a);const fa=new X.a("ru-RU"),ya={flavour:"short",gradation:Z.a,units:["day","week","month"]},Na=e=>{const a=ee()().startOf("day").diff(ee()(e).startOf("day"),"days");return 0===a?"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":1===a?"\u0432\u0447\u0435\u0440\u0430":fa.format(e,ya).replace("\u043d\u0430\u0437\u0430\u0434","")},va=e=>({...e,results:v.a.flow(v.a.get("results"),v.a.toPairs,v.a.map(([a,t])=>{const r=v.a.find(e=>v.a.every(v.a.isNumber,[e.perfects,e.greats,e.goods,e.bads,e.misses]),t.results),n=r&&[r.perfects,r.greats,r.goods,r.bads,r.misses].reduce((e,a)=>e+a,0),[s,l]=he(t.chart_label);return{song:t.track,sharedChartId:v.a.toNumber(a),chartLabel:t.chart_label,chartLevel:l,chartType:s,mix:t.mix,duration:t.duration,results:t.results.map((a,t)=>{let r={};if(n){const e=[a.perfects,a.greats,a.goods,a.bads,a.misses];let t=-1,s=0;1===e.filter((e,a)=>v.a.isNumber(e)?(s+=e,!1):(t=a,!0)).length&&(r[["perfect","great","good","bad","miss"][t]]=n-s)}return{id:a.id,playerId:a.player,nickname:e.players[a.player].nickname,nicknameArcade:e.players[a.player].arcade_name,originalChartMix:a.originalChartMix,originalChartLabel:a.originalChartLabel,originalScore:a.originalScore,date:a.gained,dateObject:new Date(a.gained),grade:a.grade,isExactDate:!!a.exact_gain_date,score:a.score,scoreIncrease:a.score_increase,calories:a.calories&&a.calories/1e3,perfect:a.perfects,great:a.greats,good:a.goods,bad:a.bads,miss:a.misses,combo:a.max_combo,mods:a.mods_list,isRank:!!a.rank_mode,isHJ:(a.mods_list||"").split(" ").includes("HJ"),...r}})}}),v.a.map(e=>({...e,latestScoreDate:e.results.reduce((e,a)=>a.date>e?a.date:e,e.results[0].date),results:e.results.map(a=>{const t=Math.sqrt(a.perfect)*v.a.toInteger(e.chartLevel)/2,r=t?Math.floor((100*t+60*a.great+30*a.good+-20*a.miss)/(t+a.great+a.good+a.bad+a.miss)*100)/100:null,n=a.perfect?Math.floor((100*a.perfect+60*a.great+30*a.good+-20*a.miss)/(a.perfect+a.great+a.good+a.bad+a.miss)*100)/100:null;return{...a,accuracy:r<0?0:100===n?100:r&&+r.toFixed(2),accuracyRaw:n,hasRankScore:v.a.some({playerId:a.playerId,isRank:!0},e.results)}})})),v.a.orderBy(["latestScoreDate","song","chartLevel"],["desc","asc","desc"]))(e)}),ba=(e,a,t=v.a.noop,n)=>{const[s,l]=Object(r.useState)(e),[c,i]=Object(r.useState)(e),o=Object(r.useRef)(a);Object(r.useEffect)(()=>{o.current!==a?(o.current=a,l(e),i(e)):e&&!v.a.isEqual(e,c)&&(l(c),i(e),t(c,e))},[e,t,c,s,a]);const m=Object(r.useCallback)(()=>{l(e),i(e)},[e]);return Object(r.useMemo)(()=>[c,s,m],[c,s,m])},Sa=e=>Object(r.useCallback)(()=>{v.a.values(e).forEach(e=>e[2]())},[e]),Oa=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"];var Ra=Object(i.b)(e=>({resultInfo:e.results.resultInfo,profiles:e.results.profiles}),null,null,{forwardRef:!0})(n.a.forwardRef(({res:e,chart:a,resultInfo:t,profiles:r,placeDifference:s,showProtagonistEloChange:l=!1,showProtagonistPpChange:i=!1,protagonistName:o=null,uniqueSelectedNames:m=[],leftProfile:d={},rightProfile:p={},isSocketView:h=!1},E)=>{const g=t[e.id]||{},f=u();let y=null;Ye?y=n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"debug-elo-info"}," ",g.startingRating&&Math.round(g.startingRating)," / ",g.ratingDiff>0?"+":"",g.ratingDiff&&Math.round(g.ratingDiff)," / ",g.pp&&g.pp.ppFixed,"pp")):e.nickname===o&&(l||i)&&(y=n.a.createElement(n.a.Fragment,null," / ",l&&g.ratingDiff&&n.a.createElement("span",null,"".concat(g.ratingDiff>0?"+":"").concat(Math.round(g.ratingDiff))),i&&g.pp&&n.a.createElement("span",null,g.pp.ppFixed,"pp")));const N=r[e.playerId]?n.a.createElement(Ea,{region:r[e.playerId].region}):null,b=m.indexOf(e.nickname);return n.a.createElement("tr",{key:e.id,ref:E,className:M()({empty:!e.accuracy,latest:new Date(a.latestScoreDate)-new Date(e.date)<432e5,left:e.nickname===d.name,right:e.nickname===p.name}),style:b>-1?{background:Oa[b]+"3A",outline:"1px solid ".concat(Oa[b],"A0")}:{}},!h&&n.a.createElement("td",{className:"place"},e.isSecondOccurenceInResults?"":"#".concat(e.topPlace)),n.a.createElement("td",{className:"nickname",style:b>-1?{fontWeight:"bold"}:{}},n.a.createElement("div",{className:"nickname-container"},N,n.a.createElement("span",{className:"nickname-text"},n.a.createElement(c.c,{exact:!0,to:k.getPath({id:e.playerId})},e.nickname),!!s&&n.a.createElement("span",{className:"change-holder up"},n.a.createElement("span",null,s),n.a.createElement(D.b,null)),y),!h&&n.a.createElement("div",{className:"mods-container"},h&&e.mods&&e.mods.split(" ").filter(e=>e.includes("AV")).map(e=>n.a.createElement("div",{className:"mod av-mod"},n.a.createElement("div",{className:"av-text"},"AV"),n.a.createElement("div",{className:"av-number"},e.replace("AV","")))),h&&e.mods&&e.mods.split(" ").filter(e=>e.endsWith("X")).map(e=>n.a.createElement("div",{className:"mod x-mod"},n.a.createElement("div",{className:"x-number"},e))),e.isRank&&n.a.createElement("div",{className:"mod vj"},e.mods?"R":"R?"),e.isHJ&&n.a.createElement("div",{className:"mod hj"},"HJ")))),n.a.createElement("td",{className:"score"},n.a.createElement(De,{overlayClassName:"score-overlay-outer",overlayItem:n.a.createElement("span",{className:"score-span"},e.scoreIncrease>.8*e.score&&"*",pa()(e.score).format("0,0")),placement:"top"},n.a.createElement("div",{className:"score-overlay"},Ye&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"result id: "),e.id),n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"player id: "),e.playerId)),n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},f.PLAYER,": "),n.a.createElement(c.c,{exact:!0,to:k.getPath({id:e.playerId})},e.nickname," (",e.nicknameArcade,")")),!!se(e,a)&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},f.EXP,": "),"+",pa()(se(e,a)).format("0,0")),v.a.isNumber(g.startingRating)&&v.a.isNumber(g.ratingDiff)&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},f.ELO,": ",g.startingRating.toFixed(0)," "),g.ratingDiff>=0?"+".concat(g.ratingDiff.toFixed(0)):g.ratingDiff.toFixed(0)),g.pp&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},f.PP,": "),n.a.createElement("span",null,g.pp.ppFixed,"pp")),!e.isExactDate&&n.a.createElement("div",{className:"warning"},n.a.createElement(D.j,null),f.MY_BEST_SCORE_WARNING),!!e.isExactDate&&n.a.createElement(n.a.Fragment,null,!!e.mods&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},f.MODS,": "),e.mods),!!e.calories&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},f.CCAL,": "),e.calories),!!e.scoreIncrease&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},f.SCORE_INCREASE,": "),"+",pa()(e.scoreIncrease).format("0,0")),e.originalChartMix&&n.a.createElement("div",null,n.a.createElement("div",{className:"warning"},n.a.createElement(D.j,null),f.ORIGINAL_MIX," ",e.originalChartMix),e.originalChartLabel&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},f.ORIGINAL_CHART," "),e.originalChartLabel),e.originalScore&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},f.ORIGINAL_SCORE," "),e.originalScore)),e.scoreIncrease>.8*e.score&&f.SIGHTREAD)))),n.a.createElement("td",{className:"grade"},n.a.createElement("div",{className:"img-holder"},n.a.createElement(ga,{grade:e.grade}))),h&&n.a.createElement("td",{className:M()("mods",{vj:e.isRank,hj:e.isHJ})},n.a.createElement("div",{className:"mods-container"},h&&e.mods&&e.mods.split(" ").filter(e=>e.includes("AV")).map(e=>n.a.createElement("div",{className:"av-mod"},n.a.createElement("div",{className:"av-text"},"AV"),n.a.createElement("div",{className:"av-number"},e.replace("AV","")))),h&&e.mods&&e.mods.split(" ").filter(e=>e.endsWith("X")).map(e=>n.a.createElement("div",{className:"x-mod"},n.a.createElement("div",{className:"x-number"},e))),e.isRank&&n.a.createElement("div",{className:"inner"},e.isExactDate?"R":"R?"),e.isHJ&&n.a.createElement("div",{className:"inner"},"HJ"))),n.a.createElement("td",{className:"number miss"},e.miss),n.a.createElement("td",{className:"number bad"},e.bad),n.a.createElement("td",{className:"number good"},e.good),n.a.createElement("td",{className:"number great"},e.great),n.a.createElement("td",{className:"number perfect"},e.perfect),n.a.createElement("td",{className:"combo"},e.combo,e.combo?"x":""),n.a.createElement("td",{className:"accuracy"},100===e.accuracy?100:e.accuracy?e.accuracy.toFixed(2):"",e.accuracy?"%":""),n.a.createElement("td",{className:M()("date",{latest:e.date===a.latestScoreDate})},h?Na(e.dateObject):n.a.createElement(ha.a,{content:pe(e),tooltipClassName:"pumpking-tooltip"},Na(e.dateObject),e.isExactDate?"":"?")))})),ka=({type:e,level:a})=>n.a.createElement("div",{className:M()("chart-name",{single:"S"===e,singlep:"SP"===e,doublep:"DP"===e,double:"D"===e,coop:"COOP"===e})},n.a.createElement("span",{className:"chart-letter"},e),n.a.createElement("span",{className:"chart-number"},a));const Pa=n.a.forwardRef(({playersHiddenStatus:e={},sharedCharts:a={},chart:t,showHiddenPlayers:s=!1,showProtagonistEloChange:l=!1,showProtagonistPpChange:i=!1,uniqueSelectedNames:o=[],protagonistName:m=null,leftProfile:d={},rightProfile:p={},isSocketView:h=!1},E)=>{const[g,f]=Object(r.useState)(null),[y,N]=Object(r.useState)(!s),S=u();Object(r.useEffect)(()=>{N(!s)},[s]);const O=v.a.first(g)||t;Ye&&console.log(O,g);let R=1;const k=[];let P=0;const L=O.results.map((a,t)=>{const r=y&&(e[a.playerId]||!1),n=k.includes(a.nickname);return k.push(a.nickname),0===t?R=1:n||a.score===v.a.get([t-1,"score"],O.results)||(R+=1),r&&P++,{...a,topPlace:R,isSecondOccurenceInResults:n,isPlayerHidden:r}}),_=v.a.throttle(260,e=>{const a=v.a.drop(1,g);f(1===v.a.size(a)?null:a)}),C=v.a.throttle(260,e=>{v.a.isEmpty(L)&&f(null);const t=v.a.maxBy("date",L);if(!t)return;const r=t.playerId,n=a[e.sharedChartId].previousResults,s=v.a.findLast(e=>e.playerId===r&&e.isRank===t.isRank&&e.date<t.date,n),l=v.a.orderBy("score","desc",v.a.compact(v.a.map(e=>e.id===t.id?s:e,L))),c=v.a.maxBy("date",l),i={...e,latestScoreDate:c&&c.date,results:l};v.a.isEmpty(l)?f(null):f([i,...g||[e]])}),A=!v.a.isEmpty(g),x=v.a.countBy(a=>!e[a],O.eachResultPlayerIds).true,T=A?1+x-v.a.size(g):x,I=!(1===T&&1===x),w=O.interpolatedDifficulty||v.a.get("interpolatedDifficulty",a[O.sharedChartId]);return n.a.createElement("div",{className:"song-block",ref:E},n.a.createElement("div",{className:"song-name"},n.a.createElement(ka,{type:O.chartType,level:O.chartLevel}),h?n.a.createElement("div",{className:"song-name-text"},w?"(".concat(w.toFixed(1),") "):"",O.song):n.a.createElement("div",{className:"song-name-text"},n.a.createElement(c.c,{exact:!0,to:b.sharedChart.getPath({sharedChartId:O.sharedChartId})},O.song)," ",n.a.createElement("span",{className:"_grey-text"},"(",w&&w.toFixed(1),")")),!h&&n.a.createElement("div",{className:"youtube-link"},n.a.createElement("a",{href:"https://youtube.com/results?".concat(He.a.stringify({search_query:"".concat(O.song," ").concat(O.chartLabel).replace(/( -)|(- )/g," ")})),target:"_blank",rel:"noopener noreferrer"},n.a.createElement(D.x,null))),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"right-side-block"},P>0&&n.a.createElement("div",{className:M()("players-hidden-count _grey-text",{"_on-hover":!h})},S.HIDDEN,": ",P),(P>0||!y)&&!h&&n.a.createElement("div",{className:"globe-icon _on-hover",onClick:()=>N(!y)},n.a.createElement(D.m,null)),!h&&n.a.createElement("div",{className:M()("undo-result-button _on-hover",{active:A})},n.a.createElement(D.d,{className:M()("backward-btn",{disabled:!I}),onClick:()=>I&&C(O)}),n.a.createElement("span",{className:"number"},T,"/",x),n.a.createElement(D.l,{className:M()("forward-btn",{disabled:!A}),onClick:()=>A&&_(O)})))),n.a.createElement("div",{className:"charts"},!v.a.isEmpty(L)&&n.a.createElement("div",{className:"chart"},n.a.createElement("div",{className:"results"},n.a.createElement("table",null,n.a.createElement(ma.a,{enterAnimation:"fade",leaveAnimation:"fade",typeName:"tbody",maintainContainerHeight:!0,duration:250},L.map((e,a)=>{const t=e.nickname===m;if(e.isPlayerHidden&&!t||e.isUnknownPlayer&&0!==a)return null;let r,s;if(e.scoreIncrease&&e.date===O.latestScoreDate){const t=e.score-e.scoreIncrease;s=v.a.findLastIndex(e=>e.score>t,L),r=s-a}return n.a.createElement(Ra,{key:e.isRank+"_"+e.nickname,chart:O,results:L,res:e,placeDifference:r,showProtagonistEloChange:l,showProtagonistPpChange:i,uniqueSelectedNames:o,protagonistName:m,leftProfile:d,rightProfile:p,isSocketView:h})})))))))});var La=Object(i.b)((e,a)=>({sharedCharts:e.results.sharedCharts,playersHiddenStatus:a.playersHiddenStatus||e.preferences.data.playersHiddenStatus}),null,null,{forwardRef:!0})(Pa);const _a=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET?"results/best/trusted":"results/best",Ca={isLoading:!1,data:null,lastUpdatedOn:null};const Aa=(e,a)=>({type:"SET_CHARTS",data:e,lastUpdatedOn:a}),xa=()=>async(e,a)=>{e({type:"CHARTS_LOADING"}),a().charts.data||(performance.mark("cache_start"),await e(async(e,a)=>{const t=await g.a.getItem("resultsCache");t&&(console.log("Found cached data from",t.lastUpdatedOn),e(Aa(t.data,t.lastUpdatedOn)))}),performance.measure("time spent on getting cached data","cache_start"));const{data:t,lastUpdatedOn:r}=a().charts,n=r?"?"+He.a.stringify({since:r}):"",s="".concat(W,"/").concat(_a).concat(n);performance.measure("time from page open to requesting /results/best"),performance.mark("request_start");const{charts:l,lastUpdatedAt:c}=await e(j({url:s}));performance.measure("time spent on requesting /results/best","request_start");const i={...t||{},...l};await e(((e,a)=>(t,r)=>{g.a.setItem("resultsCache",{data:e,lastUpdatedOn:a}),t(Aa(e,a))})(i,c));const o=a().players.data;performance.mark("process_start");const{profiles:m,sharedCharts:d,battles:p}=((e,a)=>{const t=e=>"".concat(e.sharedChartId,"-").concat(e.playerId,"-").concat(e.isRank),r=e=>"".concat(e.sharedChartId,"-").concat(e.playerId),n={},s=[],l=[];let c={};for(let i in e){const s=e[i],o=s.chart,m=v.a.toUpper(o.chart_label),[d,p]=he(m);n[i]={song:o.track_name,chartLabel:m,chartLevel:p,chartType:d,duration:o.duration,sharedChartId:i,maxTotalSteps:o.max_total_steps,results:[],previousResults:[],eachResultPlayerIds:[],latestScoreDate:v.a.last(s.results).gained,maxScore:null};const u={},h={};v.a.forEachRight(e=>{if(!a[e.player])return;const s=n[i],o=ge(e,a,s,i),m=t(o),d=r(o),p=v.a.sortedLastIndexBy(e=>e.dateObject,o,l);if(l.splice(p,0,o),s.eachResultPlayerIds.push(o.id),(!h[d]||Ee[h[d].grade]<Ee[o.grade])&&(h[d]&&(h[d].isBestGradeOnChart=!1),o.isBestGradeOnChart=!0,h[d]=o),u[m])o.isIntermediateResult=!0,s.previousResults.push(o);else{const e=v.a.sortedIndexBy(e=>-e.score,o,s.results);if(s.results.splice(e,0,o),u[m]=o,!o.isRank)if(o.accuracy){const e=Ne(o);s.maxScore<e&&(s.maxScore=e)}else s.maxScore&&s.maxScore<o.score&&(s.maxScore=o.score);o.isUnknownPlayer||o.isIntermediateResult||(c[o.playerId]||fe(o,c,a),ye(o,s,c))}},e[i].results)}return l.forEach(e=>{if(!e.isUnknownPlayer){const a=n[e.sharedChartId];for(let t=0;t<a.results.length;t++){const r=a.results[t];if(e.dateObject<r.dateObject)break;!r.isUnknownPlayer&&r.isRank===e.isRank&&r.playerId!==e.playerId&&e.score&&r.score&&s.push([e,r,a])}}}),{profiles:c,sharedCharts:n,battles:s}})(i,o);performance.measure("time spent building charts with results","process_start"),performance.mark("display_start"),e({type:"TOP/SUCCESS",data:v.a.values(d),players:v.a.flow(v.a.toPairs,v.a.map(([e,a])=>({...a,id:v.a.toInteger(e)})))(o),profiles:m,sharedCharts:d}),e({type:"CHARTS_LOADING_FINISH"}),performance.measure("time spent rendering charts","display_start"),performance.measure("time from page open to displaying first data");const{tracklist:u}=a(),h={sharedCharts:d,profiles:m,tracklist:u,battles:p,debug:Ye};let E;if(performance.mark("elo_calc_start"),window.Worker){const e=new Ge.a;E=await e.getProcessedProfiles(h),e.terminate()}else E=Ve(h);performance.measure("time spent calculating elo/pp and graphs for profiles","elo_calc_start"),Ye&&console.log(E.logText),Ye&&console.log("Processed profiles:",Object.values(E.profiles).filter(e=>e.pp).sort((e,a)=>a.pp.pp-e.pp.pp)),performance.mark("display2_start"),e({type:"TOP/PROFILES_UPDATE",...E}),e(aa(E.profiles)),performance.measure("time spent rendering update with elo/pp","display2_start"),performance.measure("time from page open to displaying everything"),console.log(performance.getEntriesByType("measure").map(e=>"".concat(e.name,": ").concat(e.duration," ms")).join("\n")),performance.clearMarks(),performance.clearMeasures()};var Ta=t(24),Ia=t(171);const Da=Object(Ta.a)(e=>e.results.players,e=>e.user.data.player.id,(e,a)=>v.a.flow(v.a.toPairs,v.a.map(([,{nickname:e,arcade_name:t,id:r,region:n}])=>({label:"".concat(e," (").concat(t,")"),value:e,isCurrentPlayer:a===r})),v.a.sortBy(e=>e.isCurrentPlayer?"!":v.a.toLower(e.label)))(e)),wa=Object(Ta.a)(e=>e.results.data,e=>e.results.sharedCharts,e=>e.results.filter,e=>e.results.resultInfo,e=>e.preferences.data,(e,a,t=ze,r={},n)=>{const s=performance.now(),l=n.playersHiddenStatus,c=t.showHiddenFromPreferences,i=v.a.map("value",t.players),o=v.a.map("value",t.playersOr),m=v.a.map("value",t.playersNot),d=v.a.get("value",t.sortingType),p=v.a.get("value",t.rank)||L,u=[P.PROTAGONIST,P.RANK_ASC,P.RANK_DESC,P.PP_ASC,P.PP_DESC,P.NEW_SCORES_PLAYER].includes(d)?v.a.get("value",t.protagonist):null,h=v.a.map("value",t.excludeAntagonists),E=[v.a.orderBy([e=>v.a.max(v.a.map(e=>c||!l[e.playerId]?e.dateObject.getTime():0,e.results))],["desc"])],g=u?[v.a.orderBy([e=>v.a.max(v.a.map(e=>e.nickname===u?e.dateObject.getTime():0,e.results))],["desc"])]:E,f=[v.a.filter(e=>v.a.map("nickname",e.results).includes(u)),v.a.map(e=>{const a=v.a.findIndex({nickname:u},e.results),t=e.results[a].score,r=v.a.flow([v.a.take(a),v.a.uniqBy("nickname"),v.a.remove(e=>h.includes(e.nickname)||e.score===t)])(e.results),n=Math.sqrt(v.a.reduce((e,a)=>e+(a.score/t-.99)**2,0,r));return{...e,distanceFromProtagonist:n}}),v.a.orderBy(["distanceFromProtagonist"],["desc"])],y=(e,a="desc")=>[v.a.filter(e=>v.a.map("nickname",e.results).includes(u)),v.a.orderBy([t=>{const n=v.a.find({nickname:u},t.results),s=r[n.id]||{};return v.a.getOr("desc"===a?-1/0:1/0,e,s)}],[a])],N=e=>[v.a.filter(e=>v.a.map("nickname",e.results).includes(u)),v.a.orderBy([a=>{const t=v.a.find({nickname:u},a.results),n=r[t.id];return v.a.getOr("asc"===e?1/0:-1/0,"ratingDiff",n)}],[e])],b=(e="desc")=>[v.a.orderBy([e=>{const t=a[e.sharedChartId];return v.a.getOr(v.a.toNumber(e.chartLevel),"interpolatedDifficulty",t)}],[e])],S={[P.DEFAULT]:E,[P.NEW_SCORES_PLAYER]:g,[P.PROTAGONIST]:f,[P.RANK_ASC]:N("asc"),[P.RANK_DESC]:N("desc"),[P.PP_ASC]:y("pp.ppRatio","asc"),[P.PP_DESC]:y("pp.pp"),[P.EASIEST_SONGS]:b("asc"),[P.HARDEST_SONGS]:b("desc")}[d]||E,O=v.a.flow(v.a.compact([v.a.map(e=>{let a=null;const t=[],r=e.results.filter((e,r)=>{const n=!p||p===L||(p===C?e.isRank:p===A?!e.isRank:p!==_||!t.includes(e.playerId));p===_&&t.push(e.playerId);const s=(!e.isUnknownPlayer||0===r)&&n;return s&&(!a||a<e.date)&&(a=e.date),s},e.results);return{...e,latestScoreDate:a,results:r}}),t.chartRange&&(e=>((e,a)=>{const t=v.a.getOr(x,"range",e),r=v.a.getOr(null,"type",e),n=v.a.getOr(I,"duration",e);return v.a.filter(e=>!(n!==I&&!n.includes(e.duration))&&(e.chartLevel>=t[0]&&e.chartLevel<=t[1]&&(!r||e.chartType.startsWith(r))),a)})(t.chartRange,e)),(i.length||o.length||m.length)&&v.a.filter(e=>{const a=v.a.map("nickname",e.results);return(!i.length||v.a.every(e=>a.includes(e),i))&&(!o.length||v.a.some(e=>a.includes(e),o))&&(!m.length||!v.a.some(e=>a.includes(e),m))}),v.a.filter(e=>v.a.size(e.results)),...S,t.song&&(e=>Object(Ia.a)(e,t.song.trim(),{keys:["song"]}))]))(e);return console.log("Sorting took",performance.now()-s,"ms"),O}),Ma=Object(Ta.a)(e=>e.results.data,(e,a)=>a.match.params.sharedChartId,(e,a)=>e.filter(e=>e.sharedChartId==a)),Fa=v.a.memoize(e=>[{label:e.NEW_TO_OLD_SCORES,value:P.DEFAULT},{label:e.NEW_TO_OLD_SCORES_OF_A_PLAYER,value:P.NEW_SCORES_PLAYER},{label:e.WORST_TO_BEST_BY_ELO,value:P.RANK_ASC},{label:e.BEST_TO_WORST_BY_ELO,value:P.RANK_DESC},{label:e.WORST_TO_BEST_BY_PP,value:P.PP_ASC},{label:e.BEST_TO_WORST_BY_PP,value:P.PP_DESC},{label:e.EASY_TO_HARD_CHARTS,value:P.EASIEST_SONGS},{label:e.HARD_TO_EASY_CHARTS,value:P.HARDEST_SONGS}]),Ba=v.a.memoize(e=>[{label:e.SHOW_ALL_SCORES,value:L},{label:e.BEST_SCORE,value:_},{label:e.RANK_ONLY,value:C},{label:e.ONLY_NO_RANK,value:A}]),Ha={fetchChartsData:xa,setFilter:Ze,resetFilter:()=>({type:"TOP/RESET_FILTER"}),selectPreset:sa,openPreset:la};class ja extends r.Component{constructor(...e){super(...e),this.state={showItemsCount:20},this.setFilter=v.a.curry((e,a)=>{const t={...this.props.filter,[e]:a};this.props.setFilter(t),g.a.setItem("filter",t)}),this.resetFilter=()=>{this.props.resetFilter(),g.a.setItem("filter",ze)},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()},this.onTypeSongName=v.a.debounce(300,e=>{this.setFilter("song",e)})}renderSimpleSearch(){const{isLoading:e,filter:a}=this.props;return n.a.createElement(p.Consumer,null,t=>n.a.createElement("div",{className:"simple-search"},n.a.createElement("div",{className:"song-name _margin-right _margin-bottom"},n.a.createElement(ke,{value:a.song||"",placeholder:t.SONG_NAME_PLACEHOLDER,className:"form-control",onChange:this.onTypeSongName})),n.a.createElement("div",{className:"chart-range _margin-right _margin-bottom"},n.a.createElement(Fe,{filterValue:a.chartRange,onChange:this.setFilter("chartRange")})),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"_flex-row _margin-bottom"},n.a.createElement(oa,null),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.resetFilter},n.a.createElement(D.s,null)," ",t.RESET_FILTERS),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(D.u,null)," ",t.REFRESH))))}renderFilters(){const{players:e,filter:a}=this.props;return n.a.createElement(p.Consumer,null,t=>n.a.createElement("div",{className:"filters"},n.a.createElement("div",{className:"people-filters"},n.a.createElement("label",{className:"label"},t.SHOW_CHARTS_PLAYED_BY),n.a.createElement("div",{className:"players-block"},n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},t.EACH_OF_THESE),n.a.createElement(Oe.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:t.PLAYERS_PLACEHOLDER,isMulti:!0,options:e,value:v.a.getOr(null,"players",a),onChange:this.setFilter("players")})),n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},t.AND_ANY_OF_THESE),n.a.createElement(Oe.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:t.PLAYERS_PLACEHOLDER,isMulti:!0,options:e,value:v.a.getOr(null,"playersOr",a),onChange:this.setFilter("playersOr")})),n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},t.AND_NONE_OF_THESE),n.a.createElement(Oe.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:t.PLAYERS_PLACEHOLDER,isMulti:!0,options:e,value:v.a.getOr(null,"playersNot",a),onChange:this.setFilter("playersNot")})))),n.a.createElement("div",{className:"people-filters"},n.a.createElement("div",{className:"players-block"},n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},t.SHOW_RANK),n.a.createElement(Oe.a,{closeMenuOnSelect:!1,className:"select",classNamePrefix:"select",placeholder:"...",options:Ba(t),value:v.a.getOr(null,"rank",a)||L,onChange:this.setFilter("rank")})))),n.a.createElement("div",null,n.a.createElement(Pe,{checked:v.a.getOr(!1,"showHiddenFromPreferences",a),onChange:this.setFilter("showHiddenFromPreferences")},t.SHOW_HIDDEN_PLAYERS))))}renderSortings(){const{players:e,filter:a}=this.props;return n.a.createElement(p.Consumer,null,t=>n.a.createElement("div",{className:"sortings"},n.a.createElement("div",null,n.a.createElement("label",{className:"label"},t.SORTING_LABEL),n.a.createElement(Oe.a,{placeholder:t.SORTING_PLACEHOLDER,className:"select",classNamePrefix:"select",isClearable:!1,options:Fa(t),value:v.a.getOr(Fa(t)[0],"sortingType",a),onChange:this.setFilter("sortingType")})),[P.PROTAGONIST,P.RANK_ASC,P.RANK_DESC,P.PP_ASC,P.PP_DESC,P.NEW_SCORES_PLAYER].includes(v.a.get("sortingType.value",a))&&n.a.createElement("div",null,n.a.createElement("label",{className:"label"},t.PLAYER_LABEL),n.a.createElement(Oe.a,{className:M()("select players",{"red-border":!v.a.get("protagonist",a)}),classNamePrefix:"select",placeholder:t.PLAYERS_PLACEHOLDER,options:e,value:v.a.getOr(null,"protagonist",a),onChange:this.setFilter("protagonist")})),[P.PROTAGONIST].includes(v.a.get("sortingType.value",a))&&n.a.createElement("div",null,n.a.createElement("label",{className:"label"},t.EXCLUDE_FROM_COMPARISON),n.a.createElement(Oe.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:t.PLAYERS_PLACEHOLDER,options:e,isMulti:!0,value:v.a.getOr([],"excludeAntagonists",a),onChange:this.setFilter("excludeAntagonists")}))))}render(){const{isLoading:e,isChartView:a,filteredData:t,error:r,filter:s,presets:l,history:c}=this.props,{showItemsCount:i}=this.state,o=t.length>i,m=v.a.slice(0,i,t),d=v.a.get("sortingType.value",s),u=[P.RANK_ASC,P.RANK_DESC].includes(d),h=[P.PP_ASC,P.PP_DESC].includes(d),E=[P.PROTAGONIST,P.RANK_ASC,P.RANK_DESC,P.PP_ASC,P.PP_DESC,P.NEW_SCORES_PLAYER].includes(d),g=v.a.get("protagonist.value",s),f=v.a.slice(0,Oa.length,v.a.uniq(v.a.compact([E&&g,...v.a.map("value",s.players),...v.a.map("value",s.playersOr)])));return n.a.createElement(p.Consumer,null,i=>n.a.createElement("div",{className:"leaderboard-page"},n.a.createElement("div",{className:"content"},a&&n.a.createElement("div",{className:"simple-search"},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon",onClick:()=>c.goBack()},n.a.createElement(D.c,null)," ",i.BACK_BUTTON)),!a&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"search-block"},this.renderSimpleSearch(),n.a.createElement(Le,{title:i.FILTERS},this.renderFilters()),n.a.createElement(Le,{title:i.SORTING},this.renderSortings())),!!l.length&&n.a.createElement("div",{className:"presets-buttons"},n.a.createElement("span",null,i.PRESETS,":"),l.map(e=>n.a.createElement(Re,{key:e.name,text:e.name,className:"btn btn-sm btn-dark _margin-right",active:v.a.get("filter",e)===s,onToggle:()=>{this.props.selectPreset(e),this.props.openPreset()}})))),n.a.createElement("div",{className:"top-list"},e&&n.a.createElement(F,null),v.a.isEmpty(t)&&!e&&(r?r.message:i.NO_RESULTS),!e&&m.map((e,t)=>n.a.createElement(La,{showHiddenPlayers:a||s.showHiddenFromPreferences,key:e.sharedChartId,chart:e,chartIndex:t,showProtagonistEloChange:u,showProtagonistPpChange:h,uniqueSelectedNames:f,protagonistName:g})),!e&&o&&n.a.createElement("button",{className:"btn btn-sm btn-primary",onClick:()=>this.setState(e=>({showItemsCount:e.showItemsCount+10}))},i.SHOW_MORE)))))}}var Ga=Object(i.b)((e,a)=>{const t=!!a.match.params.sharedChartId;return{isChartView:t,players:Da(e),filteredData:t?Ma(e,a):wa(e),filter:t?ze:e.results.filter,error:e.charts.error||e.tracklist.error,isLoading:e.charts.isLoading||e.tracklist.isLoading,presets:e.presets.presets}},Ha)(ja);t(266);function Ua({ranking:e,isLoading:a,preferences:t,updatePreferences:r}){return n.a.createElement("div",{className:"ranking-list"},v.a.isEmpty(e)&&!a&&"\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",a&&n.a.createElement(F,null),!a&&n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{className:"place"}),n.a.createElement("th",{className:"change"}),n.a.createElement("th",{className:"exp-rank"},"rank"),n.a.createElement("th",{className:"name"},"name"),n.a.createElement("th",{className:"name name-piu"},"piu name"),n.a.createElement("th",{className:"rating"},"elo"),n.a.createElement("th",{className:"rating-change-cell"}),n.a.createElement("th",{className:"rating"},"pp"),n.a.createElement("th",{className:"grades sss"},n.a.createElement(ga,{grade:"SSS"})),n.a.createElement("th",{className:"grades ss"},n.a.createElement(ga,{grade:"SS"})),n.a.createElement("th",{className:"grades s"},n.a.createElement(ga,{grade:"S"})),n.a.createElement("th",{className:"grades a"},n.a.createElement(ga,{grade:"A+"})),n.a.createElement("th",{className:"grades b"},n.a.createElement(ga,{grade:"B"})),n.a.createElement("th",{className:"grades c"},n.a.createElement(ga,{grade:"C"})),n.a.createElement("th",{className:"grades d"},n.a.createElement(ga,{grade:"D"})),n.a.createElement("th",{className:"grades f"},n.a.createElement(ga,{grade:"F"})),n.a.createElement("th",{className:"playcount"},"scores"),n.a.createElement("th",{className:"accuracy"},"accuracy"),n.a.createElement("th",{className:"hide-col"}," "))),n.a.createElement("tbody",null,e.map((e,a)=>{const s=t.playersHiddenStatus[e.id];return s&&!t.showHiddenPlayersInRanking?null:n.a.createElement("tr",{className:M()("player",{"hidden-player":s}),key:e.name},n.a.createElement("td",{className:"place"},0===a?n.a.createElement(ce.e,null):"#".concat(a+1)),n.a.createElement("td",{className:"change"},e.change>0&&n.a.createElement("div",{className:"change-holder up"},n.a.createElement("span",null,e.change),n.a.createElement(D.b,null)),e.change<0&&n.a.createElement("div",{className:"change-holder down"},n.a.createElement("span",null,-e.change),n.a.createElement(D.a,null)),!!e.change&&v.a.isString(e.change)&&n.a.createElement("div",{className:"change-holder text"},n.a.createElement("span",null,e.change))),n.a.createElement("td",{className:"exp-rank"},le(e.expRank)),n.a.createElement("td",{className:"name"},n.a.createElement("div",{className:"name-container"},n.a.createElement(Ea,{region:e.region}),n.a.createElement(c.c,{exact:!0,to:k.getPath({id:e.id})},e.name))),n.a.createElement("td",{className:"name name-piu"},n.a.createElement(c.c,{exact:!0,to:k.getPath({id:e.id})},e.nameArcade)),n.a.createElement("td",{className:"rating"},e.rating),n.a.createElement("td",{className:"rating-change-cell"},!!e.prevRating&&e.prevRating!==e.rating&&n.a.createElement("span",{className:M()("rating-change",{down:e.prevRating>e.rating,up:e.prevRating<e.rating})},e.prevRating<e.rating?"+":"",e.rating-e.prevRating)),n.a.createElement("td",{className:"rating secondary"},Math.round(e.pp.pp)),n.a.createElement("td",{className:"grades sss"},e.grades.SSS),n.a.createElement("td",{className:"grades ss"},e.grades.SS),n.a.createElement("td",{className:"grades s"},e.grades.S),n.a.createElement("td",{className:"grades a"},e.grades.A),n.a.createElement("td",{className:"grades b"},e.grades.B),n.a.createElement("td",{className:"grades c"},e.grades.C),n.a.createElement("td",{className:"grades d"},e.grades.D),n.a.createElement("td",{className:"grades f"},e.grades.F),n.a.createElement("td",{className:"playcount"},e.count),n.a.createElement("td",{className:"accuracy"},e.accuracy?"".concat(e.accuracy.toFixed(2),"%"):""),n.a.createElement("td",{className:"hide-col"},n.a.createElement(Pe,{onChange:()=>{r(v.a.set(["playersHiddenStatus",e.id],!s,t))},checked:!s})))}))))}function Ka(){return n.a.createElement("div",{className:"faq"},n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0440\u0435\u0439\u0442\u0438\u043d\u0433?"),n.a.createElement("div",{className:"answer"},"A: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f ",n.a.createElement("a",{href:"https://en.wikipedia.org/wiki/Elo_rating_system"},"\u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u042d\u043b\u043e"),", \u0448\u0438\u0440\u043e\u043a\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0439 \u0432 \u0448\u0430\u0445\u043c\u0430\u0442\u0430\u0445 \u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0438\u0433\u0440\u0430\u0445, \u0441\u043b\u0435\u0433\u043a\u0430 \u043c\u043e\u0434\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u043e\u0434 \u0443\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0433\u0440\u044b \u043d\u0430 \u043f\u0430\u043c\u043f\u0435. \u0421\u0440\u0435\u0434\u043d\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 - 1000. \u041a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442 \u041a \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u0443\u0440\u043e\u0432\u043d\u044f \u0447\u0430\u0440\u0442\u0430 (\u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0435 \u0447\u0430\u0440\u0442\u044b \u0441\u0438\u043b\u044c\u043d\u0435\u0435 \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0440\u0435\u0439\u0442\u0438\u043d\u0433). \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0447\u043a\u043e\u0432 \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u0437\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 (\u043c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0439 \u043e\u0442\u0440\u044b\u0432 \u043e\u0442 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u0438\u043a\u0430 \u043d\u0435 \u0434\u0430\u0441\u0442 \u0442\u0430\u043a \u043c\u043d\u043e\u0433\u043e \u043e\u0447\u043a\u043e\u0432 \u043a\u0430\u043a \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u043e\u0442\u0440\u044b\u0432).")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u0440\u0440 \u0438 \u0447\u0435\u043c \u043e\u043d\u043e \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u043e\u0442 \u044d\u043b\u043e?"),n.a.createElement("div",{className:"answer"},"A: \u0420\u0420 (performance points) - \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043e\u0447\u043a\u043e\u0432, \u0432\u0437\u044f\u0442\u0430\u044f \u0438\u0437 osu!. \u042d\u043b\u043e - \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0430, \u0432\u0437\u044f\u0442\u0430\u044f \u0438\u0437 \u0448\u0430\u0445\u043c\u0430\u0442. \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043e\u0442\u043b\u0438\u0447\u0438\u044f:",n.a.createElement("br",null),"\u0421 \u044d\u043b\u043e \u0442\u0432\u043e\u0438 \u043e\u0447\u043a\u0438 \u0437\u0430\u0432\u0438\u0441\u044f\u0442 \u043e\u0442 \u0434\u0440\u0443\u0433\u0438\u0445 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u043d\u0430 \u044d\u0442\u043e\u043c \u0447\u0430\u0440\u0442\u0435, \u0441 \u0440\u0440 \u0442\u0432\u043e\u0438 \u043e\u0447\u043a\u0438 \u0437\u0430\u0432\u0438\u0441\u044f\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0442\u044b \u0441\u044b\u0433\u0440\u0430\u0435\u0448\u044c \u0447\u0430\u0440\u0442.",n.a.createElement("br",null),"\u0421 \u044d\u043b\u043e \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u0442\u0435\u0440\u044f\u0442\u044c \u043e\u0447\u043a\u0438 \u0438\u043b\u0438 \u0437\u0430\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430 \u0438\u0445 \u043f\u043e\u0442\u0435\u0440\u044f\u0442\u044c, \u0441 \u0440\u0440 \u043c\u043e\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430\u0431\u0438\u0440\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u0447\u043a\u043e\u0432.",n.a.createElement("br",null),"\u0421 \u044d\u043b\u043e \u043d\u0430\u043c\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0449\u0435 \u043a\u043e\u0433\u043e-\u0442\u043e \u043e\u0431\u043e\u0433\u043d\u0430\u0442\u044c, \u0441 \u0440\u0440 \u043b\u044e\u0434\u0438 \u0440\u0435\u0434\u043a\u043e \u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f \u043c\u0435\u0441\u0442\u0430\u043c\u0438 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435.",n.a.createElement("br",null),"\u042d\u043b\u043e \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u0442\u043e \u043a\u043e\u0433\u043e \u043e\u0431\u044b\u0433\u0440\u044b\u0432\u0430\u0435\u0442 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0432\u0440\u0435\u043c\u044f, \u0430 \u0440\u0440 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u043a\u0442\u043e \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u043d\u043e \u0443\u0440\u043e\u0432\u043d\u0435 \u043f\u043e \u0441\u043a\u0438\u043b\u043b\u0443.",n.a.createElement("br",null),"\u0421\u0435\u0439\u0447\u0430\u0441 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043f\u043e \u042d\u043b\u043e. \u0420\u0420 \u0432\u044b\u0441\u0442\u0443\u043f\u0430\u0435\u0442 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0438\u043d\u0444\u044b \u0434\u043b\u044f \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0430, \u043f\u043b\u044e\u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u042d\u043b\u043e.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u042d\u043b\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0438\u0433\u0440 1 \u043d\u0430 1, \u043a\u0430\u043a \u043e\u043d\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043d\u0430 \u043f\u0430\u043c\u043f\u0435, \u0433\u0434\u0435 \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0447\u0430\u0440\u0442\u0435 \u0438\u0433\u0440\u0430\u0435\u0442 \u043c\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u043e\u0432?"),n.a.createElement("div",{className:"answer"},"A: \u0420\u0435\u043a\u043e\u0440\u0434\u044b \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0447\u0430\u0440\u0442\u0435 \u0434\u0435\u043b\u044f\u0442\u0441\u044f \u043d\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0438\u0433\u0440 1 \u043d\u0430 1. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c 3 \u0438\u0433\u0440\u043e\u043a\u0430: A, B, C; \u0442\u043e \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u0431\u044b\u043b\u043e 3 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0438\u0433\u0440\u044b: A vs B, A vs C, B vs C.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u0443\u043c\u043c\u0430 \u0440\u0440?"),n.a.createElement("div",{className:"answer"},"A: \u0421\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u0441\u0435 \u0441\u043a\u043e\u0440\u044b \u0438\u0433\u0440\u043e\u043a\u0430 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u043f\u043e \u0440\u0440. \u0417\u0430\u0442\u0435\u043c \u0432 \u043e\u0431\u0449\u0443\u044e \u0441\u0443\u043c\u043c\u0443 \u0440\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f 100% \u043e\u0442 \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u0441\u043a\u043e\u0440\u0430, 95% \u043e\u0442 \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u0441\u043a\u043e\u0440\u0430, 90% \u043e\u0442 \u0442\u0440\u0435\u0442\u044c\u0435\u0433\u043e, 86% \u043e\u0442 4-\u0433\u043e \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435. (\u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u043a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442\u0430 - 0.95^N). \u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u043d\u0430 \u043e\u0431\u0449\u0443\u044e \u0441\u0443\u043c\u043c\u0443 \u0440\u0440 \u0431\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0432\u043b\u0438\u044f\u044e\u0442 \u0441\u0430\u043c\u044b\u0435 \u043b\u0443\u0447\u0448\u0438\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u0430 \u0437\u0430 \u0432\u0441\u0451 \u0432\u0440\u0435\u043c\u044f, \u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0434\u043d\u044f\u0442\u044c \u0441\u0432\u043e\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0440, \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0435 \u0442\u043e\u043f\u043e\u0432\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b (\u0438 \u043f\u043e\u0434\u043d\u0438\u043c\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0441\u043a\u0438\u043b\u043b).")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043b\u0438 \u0440\u0435\u043a\u043e\u0440\u0434\u044b \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0414\u0430. \u041a\u0430\u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u043c\u043d\u043e\u0433\u043e \u0440\u0435\u043a\u043e\u0440\u0434\u043e\u0432, \u0432\u0437\u044f\u0442\u044b\u0445 \u0441 \u043c\u0430\u0448\u0438\u043d \u0431\u0435\u0441\u0442\u043e\u0432, \u0438 \u043c\u044b \u043d\u0435 \u0437\u043d\u0430\u0435\u043c \u043d\u0430\u0432\u0435\u0440\u043d\u044f\u043a\u0430, \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u043e\u043d\u0438 \u0438\u043b\u0438 \u043d\u0435\u0442. \u0415\u0441\u043b\u0438 \u0443 \u0438\u0433\u0440\u043e\u043a\u0430 \u0432 \u0442\u043e\u043f\u0435 \u0435\u0441\u0442\u044c \u0434\u0432\u0430 \u0441\u043a\u043e\u0440\u0430 - \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u0438 \u0431\u0435\u0437 \u0440\u0430\u043d\u043a\u0430, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u0442, \u0433\u0434\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u0447\u043a\u043e\u0432.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041f\u043e\u0447\u0435\u043c\u0443 \u043c\u0435\u043d\u044f \u043d\u0435\u0442 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0412 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043f\u043e\u043f\u0430\u0434\u0430\u044e\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u0435, \u0443 \u043a\u043e\u0433\u043e \u0435\u0441\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b 20 \u0438\u0433\u0440 1 \u043d\u0430 1. \u041f\u0435\u0440\u0432\u044b\u0435 20 \u0438\u0433\u0440 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0438\u0437\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0430.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041f\u043e\u0447\u0435\u043c\u0443 \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0446\u0435\u043d\u043e\u043a S-A-B \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 \u043e\u0431\u0449\u0438\u043c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e\u043c \u0441\u043a\u043e\u0440\u043e\u0432?"),n.a.createElement("div",{className:"answer"},"A: \u041d\u0435 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430 \u043e\u0446\u0435\u043d\u043a\u0430.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0415\u0441\u043b\u0438 \u0443 \u043c\u0435\u043d\u044f \u0435\u0441\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u043a\u043e\u0440\u0434\u043e\u0432 \u043d\u0430 \u0410, \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0410+, \u043a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0433\u0440\u0435\u0439\u0434\u043e\u0432 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0412 \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u043e\u043b\u043e\u043d\u043a\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043e\u0431\u0435 \u0431\u0443\u043a\u0432\u044b - \u0438 \u0442\u0440\u0435\u0441\u043d\u0443\u0442\u044b\u0435, \u0438 \u0441 \u0443\u0434\u0435\u0440\u0436\u0430\u043d\u043d\u044b\u043c \u043b\u0430\u0439\u0444\u043e\u043c. \u0422\u043e \u0435\u0441\u0442\u044c \u0438 \u0410, \u0438 \u0410+ \u0438\u0434\u0443\u0442 \u0432 \u043a\u043e\u043b\u043e\u043d\u043a\u0443 \u0410. \u0422\u043e\u0447\u043d\u043e \u0442\u0430\u043a \u0436\u0435 \u0434\u043b\u044f B, C, D.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0423\u0431\u0435\u0440\u0438 \u0430\u043a\u043a\u0443\u0440\u0430\u0441\u0438 \u0438\u0437 \u0442\u0430\u0431\u043b\u0438\u0446\u044b!"),n.a.createElement("div",{className:"answer"},"A: \u0413\u0440\u0435\u043c, \u044d\u0442\u043e \u0441\u0435\u043a\u0446\u0438\u044f \u0434\u043b\u044f \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432.")))}const Wa={playersHiddenStatus:{}},Va={isLoading:!1,data:Wa,error:null};const Ya=Object(Ta.a)(e=>e.results.profiles,v.a.flow(v.a.values,v.a.orderBy(["ratingRaw"],["desc"]))),qa={fetchChartsData:xa,updatePreferences:e=>async a=>{a({type:"PREFERENCES/CHANGE",data:e});try{await a(G({url:"".concat(W,"/profile/preferences"),body:{preferences:e}}))}catch(t){return null}}};class za extends r.Component{constructor(...e){super(...e),this.onChangeHidingPlayers=()=>{const{preferences:e,updatePreferences:a}=this.props;a(v.a.set(["showHiddenPlayersInRanking"],!e.showHiddenPlayersInRanking,e))},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()}}render(){const{isLoading:e,ranking:a,error:t,preferences:r,updatePreferences:s}=this.props;return n.a.createElement("div",{className:"ranking-page"},n.a.createElement("div",{className:"content"},t&&t.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement(h.b,{exact:!0,path:O.path,render:()=>n.a.createElement(n.a.Fragment,null,n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.onChangeHidingPlayers},r.showHiddenPlayersInRanking?"\u0441\u043a\u0440\u044b\u0442\u044c \u043d\u0435\u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0445":"\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435\u0445"),n.a.createElement(c.b,{to:O.faq.path},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},n.a.createElement(D.r,null)," faq")),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(D.u,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c"))}),n.a.createElement(h.b,{exact:!0,path:O.faq.path,render:()=>n.a.createElement(c.b,{to:O.path},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon"},"\u043d\u0430\u0437\u0430\u0434"))})),n.a.createElement(h.b,{exact:!0,path:O.path,render:()=>n.a.createElement(Ua,{ranking:a,isLoading:e,preferences:r,updatePreferences:s})}),n.a.createElement(h.b,{exact:!0,path:O.faq.path,component:Ka})))}}za.defaultProps={ranking:[]};var Xa=Object(i.b)(e=>({preferences:e.preferences.data,ranking:Ya(e),error:e.charts.error||e.tracklist.error,isLoading:e.charts.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}),qa)(Object(h.g)(za)),Ja=t(3),Qa=(t(415),t(184)),Za=(t(416),Object(i.b)(e=>({charts:e.results.sharedCharts}),{fetchJson:j})(({playerId:e,charts:a,fetchJson:t})=>{const[s,l]=Object(r.useState)(!1),[i,o]=Object(r.useState)(10),[m,d]=Object(r.useState)([]),p=u();return Object(r.useEffect)(()=>{l(!0),t({url:"".concat(W,"/player/").concat(e,"/mostPlayed?limit=").concat(i)}).then(e=>{l(!1),e.success&&d(e.data)}).catch(()=>{l(!1)})},[e,i,t]),n.a.createElement("div",{className:"most-played"},s&&n.a.createElement(F,null),m.map(e=>{const t=a[e.shared_chart];return n.a.createElement("div",{className:"chart",key:e.shared_chart},n.a.createElement("div",{className:M()("chart-name",{single:"S"===t.chartType,singlep:"SP"===t.chartType,doublep:"DP"===t.chartType,double:"D"===t.chartType,coop:"COOP"===t.chartType})},n.a.createElement("span",{className:"chart-letter"},t.chartType),n.a.createElement("span",{className:"chart-number"},t.chartLevel)),n.a.createElement("div",{className:"song-name"},n.a.createElement(c.c,{exact:!0,to:b.sharedChart.getPath({sharedChartId:t.sharedChartId})},t.song)),n.a.createElement("div",{className:"date"},e.latestDate?ue(ae(e.latestDate)):null),n.a.createElement("div",{className:"playcount"},n.a.createElement(D.p,null),n.a.createElement("span",null,e.count)))}),i===v.a.size(m)&&n.a.createElement("button",{className:"show-more btn btn-sm btn-dark btn-icon",onClick:()=>o(i+10)},n.a.createElement(Qa.a,null)," ",p.SHOW_MORE))}));function $a(){return n.a.createElement("div",{className:"faq-exp"},n.a.createElement("div",{className:"faq-header"},n.a.createElement("strong",null,"\u041e\u043f\u044b\u0442")," \u0438\u0433\u0440\u043e\u043a\u0430 \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0435 \u0441\u044b\u0433\u0440\u0430\u043d\u043d\u044b\u0445 \u043f\u0435\u0441\u0435\u043d \u0438 \u0447\u0430\u0440\u0442\u043e\u0432.",n.a.createElement("br",null),"\u0427\u0435\u043c \u0432\u044b\u0448\u0435 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0447\u0430\u0440\u0442\u0430 \u0438 \u0447\u0435\u043c \u043b\u0443\u0447\u0448\u0435 \u043e\u0446\u0435\u043d\u043a\u0430 \u043d\u0430 \u0447\u0430\u0440\u0442\u0435, \u0442\u0435\u043c \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u044b\u0442\u0430 \u043e\u043d \u0434\u0430\u0451\u0442.",n.a.createElement("br",null),"\u041f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0438 \u043d\u0430 \u0442\u0435\u0445 \u0436\u0435 \u0447\u0430\u0440\u0442\u0430\u0445 \u043d\u0435 \u0434\u0430\u044e\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u044b\u0442\u0430. \u0427\u0442\u043e\u0431\u044b \u043f\u043e\u0434\u043d\u0438\u043c\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c, \u0438\u0433\u0440\u0430\u0439 \u043d\u043e\u0432\u044b\u0435 \u0442\u0440\u0435\u043a\u0438 \u0438 \u0447\u0430\u0440\u0442\u044b."),n.a.createElement("div",{className:"faq-header"},"\u0421\u043f\u0438\u0441\u043e\u043a \u0443\u0440\u043e\u0432\u043d\u0435\u0439 \u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0439 \u043e\u043f\u044b\u0442 \u0434\u043b\u044f \u0438\u0445 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f:"),n.a.createElement("div",{className:"ranks-list"},re.map(e=>n.a.createElement("div",{key:e.threshold,className:"rank"},n.a.createElement("div",{className:"exp-rank"},le(e)),n.a.createElement("div",{className:"threshold"},e.threshold)))))}const et={},at={isLoading:!1,filter:et};const tt=e=>({type:"PROFILES/SET_FILTER",filter:e}),rt=()=>({type:"PROFILES/RESET_FILTER"}),nt=(e,a)=>{const t=v.a.findIndex(e=>e.date>a[0],e),r=v.a.findLastIndex(e=>e.date<a[1],e);let n=t>0?e[t-1]:0===t?e[t]:v.a.last(e),s=r>-1?e[r]:v.a.first(e);n={...n,date:a[0]},s={...s,date:a[1]};return[n,...t>-1&&r>-1?e.slice(t,r+1):[],s]},st={SSS:0,SS:0,S:0,"A+":0,A:0,B:0,C:0,D:0,F:0},lt=v.a.flow(v.a.flatMap(e=>v.a.flow(v.a.toPairs,v.a.map(([a,t])=>["".concat(e,"-").concat(a),t]))(st)),v.a.fromPairs)(["S","D"]),ct=e=>Object(Ta.a)((a,t)=>t.match.params[e],e=>e.charts.isLoading||e.results.isLoadingRanking,e=>e.results.profiles,e=>e.profiles.filter,e=>e.tracklist.data,(e,a,t,r,n)=>{const s=v.a.toInteger(e),l=t[s];if(v.a.isEmpty(l)||a)return null;const c=v.a.flow(v.a.get("resultsByLevel"),v.a.toPairs,v.a.map(([e,a])=>({x:v.a.toInteger(e),S:v.a.size(v.a.filter(e=>"S"===e.chart.chartType||"SP"===e.chart.chartType,a))/n.singlesLevels[e]*100,D:-v.a.size(v.a.filter(e=>"D"===e.chart.chartType||"DP"===e.chart.chartType,a))/n.doublesLevels[e]*100})))(l),i=v.a.flow(v.a.get("resultsByLevel"),v.a.toPairs,v.a.map(v.a.update("[1].result.grade",e=>e&&e.includes("+")&&"A+"!==e?e.replace("+",""):e)))(l),o=v.a.flow(v.a.map(([e,a])=>({x:v.a.toInteger(e),...st,...v.a.omit("?",v.a.mapValues(v.a.size,v.a.groupBy("result.grade",a)))})),v.a.map(e=>{const a=v.a.pick(Object.keys(st),e),t=v.a.sum(v.a.values(a));return{...e,gradesValues:a,...0===t?a:v.a.mapValues(e=>100*e/t,a)}}))(i),m=v.a.flow(v.a.map(([e,a])=>{const t=v.a.groupBy("result.grade",a),r=v.a.omit("?",v.a.mapValues(v.a.countBy(e=>"S"===e.chart.chartType||"SP"===e.chart.chartType?"S":"D"===e.chart.chartType||"DP"===e.chart.chartType?"D":"Other"),t)),s=v.a.reduce((a,[t,r])=>({...a,...v.a.flow(v.a.toPairs,v.a.map(([a,r])=>["".concat(a,"-").concat(t),"S"===a?r/n.singlesLevels[e]*100:-r/n.doublesLevels[e]*100]),v.a.fromPairs)(r)}),{},v.a.toPairs(r));return{x:v.a.toInteger(e),...lt,...s}}))(i),d=v.a.last(l.ratingHistory).date,p=v.a.last(l.rankingHistory).date,u=d>p?d:p,h=v.a.first(l.ratingHistory).date,E=ee()(u).endOf("day"),g=[ee()(h).startOf("day")/1e3/60/60/24,E/1e3/60/60/24],f=r.dayRange||[Math.max(g[0],g[1]-30),g[1]],y=[+ee()(1e3*f[0]*60*60*24).startOf("day"),+ee()(1e3*f[1]*60*60*24).endOf("day")],N=nt(l.rankingHistory,y),b=nt(l.ratingHistory,y),S=1+v.a.findIndex({id:s},v.a.orderBy(["ratingRaw"],["desc"],v.a.values(t)));return{...l,rank:S,minMaxRange:g,filterRange:f,levelsDistribution:c,gradesDistribution:o,gradesAndLevelsDistribution:m,placesChanges:N,ratingChanges:b}}),it=ct("id"),ot=Object(Ta.a)(e=>e.results.players,(e,a)=>v.a.toNumber(a.match.params.id),(e,a)=>v.a.flow(v.a.toPairs,v.a.map(([e,{nickname:a,arcade_name:t,id:r}])=>({label:"".concat(a," (").concat(t,")"),value:a,id:v.a.toNumber(r)})),v.a.remove(e=>e.id===a),v.a.sortBy(e=>v.a.toLower(e.label)))(e)),mt={fetchChartsData:xa,setProfilesFilter:tt,resetProfilesFilter:rt};class dt extends r.Component{constructor(...e){super(...e),this.state={isLevelGraphCombined:!0,showFaq:!1},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()},this.onChangeDayRange=e=>{const{filter:a}=this.props;this.props.setProfilesFilter({...a,dayRange:e})},this.onShowFaq=()=>{this.setState({showFaq:!0})},this.onHideFaq=()=>{this.setState({showFaq:!1})},this.circleShape=e=>n.a.createElement("circle",{key:e.key,cx:e.cx,cy:e.cy,r:4,fill:e.fill})}componentWillUnmount(){this.props.resetProfilesFilter()}renderRankingHistory(){const{profile:e}=this.props;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.g,{data:e.ratingChanges,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.c,{strokeDasharray:"3 3"}),n.a.createElement(Ja.m,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>ae(e).toLocaleDateString()}),n.a.createElement(Ja.n,{allowDecimals:!1,domain:["dataMin - 100","dataMax + 100"],tickFormatter:Math.round,width:40}),n.a.createElement(Ja.h,{y:1e3,stroke:"white"}),n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,ae(a[0].payload.date).toLocaleDateString()),a&&a[0]&&n.a.createElement("div",null,"Rating: ",Math.round(a[0].value))):null}),n.a.createElement(Ja.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderAccuracyPoints(e=!1){const{profile:a,sharedCharts:t}=this.props,r=v.a.groupBy(([,,e])=>{const a=t[e].chartType;return"D"===a||"DP"===a},a.accuracyPointsRaw);return e?n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.g,{margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.c,{strokeDasharray:"3 3"}),n.a.createElement(Ja.m,{dataKey:"[0]",type:"number",domain:[1,28],tickFormatter:e=>Math.round(e)}),n.a.createElement(Ja.n,{domain:[0,100],width:40}),n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,a[0].payload[0]),a&&a[0]&&n.a.createElement("div",null,"Acc: #",a[0].value)):null}),n.a.createElement(Ja.f,{data:a.accuracyPointsInterpolated,isAnimationActive:!1,dataKey:"[1]",stroke:"#88d3ff",strokeWidth:3,dot:!1}))):n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.k,{margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.c,{strokeDasharray:"3 3"}),n.a.createElement(Ja.m,{dataKey:"[0]",type:"number",domain:[1,28],tickFormatter:e=>Math.round(e),ticks:[1,3,5,7,9,11,13,15,17,19,21,23,25,27]}),n.a.createElement(Ja.n,{dataKey:"[1]",type:"number",domain:[0,100],width:40,tickFormatter:e=>Math.round(e)+"%"}),n.a.createElement(Ja.j,{data:r.true,shape:this.circleShape,fill:"#169c16"}),n.a.createElement(Ja.j,{data:r.false,shape:this.circleShape,fill:"#af2928"}),n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:a,label:r})=>{if(!a||!a[0]||!a[1])return null;const s=a[0].payload[2]&&t[a[0].payload[2]];return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",a[0].value),n.a.createElement("div",null,"Accuracy: ",a[1].value,"%"),s&&n.a.createElement("div",null,s.song," ",s.chartLabel," (",s.interpolatedDifficulty.toFixed(1),")"))}})))}renderPlaceHistory(){const{profile:e}=this.props;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.g,{data:e.placesChanges,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.c,{strokeDasharray:"3 3"}),n.a.createElement(Ja.m,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>ae(e).toLocaleDateString()}),n.a.createElement(Ja.n,{allowDecimals:!1,domain:[1,e=>e<3?e+2:e+1],interval:0,reversed:!0,width:40}),n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,ae(a[0].payload.date).toLocaleDateString()),a&&a[0]&&n.a.createElement("div",null,"Place: #",a[0].value)):null}),n.a.createElement(Ja.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderGrades(){const{profile:e}=this.props;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.b,{data:e.gradesDistribution,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",a[0].payload.x),v.a.filter(e=>e.value>0,a).map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name,": ",a[0].payload.gradesValues[e.name]))):null}),n.a.createElement(Ja.m,{dataKey:"x"}),n.a.createElement(Ja.n,{domain:[0,100],ticks:[0,50,100],tickFormatter:e=>"".concat(Math.round(e),"%"),width:40}),n.a.createElement(Ja.e,null),n.a.createElement(Ja.a,{dataKey:"SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"F",fill:"#774949",stackId:"stack"})))}renderGradesWithLevels(){const{profile:e,tracklist:a}=this.props;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:.74},n.a.createElement(Ja.b,{data:e.gradesAndLevelsDistribution,margin:{top:5,bottom:5,right:5,left:0},stackOffset:"sign"},n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:t,label:r})=>{if(!t||!t[0])return null;const s=v.a.filter(e=>0!==e.value&&e.dataKey.startsWith("D"),t),l=v.a.filter(e=>0!==e.value&&e.dataKey.startsWith("S"),t);return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),!!l.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Single:"),l.map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name.slice(2),": ",Math.round(Math.abs(e.value)),"% (",Math.round(a.singlesLevels[e.payload.x]*e.value/100),"/",a.singlesLevels[e.payload.x],")"))),!!s.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Double:"),s.map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name.slice(2),": ",Math.round(Math.abs(e.value)),"% (",Math.round(a.doublesLevels[e.payload.x]*-e.value/100),"/",a.doublesLevels[e.payload.x],")"))))}}),n.a.createElement(Ja.m,{dataKey:"x"}),n.a.createElement(Ja.n,{tickFormatter:e=>"".concat(Math.round(Math.abs(e)),"%"),width:40,domain:[e=>Math.min(e,-10),e=>Math.max(10,e)]}),n.a.createElement(Ja.a,{dataKey:"S-SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S-F",fill:"#774949",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"D-F",fill:"#774949",stackId:"stack"}),n.a.createElement(Ja.d,{value:"Double",offset:0,position:"insideBottomLeft"}),n.a.createElement(Ja.d,{value:"Single",offset:0,position:"insideTopLeft"}),n.a.createElement(Ja.h,{y:0,stroke:"#bbb"})))}renderLevels(){const{profile:e,tracklist:a}=this.props;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.b,{data:e.levelsDistribution,stackOffset:"sign",margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:t,label:r})=>{if(!t||!t[0])return null;const s=a.doublesLevels[t[0].payload.x],l=a.singlesLevels[t[0].payload.x];return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),l>0&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[1].color}},"Single: ",Math.abs(t[1].value).toFixed(1),"% (",Math.round(t[1].value*l/100),"/",l,")"),s>0&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[0].color}},"Double: ",Math.abs(t[0].value).toFixed(1),"% (",Math.round(Math.abs(t[0].value)*s/100),"/",s,")"))}}),n.a.createElement(Ja.m,{dataKey:"x"}),n.a.createElement(Ja.n,{tickFormatter:e=>Math.round(Math.abs(e))+"%",width:40,domain:[e=>Math.min(e,-10),e=>Math.max(10,e)]}),n.a.createElement(Ja.l,null),n.a.createElement(Ja.h,{y:0,stroke:"#555"}),n.a.createElement(Ja.e,null),n.a.createElement(Ja.a,{dataKey:"D",fill:"#169c16",stackId:"stack"}),n.a.createElement(Ja.a,{dataKey:"S",fill:"#af2928",stackId:"stack"})))}renderGradeBlock(e,a){const{profile:t}=this.props,r=t.progress[e],s="double"===e?"D":"S",l=Math.floor(100*(r["".concat(a,"-bonus-level-coef")]||0)),c=r["".concat(a,"-bonus-level-min-number")],i=r["".concat(a,"-bonus-level-achieved-number")],o=r["".concat(a,"-bonus-level")]?"".concat(s).concat(r["".concat(a,"-bonus-level")]):"?";return n.a.createElement("div",{className:"grade-block"},n.a.createElement("div",{className:"grade-letter"},n.a.createElement(ga,{grade:a})),n.a.createElement("div",{className:"grade-level"},o),n.a.createElement("div",{className:"grade-progress"},l,"% (",100===l?c:i,"/",c,")"),n.a.createElement("div",{className:M()("progress-background",{complete:100===l,zero:0===l}),style:{height:"".concat(l,"%")}}))}renderAchievement(e,a){const t=ie[e].icon,r=ie[e].description;return n.a.createElement(ha.a,{key:e,content:n.a.createElement("div",null,r),tooltipClassName:"pumpking-tooltip achievement-tooltip"},n.a.createElement("div",{className:"ach-block"},t&&n.a.createElement("div",{className:"ach-icon"},n.a.createElement(t,null)),n.a.createElement("div",{className:"ach-name"},e),n.a.createElement("div",{className:M()("progress-background",{complete:100===a.progress,zero:0===a.progress}),style:{height:"".concat(Math.round(a.progress),"%")}})))}renderResultsByLevelHeader(){const{isLevelGraphCombined:e}=this.state;return n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Pe,{className:"combine-toggle",checked:e,onChange:()=>this.setState(e=>({isLevelGraphCombined:!e.isLevelGraphCombined}))},"\u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438"))}renderResultsByLevelFooter(){const{profile:e}=this.props;return n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(c.b,{to:k.resultsByLevel.getPath({id:e.id})},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},"\u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435")))}renderProfile(){const{profile:e,otherPlayers:a,filter:t}=this.props,{isLevelGraphCombined:r}=this.state,s=e.expRankNext?(e.exp-e.expRank.threshold)/(e.expRankNext.threshold-e.expRank.threshold):100;return n.a.createElement("div",{className:"profile"},n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"profile-name text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,e.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",e.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,e.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,e.lastResultDate?ue(e.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430")),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"text-with-header -select"},n.a.createElement("div",{className:"text-header"},"\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441"),n.a.createElement("div",null,n.a.createElement(Oe.a,{closeMenuOnSelect:!0,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:a,onChange:a=>{this.props.history.push(k.compare.getPath({id:e.id,compareToId:a.id}))}})))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header _flex-row _align-center"},n.a.createElement("span",null,"\u043e\u043f\u044b\u0442"),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{onClick:this.onShowFaq,className:"_clickable"},n.a.createElement(D.r,{onClick:this.onShowFaq})),n.a.createElement(y.a,{ariaHideApp:!1,className:"Modal faq-modal",overlayClassName:"Overlay",isOpen:this.state.showFaq,onRequestClose:this.onHideFaq},n.a.createElement("div",{className:"close-btn",onClick:this.onHideFaq},n.a.createElement(D.v,null))," ",n.a.createElement($a,null))),n.a.createElement("div",{className:"exp-range"},n.a.createElement("div",{className:"rank exp-rank"},le(e.expRank),e.expRank&&n.a.createElement("div",null,e.expRank.threshold)),n.a.createElement("div",{className:"exp-line-with-label"},n.a.createElement("div",{className:"exp-label"},e.expRankNext?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"taken-num"},Math.round(e.exp-e.expRank.threshold))," / ".concat(e.expRankNext.threshold-e.expRank.threshold)):null),n.a.createElement("div",{className:"exp-line"},n.a.createElement("div",{className:"taken",style:{width:Math.floor(100*s)+"%"}}),n.a.createElement("div",{className:"rest",style:{width:100-Math.ceil(100*s)+"%"}})),n.a.createElement("div",{className:"exp-label"},"total: ",n.a.createElement("span",{className:"taken-num"},Math.round(e.exp)))),e.expRankNext&&n.a.createElement("div",{className:"rank exp-rank"},le(e.expRankNext),e.expRankNext&&n.a.createElement("div",null,e.expRankNext.threshold)))),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},r?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u043e\u0446\u0435\u043d\u043a\u0438"),this.renderResultsByLevelHeader()),n.a.createElement("div",{className:"chart-container single-double-labels"},this.renderGradesWithLevels())),this.renderResultsByLevelFooter()):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u0443\u0440\u043e\u0432\u043d\u0438"),this.renderResultsByLevelHeader()),n.a.createElement("div",{className:"chart-container"},this.renderLevels())),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043e\u0446\u0435\u043d\u043a\u0438")),n.a.createElement("div",{className:"chart-container"},this.renderGrades())),this.renderResultsByLevelFooter()))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u044d\u043b\u043e")),n.a.createElement("div",{className:"chart-container"},this.renderRankingHistory())),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043c\u0435\u0441\u0442\u043e \u0432 \u0442\u043e\u043f\u0435")),n.a.createElement("div",{className:"chart-container"},this.renderPlaceHistory()))),(()=>{const a=t.dayRange||e.filterRange,r=ee()(1e3*a[0]*60*60*24).format("L"),s=ee()(1e3*a[1]*60*60*24).format("L"),l=Math.max(a[0]-1,e.minMaxRange[0]),c=Math.min(a[0]+1,a[1]),i=Math.max(a[1]-1,a[0]),o=Math.min(a[1]+1,e.minMaxRange[1]);return n.a.createElement("div",{className:"range-container"},n.a.createElement(Me,{range:a,min:e.minMaxRange[0],max:e.minMaxRange[1],onChange:this.onChangeDayRange}),n.a.createElement("div",{className:"range-controls _flex-row"},n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([l,a[1]])},n.a.createElement(D.f,null)),n.a.createElement("span",{className:"date-text"},r),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([c,a[1]])},n.a.createElement(D.g,null)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],i])},n.a.createElement(D.f,null)),n.a.createElement("span",{className:"date-text"},s),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],o])},n.a.createElement(D.g,null))))})())),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"chart-container"},this.renderAccuracyPoints())))),n.a.createElement("div",{className:"profile-section"})),n.a.createElement("div",{className:"profile-section progress-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"progress-blocks-single-double"},n.a.createElement("div",{className:"progress-block"},n.a.createElement("div",{className:"achievements-grades single"},this.renderGradeBlock("single","A"),this.renderGradeBlock("single","A+"),this.renderGradeBlock("single","S"),this.renderGradeBlock("single","SS"))),n.a.createElement("div",{className:"progress-block"},n.a.createElement("div",{className:"achievements-grades double"},this.renderGradeBlock("double","A"),this.renderGradeBlock("double","A+"),this.renderGradeBlock("double","S"),this.renderGradeBlock("double","SS")))),n.a.createElement("div",{className:"bonus-faq"},"* \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0430\u0447\u0438\u0432\u043a\u0438 \u043d\u0443\u0436\u043d\u043e \u0441\u044b\u0433\u0440\u0430\u0442\u044c \u043e\u043a\u043e\u043b\u043e 10% \u0432\u0441\u0435\u0445 \u0447\u0430\u0440\u0442\u043e\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u043b\u0435\u0432\u0435\u043b\u0430 \u043d\u0430 \u043d\u0443\u0436\u043d\u044b\u0439 \u0433\u0440\u0435\u0439\u0434")),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f")),n.a.createElement("div",{className:"achievements"},v.a.keys(e.achievements).map(a=>this.renderAchievement(a,e.achievements[a])))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0447\u0430\u0441\u0442\u043e \u0438\u0433\u0440\u0430\u0435\u043c\u044b\u0435 \u0447\u0430\u0440\u0442\u044b")),n.a.createElement(Za,{playerId:e.id})))}render(){const{isLoading:e,profile:a,error:t}=this.props;return Ye&&console.log("profile:",a),n.a.createElement("div",{className:"profile-page"},n.a.createElement("div",{className:"content"},t&&t.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(D.u,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")),e&&n.a.createElement(F,null),!e&&v.a.isEmpty(a)&&n.a.createElement("div",{className:"profile"},"Profile not found"),!e&&!v.a.isEmpty(a)&&this.renderProfile()))}}dt.defaultProps={profile:{}};var pt=Object(i.b)((e,a)=>({profile:it(e,a),otherPlayers:ot(e,a),tracklist:e.tracklist.data,filter:e.profiles.filter,error:e.charts.error||e.tracklist.error,sharedCharts:e.results.sharedCharts,isLoading:e.charts.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}),mt)(Object(h.g)(dt));t(417);const ut=Object(Ta.a)(e=>e.tracklist.data,e=>v.a.flow(v.a.get("chartLevels"),v.a.keys,v.a.filter(e=>0<e),v.a.map(e=>({label:e,value:e})))(e)),ht=Object(Ta.a)(e=>e.results.sharedCharts,it,(e,a)=>a.match.params.level,(e,a)=>a.sortOrder,(e,a,t,r)=>{if(!a||!t)return null;const n=v.a.toString(t),s=v.a.flow(v.a.values,v.a.filter(e=>e.chartLevel===n&&!e.results.some(e=>e.playerId===a.id)),v.a.map(e=>({chart:e})),v.a.groupBy("chart.chartType"))(e);return{byType:v.a.flow(v.a.groupBy("chart.chartType"),e=>({...Object.keys(s).reduce((e,a)=>({...e,[a]:[]}),{}),...e}),v.a.mapValues(v.a.flow(v.a.groupBy("result.grade"),v.a.toPairs,v.a.orderBy(([e])=>Ee[e],r))),v.a.toPairs,v.a.orderBy(([e])=>"S"===e?0:"D"===e?1:2,"asc"),v.a.map(([e,a])=>"asc"===r?[e,[["X",s[e]||[]],...a]]:[e,[...a,["X",s[e]||[]]]]))(a.resultsByLevel[t])}});var Et=e=>{const{match:a,history:t}=e,s=u(),[l,o]=Object(r.useState)("asc"),m=Object(i.d)(ut),d=Object(i.d)(a=>it(a,e)),p=Object(i.d)(a=>ht(a,{...e,sortOrder:l})),h=Object(i.d)(e=>e.charts.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading);if(Object(r.useEffect)(()=>{if(d&&!a.params.level){const e=v.a.flow(v.a.get("resultsByLevel"),v.a.toPairs,v.a.maxBy("[1].length"),v.a.first)(d);t.push(k.resultsByLevel.level.getPath({...a.params,level:e}))}},[a.params,d,t]),h)return n.a.createElement(F,null);if(!p)return null;const E={D:s.DOUBLES,S:s.SINGLES};return n.a.createElement("div",{className:"profile-results-by-level"},n.a.createElement("header",null,n.a.createElement(c.b,{to:k.getPath({id:d.id})},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},s.BACK_BUTTON)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:()=>o(e=>"asc"===e?"desc":"asc")},"desc"===l?n.a.createElement(D.e,null):n.a.createElement(D.h,null)," ",s.SORTING),n.a.createElement(Oe.a,{className:"select levels",classNamePrefix:"select",placeholder:s.LEVEL_PLACEHOLDER,options:m,value:m.find(e=>e.value===a.params.level),onChange:e=>{t.push(k.resultsByLevel.level.getPath({id:d.id,level:e.value}))}})),n.a.createElement("div",{className:"chart-types"},p.byType.map(([e,a])=>n.a.createElement("div",{key:e,className:"chart-type"},n.a.createElement("header",null,E[e]||e),n.a.createElement("div",{className:"grades-groups"},a.map(([e,a])=>v.a.isEmpty(a)?null:n.a.createElement("div",{key:e,className:"grades-group"},n.a.createElement("header",null,"X"===e?s.UNPLAYED:"?"===e?"?":n.a.createElement(ga,{grade:e})," ","(",a.length,")"),n.a.createElement("div",{className:"charts-for-grade"},a.map(({chart:a,result:t})=>n.a.createElement("div",{key:a.sharedChartId,className:"chart-block"},n.a.createElement(ka,{type:a.chartType,level:a.chartLevel}),n.a.createElement(c.c,{exact:!0,to:b.sharedChart.getPath({sharedChartId:a.sharedChartId})},a.song),t&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement(ga,{grade:e}),n.a.createElement("span",{className:"score-span"},t.scoreIncrease>.8*t.score&&"*",pa()(t.score).format("0,0")))))))))))))},gt=t(185);t(418);const ft={SINGLE_TWO:"SINGLE_TWO",SINGLE_FIVE:"SINGLE_FIVE",DOUBLE_TWO:"DOUBLE_TWO",DOUBLE_FIVE:"DOUBLE_FIVE",BOTH_TWO:"BOTH_TWO",BOTH_FIVE:"BOTH_FIVE"},yt=ct("id"),Nt=ct("compareToId"),vt=Object(gt.a)()((e,a,t)=>{if(!e||!a)return{};let r=e.ratingChanges[0].rating,n=a.ratingChanges[0].rating;const s=v.a.flow(v.a.sortBy("date"),v.a.map(e=>(e.rating&&(r=e.rating),e.rating2&&(n=e.rating2),{rating1:r,rating2:n,date:e.date})),v.a.sortedUniqBy("date"))([...e.ratingChanges,...a.ratingChanges.map(e=>({date:e.date,rating2:e.rating}))]);r=e.placesChanges[0].place,n=a.placesChanges[0].place;const l=v.a.flow(v.a.sortBy("date"),v.a.map(e=>(e.place&&(r=e.place),e.place2&&(n=e.place2),{place1:r,place2:n,date:e.date})))([...e.placesChanges,...a.placesChanges.map(e=>({date:e.date,place2:e.place}))]),c=v.a.fromPairs(Array.from({length:28}).map((e,a)=>[a+1,{}]));return v.a.keys(c).forEach(r=>{const n=v.a.flow(v.a.map("chart"),v.a.uniqBy("sharedChartId"))([...e.resultsByLevel[r],...a.resultsByLevel[r]]),s={x:r,all:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}},double:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}},single:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}}};n.forEach(t=>{const r=t.results.findIndex(a=>a.playerId===e.id),n=t.results.findIndex(e=>e.playerId===a.id),l=t.chartType.startsWith("D")?s.double:s.single;r<0&&n<0?console.log("wtf?"):r<0?(s.all.p1notPlayed++,l.p1notPlayed++):n<0?(s.all.p2notPlayed++,l.p2notPlayed++):r<n?(s.all.p1win++,l.p1win++):n<r&&(s.all.p2win++,l.p2win++)});const l=e=>{const a=e.p1win+e.p2win||1;e.twoBars.p1win=e.p1win/a,e.twoBars.p2win=e.p2win/a};l(s.all),l(s.single),l(s.double);const i=(e,a)=>{e.p1win=e.p1win/a,e.p1notPlayed=e.p1notPlayed/a,e.p2win=e.p2win/a,e.p2notPlayed=e.p2notPlayed/a,e.notPlayed=1-e.p1win-e.p1notPlayed-e.p2win-e.p2notPlayed};i(s.all,t.chartLevels[r]),i(s.double,t.doublesLevels[r]),i(s.single,t.singlesLevels[r]),c[r]=s}),{ratingChanges:s,placesChanges:l,perLevelComparison:v.a.values(c)}}),bt={fetchChartsData:xa,setProfilesFilter:tt,resetProfilesFilter:rt};class St extends r.Component{constructor(...e){super(...e),this.state={isLevelGraphCombined:!0,compareBarsMode:ft.BOTH_TWO},this.onRefresh=()=>{const{isLoading:e}=this.props;!e&&this.props.fetchChartsData()},this.onChangeDayRange=e=>{const{filter:a}=this.props;this.props.setProfilesFilter({...a,dayRange:e})},this.rhMargin={top:5,bottom:5,right:5,left:0},this.rhXDomain=["dataMin","dataMax"],this.rhYDomain=["dataMin - 100","dataMax + 100"],this.rhXTickFormatter=e=>ae(e).toLocaleDateString(),this.rhTooltip=({active:e,payload:a,label:t})=>{const{profile:r,profile2:s}=this.props,l=r.name,c=s.name;return a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,ae(a[0].payload.date).toLocaleDateString()),a[1]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[1].color}},l,": ",Math.round(a[1].value)),a[0]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[0].color}},c,": ",Math.round(a[0].value))):null},this.circleShape=e=>n.a.createElement("circle",{key:e.key,cx:e.cx,cy:e.cy,r:4,fill:e.fill}),this.plcMargin={top:5,bottom:5,right:5,left:0},this.plcTooltip=({active:e,payload:a,label:t})=>{const{profile:r,profile2:s}=this.props,{compareBarsMode:l}=this.state,c=[ft.SINGLE_TWO,ft.DOUBLE_TWO,ft.BOTH_TWO].includes(l),i=r.name,o=s.name;if(!a||!a[0])return null;const m=(e,a)=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},a,": ",Math.round(100*v.a.get(e.dataKey,e.payload)),"%");return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",a[0].payload.x),m(a[0],"".concat(i," wins")),!c&&m(a[1],"".concat(o," has no score")),!c&&m(a[2],"Both have no score"),!c&&m(a[3],"".concat(i," has no score")),m(c?a[1]:a[4],"".concat(o," wins")))},this.plcXDomain=[0,1],this.plcXTicks=[0,.5,1],this.plcXFormatter=e=>"".concat(Math.round(100*e),"%")}renderRankingHistory(){const{combinedData:e}=this.props;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.g,{data:e.ratingChanges,margin:this.rhMargin},n.a.createElement(Ja.c,{strokeDasharray:"3 3"}),n.a.createElement(Ja.m,{dataKey:"date",type:"number",domain:this.rhXDomain,tickFormatter:this.rhXTickFormatter}),n.a.createElement(Ja.n,{allowDecimals:!1,domain:this.rhYDomain,tickFormatter:Math.round,width:40}),n.a.createElement(Ja.h,{y:1e3,stroke:"white"}),n.a.createElement(Ja.l,{isAnimationActive:!1,content:this.rhTooltip}),n.a.createElement(Ja.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating2",stroke:"#ffd388",strokeWidth:3,dot:!1}),n.a.createElement(Ja.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating1",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderAccuracyPoints(e=!1){const{profile:a,profile2:t}=this.props;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.k,{margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.c,{strokeDasharray:"3 3"}),n.a.createElement(Ja.m,{dataKey:"[0]",type:"number",domain:[1,28],tickFormatter:e=>Math.round(e),ticks:[1,3,5,7,9,11,13,15,17,19,21,23,25,27]}),n.a.createElement(Ja.n,{dataKey:"[1]",type:"number",domain:[0,100],width:40,tickFormatter:e=>Math.round(e)+"%"}),n.a.createElement(Ja.j,{shape:this.circleShape,data:(e?t:a).accuracyPointsRaw,fill:e?"#ffd388":"#88d3ff"})))}renderPlaceHistory(){const{combinedData:e,profile:a,profile2:t}=this.props,r=a.name,s=t.name;return n.a.createElement(Ja.i,{minHeight:void 0,aspect:1.6},n.a.createElement(Ja.g,{data:e.placesChanges,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ja.c,{strokeDasharray:"3 3"}),n.a.createElement(Ja.m,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>ae(e).toLocaleDateString()}),n.a.createElement(Ja.n,{allowDecimals:!1,domain:[1,e=>e<3?e+2:e+1],interval:0,reversed:!0,width:40}),n.a.createElement(Ja.l,{isAnimationActive:!1,content:({active:e,payload:a,label:t})=>a&&a[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,ae(a[0].payload.date).toLocaleDateString()),a[1]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[1].color}},r,": #",a[1].value),a[0]&&n.a.createElement("div",{style:{fontWeight:"bold",color:a[0].color}},s,": #",a[0].value)):null}),n.a.createElement(Ja.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place2",stroke:"#ffd388",strokeWidth:3,dot:!1}),n.a.createElement(Ja.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place1",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderPerLevelComparison(){const{combinedData:e}=this.props,{compareBarsMode:a}=this.state;return n.a.createElement(Ja.i,{width:"100%",aspect:.7},n.a.createElement(Ja.b,{layout:"vertical",data:[...e.perLevelComparison],margin:this.plcMargin},n.a.createElement(Ja.l,{isAnimationActive:!1,content:this.plcTooltip}),n.a.createElement(Ja.n,{reversed:!0,dataKey:"x",type:"category",width:23}),n.a.createElement(Ja.m,{type:"number",domain:this.plcXDomain,ticks:this.plcXTicks,tickFormatter:this.plcXFormatter}),n.a.createElement(Ja.h,{x:.5,stroke:"#666"}),(e=>{switch(e){case ft.SINGLE_TWO:return[n.a.createElement(Ja.a,{key:"11",dataKey:"single.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"22",dataKey:"single.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case ft.SINGLE_FIVE:return[n.a.createElement(Ja.a,{key:"1",dataKey:"single.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"2",dataKey:"single.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"3",dataKey:"single.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"4",dataKey:"single.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"5",dataKey:"single.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case ft.DOUBLE_TWO:return[n.a.createElement(Ja.a,{key:"11",dataKey:"double.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"22",dataKey:"double.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case ft.DOUBLE_FIVE:return[n.a.createElement(Ja.a,{key:"1",dataKey:"double.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"2",dataKey:"double.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"3",dataKey:"double.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"4",dataKey:"double.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"5",dataKey:"double.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case ft.BOTH_TWO:return[n.a.createElement(Ja.a,{key:"11",dataKey:"all.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"22",dataKey:"all.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case ft.BOTH_FIVE:return[n.a.createElement(Ja.a,{key:"1",dataKey:"all.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"2",dataKey:"all.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"3",dataKey:"all.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"4",dataKey:"all.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ja.a,{key:"5",dataKey:"all.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];default:return null}})(a)))}renderProfile(){const{profile:e,profile2:a,filter:t,otherPlayers:r}=this.props,{compareBarsMode:s}=this.state;return n.a.createElement("div",{className:"profile"},n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"profile-name text-with-header blue"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,e.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",e.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,e.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,e.lastResultDate?ue(e.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430")),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"text-with-header -select"},n.a.createElement("div",{className:"text-header"},"\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441"),n.a.createElement("div",null,n.a.createElement(Oe.a,{closeMenuOnSelect:!0,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:r,onChange:a=>{this.props.history.push(k.compare.getPath({id:e.id,compareToId:a.id}))}})))),n.a.createElement("div",{className:"profile-header right-align"},n.a.createElement("div",{className:"profile-name text-with-header orange"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,a.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",a.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,a.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,a.lastResultDate?ue(a.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430"))),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u043f\u043e\u0431\u0435\u0434\u044b \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"profile-sm-section-header flex"},(()=>{const e=[ft.SINGLE_TWO,ft.DOUBLE_TWO,ft.BOTH_TWO].includes(s);return n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Pe,{className:"combine-toggle",checked:!e,onChange:()=>this.setState(e=>({compareBarsMode:{[ft.SINGLE_TWO]:ft.SINGLE_FIVE,[ft.DOUBLE_TWO]:ft.DOUBLE_FIVE,[ft.BOTH_TWO]:ft.BOTH_FIVE,[ft.SINGLE_FIVE]:ft.SINGLE_TWO,[ft.DOUBLE_FIVE]:ft.DOUBLE_TWO,[ft.BOTH_FIVE]:ft.BOTH_TWO}[e.compareBarsMode]}))},"\u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e"),n.a.createElement("div",{className:"tabs-holder"},n.a.createElement(Re,{text:"\u0432\u0441\u0435",active:[ft.BOTH_TWO,ft.BOTH_FIVE].includes(s),onToggle:()=>{this.setState(a=>({compareBarsMode:e?ft.BOTH_TWO:ft.BOTH_FIVE}))}}),n.a.createElement(Re,{text:"\u0441\u0438\u043d\u0433\u043b\u044b",active:[ft.SINGLE_TWO,ft.SINGLE_FIVE].includes(s),onToggle:a=>{this.setState(a=>({compareBarsMode:e?ft.SINGLE_TWO:ft.SINGLE_FIVE}))}}),n.a.createElement(Re,{text:"\u0434\u0430\u0431\u043b\u044b",active:[ft.DOUBLE_TWO,ft.DOUBLE_FIVE].includes(s),onToggle:a=>{this.setState(a=>({compareBarsMode:e?ft.DOUBLE_TWO:ft.DOUBLE_FIVE}))}})))})()),n.a.createElement("div",{className:"chart-container"},this.renderPerLevelComparison())))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u044d\u043b\u043e")),n.a.createElement("div",{className:"chart-container"},this.renderRankingHistory())),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043c\u0435\u0441\u0442\u043e \u0432 \u0442\u043e\u043f\u0435")),n.a.createElement("div",{className:"chart-container"},this.renderPlaceHistory()))),(()=>{const a=t.dayRange||e.filterRange,r=ee()(1e3*a[0]*60*60*24).format("L"),s=ee()(1e3*a[1]*60*60*24).format("L"),l=Math.max(a[0]-1,e.minMaxRange[0]),c=Math.min(a[0]+1,a[1]),i=Math.max(a[1]-1,a[0]),o=Math.min(a[1]+1,e.minMaxRange[1]);return n.a.createElement("div",{className:"range-container"},n.a.createElement(Me,{range:a,min:e.minMaxRange[0],max:e.minMaxRange[1],onChange:this.onChangeDayRange}),n.a.createElement("div",{className:"range-controls _flex-row"},n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([l,a[1]])},n.a.createElement(D.f,null)),n.a.createElement("span",{className:"date-text"},r),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([c,a[1]])},n.a.createElement(D.g,null)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],i])},n.a.createElement(D.f,null)),n.a.createElement("span",{className:"date-text"},s),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([a[0],o])},n.a.createElement(D.g,null))))})())),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"chart-container"},this.renderAccuracyPoints())))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"chart-container"},this.renderAccuracyPoints(!0)))))))}render(){const{isLoading:e,profile:a,error:t}=this.props;return Ye&&console.log("profile:",a),n.a.createElement("div",{className:"profile-compare-page"},n.a.createElement("div",{className:"content"},t&&t.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{disabled:e,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(D.u,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")),e&&n.a.createElement(F,null),!e&&v.a.isEmpty(a)&&n.a.createElement("div",{className:"profile"},"Profile not found"),!e&&!v.a.isEmpty(a)&&this.renderProfile()))}}St.defaultProps={profile:{},profile2:{},combinedData:{}};var Ot=Object(i.b)((e,a)=>{const t=yt(e,a),r=Nt(e,a);return{profile:t,profile2:r,otherPlayers:ot(e,a),combinedData:vt(t,r,e.tracklist.data),tracklist:e.tracklist.data,filter:e.profiles.filter,error:e.charts.error||e.tracklist.error,isLoading:e.charts.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}},bt)(Object(h.g)(St));t(419);const Rt={isLoading:!1,data:null};const kt=()=>async e=>{e({type:"USER/LOADING"});try{const a=await e(j({url:"".concat(W,"/profile")}));return e({type:"USER/SUCCESS",data:a}),a}catch(a){return e({type:"USER/ERROR",error:a}),null}},Pt={isLoading:!1,data:null,error:null};const Lt=e=>async a=>{a({type:"LOGIN/LOADING"});try{const t=await a(G({url:"".concat(W,"/login/google"),body:{token:e.tokenId}}));return H.a.set("session",t.session,{expires:30}),a({type:"LOGIN/SUCCESS",data:t}),a(kt()),t}catch(t){return a({type:"LOGIN/ERROR",error:t}),null}},_t={login:Lt,logout:()=>async e=>{e({type:"LOGIN/LOADING"}),e({type:"USER/RESET"});try{const a=await e(G({url:"".concat(W,"/logout")}));return e({type:"LOGIN/SUCCESS",data:a}),a}catch(a){return e({type:"LOGIN/ERROR",error:a}),null}}};var Ct=Object(i.b)(e=>({isLoadingLogin:e.login.isLoading,isLoadingUser:e.user.isLoading,user:e.user.data}),_t)((function({isLoadingLogin:e,isLoadingUser:a,user:t,login:r,logout:s}){const l=u();return n.a.createElement("header",{className:"top-bar"},n.a.createElement("nav",null,n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:b.path},l.LEADERBOARDS)),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:O.path},l.RANKING)),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:R.path},l.TOURNAMENTS)),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:S.path},l.SONGS)))),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"login-container"},n.a.createElement(c.c,{className:"player-info",exact:!0,to:k.getPath({id:v.a.get("player.id",t)})},v.a.getOr("","player.nickname",t)),n.a.createElement("button",{className:"btn btn-dark btn-icon btn-sm",onClick:s,disabled:e||a},n.a.createElement("span",null," ",l.LOGOUT))))})),At=t(186),xt=t(187),Tt=t.n(xt);t(430);const It={login:Lt};var Dt=Object(i.b)(e=>({isLoading:e.login.isLoading,error:e.login.error}),It)((function({isLoading:e,error:a,login:t}){const[s,l]=Object(r.useState)(!1),c=e=>{e.error?console.log("Google login response error:",e):t(e)};return n.a.createElement("div",{className:"login-screen"},n.a.createElement("div",{className:"site-name"},"pumpking"),n.a.createElement("div",{className:"login-button"},n.a.createElement(At.GoogleLogin,{clientId:"197132042723-cmibep21qf6dald9l2l01rif7l5dtd4s.apps.googleusercontent.com",buttonText:"Login",onSuccess:c,onFailure:c,cookiePolicy:"single_host_origin",render:({onClick:a,disabled:t})=>n.a.createElement("button",{className:"btn btn-dark btn-icon btn-sm",onClick:a,disabled:t||e},n.a.createElement(D.n,null),n.a.createElement("span",null," login"))})),a&&n.a.createElement("div",{className:"error"},a.message),n.a.createElement("div",{className:"footer"},"By logging in, you agree to our"," ",s?n.a.createElement(Tt.a,{text:"\ud83e\udd21",className:"clown"}):n.a.createElement("span",{onClick:()=>l(!0),className:"link-style"},"Privacy Policy")))})),wt=t(112),Mt=t.n(wt);t(433),t(434);const Ft="ACHIEVEMENT",Bt="RANK_UP",Ht={popups:[]};const jt={[Ft]:({playerName:e,achievementName:a,progress:t})=>{const[s,l]=Object(r.useState)(t[0]);return Object(r.useEffect)(()=>{l(t[1])},[]),n.a.createElement("div",{className:"achievement-popup popup"},n.a.createElement("div",{className:"player"},n.a.createElement(ce.a,null),n.a.createElement("span",null,e),n.a.createElement(ce.a,null)),n.a.createElement("div",{className:"ach-holder"},((e,a)=>{const t=ie[e].icon;return n.a.createElement("div",{className:"ach-block"},t&&n.a.createElement("div",{className:"ach-icon"},n.a.createElement(t,null)),n.a.createElement("div",{className:"ach-name"},e),n.a.createElement("div",{className:M()("progress-background",{complete:100===a,zero:0===a}),style:{height:"".concat(Math.round(a),"%")}}))})(a,s)),n.a.createElement("div",{className:"description"},ie[a].description))},[Bt]:({playerName:e,place:[a,t],list:[s,l]})=>{const[c,i]=Object(r.useState)(a),[o,m]=Object(r.useState)(s);Object(r.useEffect)(()=>{m(l),i(t)},[]);const d=Math.min(0,Math.max(-60*(v.a.size(o)-7),-60*(c-4)));return n.a.createElement("div",{className:"rank-up-popup popup"},n.a.createElement("div",{className:"player"},n.a.createElement(ce.a,null),n.a.createElement("span",null,e),n.a.createElement(ce.a,null)),n.a.createElement("div",{className:"ranking-holder"},n.a.createElement("div",{className:"moving-list",style:{top:d}},n.a.createElement(ma.a,{duration:4500,delay:2e3,maintainContainerHeight:!0},o.map((e,a)=>n.a.createElement("div",{key:e.id,className:M()("player-block",{current:a===c-1})},((e,a)=>n.a.createElement("div",{className:"closest-player ".concat(a?"current-player":"")},n.a.createElement("div",{className:"place"},"#",e.place),n.a.createElement("div",{className:"name"},e.name),n.a.createElement("div",{className:"elo"},e.rating)))(e,a===c-1)))))))}},Gt={overlay:{backgroundColor:"rgba(0, 0, 0, 0.1)"},content:{top:null,bottom:null,left:null,right:null,position:null,borderRadius:null,padding:null,background:null,display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",transition:"2.5s opacity ease",opacity:1}},Ut={removePopup:({id:e})=>({type:"POPUPS/REMOVE",id:e})};var Kt=Object(i.b)(e=>({popups:e.popups.popups}),Ut)(({popups:e,removePopup:a})=>{const[t,s]=Object(r.useState)(null),l=Object(r.useRef)(null);Object(r.useEffect)(()=>{if(e.length>0){const t=e[0];s(t),t.persistent||setTimeout(()=>{t&&t.fadeOut?(l.current.style.opacity=0,setTimeout(()=>{s(null),a(t)},2500)):(s(null),a(t))},t.timeout||6e3)}else s(null)},[e,a]);const c=Object(r.useCallback)(()=>{t&&t.fadeIn&&(l.current.style.opacity=1)},[t]);let i=Gt,o=null;if(t){const e=jt[t.type];o=e?n.a.createElement(e,t.parameters):n.a.createElement("div",null,JSON.stringify(t)),t.fadeIn&&(i=v.a.set("content.opacity",0,Gt))}return n.a.createElement("div",{className:"popups-holder"},n.a.createElement(y.a,{isOpen:!!t,contentRef:e=>l.current=e,onAfterOpen:c,style:i},o))});const Wt={isLoading:!1,data:null,error:null,fetchingParams:null};const Vt=({player:e,profile:a,label:t,trackedData:s,isLeft:l=!1,preferences:c,topPlayersList:i,addPopup:o})=>{const m=v.a.getOr({},"playersHiddenStatus",c),d=(e,a)=>{if(!a||a===e)return null;const t=e-a;return n.a.createElement("span",{className:"change ".concat(t>=0?"pos":"neg")},t<0?t.toFixed(1):"+".concat(t.toFixed(1)))},p=i.filter(e=>!m[e.id]),u=v.a.findIndex({id:a.id},p),h=u<0?[]:p.slice(Math.max(0,u-2),Math.min(u+3,p.length));(({data:e,resetData:a,onChange:t=v.a.noop,isDataValid:n=v.a.identity,isDebugOn:s=!1})=>{const[l,c]=Object(r.useState)(e),[i,o]=Object(r.useState)(e),m=Object(r.useRef)(a);Object(r.useEffect)(()=>{m.current!==a?(m.current=a,c(e),o(e)):n(e)&&!v.a.isEqual(e,i)&&(c(i),o(e),t(i,e))},[e,t,i,l,a,n]);const d=Object(r.useCallback)(()=>{c(e),o(e)},[e]);Object(r.useMemo)(()=>[i,l,d],[i,l,d])})({data:i,resetData:a.name,isDataValid:Object(r.useCallback)(v.a.get("[0].rating"),[]),onChange:Object(r.useCallback)((e,t)=>{const r=v.a.get("place",v.a.find({id:a.id},e)),n=v.a.get("place",v.a.find({id:a.id},t));r&&n&&r>n&&o({type:Bt,fadeIn:!0,fadeOut:!0,timeout:7500,parameters:{playerName:a.name,place:[r,n],list:[e,t]}})},[o,a.id,a.name])});const[E,g]=he(t);return n.a.createElement("div",{className:"player-container ".concat(l?"left":"right")},e&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"name-with-label"},n.a.createElement("div",{className:"name"},a.name||e),n.a.createElement("div",{className:"chart-label"},n.a.createElement(ka,{type:E,level:g}))),a.exp&&a.expRank&&n.a.createElement("div",{className:"exp exp-rank"},le(a.expRank),(()=>{if(!a.expRank||!a.exp)return null;let e=a.expRankNext?(a.exp-a.expRank.threshold)/(a.expRankNext.threshold-a.expRank.threshold):1;const t=1-e;let r=0;return s.exp[1]&&(e=a.expRankNext?(s.exp[1]-a.expRank.threshold)/(a.expRankNext.threshold-a.expRank.threshold):1,r=1-t-e),n.a.createElement("div",{className:"exp-line"},n.a.createElement("div",{className:"taken",style:{width:Math.floor(100*e)+"%"}}),n.a.createElement("div",{className:"diff",style:{width:Math.ceil(100*r)+"%"}}),n.a.createElement("div",{className:"rest",style:{width:Math.ceil(100*t)+"%"}}))})()),s.exp[0]&&n.a.createElement("div",{className:"exp-text"},n.a.createElement("span",{className:"_grey-text"},"exp:"),n.a.createElement("span",null,Math.round(s.exp[0])),d(s.exp[0],s.exp[1])),s.elo[0]&&n.a.createElement("div",{className:"rating"},n.a.createElement("span",{className:"_grey-text"},"elo:"),n.a.createElement("span",null,Math.round(s.elo[0])),d(s.elo[0],s.elo[1])),s.pp[0]&&n.a.createElement("div",{className:"rating"},n.a.createElement("span",{className:"_grey-text"},"pp:"),n.a.createElement("span",null,Math.round(s.pp[0])),d(s.pp[0],s.pp[1])),n.a.createElement("div",{className:"closest-players"},v.a.map(e=>n.a.createElement("div",{className:"closest-player ".concat(a.id===e.id?"current-player":"")},n.a.createElement("div",{className:"place"},"#",e.place),n.a.createElement("div",{className:"name"},e.name),n.a.createElement("div",{className:"elo"},e.rating)),h))))},Yt=Object(Ta.a)(e=>e.results.profiles,v.a.flow(v.a.values,v.a.orderBy("ratingRaw","desc"),e=>e.map((e,a)=>({place:a+1,...v.a.pick(["id","name","rating"],e)})))),qt={fetchTopPerSong:(e,a,t)=>{const r=He.a.stringify({song_name:e,charts:v.a.compact(v.a.uniq([a,t])).join(",")});return async e=>{e({type:"TOP_PER_SONG/LOADING",fetchingParams:r});try{const a=await e(j({url:"".concat(W,"/topPerSong?").concat(r)})),t=v.a.flow(va,v.a.get("results"))(a);return e({type:"TOP_PER_SONG/SUCCESS",data:t,fetchingParams:r}),t}catch(a){return e({type:"TOP_PER_SONG/ERROR",error:a,fetchingParams:r}),null}}},appendNewResults:e=>async(a,t)=>{const{originalData:r,sharedCharts:n}=t().results;if(!e)return a(Je());a({type:"TOP/LOADING"});try{const t=await a(j({url:"".concat(W,"/").concat(qe,"?").concat(He.a.stringify({start_date:e}))}));if(t.error)throw new Error(t.error);const s=v.a.filter(e=>{const a=n[e.shared_chart];if(!a)return!0;const t=v.a.find(a=>a.id===e.id||a.playerId===e.player&&a.isRank===!!e.rank_mode,a.results);return t?!(t.id===e.id||t.score>=e.score):!(1===e.player&&a.results[0].score>e.score)},t.results);if(console.log("Received results:",t,"; Will append:",s),v.a.isEmpty(s))a({type:"TOP/STOP_LOADING"});else{const e={players:t.players,results:[...r.results,...s],shared_charts:{...r.shared_charts,...t.shared_charts}};a(Qe(e))}}catch(s){console.log(s),a({type:"TOP/ERROR",error:s})}},addPopup:({type:e,parameters:a,fadeIn:t,fadeOut:r,timeout:n,persistent:s})=>({type:"POPUPS/ADD",popupType:e,parameters:a,fadeIn:t,fadeOut:r,timeout:n,persistent:s}),fetchUserPreferences:e=>async a=>await a(j({url:"".concat(W,"/player/").concat(e,"/preferences")}))};var zt=Object(i.b)(e=>({isLoading:e.topPerSong.isLoading,songTopData:e.topPerSong.data,error:e.topPerSong.error,profiles:e.results.profiles,topPlayersList:Yt(e),sharedCharts:e.results.sharedCharts}),qt)((function({isLoading:e,fetchTopPerSong:a,fetchUserPreferences:t,appendNewResults:s,songTopData:l,error:c,profiles:i,topPlayersList:o,sharedCharts:m={},addPopup:d}){const[p,u]=Object(r.useState)(""),[h,E]=Object(r.useState)(""),[g,f]=Object(r.useState)(!1),[y,N]=Object(r.useState)(null),[b,S]=Object(r.useState)(null),[O,R]=Object(r.useState)(null),[k,P]=Object(r.useState)(null),[L,_]=Object(r.useState)(null),[C,A]=Object(r.useState)(""),[x,T]=Object(r.useState)(null),[I,D]=Object(r.useState)(null),w=Object(r.useRef)(null),M=Object(r.useRef)(null),B=Object(r.useRef)(null),H=Object(r.useRef)(null),j=Object(r.useRef)(null),G=Object(r.useMemo)(()=>!k||v.a.isEmpty(i)?{}:v.a.minBy(e=>Mt.a.get(e.nameArcade,k),v.a.values(i))||{},[k,i]),U=Object(r.useMemo)(()=>!L||v.a.isEmpty(i)?{}:v.a.minBy(e=>Mt.a.get(e.nameArcade,L),v.a.values(i))||{},[L,i]),K=e=>(a,t)=>{v.a.keys(a).forEach(r=>{a[r].progress!==t[r].progress&&d({type:Ft,fadeIn:!0,fadeOut:!0,parameters:{playerName:e,achievementName:r,progress:[a[r].progress,t[r].progress]}})})},W={pp:ba(v.a.get("pp.pp",G),G.name),elo:ba(G.ratingRaw,G.name),exp:ba(G.exp,G.name),expRank:ba(G.expRank,G.name),achievements:ba(G.achievements,G.name,K(G.name))},V=Sa(W),Y={pp:ba(v.a.get("pp.pp",U),U.name),elo:ba(U.ratingRaw,U.name),exp:ba(U.exp,U.name),expRank:ba(U.expRank,U.name),achievements:ba(U.achievements,U.name,K(U.name))},q=Sa(Y);Object(r.useEffect)(()=>{G.id&&t(G.id).then(e=>{T(e.preferences)})},[G.id,t]),Object(r.useEffect)(()=>{U.id&&t(U.id).then(e=>{D(e.preferences)})},[U.id,t]);const z=Object(r.useCallback)(()=>{N(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{N(!1),P(null),_(null),S(null),R(null),A(""),T(null),D(null)},31e4)},[]);Object(r.useEffect)(()=>{H.current=new WebSocket("ws://127.0.0.1:6789"),H.current.onerror=()=>{u("Cannot connect to websocket server, please reload the page")},H.current.onopen=e=>{f(!0)}},[]),Object(r.useEffect)(()=>{H.current.onmessage=e=>{z();try{const t=e&&e.data&&JSON.parse(e.data);if(console.log(t),"result_screen"===t.type){console.log("Resetting tracking because received result screen"),V(),q();const e=t.data.track_name,r=v.a.get("left.chart_label",t.data),n=v.a.get("right.chart_label",t.data),l=v.a.get("left.result.player_name",t.data),c=v.a.get("right.result.player_name",t.data);P(l),_(c),S(r),R(n),A(e),s(t.data.gained),a(e,r,n)}else if("chart_selected"===t.type&&(E(t.data.error||""),(t.data.leftPlayer||t.data.rightPlayer)&&(P(t.data.leftPlayer),_(t.data.rightPlayer)),(t.data.leftLabel||t.data.rightLabel)&&(S(t.data.leftLabel),R(t.data.rightLabel),t.data.text))){const e=t.data.text;A(e),console.log("song name",e,C),C!==e&&a(e,t.data.leftLabel,t.data.rightLabel)}}catch(t){console.log("on message error",t),u("Error: ".concat(t.message))}}},[C,a,z,s,V,q]),Object(r.useEffect)(()=>{if(w.current&&M.current)if(B.current){const e=M.current,a=B.current,t={w:w.current.clientWidth,h:w.current.clientHeight},r=t.w/(e.offsetWidth+a.offsetWidth),n=t.h/Math.max(e.offsetHeight,a.offsetHeight),s=t.w/Math.max(e.offsetWidth,a.offsetWidth),l=t.h/(e.offsetHeight+a.offsetHeight);Math.min(r,n)>Math.min(s,l)?(w.current.style.flexDirection="row",w.current.style.alignItems="center",w.current.style.transform="scale(".concat(r>n?.98*n:.98*r,")")):(w.current.style.flexDirection="column",w.current.style.alignItems="center",w.current.style.transform="scale(".concat(s>l?.98*l:.98*s,")"))}else{const e=M.current,a={w:w.current.clientWidth,h:w.current.clientHeight},t=a.w/e.offsetWidth,r=a.h/e.offsetHeight;w.current.style.transform="scale(".concat(t<r?.98*t:.98*r,")")}});const X=v.a.find({chartLabel:b},l),J=v.a.find({chartLabel:O},l),Q=v.a.uniq(v.a.compact([X,J]));return n.a.createElement("div",{className:"tracker-container"},n.a.createElement(Kt,null),n.a.createElement("div",{className:"sidebar"},n.a.createElement(Vt,{player:k,profile:G,label:b,trackedData:W,preferences:x,topPlayersList:o,isLeft:!0,addPopup:d}),n.a.createElement(Vt,{player:L,profile:U,label:O,trackedData:Y,preferences:I,topPlayersList:o,addPopup:d})),n.a.createElement("div",{className:"results",ref:w},(c||p)&&n.a.createElement("div",{className:"error"},p,n.a.createElement("br",null),c&&c.message),g&&!k&&!L&&!h&&!e&&v.a.isEmpty(Q)&&(null===y?n.a.createElement("div",{className:"msg"},"Waiting for recognizer..."):y?n.a.createElement("div",{className:"msg"},"Waiting for chart select..."):n.a.createElement("div",{className:"offline msg"},"Recognizer is offline")),g&&(b||O)&&!h&&!e&&v.a.isEmpty(Q)&&"No results for this chart",e&&n.a.createElement(F,null),!e&&Q.map((e,a)=>{const t=v.a.omitBy(e=>!e,v.a.getOr({},"playersHiddenStatus",x)),r=v.a.omitBy(e=>!e,v.a.getOr({},"playersHiddenStatus",I)),s=Object.keys(t).reduce((e,a)=>({...e,[a]:t[a]&&r[a]}),{});return n.a.createElement(La,{ref:0===a?M:B,playersHiddenStatus:s,key:e.sharedChartId,chart:e,leftProfile:G,rightProfile:U,isSocketView:!0})})))}));t(435);const Xt={isLoading:!1,data:{},error:null};function Jt(){const e=Object(i.c)(),[a,t]=Object(r.useState)(null),s=Object(i.d)(e=>e.tournament.data),l=Object(i.d)(e=>e.results.profiles),o=Object(i.d)(e=>e.tournament.isLoading),m=Object(i.d)(e=>v.a.get("player.id",e.user.data));if(Object(r.useEffect)(()=>{e(async e=>{e({type:"TOURNAMENT/LOADING"});try{const a=await e(j({url:"".concat(W,"/tournament/info")}));return e({type:"TOURNAMENT/SUCCESS",data:a}),a}catch(a){return e({type:"TOURNAMENT/ERROR",error:a}),null}})},[e]),Object(r.useEffect)(()=>{if(m&&!a&&v.a.get("brackets",s)){const e=v.a.find(e=>e.playerIds.includes(m),s.brackets);e&&t(e)}},[m,a,s]),o||v.a.isEmpty(l))return n.a.createElement(F,null);const{tournament:d,brackets:p}=s;if(!d)return null;const u=new Date(d.start_date),h=u.toLocaleString("default",{month:"long"}),E="".concat(u.getFullYear()," ").concat(h);return n.a.createElement("div",{className:"tournaments-page"},n.a.createElement("header",null,E),n.a.createElement("div",{className:"description"},n.a.createElement("div",{className:"labeled-item"},n.a.createElement("div",{className:"title"},"Start date:"),n.a.createElement("div",{className:"text"},new Date(d.start_date).toLocaleDateString())),n.a.createElement("div",{className:"labeled-item"},n.a.createElement("div",{className:"title"},"End date:"),n.a.createElement("div",{className:"text"},new Date(d.end_date).toLocaleDateString()))),n.a.createElement("div",{className:"brackets-title"},"Brackets:"),n.a.createElement("div",{className:"brackets"},p.map(e=>n.a.createElement("div",{key:e.name,className:M()("bracket",{active:e.name===v.a.get("name",a)}),onClick:()=>t(e)},n.a.createElement("div",{className:"bracket-name"},e.name),e.charts.map(e=>{const[a,t]=he(e.label);return n.a.createElement("div",{className:"chart",key:e.sharedChartId},n.a.createElement(ka,{type:a,level:t})," ",e.trackName)})))),a&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"results-title"},"Results:"),n.a.createElement("div",{className:"results"},n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{className:"player-name"},"player"),n.a.createElement("th",{className:"total"},"total"),a.charts.map(e=>{const[a,t]=he(e.label);return n.a.createElement("th",{colSpan:3,key:e.sharedChartId},n.a.createElement("div",{className:"chart-header"},n.a.createElement(ka,{type:a,level:t})," ",n.a.createElement(c.c,{exact:!0,to:b.sharedChart.getPath({sharedChartId:e.sharedChartId})},e.trackName)))}))),n.a.createElement("tbody",null,(()=>{const e=v.a.flow(v.a.groupBy("player_id"),v.a.mapValues(v.a.flow(v.a.map(e=>({...e,columnIndex:v.a.findIndex({sharedChartId:e.shared_chart},a.charts)})),v.a.groupBy("columnIndex"))))(a.scores),t=a.charts.map((a,t)=>({...a,maxScore:v.a.flow(v.a.values,v.a.flatMap(t),v.a.maxBy("score"),v.a.get("score"))(e)})),r=v.a.mapValues(v.a.flow(v.a.toPairs,v.a.map(([e,a])=>{const r=t[e].maxScore,n=v.a.flow(v.a.maxBy("score"),v.a.get("score"))(a),s=(n/r*100).toFixed(1);return[e,{playerName:a[0].player_name,playcount:a.length,score:n,percent:s,percentRaw:n/r}]}),e=>{const a=v.a.sumBy("[1].percentRaw",e);return{infoByIndex:v.a.fromPairs(e),totalPercentRaw:a,totalPercent:(100*a).toFixed(1)}}),e),s=v.a.flow(v.a.keys,v.a.orderBy(e=>r[e].totalPercentRaw,["desc"]))(r),c=v.a.remove(e=>s.includes(v.a.toString(e))||!l[e],a.playerIds);return[...s,...c].map(e=>{const t=r[e]||{},s=v.a.get("name",l[e])||t.playerName;return n.a.createElement("tr",{key:e},n.a.createElement("td",{className:"player-name"},s),n.a.createElement("td",{className:"total"},t.totalPercent||0),a.charts.map((e,a)=>{const r=t.infoByIndex&&t.infoByIndex[a];return n.a.createElement(n.a.Fragment,{key:a},n.a.createElement("td",null,r&&"".concat(r.percent,"%")),n.a.createElement("td",null,r&&pa()(r.score).format("0,0")),n.a.createElement("td",null,r&&r.playcount))}))})})())))))}const Qt={isLoading:!1,data:[]};const Zt=()=>async e=>{e({type:"TRACKLIST/LOADING"});try{const a=await e(j({url:"".concat(W,"/tracklist/stats/XX")}));return e({type:"TRACKLIST/SUCCESS",data:a}),a}catch(a){return e({type:"TRACKLIST/ERROR",error:a}),null}},$t={isLoading:!1,data:null,error:null};y.a.setAppElement("#root");var er=function(){const e=Object(i.c)(),a=Object(i.d)(e=>e.user.data),t=Object(i.d)(e=>e.user.isLoading);return Object(r.useEffect)(()=>{Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET||(e(kt()),g.a.getItem("filter").then(a=>{a&&e(Ze({...v.a.omit("song",a),chartRange:a.chartRange&&{...a.chartRange,range:v.a.every(e=>e>=x[0]&&e<=x[1],a.chartRange.range)?a.chartRange.range:x}}))}).catch(e=>console.error("Cannot get filter from local storage",e)))},[e]),Object(r.useEffect)(()=>{!Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET&&a&&a.player&&Promise.all([e(async e=>{e({type:"PLAYERS/LOADING"});try{const a=await e(j({url:"".concat(W,"/players")}));return e({type:"PLAYERS/SUCCESS",data:a.players}),a.players}catch(a){return e({type:"PLAYERS/ERROR",error:a}),null}}),e(Zt()),e(async e=>{e({type:"PREFERENCES/LOADING"});try{const a=await e(j({url:"".concat(W,"/profile/preferences")}));return e({type:"PREFERENCES/SUCCESS",data:a.preferences}),a}catch(a){return e({type:"PREFERENCES/ERROR",error:a}),null}})]).then(()=>{e(xa())})},[e,a]),Object(r.useEffect)(()=>{Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET&&e(Zt()).then(()=>{e(Je())})},[e]),t?n.a.createElement("div",{className:"container"},n.a.createElement(F,null)):Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET?n.a.createElement(zt,null):a&&a.player?n.a.createElement("div",{className:"container"},n.a.createElement(Ct,null),n.a.createElement(h.b,{exact:!0,path:"/",render:()=>n.a.createElement(h.a,{to:b.path})}),n.a.createElement(h.b,{exact:!0,path:b.path,component:Ga}),n.a.createElement(h.b,{exact:!0,path:b.sharedChart.path,component:Ga}),n.a.createElement(h.b,{path:O.path,component:Xa}),n.a.createElement(h.b,{path:k.path},n.a.createElement(h.d,null,n.a.createElement(h.b,{path:k.path,exact:!0,component:pt}),n.a.createElement(h.b,{path:k.resultsByLevel.path,exact:!0,component:Et}),n.a.createElement(h.b,{path:k.resultsByLevel.level.path,exact:!0,component:Et}),n.a.createElement(h.b,{path:k.compare.path,exact:!0,component:Ot}))),n.a.createElement(h.b,{path:S.path,component:Se}),n.a.createElement(h.b,{path:R.path,component:Jt})):n.a.createElement(Dt,null)},ar=t(32),tr=t(113),rr=Object(ar.c)({mostPlayed:function(e=Y,a){switch(a.type){case"MOST_PLAYED/LOADING":return{...e,isLoading:!0};case V:return{...e,isLoading:!1,error:a.error};case"MOST_PLAYED/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},mostPlayedMonth:function(e=q,a){switch(a.type){case"MOST_PLAYED_MONTH/LOADING":return{...e,isLoading:!0};case"MOST_PLAYED_MONTH/ERROR":return{...e,isLoading:!1,error:a.error};case"MOST_PLAYED_MONTH/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},leastPlayed:function(e=z,a){switch(a.type){case"LEAST_PLAYED/LOADING":return{...e,isLoading:!0};case"LEAST_PLAYED/ERROR":return{...e,isLoading:!1,error:a.error};case"LEAST_PLAYED/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}}});const nr=Object(ar.c)({charts:function(e=Ca,a){switch(a.type){case"CHARTS_LOADING":return{...e,isLoading:!0};case"CHARTS_LOADING_FINISH":return{...e,isLoading:!1};case"SET_CHARTS":return{...e,data:a.data,lastUpdatedOn:a.lastUpdatedOn};case"RESET_CHARTS":return Ca;default:return e}},login:function(e=Pt,a){switch(a.type){case"LOGIN/LOADING":return{...e,isLoading:!0,data:null,error:null};case"LOGIN/ERROR":return{...e,isLoading:!1,error:a.error,data:null};case"LOGIN/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},players:function(e=$t,a){switch(a.type){case"PLAYERS/LOADING":return{...e,isLoading:!0,error:null};case"PLAYERS/ERROR":return{...e,isLoading:!1,error:a.error,data:{}};case"PLAYERS/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},popups:function(e=Ht,a){switch(a.type){case"POPUPS/ADD":const t=v.a.uniqueId("popup");return{...e,popups:[...e.popups,{id:t,type:a.popupType,...v.a.pick(["parameters","fadeIn","fadeOut","timeout","persistent"],a)}]};case"POPUPS/REMOVE":return{...e,popups:v.a.remove({id:a.id},e.popups)};default:return e}},preferences:function(e=Va,a){switch(a.type){case"PREFERENCES/LOADING":return{...e,isLoading:!0,error:null};case"PREFERENCES/ERROR":return{...e,isLoading:!1,error:a.error,data:Wa};case"PREFERENCES/SUCCESS":return{...e,isLoading:!1,data:v.a.merge(Wa,a.data)};case"PREFERENCES/CHANGE":return{data:a.data};default:return e}},presets:function(e=ta,a){switch(a.type){case"PRESETS/LOAD_PRESETS":const t=v.a.find({name:v.a.get("name",e.currentPreset)},a.presets);return{...e,currentPreset:ra(t)||null,presets:v.a.map(ra,a.presets)};case"PRESETS/SELECT_PRESET":return{...e,currentPreset:ra(a.currentPreset)};case"PRESETS/LOADING_START":return{...e,isLoading:!0};case"PRESETS/LOADING_END":return{...e,isLoading:!1};default:return e}},profiles:function(e=at,a){switch(a.type){case"PROFILES/SET_FILTER":return{...e,filter:a.filter};case"PROFILES/RESET_FILTER":return{...e,filter:et};default:return e}},results:function(e=Xe,a){switch(a.type){case"TOP/LOADING":return{...e,isLoading:!0};case"TOP/STOP_LOADING":return{...e,isLoading:!1};case"TOP/ERROR":return{...e,isLoading:!1,error:a.error,data:Xe.data,players:Xe.players,profiles:Xe.profiles,results:Xe.results,sharedCharts:Xe.sharedCharts,scoreInfo:{}};case"TOP/SUCCESS":return{...e,isLoading:!1,isLoadingRanking:!0,data:a.data,players:a.players,profiles:a.profiles,results:a.results,sharedCharts:a.sharedCharts,originalData:a.originalData,scoreInfo:{}};case"TOP/PROFILES_UPDATE":return{...e,isLoadingRanking:!1,profiles:a.profiles,resultInfo:a.resultInfo,sharedCharts:a.sharedCharts,data:v.a.values(a.sharedCharts)};case"TOP/SET_FILTER":return{...e,filter:a.filter};case"TOP/RESET_FILTER":return{...e,filter:ze};case"TOP/RANKING_CHANGE_SET":const t=!v.a.isEmpty(a.listPrev);return{...e,profiles:v.a.mapValues(e=>{const r={...e,prevRating:v.a.get(e.id,a.rankingsPointsMap)};return t?v.a.includes(r.id,a.listPrev)?v.a.includes(r.id,a.listNow)?{...r,change:v.a.indexOf(r.id,a.listPrev)-v.a.indexOf(r.id,a.listNow)}:{...r,change:"?"}:{...r,change:"NEW"}:r},e.profiles)};default:return e}},topPerSong:function(e=Wt,a){switch(a.type){case"TOP_PER_SONG/LOADING":return{...e,isLoading:!0,fetchingParams:a.fetchingParams,data:null,error:null};case"TOP_PER_SONG/ERROR":return a.fetchingParams===e.fetchingParams?{...e,isLoading:!1,error:a.error,data:null,fetchingParams:null}:e;case"TOP_PER_SONG/SUCCESS":return a.fetchingParams===e.fetchingParams?{...e,isLoading:!1,data:a.data,fetchingParams:null}:e;default:return e}},tournament:function(e=Xt,a){switch(a.type){case"TOURNAMENT/LOADING":return{...e,isLoading:!0,error:null};case"TOURNAMENT/ERROR":return{...e,isLoading:!1,error:a.error,data:{}};case"TOURNAMENT/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},tracklist:function(e=Qt,a){switch(a.type){case"TRACKLIST/LOADING":return{...e,isLoading:!0};case"TRACKLIST/ERROR":return{...e,isLoading:!1,error:a.error};case"TRACKLIST/SUCCESS":return{...e,isLoading:!1,data:a.data};default:return e}},trackStats:rr,user:function(e=Rt,a){switch(a.type){case"USER/LOADING":return{...e,isLoading:!0,data:null};case"USER/ERROR":return{...e,isLoading:!1,error:a.error,data:null};case"USER/SUCCESS":return{...e,isLoading:!1,data:a.data};case"USER/RESET":return Rt;default:return e}}}),sr=Object(ar.e)(nr,(window.__REDUX_DEVTOOLS_EXTENSION__,Object(ar.a)(tr.a)));l.a.render(n.a.createElement(p.Provider,{value:d},n.a.createElement(i.a,{store:sr},n.a.createElement(c.a,null,n.a.createElement(er,null)))),document.getElementById("root"))},77:function(e,a,t){var r=t(262),n=["getProcessedProfiles"];e.exports=function(){var e=new Worker(t.p+"59428aa818000367af89.worker.js",{name:"[hash].worker.js"});return r(e,n),e}}},[[214,1,2]]]);
//# sourceMappingURL=main.003aa045.chunk.js.map