(this["webpackJsonppiu-spy-web-2"]=this["webpackJsonppiu-spy-web-2"]||[]).push([[0],{179:function(e,t,a){var r=a(269),n=["getProcessedProfiles"];e.exports=function(){var e=new Worker(a.p+"49b18c24eacf8a5262f6.worker.js",{name:"[hash].worker.js"});return r(e,n),e}},228:function(e,t,a){e.exports=a(445)},233:function(e,t){Number.isNaN=Number.isNaN||function(e){return e!==e},"undefined"===typeof Math.sign&&(Math.sign=function(e){return e>0?1:e<0?-1:e}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),a=t.length>>>0;if("function"!==typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],n=0;n<a;){var s=t[n];if(e.call(r,s,n,t))return n;n++}return-1},configurable:!0,writable:!0})},242:function(e,t,a){},248:function(e,t,a){},249:function(e,t,a){},250:function(e,t,a){},261:function(e,t,a){},263:function(e,t,a){},264:function(e,t,a){},265:function(e,t,a){},266:function(e,t,a){},273:function(e,t,a){},428:function(e,t,a){},429:function(e,t,a){},430:function(e,t,a){},431:function(e,t,a){},441:function(e,t,a){},444:function(e,t,a){},445:function(e,t,a){"use strict";a.r(t);a(229),a(232),a(233);var r=a(1),n=a.n(r),s=a(14),l=a.n(s),c=a(18),o=a(13),i=(a(242),a(9)),m=a(49),d=a(17),p=a.n(d),u=a(2),h=a.n(u);a(247),a(248);const g={leaderboard:{path:"/leaderboard"},songs:{path:"/songs"},ranking:{path:"/ranking",faq:{path:"/ranking/faq"}},profile:{path:"/profiles/:id",getPath:e=>"/profiles/".concat(e.id),compare:{path:"/profiles/:id/vs/:compareToId",getPath:e=>"/profiles/".concat(e.id,"/vs/").concat(e.compareToId)}}};var f={DEFAULT:"default",PROTAGONIST:"protagonist",RANK_ASC:"rankAsc",RANK_DESC:"rankDesc",NEW_SCORES_PLAYER:"newScoresPlayer"},b=[1,28],E={STD:"Standard",SHORT:"Short",REMIX:"Remix",FULL:"Full"},y=h.a.values(E),v=a(11),O=a(10),N=a(5),k=a.n(N);a(249),a(250);function P(){return n.a.createElement("div",{className:"loader"},n.a.createElement("svg",{width:"40",height:"12",viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:"#eee"},n.a.createElement("circle",{cx:"15",cy:"15",r:"15"},n.a.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})),n.a.createElement("circle",{cx:"60",cy:"15",r:"9",fillOpacity:"0.3"},n.a.createElement("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"0.5",to:"0.5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})),n.a.createElement("circle",{cx:"105",cy:"15",r:"15"},n.a.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.a.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"}))))}var S=a(85),w=a.n(S);const j="USER/RESET",x=()=>({type:j});function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function D(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const L=({url:e})=>A({url:e,method:"get"}),I=({url:e,body:t})=>A({url:e,method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json;charset=utf-8"}}),C={},A=({url:e,method:t,body:a,headers:r})=>async(n,s)=>{try{const n=w.a.get("session");n&&(C.Session=n);const s=await fetch(e,{method:t,body:a,headers:D({},C,{},r),credentials:"include"});if(s.status>=200&&s.status<300){return await s.json()}{const e=await s.json();throw h.a.isObject(e)&&h.a.isString(e.error)?new Error(e.error):h.a.isString(e)?new Error(e):new Error("HTTP Status "+s.status)}}catch(l){return"Invalid session"===l.message&&n(x()),Promise.reject(l)}},_="https://vps720616.ovh.net:5000",T="ws://127.0.0.1:6789";function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const B="MOST_PLAYED/LOADING",K="MOST_PLAYED/SUCCESS",W="MOST_PLAYED/ERROR",G={isLoading:!1,data:[]};function H(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function U(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?H(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const q="MOST_PLAYED_MONTH/LOADING",V="MOST_PLAYED_MONTH/SUCCESS",z="MOST_PLAYED_MONTH/ERROR",J={isLoading:!1,data:[]};function Y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Z="LEAST_PLAYED/LOADING",Q="LEAST_PLAYED/SUCCESS",$="LEAST_PLAYED/ERROR",ee={isLoading:!1,data:[]};var te=a(449),ae=a(86),re=a.n(ae),ne=a(448),se=a(40),le=a.n(se);te.a.addLocale(re.a);const ce=new te.a("ru-RU"),oe={flavour:"long",gradation:ne.a,units:["day","week","month"]},ie=e=>{if(e.isExactDate)return e.dateObject.toLocaleDateString();{const t=void 0===e.isMyBest&&void 0===e.isMachineBest?"\u0441 my best \u0438\u043b\u0438 machine best":e.isMyBest?"\u0441 my best":e.isMachineBest?"\u0441 machine best":"\u0445\u0437 \u043e\u0442\u043a\u0443\u0434\u0430";return n.a.createElement("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"}},n.a.createElement("div",null,"\u0442\u043e\u0447\u043d\u0430\u044f \u0434\u0430\u0442\u0430 \u0432\u0437\u044f\u0442\u0438\u044f \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430"),n.a.createElement("div",null,"\u0441\u043a\u043e\u0440 \u0431\u044b\u043b \u0437\u0430\u043f\u0438\u0441\u0430\u043d ",t),n.a.createElement("div",null,"\u0434\u0430\u0442\u0430 \u0437\u0430\u043f\u0438\u0441\u0438: ",e.dateObject.toLocaleDateString()))}},me=e=>{const t=le()().startOf("day").diff(le()(e).startOf("day"),"days"),a=le()(e).hour();return le()().hour()<5?t<=1?"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":ce.format(e,oe):0===t?a<5?"\u0432\u0447\u0435\u0440\u0430 \u043d\u043e\u0447\u044c\u044e":"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":1===t?"\u0432\u0447\u0435\u0440\u0430":ce.format(e,oe)},de=e=>"string"===typeof e?le()(e,"YYYY-MM-DD HH:mm:ss").toDate():new Date(e);function pe({fetchList:e,title:t,renderRightSide:a}){const s=Object(r.useState)([]),l=Object(v.a)(s,2),c=l[0],o=l[1],i=Object(r.useState)(!1),m=Object(v.a)(i,2),d=m[0],p=m[1],u=a||(e=>n.a.createElement("div",{className:"playcount"},n.a.createElement(O.l,null),n.a.createElement("span",null,e.countplay)));return Object(r.useEffect)(()=>{p(!0),e().then(e=>{e.success&&o(e.data),p(!1)}).catch(()=>{p(!1)})},[e]),n.a.createElement("div",{className:"top-songs-list"},n.a.createElement("div",{className:"top-songs-header"},n.a.createElement("span",null,t)),d&&n.a.createElement(P,null),!d&&c.map((e,t)=>n.a.createElement("div",{key:e.id,className:"top-songs-item"},n.a.createElement("div",{className:k()("place","top-".concat(t+1),{best:t<3})},n.a.createElement("span",null,t+1,".")),n.a.createElement("div",{className:"song-name"},e.full_name),u(e))))}const ue=e=>n.a.createElement("div",{className:"date"},n.a.createElement("span",null,e.last_play?me(de(e.last_play)):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430"));var he=Object(o.b)(null,{fetchMostPlayed:()=>async e=>{e({type:B});try{const t=await e(L({url:"".concat(_,"/track-stats/most-played")}));return e({type:K,data:t}),t}catch(t){return e({type:W,error:t}),null}},fetchMostPlayedMonth:()=>async e=>{e({type:q});try{const t=await e(L({url:"".concat(_,"/track-stats/most-played-month")}));return e({type:V,data:t}),t}catch(t){return e({type:z,error:t}),null}},fetchLeastPlayed:()=>async e=>{e({type:Z});try{const t=await e(L({url:"".concat(_,"/track-stats/most-time-not-played")}));return e({type:Q,data:t}),t}catch(t){return e({type:$,error:t}),null}}})((function({fetchMostPlayed:e,fetchMostPlayedMonth:t,fetchLeastPlayed:a}){return n.a.createElement("div",{className:"songs-top-page"},n.a.createElement(pe,{fetchList:e,title:"\u0442\u043e\u043f \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0445 \u0442\u0440\u0435\u043a\u043e\u0432"}),n.a.createElement(pe,{fetchList:t,title:"\u0442\u043e\u043f \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0445 \u0442\u0440\u0435\u043a\u043e\u0432 \u0437\u0430 \u043c\u0435\u0441\u044f\u0446"}),n.a.createElement(pe,{fetchList:a,title:"\u0442\u0440\u0435\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u043e\u043b\u0433\u043e \u043d\u0435 \u0438\u0433\u0440\u0430\u043b\u0438",renderRightSide:ue}),n.a.createElement("div",{className:"top-songs-list -placeholder"}))})),ge=a(35),fe=a(58),be=a.n(fe),Ee=a(67),ye=a.n(Ee),ve=a(182),Oe=(a(261),a(26)),Ne=a(27),ke=a(29),Pe=a(28),Se=a(52),we=a(30),je=a(199),xe=a(178),Re=(a(263),{preventOverflow:{enabled:!0,padding:10,boundariesElement:"viewport"}}),De={right:"left",left:"right",top:"bottom",bottom:"top"},Le=function(e){return e&&De[e.split("-")[0]]},Ie=function(e){function t(){var e;return Object(Oe.a)(this,t),(e=Object(ke.a)(this,Object(Pe.a)(t).call(this))).state={isVisible:!1},e.containerItemRef=n.a.createRef(),e.renderPopper=e.renderPopper.bind(Object(Se.a)(e)),e.toggleOverlayVisibility=e.toggleOverlayVisibility.bind(Object(Se.a)(e)),e}return Object(we.a)(t,e),Object(Ne.a)(t,[{key:"hideOverlay",value:function(){this.setState({isVisible:!1})}},{key:"toggleOverlayVisibility",value:function(){this.setState({isVisible:!this.state.isVisible})}},{key:"handleClickOutside",value:function(e){e&&e.target.closest(".inner-popper-overlay")||this.hideOverlay()}},{key:"renderPopper",value:function(e){var t=e.ref,a=e.style,r=e.placement,s=e.arrowProps,l=(e.scheduleUpdate,e.outOfBoundaries),c=this.props,o=c.children,i=c.hideWhenOutOfBounds;return n.a.createElement("div",{ref:t,style:a,"data-placement":r,className:k()("inner-popper-overlay","arrow-".concat(Le(r)),this.props.overlayClassName,{"out-of-bounds":l&&i})},n.a.createElement("div",{className:"arrow-hider"},n.a.createElement("div",{className:"arrow",ref:s.ref,style:s.style})),n.a.createElement("div",{className:"inner-popper-content"},o))}},{key:"render",value:function(){var e=this.props,t=e.placement,a=e.overlayItem,r=this.state.isVisible;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"overlay-item",ref:this.containerItemRef,onClick:this.toggleOverlayVisibility},a),r&&l.a.createPortal(n.a.createElement(je.a,{container:document.body,modifiers:Re,placement:t,referenceElement:this.containerItemRef.current},this.renderPopper),document.body))}}]),t}(n.a.PureComponent);Ie.defaultTypes={placement:"bottom"};var Ce=Object(xe.a)(Ie),Ae=(a(264),function(e){function t(){return Object(Oe.a)(this,t),Object(ke.a)(this,Object(Pe.a)(t).apply(this,arguments))}return Object(we.a)(t,e),Object(Ne.a)(t,[{key:"render",value:function(){var e=this.props,t=e.active,a=e.onToggle,r=e.text;return n.a.createElement("div",{className:k()("toggle-button",{active:t}),onClick:function(){return a(!t)}},r)}}]),t}(n.a.PureComponent)),_e=function(e){function t(e){var a;return Object(Oe.a)(this,t),(a=Object(ke.a)(this,Object(Pe.a)(t).call(this,e))).state={value:(h.a.isNil(e.value)?e.defaultValue:e.value)||""},h.a.bindAll(["handleChange","handleBlur","handleKeyPress"],Object(Se.a)(a)),a}return Object(we.a)(t,e),Object(Ne.a)(t,[{key:"componentDidUpdate",value:function(e){e.value!==this.props.value&&this.setState({value:this.props.value})}},{key:"handleChange",value:function(e){var t=this,a=e.target.value;this.setState({value:a},(function(){return t.props.onChange(a)}))}},{key:"handleBlur",value:function(e){var t=this.props.type,a=this.state.value;if("number"===t){var r=Number(a);r>=Number(e.target.min)&&r<=Number(e.target.max)?this.props.onBlur(r,e):(this.setState({value:this.props.value}),this.props.onBlur(this.props.value,e))}}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&this.handleBlur(e)}},{key:"render",value:function(){var e=this.props.className;return n.a.createElement("input",Object.assign({},h.a.omit(["defaultValue","onChange"],this.props),{className:k()(e,"text-input"),value:this.state.value,onBlur:this.handleBlur,onKeyPress:this.handleKeyPress,onInput:this.handleChange,onChange:h.a.noop}))}}]),t}(n.a.Component);_e.defaultProps={value:null,type:"text",onChange:h.a.noop,onBlur:h.a.noop};a(265);var Te=function(e){function t(){var e;return Object(Oe.a)(this,t),(e=Object(ke.a)(this,Object(Pe.a)(t).call(this))).onChange=function(t){e.props.onChange(t.target.checked)},e.id=h.a.uniqueId(),e}return Object(we.a)(t,e),Object(Ne.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"toggle-checkbox"},n.a.createElement("input",{type:"checkbox",className:"toggle-checkbox-cb",id:this.id,onChange:this.onChange,checked:this.props.checked}),n.a.createElement("label",{htmlFor:this.id,className:"toggle"},n.a.createElement("span",null)),n.a.createElement("label",{htmlFor:this.id,className:"text-label"},this.props.children))}}]),t}(n.a.Component),Fe=(a(266),function(e){function t(e){var a;return Object(Oe.a)(this,t),(a=Object(ke.a)(this,Object(Pe.a)(t).call(this))).state={open:e.defaultOpen||!1},a}return Object(we.a)(t,e),Object(Ne.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.children,r=t.title,s=t.className,l=this.state.open;return n.a.createElement("div",{className:k()("collapsible-bar",s,{open:l})},n.a.createElement("div",{className:"header",onClick:function(){return e.setState((function(e){return{open:!e.open}}))}},n.a.createElement("div",{className:"collapse-button"},n.a.createElement(O.f,null)),n.a.createElement("div",{className:"title"},r)),a&&n.a.createElement("div",{className:"collapsible-children"},a))}}]),t}(r.PureComponent)),Me=a(24),Be=a(116);function Ke(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function We(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ke(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ge(e){var t=e.range,a=e.min,r=e.max,s=e.onChange;return n.a.createElement(Be.Range,{values:t,step:1,min:a,max:r,onChange:s,renderTrack:function(e){var s=e.props,l=e.children;return n.a.createElement("div",{onMouseDown:s.onMouseDown,onTouchStart:s.onTouchStart,style:We({},s.style,{position:"relative",height:"10px",display:"flex",width:"100%"})},n.a.createElement("div",{ref:s.ref,style:{height:"6px",width:"100%",borderRadius:"3px",background:Object(Be.getTrackBackground)({values:t,colors:["#ccc","#88d3ff","#ccc"],min:a,max:r}),alignSelf:"center"}},l))},renderThumb:function(e){var t=e.props,a=e.isDragged;return n.a.createElement("div",Object.assign({},t,{style:We({},t.style,{height:"12px",width:"12px",borderRadius:"6px",backgroundColor:"#FFF",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0px 2px 3px #AAA"})}),n.a.createElement("div",{style:{height:"6px",width:"6px",borderRadius:"3px",backgroundColor:a?"#88d3ff":"#CCC"}}))}})}function He(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ue(e){var t=e.filterValue,a=e.onChange,r=h.a.getOr(b,"range",t),s=h.a.getOr(null,"type",t),l=h.a.getOr(y,"duration",t),c="\u0444\u0438\u043b\u044c\u0442\u0440 \u0447\u0430\u0440\u0442\u043e\u0432";if(t){var o=s||"";c="\u0447\u0430\u0440\u0442\u044b: "+(c=r[0]===r[1]?"".concat(o).concat(r[0]):"".concat(o).concat(r[0]," - ").concat(o).concat(r[1])),h.a.isEqual(l,y)||(c+=" ***")}var m=function(e){a(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?He(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):He(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({range:r,type:s},e,{duration:h.a.isEmpty(e.duration)?l:e.duration}))};return n.a.createElement("div",null,n.a.createElement(Ce,{overlayClassName:"chart-range-overlay-outer",overlayItem:n.a.createElement("button",{className:"filter-charts-button btn btn-sm btn-dark"},c)},n.a.createElement("div",{className:"chart-range-overlay"},n.a.createElement("div",{className:"buttons"},n.a.createElement(Ae,{text:"Single",active:"S"===s,onToggle:function(e){m({type:e?"S":null})}}),n.a.createElement(Ae,{text:"Double",active:"D"===s,onToggle:function(e){m({type:e?"D":null})}})),n.a.createElement(Ge,{range:r,min:b[0],max:b[1],onChange:function(e){return m({range:e})}}),n.a.createElement("div",{className:"inputs"},n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:function(){return m({range:[Math.max(r[0]-1,b[0]),r[1]]})}},n.a.createElement(O.d,null)),n.a.createElement(_e,{type:"number",className:"form-control",min:b[0],max:Math.min(b[1],r[1]),value:r[0],onBlur:function(e){m({range:[e,r[1]]})}}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:function(){var e=Math.min(r[0]+1,b[1]);m({range:[e,r[1]<e?e:r[1]]})}},n.a.createElement(O.e,null)),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:function(){var e=Math.max(r[1]-1,b[0]);m({range:[r[0]>e?e:r[0],e]})}},n.a.createElement(O.d,null)),n.a.createElement(_e,{type:"number",className:"form-control",min:Math.max(b[0],r[0]),max:b[1],value:r[1],onBlur:function(e){return m({range:[r[0],e]})}}),n.a.createElement("button",{className:"btn btn-sm btn-dark",onClick:function(){return m({range:[r[0],Math.min(r[1]+1,b[1])]})}},n.a.createElement(O.e,null))),n.a.createElement("div",{className:"buttons-duration"},n.a.createElement(Ae,{text:"Standard",active:l.includes(E.STD),onToggle:function(e){m({duration:e?[].concat(Object(Me.a)(l),[E.STD]):h.a.without([E.STD],l)})}}),n.a.createElement(Ae,{text:"Short",active:l.includes(E.SHORT),onToggle:function(e){m({duration:e?[].concat(Object(Me.a)(l),[E.SHORT]):h.a.without([E.SHORT],l)})}}),n.a.createElement(Ae,{text:"Remix",active:l.includes(E.REMIX),onToggle:function(e){m({duration:e?[].concat(Object(Me.a)(l),[E.REMIX]):h.a.without([E.REMIX],l)})}}),n.a.createElement(Ae,{text:"Full",active:l.includes(E.FULL),onToggle:function(e){m({duration:e?[].concat(Object(Me.a)(l),[E.FULL]):h.a.without([E.FULL],l)})}})))))}var qe=a(87),Ve=a.n(qe);const ze=[{threshold:0,iconName:"0.png",color:"bronze"},{threshold:1e3,iconName:"1.png",color:"bronze"},{threshold:2e3,iconName:"2.png",color:"bronze"},{threshold:3e3,iconName:"3.png",color:"bronze"},{threshold:4e3,iconName:"4.png",color:"bronze"},{threshold:5e3,iconName:"5.png",color:"bronze"},{threshold:6250,iconName:"6.png",color:"bronze"},{threshold:7500,iconName:"7.png",color:"bronze"},{threshold:8750,iconName:"8.png",color:"bronze"},{threshold:1e4,iconName:"9.png",color:"silver"},{threshold:12e3,iconName:"10.png",color:"silver"},{threshold:14e3,iconName:"11.png",color:"silver"},{threshold:16e3,iconName:"12.png",color:"silver"},{threshold:18e3,iconName:"13.png",color:"silver"},{threshold:22e3,iconName:"14.png",color:"silver"},{threshold:26e3,iconName:"15.png",color:"silver"},{threshold:3e4,iconName:"16.png",color:"silver"},{threshold:35e3,iconName:"17.png",color:"silver"},{threshold:4e4,iconName:"18.png",color:"gold"},{threshold:5e4,iconName:"19.png",color:"gold"},{threshold:6e4,iconName:"20.png",color:"gold"},{threshold:7e4,iconName:"21.png",color:"gold"},{threshold:8e4,iconName:"22.png",color:"gold"},{threshold:1e5,iconName:"23.png",color:"gold"},{threshold:12e4,iconName:"24.png",color:"gold"},{threshold:14e4,iconName:"25.png",color:"gold"},{threshold:16e4,iconName:"26.png",color:"gold"},{threshold:18e4,iconName:"27.png",color:"green"}],Je={F:.1,D:.2,"D+":.3,C:.3,"C+":.5,B:.5,"B+":.8,A:.8,"A+":1,S:1.1,SS:1.2,SSS:1.2},Ye=(e,t)=>{if(!e.isBestGradeOnChart)return 0;if("COOP"===t.chartType)return 1e3*t.chartLevel*(Je[e.grade]||.8)/8;return t.chartLevel**2.31*(Je[e.grade]||.8)/9},Xe=e=>e&&n.a.createElement("img",{className:e.color,src:"".concat(".","/ranks/").concat(e.iconName),alt:e.threshold});var Ze=a(25),Qe={"500 \u043a\u043e\u043c\u0431\u043e":{icon:Ze.e,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 500+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:function(e,t,a){return{progress:100===a.progress?100:e.combo>=500?100:0}}},"1000 \u043a\u043e\u043c\u0431\u043e":{icon:Ze.f,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 1000+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:function(e,t,a){return{progress:100===a.progress?100:e.combo>=1e3?100:0}}},"2000 \u043a\u043e\u043c\u0431\u043e":{icon:Ze.g,description:"\u0417\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 2000+ \u043a\u043e\u043c\u0431\u043e \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0447\u0430\u0440\u0442\u0435",resultFunction:function(e,t,a){return{progress:100===a.progress?100:e.combo>=2e3?100:0}}},"\u041c\u0430\u0441\u0442\u0435\u0440 \u0444\u0438\u043d\u0433\u0435\u0440\u0438\u043d\u0433\u0430":{icon:Ze.i,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c \u0432\u0441\u0435 Fingers \u0442\u0440\u0435\u043a\u0438",initialState:{progress:0,playedSongs:[],songsToPlay:["Monkey Fingers","Kimchi Fingers","Monkey Fingers 2","Money Fingers"]},resultFunction:function(e,t,a){var r=a.songsToPlay.includes(t.song)?h.a.uniq([].concat(Object(Me.a)(a.playedSongs),[t.song])):a.playedSongs;return{playedSongs:r,songsToPlay:a.songsToPlay,progress:100*r.length/a.songsToPlay.length}}},"8-bit":{icon:Ze.h,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c Seize My Day, Tales of Pumpnia \u0438 Pumptris (8bit ver.)",initialState:{progress:0,playedSongs:[],songsToPlay:["Seize My Day","Tales of Pumpnia","Pumptris (8bit ver.)"]},resultFunction:function(e,t,a){var r=a.songsToPlay.includes(t.song)?h.a.uniq([].concat(Object(Me.a)(a.playedSongs),[t.song])):a.playedSongs;return{playedSongs:r,songsToPlay:a.songsToPlay,progress:100*r.length/a.songsToPlay.length}}},"Love is...":{icon:Ze.b,description:"\u0421\u044b\u0433\u0440\u0430\u0442\u044c \u0432\u0441\u0435 Love is a Danger Zone \u0442\u0440\u0435\u043a\u0438",initialState:{progress:0,playedSongs:[],songsToPlay:["Love is a Danger Zone","Love is a Danger Zone [SHORT]","Love is a Danger Zone (Cranky Mix)","Love is a Danger Zone 2","Love is a Danger Zone 2 [SHORT]","Love is a Danger Zone 2 [FULL]","Love is a Danger Zone 2 (D&G Ver.)","Love is a Danger Zone (try to B.P.M.)"]},resultFunction:function(e,t,a){var r=a.songsToPlay.includes(t.song)?h.a.uniq([].concat(Object(Me.a)(a.playedSongs),[t.song])):a.playedSongs;return{playedSongs:r,songsToPlay:a.songsToPlay,progress:100*r.length/a.songsToPlay.length}}},"\u0423\u043b\u0438\u0442\u043a\u0430":{icon:Ze.j,description:"\u041c\u0430\u0441\u0442\u0435\u0440 \u0437\u0430\u043c\u0435\u0434\u043b\u0435\u043d\u0438\u0439: \u0441\u044b\u0433\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u0448\u0438\u0435 \u0447\u0430\u0440\u0442\u044b Twist of Fate, Karyawisata, Awakening \u0438 Moonlight",initialState:{progress:0,playedSongs:[],songsToPlay:[{song:"Twist of Fate (feat. Ruriling)",charts:["D20","S19"]},{song:"Karyawisata",charts:["S20","D16"]},{song:"Awakening",charts:["S19","D20"]},{song:"Moonlight",charts:["S19","D21"]}]},resultFunction:function(e,t,a){var r=a.songsToPlay.some((function(e){return t.song===e.song&&e.charts.includes(t.chartLabel)}))?h.a.uniq([].concat(Object(Me.a)(a.playedSongs),[t.song])):a.playedSongs;return{playedSongs:r,songsToPlay:a.songsToPlay,progress:100*r.length/a.songsToPlay.length}}},"\u041a\u043e\u0440\u0438\u0447\u043d\u0435\u0432\u0430\u044f S":{icon:Ze.c,description:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c S, \u043d\u043e 5+ \u0431\u044d\u0434\u043e\u0432",resultFunction:function(e,t,a){return{progress:100===a.progress?100:0===e.miss&&e.bad>=5?100:0}}},"\u041c\u044b \u0432\u044b\u0436\u0438\u0432\u0430\u043b\u0438 \u043a\u0430\u043a \u043c\u043e\u0433\u043b\u0438":{icon:Ze.a,description:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c B \u0438\u043b\u0438 \u043d\u0438\u0436\u0435, \u043d\u043e \u0443\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043b\u0430\u0439\u0444\u0431\u0430\u0440",resultFunction:function(e,t,a){return{progress:100===a.progress?100:["B+","C+","D+"].includes(e.grade)?100:0}}},"\u041f\u0430\u0434\u043e\u0432\u044b\u0439 \u043c\u0438\u0441\u0441":{icon:Ze.k,description:"\u041a\u043e\u0433\u0434\u0430 \u043e\u0442 SSS \u0442\u0435\u0431\u044f \u0443\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043c\u0438\u0441\u0441\u044b \u0438\u0437-\u0437\u0430 \u043f\u043b\u043e\u0445\u043e\u0433\u043e \u043c\u043e\u0434\u0434\u0438\u043d\u0433\u0430 \u043f\u0430\u0434\u043e\u0432",resultFunction:function(e,t,a){return{progress:100===a.progress?100:e.miss>0&&0===e.bad&&0===e.good&&0===e.great?100:0}}}},$e={progress:0};const et=(e,t)=>"SSS"===t?e-3e5:"SS"===t?e-15e4:"S"===t?e-1e5:e;var tt=a(179),at=a.n(tt);const rt=(e,t)=>{return h.a.mapValues(e=>{const a=["A","A+","S","SS","SSS"];e.expRank=h.a.findLast(t=>t.threshold<=e.exp,ze),e.expRankNext=h.a.find(t=>t.threshold>e.exp,ze),e.progress={double:{SS:{},S:{},"A+":{},A:{}},single:{SS:{},S:{},"A+":{},A:{}}};const r={SSS:["SS","S","A+","A"],SS:["SS","S","A+","A"],S:["S","A+","A"],"A+":["A+","A"],A:["A"]};return h.a.keys(e.resultsByLevel).forEach(t=>{e.resultsByLevel[t].forEach(n=>{const s=n.result.grade,l=n.result.playerId,c=n.chart.results.filter(e=>e.playerId===l);if(c.length>1){if(c.sort((e,t)=>a.indexOf(t.grade)-a.indexOf(e.grade))[0].grade!==s)return}const o=r[s];o&&o.forEach(a=>{((t,a,r)=>{const n="S"===r||"SP"===r?e.progress.single:"D"===r||"DP"===r?e.progress.double:null;n&&(n[a][t]=n[a][t]?n[a][t]+1:1)})(t,a,n.chart.chartType)})})}),["single","double"].forEach(a=>{e.progress["".concat(a,"-bonus")]=0,h.a.keys(e.progress[a]).forEach(r=>{e.progress[a]["".concat(r,"-bonus")]=0,h.a.keys(e.progress[a][r]).forEach(n=>{const s=e.progress[a][r][n],l=(e=>Math.round(Math.min(e,1+e/20+.7*Math.sqrt(Math.max(e-1,0)))))(t.data["".concat(a,"sLevels")][n]),c=Math.min(1,s/l),o=(e=>30*(1+2**(e/4))/11)(n)*c;e.progress[a][r]["".concat(n,"-bonus")]=o,e.progress[a][r]["".concat(n,"-bonus-coef")]=c,e.progress[a][r]["".concat(n,"-min-number")]=l,e.progress[a][r]["".concat(n,"-achieved-number")]=s,o>=e.progress[a]["".concat(r,"-bonus")]&&(e.progress[a]["".concat(r,"-bonus")]=o,e.progress[a]["".concat(r,"-bonus-level")]=n,e.progress[a]["".concat(r,"-bonus-level-coef")]=c,e.progress[a]["".concat(r,"-bonus-level-min-number")]=l,e.progress[a]["".concat(r,"-bonus-level-achieved-number")]=s)}),e.progress["".concat(a,"-bonus")]+=e.progress[a]["".concat(r,"-bonus")]})}),e.progress.bonus=e.progress["double-bonus"]+e.progress["single-bonus"],e.achievementBonus=e.progress.bonus,e.accuracy=e.countAcc>0?Math.round(e.sumAccuracy/e.countAcc*100)/100:null,e},e)},nt=({profiles:e,sharedCharts:t,tracklist:a})=>{const r=(({profiles:e,sharedCharts:t})=>{const a={};for(const r in t){const n=t[r],s=n.results,l=Number(n.chartLevel)**2.2/7;if(n.maxNonRankScore){const t=n.maxNonRankScore;for(const r of s)if(!r.isRank&&r.accuracyRaw&&r.grade&&t){let s={SSS:1,SS:.97,S:.95,"A+":.9,A:.84,B:.77,C:.63,D:.4,F:0}[r.grade];s=void 0===s?.4:s;const c=Math.max(0,Math.min(1,r.scoreRaw/t-.3)/.7),o=s*c,i=o*l;a[r.id]={pp:{pp:i,k:o,kX:{K2:s,K3:c},maxScore:t,maxPP:l,ppPotential:l-i,ppRatio:i/l,ppFixed:Number(i.toFixed(1))}};const m=e[r.playerId];m&&(m.pp||(m.pp={scores:[],pp:0}),m.pp.scores.push({pp_:Number(i.toFixed(1)),s:n.song,l:n.chartLabel,pp:i,result:r,chart:n,k:{K2:s,K3:c,K:o}}))}}}for(const r in e){const t=e[r];t.pp?(t.pp.scores.sort((e,t)=>t.pp-e.pp),t.pp.pp=0,t.pp.scores.forEach((e,a)=>{t.pp.pp+=.95**a*e.pp}),t.ratingRaw=t.pp.pp):t.ratingRaw=0,t.id=h.a.toInteger(r),t.accuracy=t.countAcc>0?Math.round(t.sumAccuracy/t.countAcc*100)/100:null,t.rating=Math.round(t.ratingRaw)}return{resultInfo:a,profiles:e}})({profiles:rt(e,a),sharedCharts:t}),n=r.resultInfo;return{processedProfiles:r.profiles,resultInfo:n}};localStorage&&(window.debugOn=function(){localStorage.setItem("debug",1)},window.debugOff=function(){localStorage.removeItem("debug")});var st=localStorage&&localStorage.getItem("debug");function lt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ct(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):lt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const ot="TOP/LOADING",it="TOP/SUCCESS",mt="TOP/ERROR",dt="TOP/SET_FILTER",pt="TOP/RESET_FILTER",ut="TOP/RANKING_CHANGE_SET",ht="TOP/PROFILES_UPDATE",gt={showRank:!0,showRankAndNorank:!0},ft={isLoading:!1,isLoadingRanking:!1,data:[],filter:gt,players:{},profiles:{},results:[],resultInfo:{},sharedCharts:{}},bt={"?":0,F:1,D:2,"D+":3,C:4,"C+":5,B:6,"B+":7,A:8,"A+":9,S:10,SS:11,SSS:12},Et=e=>0===e.misses&&0===e.bads&&0===e.goods?0===e.greats?"SSS":"SS":e.grade,yt=(e,t,a)=>{if("undefined"===typeof e.recognition_notes)return{id:e.id,isUnknownPlayer:"PUMPITUP"===t[e.player].arcade_name,isIntermediateResult:!0,sharedChartId:e.shared_chart,playerId:e.player,nickname:t[e.player].nickname,nicknameArcade:t[e.player].arcade_name,date:e.gained,dateObject:de(e.gained),grade:e.grade,isExactDate:!!e.exact_gain_date,score:e.score,scoreRaw:et(e.score,e.grade),isRank:!!e.rank_mode};let r={isUnknownPlayer:"PUMPITUP"===t[e.player].arcade_name,isIntermediateResult:!1,sharedChartId:e.shared_chart,id:e.id,playerId:e.player,nickname:t[e.player].nickname,nicknameArcade:t[e.player].arcade_name,originalChartMix:e.original_mix,originalChartLabel:e.original_label,originalScore:e.original_score,date:e.gained,dateObject:de(e.gained),grade:"?"!==e.grade?e.grade:Et(e),isExactDate:!!e.exact_gain_date,score:e.score,scoreRaw:et(e.score,e.grade),maxScore:e.max_score,scoreIncrease:e.score_increase,calories:e.calories&&e.calories/1e3,perfect:e.perfects,great:e.greats,good:e.goods,bad:e.bads,miss:e.misses,combo:e.max_combo,mods:e.mods_list,isRank:!!e.rank_mode,isHJ:(e.mods_list||"").split(" ").includes("HJ"),isMachineBest:"machine_best"===e.recognition_notes,isMyBest:"personal_best"===e.recognition_notes};((e,t)=>{if(!t)return;const a=[e.perfect,e.great,e.good,e.bad,e.miss];let r=-1,n=0,s=0;for(let l=0;l<5;++l)h.a.isNumber(a[l])?s+=a[l]:(r=l,n++);1===n&&(e[["perfect","great","good","bad","miss"][r]]=t-s)})(r,a.maxTotalSteps);const n=10*Math.sqrt(r.perfect),s=n?Math.floor((100*n+60*r.great+30*r.good+-20*r.miss)/(n+r.great+r.good+r.bad+r.miss)*100)/100:null,l=r.perfect?Math.floor((100*r.perfect+60*r.great+30*r.good+-20*r.miss)/(r.perfect+r.great+r.good+r.bad+r.miss)*100)/100:null;return r.accuracy=s<0?0:100===l?100:s&&+s.toFixed(2),r.accuracyRaw=l,r},vt=e=>e.score/e.accuracyRaw*100/(e.isRank?1.2:1),Ot=e=>e.scoreRaw/e.accuracy*100/(e.isRank?1.2:1),Nt=(e,t)=>{const a=e.playerId,r=h.a.fromPairs(Array.from({length:28}).map((e,t)=>[t+1,[]]));t[a]={name:e.nickname,nameArcade:e.nicknameArcade,resultsByGrade:{},resultsByLevel:r,lastResultDate:e.dateObject,count:0,battleCount:0,countAcc:0,grades:{F:0,D:0,C:0,B:0,A:0,S:0,SS:0,SSS:0},sumAccuracy:0,rankingHistory:[],ratingHistory:[],lastPlace:null,lastBattleDate:0},t[a].achievements=h.a.flow(h.a.keys,h.a.map(e=>[e,ct({},Qe[e].initialState||$e)]),h.a.fromPairs)(Qe),t[a].exp=0},kt=(e,t,a)=>{const r=a[e.playerId];r.count++,e.accuracy&&(r.countAcc++,r.sumAccuracy+=e.accuracy),r.grades[e.grade.replace("+","")]++,"COOP"!==t.chartType&&e.isBestGradeOnChart&&(r.resultsByGrade[e.grade]=[...r.resultsByGrade[e.grade]||[],{result:e,chart:t}],r.resultsByLevel[t.chartLevel]=[...r.resultsByLevel[t.chartLevel]||[],{result:e,chart:t}]),e.isExactDate&&r.lastResultDate<e.dateObject&&(r.lastResultDate=e.dateObject),r.achievements=h.a.mapValues.convert({cap:!1})((a,n)=>Qe[n].resultFunction(e,t,a,r),r.achievements),r.exp+=Ye(e,t)};const Pt=()=>async(e,t)=>{e({type:ot});try{const t=await e(L({url:"".concat(_,"/results/highscores")}));if(t.error)throw new Error(t.error);e(St(t))}catch(a){console.log(a),e({type:mt,error:a})}},St=e=>async(t,a)=>{const r=a().tracklist,n=((e,t)=>{const a=e.players,r=e.results,n=e.shared_charts,s=[],l=e=>"".concat(e.sharedChartId,"-").concat(e.playerId,"-").concat(e.isRank),c=e=>"".concat(e.sharedChartId,"-").concat(e.playerId),o={},i={},m={};let d={};for(let p of r){const e=p.shared_chart;if(!m[e]){const t=n[e],a=h.a.toUpper(t.chart_label),r=a.match(/(\D+)|(\d+)/g),s=Object(v.a)(r,2),l=s[0],c=s[1];m[e]={song:t.track_name,chartLabel:a,chartLevel:c,chartType:l,duration:t.duration,sharedChartId:e,maxTotalSteps:t.max_total_steps,results:[],totalResultsCount:0}}const t=m[e],r=yt(p,a,t);s.push(r);const d=l(r),u=o[d];if(!u||u.score<r.score){if(u){const e=t.results.indexOf(u);-1!==e&&t.results.splice(e,1)}const e=h.a.sortedLastIndexBy(e=>-e.score,r,t.results);r.isUnknownPlayer&&0!==e||(t.results.splice(e,0,r),t.latestScoreDate=r.date,t.totalResultsCount++,o[d]=r)}if(!r.isIntermediateResult){const e=c(r),t=i[e];(!t||bt[t.grade]<=bt[r.grade])&&(t&&(t.isBestGradeOnChart=!1),r.isBestGradeOnChart=!0,i[e]=r)}}for(let p in m){const e=m[p];e.maxScoreWithAccuracy=0,e.maxNonRankScore=0;for(let t of e.results)t.accuracyRaw&&e.maxScoreWithAccuracy<t.score&&(e.maxScoreResult=t,e.maxScoreWithAccuracy=t.score),t.accuracyRaw&&!t.isRank&&e.maxNonRankScore<t.score&&(e.maxNonRankScoreResult=t,e.maxNonRankScore=t.score),t.isUnknownPlayer||t.isIntermediateResult||(d[t.playerId]||Nt(t,d),kt(t,e,d));e.maxScoreWithAccuracy&&(e.maxScore=vt(e.maxScoreResult)),e.maxNonRankScore&&(e.maxNonRankScore=Ot(e.maxNonRankScoreResult))}return{mappedResults:s,profiles:d,sharedCharts:m}})(e),s=n.sharedCharts,l=n.mappedResults,c=n.profiles;t({type:it,data:h.a.values(s),players:h.a.flow(h.a.toPairs,h.a.map(([e,t])=>ct({},t,{id:h.a.toInteger(e)})))(e.players),results:l,profiles:c,sharedCharts:s,originalData:e});const o={sharedCharts:s,profiles:c,tracklist:r};let i,m;i=window.Worker?(m=new at.a).getProcessedProfiles(o):new Promise(e=>e(nt(o)));const d=await i,p=d.processedProfiles,u=d.resultInfo;st&&console.log("Processed profiles:",Object.values(p).filter(e=>e.pp).sort((e,t)=>t.pp.pp-e.pp.pp)),t({type:ht,profiles:p,resultInfo:u}),t(Rt(p)),m&&m.terminate()},wt=e=>({type:dt,filter:e}),jt=h.a.map("id"),xt=h.a.flow(h.a.map(e=>[e.id,e.rating]),h.a.fromPairs),Rt=e=>async(t,a)=>{try{const a=h.a.orderBy("ratingRaw","desc",h.a.values(e)),r=await Promise.all([p.a.getItem("lastChangedRanking_v3"),p.a.getItem("lastChangedRankingPoints_v3"),p.a.getItem("lastFetchedRanking_v3")]),n=Object(v.a)(r,3),s=n[0],l=n[1],c=n[2],o=jt(a),i=jt(c),m=jt(s),d=xt(a),u=xt(c);let g=xt(l);h.a.isEqual(d,u)||(p.a.setItem("lastChangedRankingPoints_v3",c),g=u);let f=m;h.a.isEqual(o,i)||(p.a.setItem("lastChangedRanking_v3",c),f=i),t({type:ut,listNow:o,listPrev:f,rankingsPointsMap:g}),p.a.setItem("lastFetchedRanking_v3",a)}catch(r){console.warn("Cannot get ranking from local storage",r)}};function Dt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Lt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Dt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var It="PRESETS/SELECT_PRESET",Ct="PRESETS/LOAD_PRESETS",At="PRESETS/LOADING_START",_t="PRESETS/LOADING_END",Tt={presets:[],currentPreset:null,isLoading:!1},Ft=function(e){return e&&Lt({},e,{label:e.name,value:e.name})};var Mt=function(e){return{type:Ct,presets:e||[]}},Bt=function(){return{type:At}},Kt=function(){return{type:_t}},Wt=function(e){return{type:It,currentPreset:e}},Gt=function(){return function(e,t){e(Bt());var a=t().presets.currentPreset,r=h.a.get("name",a);return p.a.getItem("filterPresets").then((function(t){r&&h.a.find({name:r},t)?(e(Wt(a)),e(wt(a.filter))):e(Mt(t)),e(Kt())}))}};function Ht(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var Ut=n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},n.a.createElement(O.k,null),"\u043f\u0440\u0435\u0441\u0435\u0442\u044b"),qt=function(){return"\u043f\u0443\u0441\u0442\u043e"},Vt={loadPresets:function(){return function(e,t){return e(Bt()),p.a.getItem("filterPresets").then((function(t){e(Mt(t)),e(Kt())}))}},savePreset:function(e){return function(t,a){return t(Bt()),p.a.getItem("filterPresets").then((function(r){var n=a().top.filter,s={name:e,filter:n};if(h.a.some({name:e},r)){if(window.confirm("Preset with this name already exists, replace it?")){var l=h.a.remove({name:e},r),c=[].concat(Object(Me.a)(l),[s]);t(Mt(c)),p.a.setItem("filterPresets",c)}}else{var o=[].concat(Object(Me.a)(r||[]),[s]);t(Mt(o)),t(Wt(s)),p.a.setItem("filterPresets",o)}t(Kt())}))}},openPreset:Gt,deletePreset:function(){return function(e,t){e(Bt());var a=h.a.get("name",t().presets.currentPreset);return p.a.getItem("filterPresets").then((function(t){if(h.a.find({name:a},t)&&window.confirm("Are you sure you want to delete selected preset?")){var r=h.a.remove({name:a},t);e(Mt(r)),p.a.setItem("filterPresets",r)}else e(Mt(t));e(Kt())}))}},selectPreset:Wt},zt=function(e){function t(){var e,a;Object(Oe.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(ke.a)(this,(e=Object(Pe.a)(t)).call.apply(e,[this].concat(n)))).state={},a.onChangeSelection=function(e){a.props.selectPreset(e.name)},a.onRewritePreset=function(){var e=a.props.currentPreset;a.props.savePreset(e.name)},a.onSavePreset=function(){var e=a.state.name;a.props.savePreset(e),a.setState({isAddingNew:!1})},a}return Object(we.a)(t,e),Object(Ne.a)(t,[{key:"componentDidMount",value:function(){this.props.loadPresets()}},{key:"render",value:function(){var e=this,t=this.props,a=t.presets,r=t.currentPreset,s=t.isLoading,l=this.state,c=l.name,o=l.isAddingNew;return n.a.createElement("div",null,n.a.createElement(Ce,{overlayItem:Ut},n.a.createElement("div",{className:"presets-control-overlay"},n.a.createElement(ge.a,{className:"select _margin-bottom",classNamePrefix:"select",placeholder:"\u043f\u0440\u0435\u0441\u0435\u0442\u044b...",options:a,value:r,onChange:this.props.selectPreset,noOptionsMessage:qt}),r&&n.a.createElement("div",{className:"buttons-presets _margin-bottom"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.props.openPreset,disabled:s},n.a.createElement(O.h,null)," \u043e\u0442\u043a\u0440\u044b\u0442\u044c"),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.onRewritePreset,disabled:s},n.a.createElement(O.p,null)," \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c"),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon",onClick:this.props.deletePreset,disabled:s},n.a.createElement(O.s,null)," \u0443\u0434\u0430\u043b\u0438\u0442\u044c")),!o&&n.a.createElement("div",{className:"buttons-presets _margin-bottom"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left _self-align-end",onClick:function(){return e.setState({isAddingNew:!0})},disabled:s},n.a.createElement(O.m,null)," \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c")),o&&n.a.createElement("div",{className:"adding-new _margin-bottom"},n.a.createElement(_e,{value:c,placeholder:"\u0438\u043c\u044f \u043f\u0440\u0435\u0441\u0435\u0442\u0430...",className:"form-control",onChange:function(t){return e.setState({name:t})}}),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:this.onSavePreset,disabled:!c||s},n.a.createElement(O.p,null)," \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:function(){return e.setState({isAddingNew:!1})},disabled:s},"\u043e\u0442\u043c\u0435\u043d\u0430")))))}}]),t}(n.a.Component),Jt=Object(o.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ht(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e.presets)}),Vt)(zt),Yt=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"],Xt=a(44),Zt=a(180);function Qt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function $t(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Qt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const ea=Object(Xt.a)(e=>e.results.players,e=>e.user.data.player.id,(e,t)=>h.a.flow(h.a.toPairs,h.a.map(([,{nickname:e,arcade_name:a,id:r}])=>({label:"".concat(e," (").concat(a,")"),value:e,isCurrentPlayer:t===r})),h.a.sortBy(e=>e.isCurrentPlayer?"!":h.a.toLower(e.label)))(e)),ta=Object(Xt.a)(e=>e.results.data,e=>e.results.filter,e=>e.results.resultInfo,(e,t,a={})=>{const r=h.a.map("value",t.players),n=h.a.map("value",t.playersOr),s=h.a.map("value",t.playersNot),l=h.a.get("value",t.sortingType),c=h.a.get("value",t.protagonist),o=h.a.map("value",t.excludeAntagonists),i=[h.a.orderBy(["latestScoreDate"],["desc"])],m=c?[h.a.orderBy([e=>h.a.max(h.a.map(e=>e.nickname===c?e.dateObject.getTime():0,e.results))],["desc"])]:i,d=[h.a.filter(e=>h.a.map("nickname",e.results).includes(c)),h.a.map(e=>{const t=h.a.findIndex({nickname:c},e.results),a=e.results[t].score,r=h.a.flow([h.a.take(t),h.a.uniqBy("nickname"),h.a.remove(e=>o.includes(e.nickname)||e.score===a)])(e.results);return $t({},e,{distanceFromProtagonist:Math.sqrt(h.a.reduce((e,t)=>e+(t.score/a-.99)**2,0,r))})}),h.a.orderBy(["distanceFromProtagonist"],["desc"])],p=(e,t="desc")=>[h.a.filter(e=>h.a.map("nickname",e.results).includes(c)),h.a.orderBy([r=>{const n=h.a.find({nickname:c},r.results),s=a[n.id]||{};return h.a.getOr("desc"===t?-1/0:1/0,e,s)}],[t])],u={[f.DEFAULT]:i,[f.NEW_SCORES_PLAYER]:m,[f.PROTAGONIST]:d,[f.RANK_ASC]:p("pp.ppRatio","asc"),[f.RANK_DESC]:p("pp.pp")}[l]||i;return h.a.flow(h.a.compact([h.a.map(e=>$t({},e,{results:e.results.filter((e,t)=>!e.isUnknownPlayer||0===t,e.results)})),t.chartRange&&(e=>((e,t)=>{const a=h.a.getOr(b,"range",e),r=h.a.getOr(null,"type",e),n=h.a.getOr(y,"duration",e);return h.a.filter(e=>!(n!==y&&!n.includes(e.duration))&&(e.chartLevel>=a[0]&&e.chartLevel<=a[1]&&(!r||e.chartType.startsWith(r))),t)})(t.chartRange,e)),!t.showRank&&h.a.map(e=>$t({},e,{results:h.a.filter(e=>!e.isRank,e.results)})),t.showRank&&t.showOnlyRank&&h.a.map(e=>$t({},e,{results:h.a.filter(e=>e.isRank,e.results)})),t.showRank&&!t.showOnlyRank&&!t.showRankAndNorank&&h.a.map(e=>{const t=[];return $t({},e,{results:h.a.filter(e=>{const a=t.includes(e.nickname);return t.push(e.nickname),!a},e.results)})}),(r.length||n.length||s.length)&&h.a.filter(e=>{const t=h.a.map("nickname",e.results);return(!r.length||h.a.every(e=>t.includes(e),r))&&(!n.length||h.a.some(e=>t.includes(e),n))&&(!s.length||!h.a.some(e=>t.includes(e),s))}),h.a.filter(e=>h.a.size(e.results)),...u,t.song&&(e=>Object(Zt.a)(e,t.song.trim(),{keys:["song"]}))]))(e)});function aa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ra(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?aa(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):aa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const na=250,sa=[{label:"\u043e\u0442 \u043d\u043e\u0432\u044b\u0445 \u0441\u043a\u043e\u0440\u043e\u0432",value:f.DEFAULT},{label:"\u043e\u0442 \u043d\u043e\u0432\u044b\u0445 \u0441\u043a\u043e\u0440\u043e\u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430",value:f.NEW_SCORES_PLAYER},{label:"\u043e\u0442 \u0445\u0443\u0434\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432",value:f.RANK_ASC},{label:"\u043e\u0442 \u043b\u0443\u0447\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432",value:f.RANK_DESC}],la={fetchResults:Pt,setFilter:wt,resetFilter:()=>({type:pt}),selectPreset:Wt,openPreset:Gt};class ca extends r.Component{constructor(...e){super(...e),this.state={showItemsCount:20,chartOverrides:{}},this.setFilter=h.a.curry((e,t)=>{const a=ra({},this.props.filter,{[e]:t});this.props.setFilter(a),p.a.setItem("filter",a)}),this.resetFilter=()=>{this.props.resetFilter(),this.setState({chartOverrides:{}}),p.a.setItem("filter",gt)},this.onRefresh=()=>{const e=this.props.isLoading;this.setState({chartOverrides:{}}),!e&&this.props.fetchResults()},this.onTypeSongName=h.a.debounce(300,e=>{this.setFilter("song",e)}),this.onRedoLatestResult=h.a.throttle(na+10,e=>{const t=h.a.drop(1,this.state.chartOverrides[e.sharedChartId]);this.setState(a=>({chartOverrides:ra({},a.chartOverrides,{[e.sharedChartId]:1===h.a.size(t)?null:t})}))}),this.onUndoLatestResult=h.a.throttle(na+10,e=>{h.a.isEmpty(e.results)&&this.setState(t=>({chartOverrides:h.a.omit(e.sharedChartId,t.chartOverrides)}));const t=h.a.maxBy("date",e.results);if(!t)return;const a=this.props.results,r=t.playerId,n=h.a.findLast(a=>a.playerId===r&&a.sharedChartId===e.sharedChartId&&a.isRank===t.isRank&&a.date<t.date,a),s=h.a.orderBy("score","desc",h.a.compact(h.a.map(e=>e===t?n:e,e.results))),l=h.a.maxBy("date",s),c=ra({},e,{latestScoreDate:l&&l.date,results:s});h.a.isEmpty(s)?this.setState(t=>({chartOverrides:ra({},t.chartOverrides,{[e.sharedChartId]:null})})):this.setState(t=>({chartOverrides:ra({},t.chartOverrides,{[e.sharedChartId]:[c,...t.chartOverrides[e.sharedChartId]||[e]]})}))})}renderSimpleSearch(){const e=this.props,t=e.isLoading,a=e.filter;return n.a.createElement("div",{className:"simple-search"},n.a.createElement("div",{className:"song-name _margin-right _margin-bottom"},n.a.createElement(_e,{value:a.song||"",placeholder:"\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0441\u043d\u0438...",className:"form-control",onChange:this.onTypeSongName})),n.a.createElement("div",{className:"chart-range _margin-right _margin-bottom"},n.a.createElement(Ue,{filterValue:a.chartRange,onChange:this.setFilter("chartRange")})),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"_flex-row _margin-bottom"},n.a.createElement(Jt,null),n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.resetFilter},n.a.createElement(O.o,null)," \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b"),n.a.createElement("button",{disabled:t,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(O.q,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")))}renderFilters(){const e=this.props,t=e.players,a=e.filter;return console.log(t),n.a.createElement("div",{className:"filters"},n.a.createElement("div",{className:"people-filters"},n.a.createElement("label",{className:"label"},"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0447\u0430\u0440\u0442\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u044b\u0433\u0440\u0430\u043b:"),n.a.createElement("div",{className:"players-block"},n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},"\u043a\u0430\u0436\u0434\u044b\u0439 \u0438\u0437 \u044d\u0442\u0438\u0445"),n.a.createElement(ge.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",isMulti:!0,options:t,value:h.a.getOr(null,"players",a),onChange:this.setFilter("players")})),n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},"\u0438 \u0445\u043e\u0442\u044c \u043e\u0434\u0438\u043d \u0438\u0437 \u044d\u0442\u0438\u0445"),n.a.createElement(ge.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",isMulti:!0,options:t,value:h.a.getOr(null,"playersOr",a),onChange:this.setFilter("playersOr")})),n.a.createElement("div",{className:"_margin-right"},n.a.createElement("label",{className:"label"},"\u0438 \u043d\u0438\u043a\u0442\u043e \u0438\u0437 \u044d\u0442\u0438\u0445"),n.a.createElement(ge.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",isMulti:!0,options:t,value:h.a.getOr(null,"playersNot",a),onChange:this.setFilter("playersNot")})))),n.a.createElement("div",null,n.a.createElement(Te,{checked:h.a.getOr(!1,"showRank",a),onChange:this.setFilter("showRank")},"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0441\u043a\u043e\u0440\u044b \u043d\u0430 \u0440\u0430\u043d\u043a\u0435")),h.a.get("showRank",a)&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,n.a.createElement(Te,{checked:h.a.getOr(!1,"showOnlyRank",a),onChange:e=>{this.setFilter("showOnlyRank",e),h.a.get("showRankAndNorank",a)&&this.setFilter("showRankAndNorank",!1)}},n.a.createElement("strong",null,"\u0442\u043e\u043b\u044c\u043a\u043e")," \u043d\u0430 \u0440\u0430\u043d\u043a\u0435")),n.a.createElement("div",null,n.a.createElement(Te,{checked:h.a.getOr(!1,"showRankAndNorank",a),onChange:e=>{this.setFilter("showRankAndNorank",e),h.a.get("showOnlyRank",a)&&this.setFilter("showOnlyRank",!1)}},"\u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043b\u0443\u0447\u0448\u0438\u0435 \u0441\u043a\u043e\u0440\u044b \u0441 \u0440\u0430\u043d\u043a\u043e\u043c \u0438 \u0431\u0435\u0437"))))}renderSortings(){const e=this.props,t=e.players,a=e.filter;return n.a.createElement("div",{className:"sortings"},n.a.createElement("div",null,n.a.createElement("label",{className:"label"},"\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430:"),n.a.createElement(ge.a,{placeholder:"\u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0443",className:"select",classNamePrefix:"select",isClearable:!1,options:sa,value:h.a.getOr(sa[0],"sortingType",a),onChange:this.setFilter("sortingType")})),[f.PROTAGONIST,f.RANK_ASC,f.RANK_DESC,f.NEW_SCORES_PLAYER].includes(h.a.get("sortingType.value",a))&&n.a.createElement("div",null,n.a.createElement("label",{className:"label"},"\u0438\u0433\u0440\u043e\u043a:"),n.a.createElement(ge.a,{className:k()("select players",{"red-border":!h.a.get("protagonist",a)}),classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:t,value:h.a.getOr(null,"protagonist",a),onChange:this.setFilter("protagonist")})),[f.PROTAGONIST].includes(h.a.get("sortingType.value",a))&&n.a.createElement("div",null,n.a.createElement("label",{className:"label"},"\u043d\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0432 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0438:"),n.a.createElement(ge.a,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:t,isMulti:!0,value:h.a.getOr([],"excludeAntagonists",a),onChange:this.setFilter("excludeAntagonists")})))}render(){const e=this.props,t=e.isLoading,a=e.filteredData,r=e.error,s=e.filter,l=e.resultInfo,o=this.state,i=o.showItemsCount,m=o.chartOverrides,d=a.length>i,p=h.a.slice(0,i,a),u=h.a.get("sortingType.value",s),b=[f.PROTAGONIST,f.RANK_ASC,f.RANK_DESC,f.NEW_SCORES_PLAYER].includes(u),E=h.a.get("protagonist.value",s),y=h.a.slice(0,Yt.length,h.a.uniq(h.a.compact([b&&E,...h.a.map("value",s.players),...h.a.map("value",s.playersOr)])));return n.a.createElement("div",{className:"leaderboard-page"},n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"search-block"},this.renderSimpleSearch(),n.a.createElement(Fe,{title:"\u0444\u0438\u043b\u044c\u0442\u0440\u044b"},this.renderFilters()),n.a.createElement(Fe,{title:"\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430"},this.renderSortings())),t&&n.a.createElement(P,null),!!this.props.presets.length&&n.a.createElement("div",{className:"presets-buttons"},n.a.createElement("span",null,"\u043f\u0440\u0435\u0441\u0435\u0442\u044b:"),this.props.presets.map(e=>n.a.createElement(Ae,{key:e.name,text:e.name,className:"btn btn-sm btn-dark _margin-right",active:h.a.get("filter",e)===this.props.filter,onToggle:()=>{this.props.selectPreset(e),this.props.openPreset()}}))),n.a.createElement("div",{className:"top-list"},h.a.isEmpty(a)&&!t&&(r?r.message:"\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"),!t&&p.map((e,t)=>{const a=m[e.sharedChartId],r=h.a.first(a)||e;st&&console.log(r);let s=1;const o=[],i=r.results.map((e,t)=>{const a=o.includes(e.nickname);return o.push(e.nickname),0===t?s=1:a||e.score===h.a.get([t-1,"score"],r.results)||(s+=1),ra({},e,{topPlace:s,isSecondOccurenceInResults:a})});return n.a.createElement("div",{className:"song-block",key:r.song+r.chartLabel},n.a.createElement("div",{className:"song-name"},n.a.createElement("div",{className:k()("chart-name",{single:"S"===r.chartType,singlep:"SP"===r.chartType,doublep:"DP"===r.chartType,double:"D"===r.chartType,coop:"COOP"===r.chartType})},n.a.createElement("span",{className:"chart-letter"},r.chartType),n.a.createElement("span",{className:"chart-number"},r.chartLevel)),n.a.createElement("div",null,r.song),n.a.createElement("div",{className:"youtube-link"},n.a.createElement("a",{href:"https://youtube.com/results?search_query=".concat(r.song.replace(/ /g,"+").replace(/-/g,""),"+").concat(r.chartLabel),target:"_blank",rel:"noopener noreferrer"},n.a.createElement(O.t,null))),n.a.createElement("div",{className:"_flex-fill"}),(()=>{const e=!h.a.isEmpty(a),t=e?1+r.totalResultsCount-h.a.size(a):r.totalResultsCount,s=!(1===t&&1===r.totalResultsCount);return n.a.createElement("div",{className:k()("undo-result-button",{active:e})},n.a.createElement(O.c,{className:k()("backward-btn",{disabled:!s}),onClick:()=>s&&this.onUndoLatestResult(r)}),n.a.createElement("span",{className:"number"},t,"/",r.totalResultsCount),n.a.createElement(O.i,{className:k()("forward-btn",{disabled:!e}),onClick:()=>e&&this.onRedoLatestResult(r)}))})()),n.a.createElement("div",{className:"charts"},!h.a.isEmpty(i)&&n.a.createElement("div",{className:"chart"},n.a.createElement("div",{className:"results"},n.a.createElement("table",null,0===t&&n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{className:"place"}),n.a.createElement("th",{className:"nickname"}),n.a.createElement("th",{className:"judge"}),n.a.createElement("th",{className:"score"},"score"),n.a.createElement("th",{className:"grade"}),n.a.createElement("th",{className:"number"},"miss"),n.a.createElement("th",{className:"number"},"bad"),n.a.createElement("th",{className:"number"},"good"),n.a.createElement("th",{className:"number"},"great"),n.a.createElement("th",{className:"number"},"perfect"),n.a.createElement("th",{className:"combo"},"combo"),n.a.createElement("th",{className:"accuracy"},"accuracy"),n.a.createElement("th",{className:"date"}))),n.a.createElement(ve.a,{enterAnimation:"fade",leaveAnimation:"fade",typeName:"tbody",maintainContainerHeight:!0,duration:na},i.map((e,t)=>{if(e.isUnknownPlayer&&0!==t)return null;const a=y.indexOf(e.nickname);let s,o;if(e.scoreIncrease&&e.date===r.latestScoreDate){const a=e.score-e.scoreIncrease;s=(o=h.a.findLastIndex(e=>e.score>a,i))-t}const m=l[e.id]||{};return n.a.createElement("tr",{key:e.isRank+"_"+e.nickname,className:k()({empty:!e.isExactDate,latest:e.date===r.latestScoreDate})},n.a.createElement("td",{className:"place"},e.isSecondOccurenceInResults?"":"#".concat(e.topPlace)),n.a.createElement("td",{className:"nickname",style:a>-1?{fontWeight:"bold",color:Yt[a]}:{}},e.nickname,!!s&&n.a.createElement("span",{className:"change-holder up"},n.a.createElement("span",null,s),n.a.createElement(O.b,null)),!m.pp||u!==f.RANK_DESC&&u!==f.RANK_ASC||e.nickname!==E?m.pp&&n.a.createElement("span",{className:"debug-elo-info"}," ",m.pp.ppFixed,"pp"):n.a.createElement("span",null," (",m.pp.ppFixed,"pp)")),n.a.createElement("td",{className:k()("judge",{vj:e.isRank,hj:e.isHJ})},e.isRank&&n.a.createElement("div",{className:"inner"},e.isExactDate?"VJ":n.a.createElement(ye.a,{content:n.a.createElement("div",null,"\u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0440\u0430\u043d\u043a\u0430 \u043d\u0430 \u044d\u0442\u043e\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u0431\u044b\u043b\u043e \u0443\u0433\u0430\u0434\u0430\u043d\u043e, \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u044f\u0441\u044c \u043d\u0430 \u0441\u043a\u043e\u0440\u0435"),tooltipClassName:"pumpking-tooltip"},"VJ?")),e.isHJ&&n.a.createElement("div",{className:"inner"},"HJ")),n.a.createElement("td",{className:"score"},n.a.createElement(Ce,{overlayClassName:"score-overlay-outer",overlayItem:n.a.createElement("span",{className:"score-span"},e.scoreIncrease>.8*e.score&&"*",be()(e.score).format("0,0")),placement:"top"},n.a.createElement("div",{className:"score-overlay"},st&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"result id: "),e.id),n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"player id: "),e.playerId)),n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u0438\u0433\u0440\u043e\u043a: "),n.a.createElement(c.c,{exact:!0,to:g.profile.getPath({id:e.playerId})},e.nickname," (",e.nicknameArcade,")")),!!Ye(e,r)&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},"\u043e\u043f\u044b\u0442: "),"+",be()(Ye(e,r)).format("0,0")),m.pp&&n.a.createElement("div",{className:"important"},n.a.createElement("span",{className:"_grey"},"pp: "),n.a.createElement("span",null,m.pp.ppFixed,"pp")),!e.isExactDate&&n.a.createElement("div",{className:"warning"},n.a.createElement(O.g,null),"\u0440\u0435\u043a\u043e\u0440\u0434 \u0432\u0437\u044f\u0442 \u0441 my best. \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430"),!!e.isExactDate&&n.a.createElement(n.a.Fragment,null,!!e.mods&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043c\u043e\u0434\u044b: "),e.mods),!!e.calories&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043a\u043a\u0430\u043b: "),e.calories),!!e.scoreIncrease&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043f\u0440\u0438\u0440\u043e\u0441\u0442: "),"+",be()(e.scoreIncrease).format("0,0")),e.originalChartMix&&n.a.createElement("div",null,n.a.createElement("div",{className:"warning"},n.a.createElement(O.g,null),"\u0431\u044b\u043b\u043e \u0441\u044b\u0433\u0440\u0430\u043d\u043e \u043d\u0430 ",e.originalChartMix),e.originalChartLabel&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0447\u0430\u0440\u0442:"," "),e.originalChartLabel),e.originalScore&&n.a.createElement("div",null,n.a.createElement("span",{className:"_grey"},"\u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u043a\u043e\u0440:"," "),e.originalScore)),e.scoreIncrease>.8*e.score&&"* \u0441\u0430\u0439\u0442\u0440\u0438\u0434")))),n.a.createElement("td",{className:"grade"},n.a.createElement("div",{className:"img-holder"},e.grade&&"?"!==e.grade&&n.a.createElement("img",{src:"".concat(".","/grades/").concat(e.grade,".png"),alt:e.grade}),"?"===e.grade&&null)),n.a.createElement("td",{className:"number miss"},e.miss),n.a.createElement("td",{className:"number bad"},e.bad),n.a.createElement("td",{className:"number good"},e.good),n.a.createElement("td",{className:"number great"},e.great),n.a.createElement("td",{className:"number perfect"},e.perfect),n.a.createElement("td",{className:"combo"},e.combo,e.combo?"x":""),n.a.createElement("td",{className:"accuracy"},e.accuracy,e.accuracy?"%":""),n.a.createElement("td",{className:k()("date",{latest:e.date===r.latestScoreDate})},n.a.createElement(ye.a,{content:ie(e),tooltipClassName:"pumpking-tooltip"},me(e.dateObject),e.isExactDate?"":"?")))})))))))}),!t&&d&&n.a.createElement("button",{className:"btn btn-sm btn-primary",onClick:()=>this.setState(e=>({showItemsCount:e.showItemsCount+10}))},"show more..."))))}}var oa=Object(o.b)(e=>({players:ea(e),resultInfo:e.results.resultInfo,results:e.results.results,filteredData:ta(e),data:e.results.data,filter:e.results.filter,error:e.results.error||e.tracklist.error,isLoading:e.results.isLoading||e.tracklist.isLoading,presets:e.presets.presets,currentPreset:e.presets.currentPreset}),la)(ca);a(273);const ia=e=>n.a.createElement("img",{src:"".concat(".","/grades/").concat(e,".png"),alt:e});function ma({ranking:e,isLoading:t}){return n.a.createElement("div",{className:"ranking-list"},h.a.isEmpty(e)&&!t&&"\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",t&&n.a.createElement(P,null),!t&&n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{className:"place"}),n.a.createElement("th",{className:"change"}),n.a.createElement("th",{className:"exp-rank"},"rank"),n.a.createElement("th",{className:"name"},"name"),n.a.createElement("th",{className:"name2"},"piu name"),n.a.createElement("th",{className:"rating"},"pp"),n.a.createElement("th",{className:"rating-change-cell"}),n.a.createElement("th",{className:"grades sss"},ia("SSS")),n.a.createElement("th",{className:"grades ss"},ia("SS")),n.a.createElement("th",{className:"grades s"},ia("S")),n.a.createElement("th",{className:"grades a"},ia("A+")),n.a.createElement("th",{className:"grades b"},ia("B")),n.a.createElement("th",{className:"grades c"},ia("C")),n.a.createElement("th",{className:"grades d"},ia("D")),n.a.createElement("th",{className:"grades f"},ia("F")),n.a.createElement("th",{className:"playcount"},"scores"),n.a.createElement("th",{className:"accuracy"},"accuracy"))),n.a.createElement("tbody",null,e.map((e,t)=>n.a.createElement("tr",{className:"player",key:e.name},n.a.createElement("td",{className:"place"},0===t?n.a.createElement(Ze.d,null):"#".concat(t+1)),n.a.createElement("td",{className:"change"},e.change>0&&n.a.createElement("div",{className:"change-holder up"},n.a.createElement("span",null,e.change),n.a.createElement(O.b,null)),e.change<0&&n.a.createElement("div",{className:"change-holder down"},n.a.createElement("span",null,-e.change),n.a.createElement(O.a,null)),!!e.change&&h.a.isString(e.change)&&n.a.createElement("div",{className:"change-holder text"},n.a.createElement("span",null,e.change))),n.a.createElement("td",{className:"exp-rank"},Xe(e.expRank)),n.a.createElement("td",{className:"name"},n.a.createElement(c.c,{exact:!0,to:g.profile.getPath({id:e.id})},e.name)),n.a.createElement("td",{className:"name"},n.a.createElement(c.c,{exact:!0,to:g.profile.getPath({id:e.id})},e.nameArcade)),n.a.createElement("td",{className:"rating"},Math.round(e.pp.pp)),n.a.createElement("td",{className:"rating-change-cell"},!!e.prevRating&&e.prevRating!==e.rating&&n.a.createElement("span",{className:k()("rating-change",{down:e.prevRating>e.rating,up:e.prevRating<e.rating})},e.prevRating<e.rating?"+":"",e.rating-e.prevRating)),n.a.createElement("td",{className:"grades sss"},e.grades.SSS),n.a.createElement("td",{className:"grades ss"},e.grades.SS),n.a.createElement("td",{className:"grades s"},e.grades.S),n.a.createElement("td",{className:"grades a"},e.grades.A),n.a.createElement("td",{className:"grades b"},e.grades.B),n.a.createElement("td",{className:"grades c"},e.grades.C),n.a.createElement("td",{className:"grades d"},e.grades.D),n.a.createElement("td",{className:"grades f"},e.grades.F),n.a.createElement("td",{className:"playcount"},e.count),n.a.createElement("td",{className:"accuracy"},e.accuracy?"".concat(e.accuracy.toFixed(2),"%"):""))))))}function da(){return n.a.createElement("div",{className:"faq"},n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0440\u0435\u0439\u0442\u0438\u043d\u0433?"),n.a.createElement("div",{className:"answer"},"A: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f ",n.a.createElement("a",{href:"https://en.wikipedia.org/wiki/Elo_rating_system"},"\u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u042d\u043b\u043e"),", \u0448\u0438\u0440\u043e\u043a\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0439 \u0432 \u0448\u0430\u0445\u043c\u0430\u0442\u0430\u0445 \u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0438\u0433\u0440\u0430\u0445, \u0441\u043b\u0435\u0433\u043a\u0430 \u043c\u043e\u0434\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u043e\u0434 \u0443\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0433\u0440\u044b \u043d\u0430 \u043f\u0430\u043c\u043f\u0435. \u0421\u0440\u0435\u0434\u043d\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 - 1000. \u041a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442 \u041a \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u0443\u0440\u043e\u0432\u043d\u044f \u0447\u0430\u0440\u0442\u0430 (\u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0435 \u0447\u0430\u0440\u0442\u044b \u0441\u0438\u043b\u044c\u043d\u0435\u0435 \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0440\u0435\u0439\u0442\u0438\u043d\u0433). \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0447\u043a\u043e\u0432 \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u0437\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433 (\u043c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0439 \u043e\u0442\u0440\u044b\u0432 \u043e\u0442 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u0438\u043a\u0430 \u043d\u0435 \u0434\u0430\u0441\u0442 \u0442\u0430\u043a \u043c\u043d\u043e\u0433\u043e \u043e\u0447\u043a\u043e\u0432 \u043a\u0430\u043a \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u043e\u0442\u0440\u044b\u0432).")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u042d\u043b\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0438\u0433\u0440 1 \u043d\u0430 1, \u043a\u0430\u043a \u043e\u043d\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043d\u0430 \u043f\u0430\u043c\u043f\u0435, \u0433\u0434\u0435 \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0447\u0430\u0440\u0442\u0435 \u0438\u0433\u0440\u0430\u0435\u0442 \u043c\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u043e\u0432?"),n.a.createElement("div",{className:"answer"},"A: \u0420\u0435\u043a\u043e\u0440\u0434\u044b \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0447\u0430\u0440\u0442\u0435 \u0434\u0435\u043b\u044f\u0442\u0441\u044f \u043d\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0438\u0433\u0440 1 \u043d\u0430 1. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c 3 \u0438\u0433\u0440\u043e\u043a\u0430: A, B, C; \u0442\u043e \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u0431\u044b\u043b\u043e 3 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0438\u0433\u0440\u044b: A vs B, A vs C, B vs C.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043b\u0438 \u0440\u0435\u043a\u043e\u0440\u0434\u044b \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0414\u0430. \u041a\u0430\u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u043c\u043d\u043e\u0433\u043e \u0440\u0435\u043a\u043e\u0440\u0434\u043e\u0432, \u0432\u0437\u044f\u0442\u044b\u0445 \u0441 \u043c\u0430\u0448\u0438\u043d \u0431\u0435\u0441\u0442\u043e\u0432, \u0438 \u043c\u044b \u043d\u0435 \u0437\u043d\u0430\u0435\u043c \u043d\u0430\u0432\u0435\u0440\u043d\u044f\u043a\u0430, \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u043e\u043d\u0438 \u0438\u043b\u0438 \u043d\u0435\u0442. \u0415\u0441\u043b\u0438 \u0443 \u0438\u0433\u0440\u043e\u043a\u0430 \u0432 \u0442\u043e\u043f\u0435 \u0435\u0441\u0442\u044c \u0434\u0432\u0430 \u0441\u043a\u043e\u0440\u0430 - \u043d\u0430 \u0440\u0430\u043d\u043a\u0435 \u0438 \u0431\u0435\u0437 \u0440\u0430\u043d\u043a\u0430, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u0442, \u0433\u0434\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u0447\u043a\u043e\u0432.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041f\u043e\u0447\u0435\u043c\u0443 \u043c\u0435\u043d\u044f \u043d\u0435\u0442 \u0432 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0412 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043f\u043e\u043f\u0430\u0434\u0430\u044e\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u0435, \u0443 \u043a\u043e\u0433\u043e \u0435\u0441\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b 20 \u0438\u0433\u0440 1 \u043d\u0430 1. \u041f\u0435\u0440\u0432\u044b\u0435 20 \u0438\u0433\u0440 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0438\u0437\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0430.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u041f\u043e\u0447\u0435\u043c\u0443 \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0446\u0435\u043d\u043e\u043a S-A-B \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 \u043e\u0431\u0449\u0438\u043c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e\u043c \u0441\u043a\u043e\u0440\u043e\u0432?"),n.a.createElement("div",{className:"answer"},"A: \u041d\u0435 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430 \u043e\u0446\u0435\u043d\u043a\u0430.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0415\u0441\u043b\u0438 \u0443 \u043c\u0435\u043d\u044f \u0435\u0441\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u043a\u043e\u0440\u0434\u043e\u0432 \u043d\u0430 \u0410, \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0410+, \u043a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0433\u0440\u0435\u0439\u0434\u043e\u0432 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435?"),n.a.createElement("div",{className:"answer"},"A: \u0412 \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u043e\u043b\u043e\u043d\u043a\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043e\u0431\u0435 \u0431\u0443\u043a\u0432\u044b - \u0438 \u0442\u0440\u0435\u0441\u043d\u0443\u0442\u044b\u0435, \u0438 \u0441 \u0443\u0434\u0435\u0440\u0436\u0430\u043d\u043d\u044b\u043c \u043b\u0430\u0439\u0444\u043e\u043c. \u0422\u043e \u0435\u0441\u0442\u044c \u0438 \u0410, \u0438 \u0410+ \u0438\u0434\u0443\u0442 \u0432 \u043a\u043e\u043b\u043e\u043d\u043a\u0443 \u0410. \u0422\u043e\u0447\u043d\u043e \u0442\u0430\u043a \u0436\u0435 \u0434\u043b\u044f B, C, D.")),n.a.createElement("div",{className:"question-answer"},n.a.createElement("div",{className:"question"},"Q: \u0423\u0431\u0435\u0440\u0438 \u0430\u043a\u043a\u0443\u0440\u0430\u0441\u0438 \u0438\u0437 \u0442\u0430\u0431\u043b\u0438\u0446\u044b!"),n.a.createElement("div",{className:"answer"},"A: \u0413\u0440\u0435\u043c, \u044d\u0442\u043e \u0441\u0435\u043a\u0446\u0438\u044f \u0434\u043b\u044f \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432.")))}const pa=Object(Xt.a)(e=>e.results.profiles,h.a.flow(h.a.values,h.a.remove(e=>!e.pp),h.a.orderBy(["pp.pp"],["desc"]))),ua={fetchResults:Pt};class ha extends r.Component{constructor(...e){super(...e),this.onRefresh=()=>{!this.props.isLoading&&this.props.fetchResults()}}render(){const e=this.props,t=e.isLoading,a=e.ranking,r=e.error;return n.a.createElement("div",{className:"ranking-page"},n.a.createElement("div",{className:"content"},r&&r.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement(m.b,{exact:!0,path:g.ranking.path,render:()=>n.a.createElement(n.a.Fragment,null,n.a.createElement(c.b,{to:g.ranking.faq.path},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon _margin-right"},n.a.createElement(O.n,null)," faq")),n.a.createElement("button",{disabled:t,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(O.q,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c"))}),n.a.createElement(m.b,{exact:!0,path:g.ranking.faq.path,render:()=>n.a.createElement(c.b,{to:g.ranking.path},n.a.createElement("button",{className:"btn btn-sm btn-dark btn-icon"},"\u043d\u0430\u0437\u0430\u0434"))})),n.a.createElement(m.b,{exact:!0,path:g.ranking.path,render:()=>n.a.createElement(ma,{ranking:a,isLoading:t})}),n.a.createElement(m.b,{exact:!0,path:g.ranking.faq.path,component:da})))}}ha.defaultProps={ranking:[]};var ga=Object(o.b)(e=>({ranking:pa(e),error:e.results.error||e.tracklist.error,isLoading:e.results.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}),ua)(Object(m.g)(ha)),fa=a(183),ba=a.n(fa),Ea=a(3),ya=(a(428),a(195)),va=(a(429),Object(o.b)(e=>({charts:e.results.sharedCharts}),{fetchJson:L})(({playerId:e,charts:t,fetchJson:a})=>{const s=Object(r.useState)(!1),l=Object(v.a)(s,2),c=l[0],o=l[1],i=Object(r.useState)(10),m=Object(v.a)(i,2),d=m[0],p=m[1],u=Object(r.useState)([]),g=Object(v.a)(u,2),f=g[0],b=g[1];return Object(r.useEffect)(()=>{o(!0),a({url:"".concat(_,"/player/").concat(e,"/mostPlayed?limit=").concat(d)}).then(e=>{o(!1),e.success&&b(e.data)}).catch(()=>{o(!1)})},[e,d,a]),n.a.createElement("div",{className:"most-played"},c&&n.a.createElement(P,null),f.map(e=>{const a=t[e.shared_chart];return n.a.createElement("div",{className:"chart",key:e.shared_chart},n.a.createElement("div",{className:k()("chart-name",{single:"S"===a.chartType,singlep:"SP"===a.chartType,doublep:"DP"===a.chartType,double:"D"===a.chartType,coop:"COOP"===a.chartType})},n.a.createElement("span",{className:"chart-letter"},a.chartType),n.a.createElement("span",{className:"chart-number"},a.chartLevel)),n.a.createElement("div",{className:"song-name"},a.song),n.a.createElement("div",{className:"date"},e.latestDate?me(de(e.latestDate)):null),n.a.createElement("div",{className:"playcount"},n.a.createElement(O.l,null),n.a.createElement("span",null,e.count)))}),d===h.a.size(f)&&n.a.createElement("button",{className:"show-more btn btn-sm btn-dark btn-icon",onClick:()=>p(d+10)},n.a.createElement(ya.a,null)," \u0431\u043e\u043b\u044c\u0448\u0435"))}));function Oa(){return n.a.createElement("div",{className:"faq-exp"},n.a.createElement("div",{className:"faq-header"},n.a.createElement("strong",null,"\u041e\u043f\u044b\u0442")," \u0438\u0433\u0440\u043e\u043a\u0430 \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0435 \u0441\u044b\u0433\u0440\u0430\u043d\u043d\u044b\u0445 \u043f\u0435\u0441\u0435\u043d \u0438 \u0447\u0430\u0440\u0442\u043e\u0432.",n.a.createElement("br",null),"\u0427\u0435\u043c \u0432\u044b\u0448\u0435 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0447\u0430\u0440\u0442\u0430 \u0438 \u0447\u0435\u043c \u043b\u0443\u0447\u0448\u0435 \u043e\u0446\u0435\u043d\u043a\u0430 \u043d\u0430 \u0447\u0430\u0440\u0442\u0435, \u0442\u0435\u043c \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u044b\u0442\u0430 \u043e\u043d \u0434\u0430\u0451\u0442.",n.a.createElement("br",null),"\u041f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0438 \u043d\u0430 \u0442\u0435\u0445 \u0436\u0435 \u0447\u0430\u0440\u0442\u0430\u0445 \u043d\u0435 \u0434\u0430\u044e\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u044b\u0442\u0430. \u0427\u0442\u043e\u0431\u044b \u043f\u043e\u0434\u043d\u0438\u043c\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c, \u0438\u0433\u0440\u0430\u0439 \u043d\u043e\u0432\u044b\u0435 \u0442\u0440\u0435\u043a\u0438 \u0438 \u0447\u0430\u0440\u0442\u044b."),n.a.createElement("div",{className:"faq-header"},"\u0421\u043f\u0438\u0441\u043e\u043a \u0443\u0440\u043e\u0432\u043d\u0435\u0439 \u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0439 \u043e\u043f\u044b\u0442 \u0434\u043b\u044f \u0438\u0445 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f:"),n.a.createElement("div",{className:"ranks-list"},ze.map((function(e){return n.a.createElement("div",{key:e.threshold,className:"rank"},n.a.createElement("div",{className:"exp-rank"},Xe(e)),n.a.createElement("div",{className:"threshold"},e.threshold))}))))}function Na(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ka(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Na(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Na(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Pa="PROFILES/SET_FILTER",Sa="PROFILES/RESET_FILTER",wa={},ja={isLoading:!1,filter:wa};const xa=e=>({type:Pa,filter:e}),Ra=()=>({type:Sa});function Da(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function La(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Da(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Da(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Ia={SSS:0,SS:0,S:0,"A+":0,A:0,B:0,C:0,D:0,F:0},Ca=h.a.flow(h.a.flatMap(e=>h.a.flow(h.a.toPairs,h.a.map(([t,a])=>["".concat(e,"-").concat(t),a]))(Ia)),h.a.fromPairs)(["S","D"]),Aa=e=>Object(Xt.a)((t,a)=>h.a.toInteger(a.match.params[e]),e=>e.results.isLoading||e.results.isLoadingRanking,e=>e.results.profiles,e=>e.profiles.filter,e=>e.tracklist.data,(e,t,a,r,n)=>{const s=a[e];if(h.a.isEmpty(s)||t)return null;const l=h.a.flow(h.a.get("resultsByLevel"),h.a.toPairs,h.a.map(([e,t])=>({x:h.a.toInteger(e),S:h.a.size(h.a.filter(e=>"S"===e.chart.chartType||"SP"===e.chart.chartType,t))/n.singlesLevels[e]*100,D:-h.a.size(h.a.filter(e=>"D"===e.chart.chartType||"DP"===e.chart.chartType,t))/n.doublesLevels[e]*100})))(s),c=h.a.flow(h.a.get("resultsByLevel"),h.a.toPairs,h.a.map(h.a.update("[1].result.grade",e=>e&&e.includes("+")&&"A+"!==e?e.replace("+",""):e)))(s),o=h.a.flow(h.a.map(([e,t])=>La({x:h.a.toInteger(e)},Ia,{},h.a.omit("?",h.a.mapValues(h.a.size,h.a.groupBy("result.grade",t))))),h.a.map(e=>{const t=h.a.pick(Object.keys(Ia),e),a=h.a.sum(h.a.values(t));return La({},e,{gradesValues:t},0===a?t:h.a.mapValues(e=>100*e/a,t))}))(c),i=h.a.flow(h.a.map(([e,t])=>{const a=h.a.groupBy("result.grade",t),r=h.a.omit("?",h.a.mapValues(h.a.countBy(e=>"S"===e.chart.chartType||"SP"===e.chart.chartType?"S":"D"===e.chart.chartType||"DP"===e.chart.chartType?"D":"Other"),a)),s=h.a.reduce((t,[a,r])=>{return La({},t,{},h.a.flow(h.a.toPairs,h.a.map(([t,r])=>["".concat(t,"-").concat(a),"S"===t?r/n.singlesLevels[e]*100:-r/n.doublesLevels[e]*100]),h.a.fromPairs)(r))},{},h.a.toPairs(r));return La({x:h.a.toInteger(e)},Ca,{},s)}))(c);return La({},s,{rank:1+h.a.findIndex({id:e},h.a.orderBy(["ratingRaw"],["desc"],h.a.values(a))),levelsDistribution:l,gradesDistribution:o,gradesAndLevelsDistribution:i})});function _a(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}const Ta=void 0,Fa=Aa("id"),Ma=Object(Xt.a)(e=>e.results.players,(e,t)=>h.a.toNumber(t.match.params.id),(e,t)=>h.a.flow(h.a.toPairs,h.a.map(([e,{nickname:t,arcade_name:a,id:r}])=>({label:"".concat(t," (").concat(a,")"),value:t,id:h.a.toNumber(r)})),h.a.remove(e=>e.id===t),h.a.sortBy(e=>h.a.toLower(e.label)))(e)),Ba={fetchResults:Pt,setProfilesFilter:xa,resetProfilesFilter:Ra};class Ka extends r.Component{constructor(...e){super(...e),this.state={isLevelGraphCombined:!0,showFaq:!1},this.onRefresh=()=>{!this.props.isLoading&&this.props.fetchResults()},this.onChangeDayRange=e=>{const t=this.props.filter;this.props.setProfilesFilter(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_a(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_a(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},t,{dayRange:e}))},this.onShowFaq=()=>{this.setState({showFaq:!0})},this.onHideFaq=()=>{this.setState({showFaq:!1})}}componentWillUnmount(){this.props.resetProfilesFilter()}renderRankingHistory(){return n.a.createElement(Ea.i,{minHeight:Ta,aspect:1.6},n.a.createElement(Ea.g,{data:[],margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ea.c,{strokeDasharray:"3 3"}),n.a.createElement(Ea.k,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>de(e).toLocaleDateString()}),n.a.createElement(Ea.l,{allowDecimals:!1,domain:["dataMin - 100","dataMax + 100"],tickFormatter:Math.round,width:40}),n.a.createElement(Ea.h,{y:1e3,stroke:"white"}),n.a.createElement(Ea.j,{isAnimationActive:!1,content:({active:e,payload:t,label:a})=>t&&t[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,de(t[0].payload.date).toLocaleDateString()),t&&t[0]&&n.a.createElement("div",null,"Rating: ",Math.round(t[0].value))):null}),n.a.createElement(Ea.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderPlaceHistory(){return n.a.createElement(Ea.i,{minHeight:Ta,aspect:1.6},n.a.createElement(Ea.g,{data:[],margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ea.c,{strokeDasharray:"3 3"}),n.a.createElement(Ea.k,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>de(e).toLocaleDateString()}),n.a.createElement(Ea.l,{allowDecimals:!1,domain:[1,e=>e<3?e+2:e+1],interval:0,reversed:!0,width:40}),n.a.createElement(Ea.j,{isAnimationActive:!1,content:({active:e,payload:t,label:a})=>t&&t[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,de(t[0].payload.date).toLocaleDateString()),t&&t[0]&&n.a.createElement("div",null,"Place: #",t[0].value)):null}),n.a.createElement(Ea.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderGrades(){const e=this.props.profile;return n.a.createElement(Ea.i,{minHeight:Ta,aspect:1.6},n.a.createElement(Ea.b,{data:e.gradesDistribution,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ea.j,{isAnimationActive:!1,content:({active:e,payload:t,label:a})=>t&&t[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),h.a.filter(e=>e.value>0,t).map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name,": ",t[0].payload.gradesValues[e.name]))):null}),n.a.createElement(Ea.k,{dataKey:"x"}),n.a.createElement(Ea.l,{domain:[0,100],ticks:[0,50,100],tickFormatter:e=>"".concat(Math.round(e),"%"),width:40}),n.a.createElement(Ea.e,null),n.a.createElement(Ea.a,{dataKey:"SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"F",fill:"#774949",stackId:"stack"})))}renderGradesWithLevels(){const e=this.props,t=e.profile,a=e.tracklist;return n.a.createElement(Ea.i,{minHeight:Ta,aspect:.74},n.a.createElement(Ea.b,{data:t.gradesAndLevelsDistribution,margin:{top:5,bottom:5,right:5,left:0},stackOffset:"sign"},n.a.createElement(Ea.j,{isAnimationActive:!1,content:({active:e,payload:t,label:r})=>{if(!t||!t[0])return null;const s=h.a.filter(e=>0!==e.value&&e.dataKey.startsWith("D"),t),l=h.a.filter(e=>0!==e.value&&e.dataKey.startsWith("S"),t);return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),!!l.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Single:"),l.map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name.slice(2),": ",Math.round(Math.abs(e.value)),"% (",Math.round(a.singlesLevels[e.payload.x]*e.value/100),"/",a.singlesLevels[e.payload.x],")"))),!!s.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Double:"),s.map(e=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},e.name.slice(2),": ",Math.round(Math.abs(e.value)),"% (",Math.round(a.doublesLevels[e.payload.x]*-e.value/100),"/",a.doublesLevels[e.payload.x],")"))))}}),n.a.createElement(Ea.k,{dataKey:"x"}),n.a.createElement(Ea.l,{tickFormatter:e=>"".concat(Math.round(Math.abs(e)),"%"),width:40,domain:[e=>Math.min(e,-10),e=>Math.max(10,e)]}),n.a.createElement(Ea.a,{dataKey:"S-SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S-F",fill:"#774949",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-SSS",fill:"#ffd700",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-SS",fill:"#dab800",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-S",fill:"#b19500",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-A+",fill:"#396eef",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-A",fill:"#828fb7",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-B",fill:"#7a6490",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-C",fill:"#6d5684",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-D",fill:"#5d4e6d",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"D-F",fill:"#774949",stackId:"stack"}),n.a.createElement(Ea.d,{value:"Double",offset:0,position:"insideBottomLeft"}),n.a.createElement(Ea.d,{value:"Single",offset:0,position:"insideTopLeft"}),n.a.createElement(Ea.h,{y:0,stroke:"#bbb"})))}renderLevels(){const e=this.props,t=e.profile,a=e.tracklist;return n.a.createElement(Ea.i,{minHeight:Ta,aspect:1.6},n.a.createElement(Ea.b,{data:t.levelsDistribution,stackOffset:"sign",margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ea.j,{isAnimationActive:!1,content:({active:e,payload:t,label:r})=>{if(!t||!t[0])return null;const s=a.doublesLevels[t[0].payload.x],l=a.singlesLevels[t[0].payload.x];return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),l>0&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[1].color}},"Single: ",Math.abs(t[1].value).toFixed(1),"% (",Math.round(t[1].value*l/100),"/",l,")"),s>0&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[0].color}},"Double: ",Math.abs(t[0].value).toFixed(1),"% (",Math.round(Math.abs(t[0].value)*s/100),"/",s,")"))}}),n.a.createElement(Ea.k,{dataKey:"x"}),n.a.createElement(Ea.l,{tickFormatter:e=>Math.round(Math.abs(e))+"%",width:40,domain:[e=>Math.min(e,-10),e=>Math.max(10,e)]}),n.a.createElement(Ea.j,null),n.a.createElement(Ea.h,{y:0,stroke:"#555"}),n.a.createElement(Ea.e,null),n.a.createElement(Ea.a,{dataKey:"D",fill:"#169c16",stackId:"stack"}),n.a.createElement(Ea.a,{dataKey:"S",fill:"#af2928",stackId:"stack"})))}renderGradeBlock(e,t){const a=this.props.profile.progress[e],r="double"===e?"D":"S",s=Math.floor(100*(a["".concat(t,"-bonus-level-coef")]||0)),l=a["".concat(t,"-bonus-level-min-number")],c=a["".concat(t,"-bonus-level-achieved-number")],o=a["".concat(t,"-bonus-level")]?"".concat(r).concat(a["".concat(t,"-bonus-level")]):"?";return n.a.createElement("div",{className:"grade-block"},n.a.createElement("div",{className:"grade-letter"},n.a.createElement("img",{src:"".concat(".","/grades/").concat(t,".png"),alt:t})),n.a.createElement("div",{className:"grade-level"},o),n.a.createElement("div",{className:"grade-progress"},s,"% (",100===s?l:c,"/",l,")"),n.a.createElement("div",{className:k()("progress-background",{complete:100===s,zero:0===s}),style:{height:"".concat(s,"%")}}))}renderAchievement(e,t){const a=Qe[e].icon,r=Qe[e].description;return n.a.createElement(ye.a,{key:e,content:n.a.createElement("div",null,r),tooltipClassName:"pumpking-tooltip achievement-tooltip"},n.a.createElement("div",{className:"ach-block"},a&&n.a.createElement("div",{className:"ach-icon"},n.a.createElement(a,null)),n.a.createElement("div",{className:"ach-name"},e),n.a.createElement("div",{className:k()("progress-background",{complete:100===t.progress,zero:0===t.progress}),style:{height:"".concat(Math.round(t.progress),"%")}})))}renderProfile(){const e=this.props,t=e.profile,a=e.otherPlayers,r=this.state.isLevelGraphCombined,s=t.expRankNext?(t.exp-t.expRank.threshold)/(t.expRankNext.threshold-t.expRank.threshold):100;return n.a.createElement("div",{className:"profile"},n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"profile-name text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,t.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",t.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"pp"),n.a.createElement("div",null,t.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,t.lastResultDate?me(t.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430")),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"text-with-header -select"},n.a.createElement("div",{className:"text-header"},"\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441"),n.a.createElement("div",null,n.a.createElement(ge.a,{closeMenuOnSelect:!0,className:"select players",classNamePrefix:"select",placeholder:"\u0438\u0433\u0440\u043e\u043a\u0438...",options:a,onChange:e=>{this.props.history.push(g.profile.compare.getPath({id:t.id,compareToId:e.id}))}})))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header _flex-row _align-center"},n.a.createElement("span",null,"\u043e\u043f\u044b\u0442"),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{onClick:this.onShowFaq,className:"_clickable"},n.a.createElement(O.n,{onClick:this.onShowFaq})),n.a.createElement(ba.a,{ariaHideApp:!1,className:"Modal faq-modal",overlayClassName:"Overlay",isOpen:this.state.showFaq,onRequestClose:this.onHideFaq},n.a.createElement("div",{className:"close-btn",onClick:this.onHideFaq},n.a.createElement(O.r,null))," ",n.a.createElement(Oa,null))),n.a.createElement("div",{className:"exp-range"},n.a.createElement("div",{className:"rank exp-rank"},Xe(t.expRank),t.expRank&&n.a.createElement("div",null,t.expRank.threshold)),n.a.createElement("div",{className:"exp-line-with-label"},n.a.createElement("div",{className:"exp-label"},t.expRankNext?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"taken-num"},Math.round(t.exp-t.expRank.threshold))," / ".concat(t.expRankNext.threshold-t.expRank.threshold)):null),n.a.createElement("div",{className:"exp-line"},n.a.createElement("div",{className:"taken",style:{width:Math.floor(100*s)+"%"}}),n.a.createElement("div",{className:"rest",style:{width:100-Math.ceil(100*s)+"%"}})),n.a.createElement("div",{className:"exp-label"},"total: ",n.a.createElement("span",{className:"taken-num"},Math.round(t.exp)))),t.expRankNext&&n.a.createElement("div",{className:"rank exp-rank"},Xe(t.expRankNext),t.expRankNext&&n.a.createElement("div",null,t.expRankNext.threshold)))),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},r?n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u043e\u0446\u0435\u043d\u043a\u0438"),n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Te,{className:"combine-toggle",checked:r,onChange:()=>this.setState(e=>({isLevelGraphCombined:!e.isLevelGraphCombined}))},"\u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438"))),n.a.createElement("div",{className:"chart-container single-double-labels"},this.renderGradesWithLevels())):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u0443\u0440\u043e\u0432\u043d\u0438"),n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Te,{className:"combine-toggle",checked:r,onChange:()=>this.setState(e=>({isLevelGraphCombined:!e.isLevelGraphCombined}))},"\u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438"))),n.a.createElement("div",{className:"chart-container"},this.renderLevels())),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043e\u0446\u0435\u043d\u043a\u0438")),n.a.createElement("div",{className:"chart-container"},this.renderGrades()))))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u044d\u043b\u043e (\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e)"))),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043c\u0435\u0441\u0442\u043e \u0432 \u0442\u043e\u043f\u0435 (\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e)")))))),n.a.createElement("div",{className:"profile-section progress-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"progress-blocks-single-double"},n.a.createElement("div",{className:"progress-block"},n.a.createElement("div",{className:"achievements-grades single"},this.renderGradeBlock("single","A"),this.renderGradeBlock("single","A+"),this.renderGradeBlock("single","S"),this.renderGradeBlock("single","SS"))),n.a.createElement("div",{className:"progress-block"},n.a.createElement("div",{className:"achievements-grades double"},this.renderGradeBlock("double","A"),this.renderGradeBlock("double","A+"),this.renderGradeBlock("double","S"),this.renderGradeBlock("double","SS")))),n.a.createElement("div",{className:"bonus-faq"},"* \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0430\u0447\u0438\u0432\u043a\u0438 \u043d\u0443\u0436\u043d\u043e \u0441\u044b\u0433\u0440\u0430\u0442\u044c \u043e\u043a\u043e\u043b\u043e 10% \u0432\u0441\u0435\u0445 \u0447\u0430\u0440\u0442\u043e\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u043b\u0435\u0432\u0435\u043b\u0430 \u043d\u0430 \u043d\u0443\u0436\u043d\u044b\u0439 \u0433\u0440\u0435\u0439\u0434")),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f")),n.a.createElement("div",{className:"achievements"},h.a.keys(t.achievements).map(e=>this.renderAchievement(e,t.achievements[e])))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u0447\u0430\u0441\u0442\u043e \u0438\u0433\u0440\u0430\u0435\u043c\u044b\u0435 \u0447\u0430\u0440\u0442\u044b")),n.a.createElement(va,{playerId:t.id})))}render(){const e=this.props,t=e.isLoading,a=e.profile,r=e.error;return st&&console.log("profile:",a),n.a.createElement("div",{className:"profile-page"},n.a.createElement("div",{className:"content"},r&&r.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{disabled:t,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(O.q,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")),t&&n.a.createElement(P,null),!t&&h.a.isEmpty(a)&&n.a.createElement("div",{className:"profile"},"Profile not found"),!t&&!h.a.isEmpty(a)&&this.renderProfile()))}}Ka.defaultProps={profile:{}};var Wa=Object(o.b)((e,t)=>({profile:Fa(e,t),otherPlayers:Ma(e,t),tracklist:e.tracklist.data,filter:e.profiles.filter,error:e.results.error||e.tracklist.error,isLoading:e.results.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}),Ba)(Object(m.g)(Ka)),Ga=a(196);a(430);function Ha(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}const Ua={SINGLE_TWO:"SINGLE_TWO",SINGLE_FIVE:"SINGLE_FIVE",DOUBLE_TWO:"DOUBLE_TWO",DOUBLE_FIVE:"DOUBLE_FIVE",BOTH_TWO:"BOTH_TWO",BOTH_FIVE:"BOTH_FIVE"},qa=e=>{switch(e){case Ua.SINGLE_TWO:return[n.a.createElement(Ea.a,{key:"11",dataKey:"single.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"22",dataKey:"single.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case Ua.SINGLE_FIVE:return[n.a.createElement(Ea.a,{key:"1",dataKey:"single.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"2",dataKey:"single.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"3",dataKey:"single.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"4",dataKey:"single.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"5",dataKey:"single.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case Ua.DOUBLE_TWO:return[n.a.createElement(Ea.a,{key:"11",dataKey:"double.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"22",dataKey:"double.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case Ua.DOUBLE_FIVE:return[n.a.createElement(Ea.a,{key:"1",dataKey:"double.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"2",dataKey:"double.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"3",dataKey:"double.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"4",dataKey:"double.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"5",dataKey:"double.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case Ua.BOTH_TWO:return[n.a.createElement(Ea.a,{key:"11",dataKey:"all.twoBars.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"22",dataKey:"all.twoBars.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];case Ua.BOTH_FIVE:return[n.a.createElement(Ea.a,{key:"1",dataKey:"all.p1win",fill:"#4696f0",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"2",dataKey:"all.p2notPlayed",fill:"#899db3",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"3",dataKey:"all.notPlayed",fill:"#70707060",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"4",dataKey:"all.p1notPlayed",fill:"#bfa988",stackId:"stack",isAnimationActive:!0}),n.a.createElement(Ea.a,{key:"5",dataKey:"all.p2win",fill:"#eda338",stackId:"stack",isAnimationActive:!0})];default:return null}},Va=void 0,za=Aa("id"),Ja=Aa("compareToId"),Ya=Object(Ga.a)()((e,t,a)=>{if(!e||!t)return{};const r=h.a.fromPairs(Array.from({length:28}).map((e,t)=>[t+1,{}]));return h.a.keys(r).forEach(n=>{const s=h.a.flow(h.a.map("chart"),h.a.uniqBy("sharedChartId"))([...e.resultsByLevel[n],...t.resultsByLevel[n]]),l={x:n,all:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}},double:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}},single:{p1win:0,p1notPlayed:0,p2win:0,p2notPlayed:0,notPlayed:0,twoBars:{}}};s.forEach(a=>{const r=a.results.findIndex(t=>t.playerId===e.id),n=a.results.findIndex(e=>e.playerId===t.id),s=a.chartType.startsWith("D")?l.double:l.single;r<0&&n<0?console.log("wtf?"):r<0?(l.all.p1notPlayed++,s.p1notPlayed++):n<0?(l.all.p2notPlayed++,s.p2notPlayed++):r<n?(l.all.p1win++,s.p1win++):n<r&&(l.all.p2win++,s.p2win++)});const c=e=>{const t=e.p1win+e.p2win||1;e.twoBars.p1win=e.p1win/t,e.twoBars.p2win=e.p2win/t};c(l.all),c(l.single),c(l.double);const o=(e,t)=>{e.p1win=e.p1win/t,e.p1notPlayed=e.p1notPlayed/t,e.p2win=e.p2win/t,e.p2notPlayed=e.p2notPlayed/t,e.notPlayed=1-e.p1win-e.p1notPlayed-e.p2win-e.p2notPlayed};o(l.all,a.chartLevels[n]),o(l.double,a.doublesLevels[n]),o(l.single,a.singlesLevels[n]),r[n]=l}),{perLevelComparison:h.a.values(r)}}),Xa={fetchResults:Pt,setProfilesFilter:xa,resetProfilesFilter:Ra};class Za extends r.Component{constructor(...e){super(...e),this.state={isLevelGraphCombined:!0,compareBarsMode:Ua.BOTH_TWO},this.onRefresh=()=>{!this.props.isLoading&&this.props.fetchResults()},this.onChangeDayRange=e=>{const t=this.props.filter;this.props.setProfilesFilter(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ha(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ha(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},t,{dayRange:e}))},this.rhMargin={top:5,bottom:5,right:5,left:0},this.rhXDomain=["dataMin","dataMax"],this.rhYDomain=["dataMin - 100","dataMax + 100"],this.rhXTickFormatter=e=>de(e).toLocaleDateString(),this.rhTooltip=({active:e,payload:t,label:a})=>{const r=this.props,s=r.profile,l=r.profile2,c=s.name,o=l.name;return t&&t[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,de(t[0].payload.date).toLocaleDateString()),t[1]&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[1].color}},c,": ",Math.round(t[1].value)),t[0]&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[0].color}},o,": ",Math.round(t[0].value))):null},this.plcMargin={top:5,bottom:5,right:5,left:0},this.plcTooltip=({active:e,payload:t,label:a})=>{const r=this.props,s=r.profile,l=r.profile2,c=this.state.compareBarsMode,o=[Ua.SINGLE_TWO,Ua.DOUBLE_TWO,Ua.BOTH_TWO].includes(c),i=s.name,m=l.name;if(!t||!t[0])return null;const d=(e,t)=>n.a.createElement("div",{key:e.name,style:{fontWeight:"bold",color:e.color}},t,": ",Math.round(100*h.a.get(e.dataKey,e.payload)),"%");return n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,"Level: ",t[0].payload.x),d(t[0],"".concat(i," wins")),!o&&d(t[1],"".concat(m," has no score")),!o&&d(t[2],"Both have no score"),!o&&d(t[3],"".concat(i," has no score")),d(o?t[1]:t[4],"".concat(m," wins")))},this.plcXDomain=[0,1],this.plcXTicks=[0,.5,1],this.plcXFormatter=e=>"".concat(Math.round(100*e),"%")}renderRankingHistory(){const e=this.props.combinedData;return n.a.createElement(Ea.i,{minHeight:Va,aspect:1.6},n.a.createElement(Ea.g,{data:e.ratingChanges,margin:this.rhMargin},n.a.createElement(Ea.c,{strokeDasharray:"3 3"}),n.a.createElement(Ea.k,{dataKey:"date",type:"number",domain:this.rhXDomain,tickFormatter:this.rhXTickFormatter}),n.a.createElement(Ea.l,{allowDecimals:!1,domain:this.rhYDomain,tickFormatter:Math.round,width:40}),n.a.createElement(Ea.h,{y:1e3,stroke:"white"}),n.a.createElement(Ea.j,{isAnimationActive:!1,content:this.rhTooltip}),n.a.createElement(Ea.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating2",stroke:"#ffd388",strokeWidth:3,dot:!1}),n.a.createElement(Ea.f,{type:"monotone",isAnimationActive:!1,dataKey:"rating1",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderPlaceHistory(){const e=this.props,t=e.combinedData,a=e.profile,r=e.profile2,s=a.name,l=r.name;return n.a.createElement(Ea.i,{minHeight:Va,aspect:1.6},n.a.createElement(Ea.g,{data:t.placesChanges,margin:{top:5,bottom:5,right:5,left:0}},n.a.createElement(Ea.c,{strokeDasharray:"3 3"}),n.a.createElement(Ea.k,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>de(e).toLocaleDateString()}),n.a.createElement(Ea.l,{allowDecimals:!1,domain:[1,e=>e<3?e+2:e+1],interval:0,reversed:!0,width:40}),n.a.createElement(Ea.j,{isAnimationActive:!1,content:({active:e,payload:t,label:a})=>t&&t[0]?n.a.createElement("div",{className:"history-tooltip"},n.a.createElement("div",null,de(t[0].payload.date).toLocaleDateString()),t[1]&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[1].color}},s,": #",t[1].value),t[0]&&n.a.createElement("div",{style:{fontWeight:"bold",color:t[0].color}},l,": #",t[0].value)):null}),n.a.createElement(Ea.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place2",stroke:"#ffd388",strokeWidth:3,dot:!1}),n.a.createElement(Ea.f,{isAnimationActive:!1,type:"stepAfter",dataKey:"place1",stroke:"#88d3ff",strokeWidth:3,dot:!1})))}renderPerLevelComparison(){const e=this.props.combinedData,t=this.state.compareBarsMode;return n.a.createElement(Ea.i,{width:"100%",aspect:.7},n.a.createElement(Ea.b,{layout:"vertical",data:[...e.perLevelComparison],margin:this.plcMargin},n.a.createElement(Ea.j,{isAnimationActive:!1,content:this.plcTooltip}),n.a.createElement(Ea.l,{reversed:!0,dataKey:"x",type:"category",width:23}),n.a.createElement(Ea.k,{type:"number",domain:this.plcXDomain,ticks:this.plcXTicks,tickFormatter:this.plcXFormatter}),n.a.createElement(Ea.h,{x:.5,stroke:"#666"}),qa(t)))}renderProfile(){const e=this.props,t=e.profile,a=e.profile2,r=this.state.compareBarsMode;return n.a.createElement("div",{className:"profile"},n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"profile-name text-with-header blue"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,t.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",t.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,t.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,t.lastResultDate?me(t.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430"))),n.a.createElement("div",{className:"profile-header right-align"},n.a.createElement("div",{className:"profile-name text-with-header orange"},n.a.createElement("div",{className:"text-header"},"\u0438\u0433\u0440\u043e\u043a"),n.a.createElement("div",null,a.name)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u0440\u0430\u043d\u043a"),n.a.createElement("div",null,"#",a.rank)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u044d\u043b\u043e"),n.a.createElement("div",null,a.rating)),n.a.createElement("div",{className:"text-with-header"},n.a.createElement("div",{className:"text-header"},"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0438\u0433\u0440\u0430"),n.a.createElement("div",null,a.lastResultDate?me(a.lastResultDate):"\u043d\u0438\u043a\u043e\u0433\u0434\u0430"))),n.a.createElement("div",{className:"profile-section-horizontal-container"},n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header flex"},n.a.createElement("span",null,"\u043f\u043e\u0431\u0435\u0434\u044b \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c")),n.a.createElement("div",{className:"profile-sm-section-header flex"},(()=>{const e=[Ua.SINGLE_TWO,Ua.DOUBLE_TWO,Ua.BOTH_TWO].includes(r);return n.a.createElement("div",{className:"toggle-holder"},n.a.createElement(Te,{className:"combine-toggle",checked:!e,onChange:()=>this.setState(e=>({compareBarsMode:{[Ua.SINGLE_TWO]:Ua.SINGLE_FIVE,[Ua.DOUBLE_TWO]:Ua.DOUBLE_FIVE,[Ua.BOTH_TWO]:Ua.BOTH_FIVE,[Ua.SINGLE_FIVE]:Ua.SINGLE_TWO,[Ua.DOUBLE_FIVE]:Ua.DOUBLE_TWO,[Ua.BOTH_FIVE]:Ua.BOTH_TWO}[e.compareBarsMode]}))},"\u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e"),n.a.createElement("div",{className:"tabs-holder"},n.a.createElement(Ae,{text:"\u0432\u0441\u0435",active:[Ua.BOTH_TWO,Ua.BOTH_FIVE].includes(r),onToggle:()=>{this.setState(t=>({compareBarsMode:e?Ua.BOTH_TWO:Ua.BOTH_FIVE}))}}),n.a.createElement(Ae,{text:"\u0441\u0438\u043d\u0433\u043b\u044b",active:[Ua.SINGLE_TWO,Ua.SINGLE_FIVE].includes(r),onToggle:t=>{this.setState(t=>({compareBarsMode:e?Ua.SINGLE_TWO:Ua.SINGLE_FIVE}))}}),n.a.createElement(Ae,{text:"\u0434\u0430\u0431\u043b\u044b",active:[Ua.DOUBLE_TWO,Ua.DOUBLE_FIVE].includes(r),onToggle:t=>{this.setState(t=>({compareBarsMode:e?Ua.DOUBLE_TWO:Ua.DOUBLE_FIVE}))}})))})()),n.a.createElement("div",{className:"chart-container"},this.renderPerLevelComparison())))),n.a.createElement("div",{className:"profile-section"},n.a.createElement("div",{className:"profile-section-content"},n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u044d\u043b\u043e"))),n.a.createElement("div",{className:"profile-section-2"},n.a.createElement("div",{className:"profile-sm-section-header"},n.a.createElement("span",null,"\u043c\u0435\u0441\u0442\u043e \u0432 \u0442\u043e\u043f\u0435")))))))}render(){const e=this.props,t=e.isLoading,a=e.profile,r=e.error;return st&&console.log("profile:",a),n.a.createElement("div",{className:"profile-compare-page"},n.a.createElement("div",{className:"content"},r&&r.message,n.a.createElement("div",{className:"top-controls"},n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("button",{disabled:t,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh},n.a.createElement(O.q,null)," \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")),t&&n.a.createElement(P,null),!t&&h.a.isEmpty(a)&&n.a.createElement("div",{className:"profile"},"Profile not found"),!t&&!h.a.isEmpty(a)&&this.renderProfile()))}}Za.defaultProps={profile:{},profile2:{},combinedData:{}};var Qa=Object(o.b)((e,t)=>{const a=za(e,t),r=Ja(e,t);return{profile:a,profile2:r,combinedData:Ya(a,r,e.tracklist.data),tracklist:e.tracklist.data,filter:e.profiles.filter,error:e.results.error||e.tracklist.error,isLoading:e.results.isLoading||e.results.isLoadingRanking||e.tracklist.isLoading}},Xa)(Object(m.g)(Za));a(431);function $a(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function er(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$a(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$a(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const tr="USER/LOADING",ar="USER/SUCCESS",rr="USER/ERROR",nr={isLoading:!1,data:null};const sr=()=>async e=>{e({type:tr});try{const t=await e(L({url:"".concat(_,"/profile")}));return e({type:ar,data:t}),t}catch(t){return e({type:rr,error:t}),null}};function lr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function cr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?lr(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):lr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const or="LOGIN/LOADING",ir="LOGIN/SUCCESS",mr="LOGIN/ERROR",dr={isLoading:!1,data:null,error:null};const pr=e=>async t=>{t({type:or});try{const a=await t(I({url:"".concat(_,"/login/google"),body:{token:e.tokenId}}));return w.a.set("session",a.session,{expires:30}),t({type:ir,data:a}),t(sr()),a}catch(a){return t({type:mr,error:a}),null}},ur={login:pr,logout:()=>async e=>{e({type:or}),e(x());try{const t=await e(I({url:"".concat(_,"/logout")}));return e({type:ir,data:t}),t}catch(t){return e({type:mr,error:t}),null}}};var hr=Object(o.b)(e=>({isLoadingLogin:e.login.isLoading,isLoadingUser:e.user.isLoading,user:e.user.data}),ur)((function({isLoadingLogin:e,isLoadingUser:t,user:a,login:r,logout:s}){return n.a.createElement("header",{className:"top-bar"},n.a.createElement("nav",null,n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:g.leaderboard.path},"leaderboard")),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:g.ranking.path},"ranking")),n.a.createElement("li",null,n.a.createElement(c.c,{exact:!0,to:g.songs.path},"songs")))),n.a.createElement("div",{className:"_flex-fill"}),n.a.createElement("div",{className:"login-container"},n.a.createElement(c.c,{className:"player-info",exact:!0,to:g.profile.getPath({id:h.a.get("player.id",a)})},h.a.getOr("","player.nickname",a)),n.a.createElement("button",{className:"btn btn-dark btn-icon btn-sm",onClick:s,disabled:e||t},n.a.createElement("span",null," logout"))))})),gr=a(197),fr=a(198),br=a.n(fr);a(441);const Er={login:pr};var yr=Object(o.b)(e=>({isLoading:e.login.isLoading,error:e.login.error}),Er)((function({isLoading:e,error:t,login:a}){const s=Object(r.useState)(!1),l=Object(v.a)(s,2),c=l[0],o=l[1],i=e=>{e.error?console.log("Google login response error:",e):a(e)};return n.a.createElement("div",{className:"login-screen"},n.a.createElement("div",{className:"site-name"},"pumpking"),n.a.createElement("div",{className:"login-button"},n.a.createElement(gr.GoogleLogin,{clientId:"197132042723-cmibep21qf6dald9l2l01rif7l5dtd4s.apps.googleusercontent.com",buttonText:"Login",onSuccess:i,onFailure:i,cookiePolicy:"single_host_origin",render:({onClick:t,disabled:a})=>n.a.createElement("button",{className:"btn btn-dark btn-icon btn-sm",onClick:t,disabled:a||e},n.a.createElement(O.j,null),n.a.createElement("span",null," login"))})),t&&n.a.createElement("div",{className:"error"},t.message),n.a.createElement("div",{className:"footer"},"By logging in, you agree to our"," ",c?n.a.createElement(br.a,{text:"\ud83e\udd21",className:"clown"}):n.a.createElement("span",{onClick:()=>o(!0),className:"link-style"},"Privacy Policy")))})),vr=a(119),Or=a.n(vr);a(444);function Nr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function kr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Nr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Pr="TOP_PER_SONG/LOADING",Sr="TOP_PER_SONG/SUCCESS",wr="TOP_PER_SONG/ERROR",jr={isLoading:!1,data:null,error:null,fetchingParams:null};function xr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Rr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xr(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Dr="TRACKLIST/LOADING",Lr="TRACKLIST/SUCCESS",Ir="TRACKLIST/ERROR",Cr={isLoading:!1,data:[]};const Ar=()=>async e=>{e({type:Dr});try{const t=await e(L({url:"".concat(_,"/tracklist/stats/XX")}));return e({type:Lr,data:t}),t}catch(t){return e({type:Ir,error:t}),null}};function _r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Tr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}te.a.addLocale(re.a);const Fr=new te.a("ru-RU"),Mr={flavour:"long",gradation:ne.a,units:["day","week","month"]},Br=e=>{const t=le()().startOf("day").diff(le()(e).startOf("day"),"days");return 0===t?"\u0441\u0435\u0433\u043e\u0434\u043d\u044f":1===t?"\u0432\u0447\u0435\u0440\u0430":Fr.format(e,Mr)},Kr=e=>Tr({},e,{results:h.a.flow(h.a.get("results"),h.a.values,h.a.map(t=>{const a=h.a.find(e=>h.a.every(h.a.isNumber,[e.perfects,e.greats,e.goods,e.bads,e.misses]),t.results),r=a&&[a.perfects,a.greats,a.goods,a.bads,a.misses].reduce((e,t)=>e+t,0),n=t.chart_label.match(/(\D+)|(\d+)/g),s=Object(v.a)(n,2),l=s[0],c=s[1];return{song:t.track,chartLabel:t.chart_label,chartLevel:c,chartType:l,mix:t.mix,duration:t.duration,results:t.results.map((t,a)=>{let n={};if(r){const e=[t.perfects,t.greats,t.goods,t.bads,t.misses];let a=-1,s=0;1===e.filter((e,t)=>h.a.isNumber(e)?(s+=e,!1):(a=t,!0)).length&&(n[["perfect","great","good","bad","miss"][a]]=r-s)}return Tr({id:t.id,playerId:t.player,nickname:e.players[t.player].nickname,nicknameArcade:e.players[t.player].arcade_name,originalChartMix:t.originalChartMix,originalChartLabel:t.originalChartLabel,originalScore:t.originalScore,date:t.gained,dateObject:new Date(t.gained),grade:t.grade,isExactDate:!!t.exact_gain_date,score:t.score,scoreIncrease:t.score_increase,calories:t.calories&&t.calories/1e3,perfect:t.perfects,great:t.greats,good:t.goods,bad:t.bads,miss:t.misses,combo:t.max_combo,mods:t.mods_list,isRank:!!t.rank_mode,isHJ:(t.mods_list||"").split(" ").includes("HJ")},n)})}}),h.a.map(e=>Tr({},e,{latestScoreDate:e.results.reduce((e,t)=>t.date>e?t.date:e,e.results[0].date),results:e.results.map(t=>{const a=Math.sqrt(t.perfect)*h.a.toInteger(e.chartLevel)/2,r=a?Math.floor((100*a+60*t.great+30*t.good+-20*t.miss)/(a+t.great+t.good+t.bad+t.miss)*100)/100:null,n=t.perfect?Math.floor((100*t.perfect+60*t.great+30*t.good+-20*t.miss)/(t.perfect+t.great+t.good+t.bad+t.miss)*100)/100:null;return Tr({},t,{accuracy:r<0?0:100===n?100:r&&+r.toFixed(2),accuracyRaw:n,hasRankScore:h.a.some({playerId:t.playerId,isRank:!0},e.results)})})})),h.a.orderBy(["latestScoreDate","song","chartLevel"],["desc","asc","desc"]))(e)});function Wr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Gr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Wr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Hr=6e5,Ur={fetchResults:Pt,fetchTopPerSong:(e,t,a)=>{const r=Ve.a.stringify({song_name:e,charts:h.a.compact(h.a.uniq([t,a])).join(",")});return async e=>{e({type:Pr,fetchingParams:r});try{const t=await e(L({url:"".concat(_,"/topPerSong?").concat(r)}));return e({type:Sr,data:t,fetchingParams:r}),t}catch(t){return e({type:wr,error:t,fetchingParams:r}),null}}},fetchTracklist:Ar,appendNewResults:e=>async(t,a)=>{const r=a().results,n=r.originalData,s=r.sharedCharts;if(!e)return t(Pt());t({type:ot});try{const a=await t(L({url:"".concat(_,"/results/highscores?").concat(Ve.a.stringify({start_date:e}))}));if(a.error)throw new Error(a.error);const r=h.a.filter(e=>{const t=s[e.shared_chart];return!t||!h.a.some(t=>t.playerId===e.player&&t.isRank===!!e.rank_mode&&t.score>e.score,t.results)},a.results);console.log("Received results:",a,"; Will append:",r);const l={players:a.players,results:[...n.results,...r],shared_charts:ct({},n.shared_charts,{},a.shared_charts)};t(St(l))}catch(l){console.log(l),t({type:mt,error:l})}}},qr=(e,t)=>n.a.createElement("div",{className:k()("chart-name",{single:"S"===e,singlep:"SP"===e,doublep:"DP"===e,double:"D"===e,coop:"COOP"===e})},n.a.createElement("span",{className:"chart-letter"},e),n.a.createElement("span",{className:"chart-number"},t));var Vr=Object(o.b)(e=>({isLoading:e.topPerSong.isLoading,songTopData:e.topPerSong.data,error:e.topPerSong.error,profiles:e.results.profiles,resultInfo:e.results.resultInfo}),Ur)((function({isLoading:e,fetchResults:t,fetchTracklist:a,fetchTopPerSong:s,appendNewResults:l,songTopData:c,error:o,profiles:i,resultInfo:m={}}){const d=Object(r.useState)(""),p=Object(v.a)(d,2),u=p[0],g=p[1],f=Object(r.useState)(""),b=Object(v.a)(f,2),E=b[0],y=b[1],N=Object(r.useState)(!1),S=Object(v.a)(N,2),w=S[0],j=S[1],x=Object(r.useState)(!1),R=Object(v.a)(x,2),D=R[0],L=R[1],I=Object(r.useState)(null),C=Object(v.a)(I,2),A=C[0],_=C[1],F=Object(r.useState)(null),M=Object(v.a)(F,2),B=M[0],K=M[1],W=Object(r.useState)(null),G=Object(v.a)(W,2),H=G[0],U=G[1],q=Object(r.useState)(null),V=Object(v.a)(q,2),z=V[0],J=V[1],Y=Object(r.useState)(""),X=Object(v.a)(Y,2),Z=X[0],Q=X[1],$=Object(r.useRef)(null),ee=Object(r.useRef)(null),te=h.a.values(h.a.get("results",Kr(c))),ae=h.a.find({chartLabel:A},te),re=h.a.find({chartLabel:B},te),ne=h.a.uniq(h.a.compact([ae,re])),se=h.a.flow(h.a.values,h.a.orderBy("ratingRaw","desc"),e=>e.map((e,t)=>Gr({place:t+1},e)))(i);let le={},ce={};H&&(le=h.a.minBy(e=>Or.a.get(e.nameArcade,H),h.a.values(i))||{}),z&&(ce=h.a.minBy(e=>Or.a.get(e.nameArcade,z),h.a.values(i))||{});const oe=Object(r.useState)({name:le.name,ratingRaw:null,exp:null}),ie=Object(v.a)(oe,2),me=ie[0],de=ie[1],pe=Object(r.useState)({name:ce.name,ratingRaw:null,exp:null}),ue=Object(v.a)(pe,2),he=ue[0],ge=ue[1],fe=Object(r.useCallback)(()=>{L(!0),ee.current&&clearTimeout(ee.current),ee.current=setTimeout(()=>{},Hr)},[]);Object(r.useEffect)(()=>{le.ratingRaw&&le.ratingRaw!==me.ratingRaw&&de(Gr({},me,{ratingRaw:le.ratingRaw,prevRatingRaw:me.ratingRaw,expRank:le.expRank,expRankNext:le.expRankNext})),le.exp&&le.exp!==me.exp&&de(Gr({},me,{exp:le.exp,prevExp:me.exp,expRank:le.expRank||me.expRank,expRankNext:le.expRankNext||me.expRankNext})),ce.ratingRaw&&ce.ratingRaw!==he.ratingRaw&&ge(Gr({},he,{ratingRaw:ce.ratingRaw,prevRatingRaw:he.ratingRaw,expRank:ce.expRank,expRankNext:ce.expRankNext})),ce.exp&&ce.exp!==he.exp&&ge(Gr({},he,{exp:ce.exp,prevExp:he.exp,expRank:ce.expRank||he.expRank,expRankNext:ce.expRankNext||he.expRankNext})),me.name!==le.name&&de(Gr({},me,{ratingRaw:le.ratingRaw,prevRatingRaw:null,exp:le.exp,expRank:le.expRank,expRankNext:le.expRankNext,prevExp:null,name:le.name})),he.name!==ce.name&&ge(Gr({},he,{ratingRaw:ce.ratingRaw,prevRatingRaw:null,exp:ce.exp,expRank:ce.expRank,expRankNext:ce.expRankNext,prevExp:null,name:ce.name}))},[le.ratingRaw,ce.ratingRaw,le.exp,ce.exp,le.name,ce.name,me,he]),Object(r.useEffect)(()=>{$.current=new WebSocket(T),$.current.onerror=()=>{g("Cannot connect to websocket server, please reload the page")},$.current.onopen=e=>{j(!0)}},[]),Object(r.useEffect)(()=>{$.current.onmessage=e=>{fe();try{const t=e&&e.data&&JSON.parse(e.data);if(console.log(t),"result_screen"===t.type){const e=t.data.track_name,a=h.a.get("left.chart_label",t.data),r=h.a.get("right.chart_label",t.data),n=h.a.get("left.result.player_name",t.data),c=h.a.get("right.result.player_name",t.data);U(n),J(c),_(a),K(r),Q(e),l(t.data.gained),s(e,a,r)}else if("chart_selected"===t.type&&(y(t.data.error||""),(t.data.leftPlayer||t.data.rightPlayer)&&(U(t.data.leftPlayer),J(t.data.rightPlayer)),(t.data.leftLabel||t.data.rightLabel)&&(_(t.data.leftLabel),K(t.data.rightLabel),t.data.text))){const e=t.data.text;Q(e),console.log("song name",e,Z),Z!==e&&s(e,t.data.leftLabel,t.data.rightLabel)}}catch(t){console.log("on message error",t),g("Error: ".concat(t.message))}}},[Z,s,fe,l]);const Ee=Object(r.useRef)(null),ye=Object(r.useRef)(null),ve=Object(r.useRef)(null);Object(r.useEffect)(()=>{if(Ee.current&&ye.current)if(ve.current){const e=ye.current,t=ve.current,a={w:Ee.current.clientWidth,h:Ee.current.clientHeight},r=a.w/(e.offsetWidth+t.offsetWidth),n=a.h/Math.max(e.offsetHeight,t.offsetHeight),s=a.w/Math.max(e.offsetWidth,t.offsetWidth),l=a.h/(e.offsetHeight+t.offsetHeight);Math.min(r,n)>Math.min(s,l)?(Ee.current.style.flexDirection="row",Ee.current.style.alignItems="center",Ee.current.style.transform="scale(".concat(r>n?.98*n:.98*r,")")):(Ee.current.style.flexDirection="column",Ee.current.style.alignItems="center",Ee.current.style.transform="scale(".concat(s>l?.98*l:.98*s,")"))}else{const e=ye.current,t={w:Ee.current.clientWidth,h:Ee.current.clientHeight},a=t.w/e.offsetWidth,r=t.h/e.offsetHeight;Ee.current.style.transform="scale(".concat(a<r?.98*a:.98*r,")")}});const Oe=({player:e,profile:t,label:a,data:r,isLeft:s=!1})=>{const l=(e,t)=>{if(!t||t===e)return null;const a=e-t;return n.a.createElement("span",{className:"change ".concat(a>=0?"pos":"neg")},a<0?a.toFixed(1):"+".concat(a.toFixed(1)))},c=h.a.findIndex({id:t.id},se),o=se.slice(Math.max(0,c-1),Math.min(c+2,se.length));return n.a.createElement("div",{className:"player-container ".concat(s?"left":"right")},e&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"title-header"},"player ",s?1:2,":"),n.a.createElement("div",{className:"name-with-label"},n.a.createElement("div",{className:"name"},t.name||e),n.a.createElement("div",{className:"chart-label"},a&&qr(...a.match(/(\D+)|(\d+)/g)))),r.exp&&r.expRank&&n.a.createElement("div",{className:"exp exp-rank"},Xe(r.expRank),(()=>{if(!r.expRank||!r.exp)return null;let e=r.expRankNext?(r.exp-r.expRank.threshold)/(r.expRankNext.threshold-r.expRank.threshold):1;const t=1-e;let a=0;return r.prevExp&&(a=1-t-(e=r.expRankNext?(r.prevExp-r.expRank.threshold)/(r.expRankNext.threshold-r.expRank.threshold):1)),n.a.createElement("div",{className:"exp-line"},n.a.createElement("div",{className:"taken",style:{width:Math.floor(100*e)+"%"}}),n.a.createElement("div",{className:"diff",style:{width:Math.ceil(100*a)+"%"}}),n.a.createElement("div",{className:"rest",style:{width:Math.ceil(100*t)+"%"}}))})()),r.exp&&n.a.createElement("div",{className:"exp-text"},n.a.createElement("span",{className:"_grey-text"},"exp:")," ",Math.round(r.exp)," ",l(r.exp,r.prevExp)),r.ratingRaw&&n.a.createElement("div",{className:"rating"},n.a.createElement("span",{className:"_grey-text"},"pp:")," ",Math.round(r.ratingRaw)," ",l(r.ratingRaw,r.prevRatingRaw)),n.a.createElement("div",{className:"closest-players"},h.a.map(e=>n.a.createElement("div",{className:"closest-player ".concat(t.id===e.id?"current-player":"")},n.a.createElement("div",{className:"place"},"#",e.place),n.a.createElement("div",{className:"name"},e.name),n.a.createElement("div",{className:"elo"},e.rating)),o))))};return n.a.createElement("div",{className:"tracker-container"},n.a.createElement("div",{className:"sidebar"},Oe({player:H,profile:le,label:A,data:me,isLeft:!0}),Oe({player:z,profile:ce,label:B,data:he})),n.a.createElement("div",{className:"results",ref:Ee},(o||u)&&n.a.createElement("div",{className:"error"},u,n.a.createElement("br",null),o&&o.message),w&&!H&&!z&&!E&&!e&&h.a.isEmpty(ne)&&(D?n.a.createElement("div",{className:"msg"},"Waiting for chart select..."):n.a.createElement("div",{className:"offline msg"},"Recognizer is offline")),w&&(A||B)&&!E&&!e&&h.a.isEmpty(ne)&&"No results for this chart",e&&n.a.createElement(P,null),!e&&ne.map((e,t)=>{let a=1;const r=[],s=e.results.map((t,n)=>{const s=r.includes(t.nickname);return r.push(t.nickname),0===n?a=1:s||t.score===h.a.get([n-1,"score"],e.results)||(a+=1),Gr({},t,{topPlace:a,isSecondOccurenceInResults:s})});return n.a.createElement("div",{className:"song-block",key:e.song+e.chartLabel,ref:0===t?ye:ve},n.a.createElement("div",{className:"song-name"},qr(e.chartType,e.chartLevel),n.a.createElement("div",null,e.song)),n.a.createElement("div",{className:"charts"},n.a.createElement("div",{className:"chart"},n.a.createElement("div",{className:"results"},n.a.createElement("table",null,n.a.createElement("tbody",null,s.map((t,a)=>{let r,l;if(t.scoreIncrease&&t.date===e.latestScoreDate){const e=t.score-t.scoreIncrease;r=(l=h.a.findLastIndex(t=>t.score>e,s))-a}const c=h.a.getOr("","[".concat(t.id,"].pp.ppFixed"),m);return n.a.createElement("tr",{key:t.score+t.nickname,className:k()({empty:!t.isExactDate,latest:t.date===e.latestScoreDate,left:t.nickname===le.name,right:t.nickname===ce.name})},n.a.createElement("td",{className:"nickname"},t.nickname,!!r&&n.a.createElement("span",{className:"change-holder up"},n.a.createElement("span",null,r),n.a.createElement(O.b,null))),n.a.createElement("td",{className:"pp"},c,c&&n.a.createElement("span",{className:"_grey"},"pp")),n.a.createElement("td",{className:k()("judge",{vj:t.isRank,hj:t.isHJ})},t.isRank&&n.a.createElement("div",{className:"inner"},t.isExactDate?"VJ":"VJ?"),t.isHJ&&n.a.createElement("div",{className:"inner"},"HJ")),n.a.createElement("td",{className:"score"},n.a.createElement("span",{className:"score-span"},t.scoreIncrease>.8*t.score&&"*",be()(t.score).format("0,0"))),n.a.createElement("td",{className:"grade"},n.a.createElement("div",{className:"img-holder"},t.grade&&"?"!==t.grade&&n.a.createElement("img",{src:"".concat(".","/grades/").concat(t.grade,".png"),alt:t.grade}),"?"===t.grade&&null)),n.a.createElement("td",{className:"number miss"},t.miss),n.a.createElement("td",{className:"number bad"},t.bad),n.a.createElement("td",{className:"number good"},t.good),n.a.createElement("td",{className:"number great"},t.great),n.a.createElement("td",{className:"number perfect"},t.perfect),n.a.createElement("td",{className:"combo"},t.combo,t.combo?"x":""),n.a.createElement("td",{className:"accuracy"},t.accuracy,t.accuracy?"%":""),n.a.createElement("td",{className:k()("date",{latest:t.date===e.latestScoreDate})},Br(t.dateObject),t.isExactDate?"":"?"))})))))))})))}));function zr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Jr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?zr(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):zr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Yr={setFilter:wt,fetchResults:Pt,fetchTracklist:Ar,fetchUser:sr};var Xr=Object(o.b)(e=>({data:e.user.data,isLoading:e.user.isLoading}),Yr)((function(e){const t=e.fetchUser,a=e.fetchTracklist,s=e.fetchResults,l=e.setFilter,c=e.data,o=e.isLoading;return Object(r.useEffect)(()=>{p.a.getItem("filter").then(e=>{e&&l(Jr({},e,{chartRange:e.chartRange&&Jr({},e.chartRange,{range:h.a.every(e=>e>=b[0]&&e<=b[1],e.chartRange.range)?e.chartRange.range:b})}))}).catch(e=>console.error("Cannot get filter from local storage",e)),t()},[t,a,s,l]),Object(r.useEffect)(()=>{c&&c.player&&a().then(()=>{s()})},[c,s,a]),o?n.a.createElement("div",{className:"container"},n.a.createElement(P,null)):c&&c.player?Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_SOCKET?n.a.createElement(Vr,null):n.a.createElement("div",{className:"container"},n.a.createElement(hr,null),n.a.createElement(m.b,{exact:!0,path:"/",render:()=>n.a.createElement(m.a,{to:g.leaderboard.path})}),n.a.createElement(m.b,{path:g.leaderboard.path,component:oa}),n.a.createElement(m.b,{path:g.ranking.path,component:ga}),n.a.createElement(m.b,{path:g.profile.path},n.a.createElement(m.d,null,n.a.createElement(m.b,{path:g.profile.path,exact:!0,component:Wa}),n.a.createElement(m.b,{path:g.profile.compare.path,exact:!0,component:Qa}))),n.a.createElement(m.b,{path:g.songs.path,component:he})):n.a.createElement(yr,null)})),Zr=a(39),Qr=a(120),$r=Object(Zr.c)({mostPlayed:function(e=G,t){switch(t.type){case B:return M({},e,{isLoading:!0});case W:return M({},e,{isLoading:!1,error:t.error});case K:return M({},e,{isLoading:!1,data:t.data});default:return e}},mostPlayedMonth:function(e=J,t){switch(t.type){case q:return U({},e,{isLoading:!0});case z:return U({},e,{isLoading:!1,error:t.error});case V:return U({},e,{isLoading:!1,data:t.data});default:return e}},leastPlayed:function(e=ee,t){switch(t.type){case Z:return X({},e,{isLoading:!0});case $:return X({},e,{isLoading:!1,error:t.error});case Q:return X({},e,{isLoading:!1,data:t.data});default:return e}}});const en=Object(Zr.c)({topPerSong:function(e=jr,t){switch(t.type){case Pr:return kr({},e,{isLoading:!0,fetchingParams:t.fetchingParams,data:null,error:null});case wr:return t.fetchingParams===e.fetchingParams?kr({},e,{isLoading:!1,error:t.error,data:null,fetchingParams:null}):e;case Sr:return t.fetchingParams===e.fetchingParams?kr({},e,{isLoading:!1,data:t.data,fetchingParams:null}):e;default:return e}},login:function(e=dr,t){switch(t.type){case or:return cr({},e,{isLoading:!0,data:null,error:null});case mr:return cr({},e,{isLoading:!1,error:t.error,data:null});case ir:return cr({},e,{isLoading:!1,data:t.data});default:return e}},presets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ct:var a=h.a.find({name:h.a.get("name",e.currentPreset)},t.presets);return Lt({},e,{currentPreset:Ft(a)||null,presets:h.a.map(Ft,t.presets)});case It:return Lt({},e,{currentPreset:Ft(t.currentPreset)});case At:return Lt({},e,{isLoading:!0});case _t:return Lt({},e,{isLoading:!1});default:return e}},profiles:function(e=ja,t){switch(t.type){case Pa:return ka({},e,{filter:t.filter});case Sa:return ka({},e,{filter:wa});default:return e}},results:function(e=ft,t){switch(t.type){case ot:return ct({},e,{isLoading:!0});case mt:return ct({},e,{isLoading:!1,error:t.error,data:ft.data,players:ft.players,profiles:ft.profiles,results:ft.results,sharedCharts:ft.sharedCharts,scoreInfo:{}});case it:return ct({},e,{isLoading:!1,isLoadingRanking:!0,data:t.data,players:t.players,profiles:t.profiles,results:t.results,sharedCharts:t.sharedCharts,originalData:t.originalData,scoreInfo:{}});case ht:return ct({},e,{isLoadingRanking:!1,profiles:t.profiles,resultInfo:t.resultInfo});case dt:return ct({},e,{filter:t.filter});case pt:return ct({},e,{filter:gt});case ut:const a=!h.a.isEmpty(t.listPrev);return ct({},e,{profiles:h.a.mapValues(e=>{const r=ct({},e,{prevRating:h.a.get(e.id,t.rankingsPointsMap)});return a?h.a.includes(r.id,t.listPrev)?h.a.includes(r.id,t.listNow)?ct({},r,{change:h.a.indexOf(r.id,t.listPrev)-h.a.indexOf(r.id,t.listNow)}):ct({},r,{change:"?"}):ct({},r,{change:"NEW"}):r},e.profiles)});default:return e}},trackStats:$r,tracklist:function(e=Cr,t){switch(t.type){case Dr:return Rr({},e,{isLoading:!0});case Ir:return Rr({},e,{isLoading:!1,error:t.error});case Lr:return Rr({},e,{isLoading:!1,data:t.data});default:return e}},user:function(e=nr,t){switch(t.type){case tr:return er({},e,{isLoading:!0,data:null});case rr:return er({},e,{isLoading:!1,error:t.error,data:null});case ar:return er({},e,{isLoading:!1,data:t.data});case j:return nr;default:return e}}}),tn=Object(Zr.e)(en,(window.__REDUX_DEVTOOLS_EXTENSION__,Object(Zr.a)(Qr.a)));l.a.render(n.a.createElement(o.a,{store:tn},n.a.createElement(c.a,null,n.a.createElement(Xr,null))),document.getElementById("root"))}},[[228,1,2]]]);
//# sourceMappingURL=main.6c3a5ac2.chunk.js.map