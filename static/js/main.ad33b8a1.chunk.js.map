{"version":3,"sources":["utils/polyfills.js","constants/routes.js","components/Shared/Overlay/Overlay.js","components/Shared/ToggleButton/ToggleButton.js","components/Shared/Loader/index.js","components/Shared/Input/Input.js","components/Shared/Toggle/Toggle.js","components/Shared/CollapsibleBar/index.js","components/Shared/Range/index.js","constants/leaderboard.js","components/Leaderboard/ChartFilter.js","utils/fetch.js","constants/env.js","reducers/ranking.js","constants/grades.js","reducers/profiles.js","constants/backend.js","reducers/top.js","reducers/presets.js","components/Leaderboard/PresetsControl.js","utils/leaderboards.js","utils/colors.js","reducers/selectors.js","components/Leaderboard/Leaderboard.js","components/Ranking/RankingList.js","components/Ranking/RankingFaq.js","components/Ranking/Ranking.js","components/Profile/Profile.js","components/Shared/TopBar/TopBar.js","components/App.js","reducers/tracklist.js","reducers/index.js","index.js"],"names":["Number","isNaN","value","Math","sign","x","Array","prototype","findIndex","Object","defineProperty","predicate","this","TypeError","o","len","length","thisArg","arguments","k","kValue","call","configurable","writable","routes","leaderboard","path","ranking","faq","profile","getPath","params","id","POPPER_MODIFIERS","preventOverflow","enabled","padding","boundariesElement","PLACEMENT_ARROW_MAPPING","right","left","top","bottom","getArrowPlacement","placement","split","Overlay","state","isVisible","containerItemRef","React","createRef","renderPopper","bind","toggleOverlayVisibility","setState","event","target","closest","hideOverlay","ref","style","arrowProps","outOfBoundaries","scheduleUpdate","props","children","hideWhenOutOfBounds","data-placement","className","classNames","overlayClassName","overlayItem","Fragment","onClick","ReactDOM","createPortal","container","document","body","modifiers","referenceElement","current","PureComponent","defaultTypes","listensToClickOutside","ToggleButton","active","onToggle","text","Loader","width","height","viewBox","xmlns","fill","cx","cy","r","attributeName","from","to","begin","dur","values","calcMode","repeatCount","fillOpacity","Input","_","isNil","defaultValue","bindAll","prevProps","e","newValue","onChange","type","numericValue","min","max","onBlur","key","handleBlur","omit","onKeyPress","handleKeyPress","onInput","handleChange","Component","defaultProps","noop","Toggle","checked","uniqueId","htmlFor","CollapsibleBar","open","defaultOpen","title","Range","range","step","renderTrack","onMouseDown","onTouchStart","position","display","borderRadius","background","getTrackBackground","colors","alignSelf","renderThumb","isDragged","backgroundColor","justifyContent","alignItems","boxShadow","SORT","DEFAULT","PROTAGONIST","RANK_ASC","RANK_DESC","NEW_SCORES_PLAYER","CHART_MIN_MAX","DURATION","STD","SHORT","REMIX","FULL","DURATION_DEFAULT","ChartFilter","filterValue","onChangeEx","getOr","duration","buttonText","t","isEqual","isEmpty","newMin","newMax","includes","without","fetchJson","a","url","fetch","response","status","json","data","Error","console","error","Promise","reject","localStorage","window","debugOn","setItem","debugOff","removeItem","DEBUG","getItem","SET_RANKINGS","RANKING_CHANGE_SET","getRankings","profiles","players","defaultInfo","count","battleCount","countAcc","grades","F","D","C","B","A","S","SS","SSS","totalScore","calories","sumAccuracy","history","ratingHistory","lastPlace","lastBattleDate","setupDefaultInfo","cloneDeep","rating","progress","bonus","playerInfo","battles","forEach","song","validResults","orderBy","results","score","nickname","push","playerId","p1","accuracy","chartType","grade","replace","maxScore","isInteger","perfect","great","good","bad","miss","isFullScore","accuracyRaw","isRank","getMaxScore","scoreIndex","slice","enemyScore","flow","sortBy","s1","s2","dateObject","getTime","p2","scoreMultiplier","isExactDate","map","startingRating","S1","S2","r1","r2","R1","R2","E1","E2","kRating1","kRating2","maxK1","maxK2","kLevel1","chartLevel","kLevel2","kLevel","K1","K2","dr1","dr2","ratingDiff","ratingDiffLast","log","chartLabel","toFixed","playersSorted","keys","battleDate","player","index","place","date","p1LastRating","last","p2LastRating","toInteger","name","nameArcade","arcade_name","round","ratingRaw","remove","i","setRankingsAction","getListOfNames","getMapOfRatings","q","fromPairs","setRankings","dispatch","getState","all","localForage","lastChangedRanking","lastChangedRankingPoints","lastFetchedRanking","listNow","listLastFetched","listLastChanged","mapPointsNow","mapPointsLastFetched","mapPointsLastChanged","rankingsPointsMap","listPrev","warn","GRADES","SET_PROFILES","SET_FILTER","RESET_FILTER","defaultFilter","initialState","isLoading","filter","getProfiles","mapValues","resultsByGrade","result","find","get","rankingHistory","Date","now","getInitialProfiles","tracklist","addResultData","chart","resultsByLevel","lastResultDate","initializeProfile","resultsOfThisPlayer","bestGradeResult","sort","b","indexOf","neededGrades","double","single","gradeIncrementMap","level","res","thisGrade","thisPlayerId","otherResults","gradeIncArray","gradeInc","l","g","isS","prog","incrementLevel","number","minimumNumber","totalCharts","sqrt","getMinimumNumber","bonusCoefficientNumber","getBonusForLevel","setProfiles","HOST","LOADING","SUCCESS","ERROR","showRank","showRankAndNorank","preprocessData","item","fullRes","every","isNumber","perfects","greats","goods","bads","misses","stepSum","reduce","sum","n","chart_label","match","track","mix","resultInfoOverrides","infos","fixableIndex","localStepSum","numb","nicknameArcade","originalChartMix","originalChartLabel","originalScore","gained","exact_gain_date","scoreIncrease","score_increase","combo","max_combo","mods","mods_list","rank_mode","isHJ","latestScoreDate","latest","acc","floor","accRaw","hasRankScore","some","fetchTopScores","processedData","initialProfiles","rankings","toPairs","setFilter","SELECT_PRESET","LOAD_PRESETS","LOADING_START","LOADING_END","presets","currentPreset","itemToOption","label","reloadPresets","startLoading","endLoading","selectPreset","openPreset","then","noPresetsMessage","mapDispatchToProps","loadPresets","savePreset","newPreset","confirm","withoutOldPreset","newPresets","deletePreset","PresetsControl","onChangeSelection","selected","onRewritePreset","onSavePreset","isAddingNew","classNamePrefix","placeholder","options","noOptionsMessage","disabled","connect","TimeAgo","addLocale","ru","timeAgo","timeStyle","flavour","gradation","convenient","units","tooltipFormatterForBests","flexDirection","toLocaleDateString","getTimeAgo","dayDiff","moment","startOf","diff","format","colorsArray","playersSelector","createSelector","it","toLower","filteredDataSelector","names","namesOr","playersOr","namesNot","playersNot","sortingType","protagonist","excludeAntagonists","defaultSorting","newScoresProtagonistSorting","protagonistSorting","row","protIndex","protScore","enemies","take","uniqBy","distanceFromProtagonist","dist","enemy","getScoreSorting","direction","Infinity","sortingFunctions","compact","chartRange","items","rows","startsWith","filterCharts","showOnlyRank","occuredNames","alreadyOccured","rowNames","size","matchSorter","sortingOptions","resetFilter","Leaderboard","showItemsCount","curry","onRefresh","onTypeSongName","debounce","closeMenuOnSelect","isMulti","isClearable","filteredData","canShowMore","visibleData","showProtagonistRatingChange","highlightProtagonist","protagonistName","uniqueSelectedNames","uniq","renderSimpleSearch","renderFilters","renderSortings","preset","message","chartIndex","topPlace","occuredNicknames","isSecondOccurenceInResults","singlep","doublep","coop","href","rel","placeDifference","nameIndex","prevScore","findLastIndex","empty","fontWeight","color","vj","hj","content","tooltipClassName","numeral","exact","src","process","alt","getGradeImg","RankingList","playerIndex","change","isString","prevRating","down","up","RankingFaq","Ranking","render","component","withRouter","defaultGradesDistribution","defaultGradesWithLevelsDistribution","flatMap","cutRange","array","startIndex","endIndex","firstElement","lastElement","first","middleElements","profileSelector","levelsDistribution","y","singlesLevels","doublesLevels","gradesData","update","gradesDistribution","groupBy","pick","gradesValues","gradesAndLevelsDistribution","groupedResults","counts","countBy","reduced","levelsData","lastTickRating","lastTickRanking","lastTick","minMaxRange","filterRange","dayRange","dayRangeMs","placesChanges","ratingChanges","rankingIndex","rank","setProfilesFilter","resetProfilesFilter","Profile","isLevelGraphCombined","onChangeDayRange","minHeight","undefined","aspect","margin","strokeDasharray","dataKey","domain","tickFormatter","allowDecimals","stroke","isAnimationActive","payload","strokeWidth","dot","dataMax","interval","reversed","ticks","stackId","stackOffset","doubleItems","singleItems","abs","offset","totalD","totalS","obj","typeLetter","progr","minNumber","currentNumber","levelString","complete","zero","renderGradesWithLevels","renderLevels","renderGrades","renderRankingHistory","renderPlaceHistory","renderGradeBlock","TopBar","App","rootReducer","combineReducers","action","hasPrevList","playerOriginal","store","createStore","__REDUX_DEVTOOLS_EXTENSION__","applyMiddleware","thunk","catch","getElementById"],"mappings":"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","file":"static/js/main.ad33b8a1.chunk.js","sourcesContent":["/* eslint-disable */\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isNaN\r\nNumber.isNaN =\r\n  Number.isNaN ||\r\n  function(value) {\r\n    return value !== value;\r\n  };\r\n\r\nif (typeof Math.sign === 'undefined') {\r\n  Math.sign = function(x) {\r\n    return x > 0 ? 1 : x < 0 ? -1 : x;\r\n  };\r\n}\r\n\r\n// https://tc39.github.io/ecma262/#sec-array.prototype.findindex\r\nif (!Array.prototype.findIndex) {\r\n  Object.defineProperty(Array.prototype, 'findIndex', {\r\n    value: function(predicate) {\r\n      // 1. Let O be ? ToObject(this value).\r\n      if (this == null) {\r\n        throw new TypeError('\"this\" is null or not defined');\r\n      }\r\n\r\n      var o = Object(this);\r\n\r\n      // 2. Let len be ? ToLength(? Get(O, \"length\")).\r\n      var len = o.length >>> 0;\r\n\r\n      // 3. If IsCallable(predicate) is false, throw a TypeError exception.\r\n      if (typeof predicate !== 'function') {\r\n        throw new TypeError('predicate must be a function');\r\n      }\r\n\r\n      // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\r\n      var thisArg = arguments[1];\r\n\r\n      // 5. Let k be 0.\r\n      var k = 0;\r\n\r\n      // 6. Repeat, while k < len\r\n      while (k < len) {\r\n        // a. Let Pk be ! ToString(k).\r\n        // b. Let kValue be ? Get(O, Pk).\r\n        // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).\r\n        // d. If testResult is true, return k.\r\n        var kValue = o[k];\r\n        if (predicate.call(thisArg, kValue, k, o)) {\r\n          return k;\r\n        }\r\n        // e. Increase k by 1.\r\n        k++;\r\n      }\r\n\r\n      // 7. Return -1.\r\n      return -1;\r\n    },\r\n    configurable: true,\r\n    writable: true,\r\n  });\r\n}\r\n","export const routes = {\r\n  leaderboard: {\r\n    path: `/leaderboard`,\r\n  },\r\n  ranking: {\r\n    path: `/ranking`,\r\n    faq: {\r\n      path: '/ranking/faq',\r\n    },\r\n  },\r\n  profile: {\r\n    path: `/profiles/:id`,\r\n    getPath: params => `/profiles/${params.id}`,\r\n  },\r\n};\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport toBe from 'prop-types';\r\nimport { Popper } from 'react-popper';\r\nimport classNames from 'classnames';\r\nimport listensToClickOutside from 'react-onclickoutside';\r\n\r\nimport './overlay.scss';\r\n\r\nconst POPPER_MODIFIERS = {\r\n  preventOverflow: {\r\n    enabled: true,\r\n    padding: 10,\r\n    boundariesElement: 'viewport',\r\n  },\r\n};\r\n\r\nconst PLACEMENT_ARROW_MAPPING = {\r\n  right: 'left',\r\n  left: 'right',\r\n  top: 'bottom',\r\n  bottom: 'top',\r\n};\r\n\r\nconst getArrowPlacement = placement => {\r\n  return placement && PLACEMENT_ARROW_MAPPING[placement.split('-')[0]];\r\n};\r\n\r\nclass Overlay extends React.PureComponent {\r\n  static propTypes = {\r\n    placement: toBe.string,\r\n    overlayItem: toBe.any,\r\n    hideWhenOutOfBounds: toBe.bool,\r\n  };\r\n\r\n  static defaultTypes = {\r\n    placement: 'bottom',\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      isVisible: false,\r\n    };\r\n    this.containerItemRef = React.createRef();\r\n    this.renderPopper = this.renderPopper.bind(this);\r\n    this.toggleOverlayVisibility = this.toggleOverlayVisibility.bind(this);\r\n  }\r\n\r\n  hideOverlay() {\r\n    this.setState({\r\n      isVisible: false,\r\n    });\r\n  }\r\n\r\n  toggleOverlayVisibility() {\r\n    this.setState({\r\n      isVisible: !this.state.isVisible,\r\n    });\r\n  }\r\n\r\n  handleClickOutside(event) {\r\n    const preventHiding = event && event.target.closest('.inner-popper-overlay'); // prevent overlays from hiding when a modal is opened within overlay\r\n\r\n    if (!preventHiding) {\r\n      this.hideOverlay();\r\n    }\r\n  }\r\n\r\n  renderPopper({ ref, style, placement, arrowProps, scheduleUpdate, outOfBoundaries }) {\r\n    const { children, hideWhenOutOfBounds } = this.props;\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        style={style}\r\n        data-placement={placement}\r\n        className={classNames(\r\n          'inner-popper-overlay',\r\n          `arrow-${getArrowPlacement(placement)}`,\r\n          this.props.overlayClassName,\r\n          { 'out-of-bounds': outOfBoundaries && hideWhenOutOfBounds }\r\n        )}\r\n      >\r\n        <div className=\"arrow-hider\">\r\n          <div className=\"arrow\" ref={arrowProps.ref} style={arrowProps.style} />\r\n        </div>\r\n        <div\r\n          className=\"inner-popper-content\"\r\n          // ref={ref => this.setupPopperContentRef(scheduleUpdate, ref)}\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { placement, overlayItem } = this.props;\r\n    const { isVisible } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <div\r\n          className=\"overlay-item\"\r\n          ref={this.containerItemRef}\r\n          onClick={this.toggleOverlayVisibility}\r\n        >\r\n          {overlayItem}\r\n        </div>\r\n        {isVisible &&\r\n          ReactDOM.createPortal(\r\n            <Popper\r\n              container={document.body}\r\n              modifiers={POPPER_MODIFIERS}\r\n              placement={placement}\r\n              referenceElement={this.containerItemRef.current}\r\n            >\r\n              {this.renderPopper}\r\n            </Popper>,\r\n            document.body\r\n          )}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default listensToClickOutside(Overlay);\r\n","import React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nimport './toggle-button.scss';\r\n\r\nexport default class ToggleButton extends React.PureComponent {\r\n  static propTypes = {\r\n    text: toBe.string,\r\n    onToggle: toBe.func,\r\n    active: toBe.bool,\r\n  };\r\n\r\n  render() {\r\n    const { active, onToggle, text } = this.props;\r\n    return (\r\n      <div\r\n        className={classNames('toggle-button', { active: active })}\r\n        onClick={() => onToggle(!active)}\r\n      >\r\n        {text}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nimport './loader.scss';\r\n\r\nexport default function Loader() {\r\n  return (\r\n    <div className=\"loader\">\r\n      <svg\r\n        width=\"40\"\r\n        height=\"12\"\r\n        viewBox=\"0 0 120 30\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        fill=\"#eee\"\r\n      >\r\n        <circle cx=\"15\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"60\" cy=\"15\" r=\"9\" fillOpacity=\"0.3\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"9\"\r\n            to=\"9\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"9;15;9\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"0.5\"\r\n            to=\"0.5\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\".5;1;.5\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"105\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n      </svg>\r\n    </div>\r\n  );\r\n}\r\n","/* eslint-disable react/no-deprecated */\r\n// imports from vendor deps\r\nimport React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash/fp';\r\n\r\n// imports from styles\r\nexport default class Input extends React.Component {\r\n  static propTypes = {\r\n    value: toBe.any,\r\n    defaultValue: toBe.any,\r\n    onChange: toBe.func,\r\n    onBlur: toBe.func,\r\n    type: toBe.string,\r\n    className: toBe.string,\r\n    trimOnBlur: toBe.bool,\r\n  };\r\n\r\n  static defaultProps = {\r\n    value: null,\r\n    type: 'text',\r\n    onChange: _.noop,\r\n    onBlur: _.noop,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      value: (!_.isNil(props.value) ? props.value : props.defaultValue) || '',\r\n    };\r\n    _.bindAll(['handleChange', 'handleBlur', 'handleKeyPress'], this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.value !== this.props.value) {\r\n      this.setState({ value: this.props.value });\r\n    }\r\n  }\r\n\r\n  handleChange(e) {\r\n    const newValue = e.target.value;\r\n    this.setState({ value: newValue }, () => this.props.onChange(newValue));\r\n  }\r\n\r\n  handleBlur(e) {\r\n    const { type } = this.props;\r\n    const { value } = this.state;\r\n    if (type === 'number') {\r\n      const numericValue = Number(value);\r\n      if (numericValue >= Number(e.target.min) && numericValue <= Number(e.target.max)) {\r\n        this.props.onBlur(numericValue, e);\r\n      } else {\r\n        this.setState({ value: this.props.value });\r\n        this.props.onBlur(this.props.value, e);\r\n      }\r\n    }\r\n  }\r\n\r\n  handleKeyPress(e) {\r\n    if (e.key === 'Enter') {\r\n      this.handleBlur(e);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { className } = this.props;\r\n\r\n    // HACK: This component uses onInput instead of onChange\r\n    // because IE11 fails to call onChange events when you paste/cut using context menu (RMB)\r\n    // We're using onInput because it works fine, and because for text input\r\n    // there's no difference between how onChange and onInput work\r\n    return (\r\n      <input\r\n        {..._.omit(['defaultValue', 'onChange'], this.props)}\r\n        className={classNames(className, 'text-input')}\r\n        value={this.state.value}\r\n        onBlur={this.handleBlur}\r\n        onKeyPress={this.handleKeyPress}\r\n        onInput={this.handleChange}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\n\r\nimport './toggle.scss';\r\n\r\n// imports from styles\r\nexport default class Toggle extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.id = _.uniqueId();\r\n  }\r\n\r\n  onChange = e => {\r\n    this.props.onChange(e.target.checked);\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"toggle-checkbox\">\r\n        <input\r\n          type=\"checkbox\"\r\n          className=\"toggle-checkbox-cb\"\r\n          id={this.id}\r\n          onChange={this.onChange}\r\n          checked={this.props.checked}\r\n        />\r\n        <label htmlFor={this.id} className=\"toggle\">\r\n          <span></span>\r\n        </label>\r\n        <label htmlFor={this.id} className=\"text-label\">\r\n          {this.props.children}\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { FaChevronRight } from 'react-icons/fa';\r\nimport classNames from 'classnames';\r\n\r\nimport './styles.scss';\r\n\r\nexport default class CollapsibleBar extends PureComponent {\r\n  static propTypes = {\r\n    className: toBe.string,\r\n    children: toBe.any,\r\n    title: toBe.any,\r\n    defaultOpen: toBe.bool,\r\n  };\r\n\r\n  constructor(props) {\r\n    super();\r\n    this.state = { open: props.defaultOpen || false };\r\n  }\r\n\r\n  render() {\r\n    const { children, title, className } = this.props;\r\n    const { open } = this.state;\r\n\r\n    return (\r\n      <div className={classNames('collapsible-bar', className, { open })}>\r\n        <div className=\"header\" onClick={() => this.setState(state => ({ open: !state.open }))}>\r\n          <div className=\"collapse-button\">\r\n            <FaChevronRight />\r\n          </div>\r\n          <div className=\"title\">{title}</div>\r\n        </div>\r\n        {children && <div className=\"collapsible-children\">{children}</div>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { Range as ReactRange, getTrackBackground } from 'react-range';\r\n\r\nexport default function Range({ range, min, max, onChange }) {\r\n  return (\r\n    <ReactRange\r\n      values={range}\r\n      step={1}\r\n      min={min}\r\n      max={max}\r\n      onChange={onChange}\r\n      renderTrack={({ props, children }) => (\r\n        <div\r\n          onMouseDown={props.onMouseDown}\r\n          onTouchStart={props.onTouchStart}\r\n          style={{\r\n            ...props.style,\r\n            position: 'relative',\r\n            height: '10px',\r\n            display: 'flex',\r\n            width: '100%',\r\n          }}\r\n        >\r\n          <div\r\n            ref={props.ref}\r\n            style={{\r\n              height: '6px',\r\n              width: '100%',\r\n              borderRadius: '3px',\r\n              background: getTrackBackground({\r\n                values: range,\r\n                colors: ['#ccc', '#88d3ff', '#ccc'],\r\n                min,\r\n                max,\r\n              }),\r\n              alignSelf: 'center',\r\n            }}\r\n          >\r\n            {children}\r\n          </div>\r\n        </div>\r\n      )}\r\n      renderThumb={({ props, isDragged }) => (\r\n        <div\r\n          {...props}\r\n          style={{\r\n            ...props.style,\r\n            height: '12px',\r\n            width: '12px',\r\n            borderRadius: '6px',\r\n            backgroundColor: '#FFF',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            boxShadow: '0px 2px 3px #AAA',\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              height: '6px',\r\n              width: '6px',\r\n              borderRadius: '3px',\r\n              backgroundColor: isDragged ? '#88d3ff' : '#CCC',\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n    />\r\n  );\r\n}\r\n","import _ from 'lodash/fp';\r\n\r\nexport const SORT = {\r\n  DEFAULT: 'default',\r\n  PROTAGONIST: 'protagonist',\r\n  RANK_ASC: 'rankAsc',\r\n  RANK_DESC: 'rankDesc',\r\n  NEW_SCORES_PLAYER: 'newScoresPlayer',\r\n};\r\n\r\nexport const CHART_MIN_MAX = [1, 28];\r\nexport const DURATION = {\r\n  STD: 'Standard',\r\n  SHORT: 'Short',\r\n  REMIX: 'Remix',\r\n  FULL: 'Full',\r\n};\r\nexport const DURATION_DEFAULT = _.values(DURATION);\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\nimport { FaCaretLeft, FaCaretRight } from 'react-icons/fa';\r\n\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Input from 'components/Shared/Input/Input';\r\nimport Range from 'components/Shared/Range';\r\n\r\nimport { CHART_MIN_MAX, DURATION_DEFAULT, DURATION } from 'constants/leaderboard';\r\n\r\nexport default function ChartFilter({ filterValue, onChange: onChangeEx }) {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filterValue);\r\n  const type = _.getOr(null, 'type', filterValue);\r\n  const duration = _.getOr(DURATION_DEFAULT, 'duration', filterValue);\r\n\r\n  let buttonText = 'фильтр чартов';\r\n  if (filterValue) {\r\n    const t = type || '';\r\n    buttonText = range[0] === range[1] ? `${t}${range[0]}` : `${t}${range[0]} - ${t}${range[1]}`;\r\n    buttonText = 'чарты: ' + buttonText;\r\n    if (!_.isEqual(duration, DURATION_DEFAULT)) {\r\n      buttonText += ' ***';\r\n      // buttonText += ` (${_.values(DURATION)\r\n      //   .filter(dur => duration.includes(dur))\r\n      //   .map(s => s.slice(0, 2))\r\n      //   .join('-')})`;\r\n    }\r\n  }\r\n\r\n  const onChange = value => {\r\n    onChangeEx({\r\n      range,\r\n      type,\r\n      ...value,\r\n      duration: _.isEmpty(value.duration) ? duration : value.duration,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Overlay\r\n        overlayClassName=\"chart-range-overlay-outer\"\r\n        overlayItem={\r\n          <button className=\"filter-charts-button btn btn-sm btn-dark\">{buttonText}</button>\r\n        }\r\n      >\r\n        <div className=\"chart-range-overlay\">\r\n          <div className=\"buttons\">\r\n            <ToggleButton\r\n              text=\"Single\"\r\n              active={type === 'S'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  type: active ? 'S' : null,\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Double\"\r\n              active={type === 'D'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  type: active ? 'D' : null,\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n          <Range\r\n            range={range}\r\n            min={CHART_MIN_MAX[0]}\r\n            max={CHART_MIN_MAX[1]}\r\n            onChange={r => onChange({ range: r })}\r\n          />\r\n          <div className=\"inputs\">\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  range: [Math.max(range[0] - 1, CHART_MIN_MAX[0]), range[1]],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={CHART_MIN_MAX[0]}\r\n              max={Math.min(CHART_MIN_MAX[1], range[1])}\r\n              value={range[0]}\r\n              onBlur={value => {\r\n                onChange({ range: [value, range[1]] });\r\n              }}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMin = Math.min(range[0] + 1, CHART_MIN_MAX[1]);\r\n                onChange({\r\n                  range: [newMin, range[1] < newMin ? newMin : range[1]],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n            <div className=\"_flex-fill\" />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMax = Math.max(range[1] - 1, CHART_MIN_MAX[0]);\r\n                onChange({\r\n                  range: [range[0] > newMax ? newMax : range[0], newMax],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={Math.max(CHART_MIN_MAX[0], range[0])}\r\n              max={CHART_MIN_MAX[1]}\r\n              value={range[1]}\r\n              onBlur={value => onChange({ range: [range[0], value] })}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  range: [range[0], Math.min(range[1] + 1, CHART_MIN_MAX[1])],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n          </div>\r\n          <div className=\"buttons-duration\">\r\n            <ToggleButton\r\n              text=\"Standard\"\r\n              active={duration.includes(DURATION.STD)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.STD]\r\n                    : _.without([DURATION.STD], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Short\"\r\n              active={duration.includes(DURATION.SHORT)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.SHORT]\r\n                    : _.without([DURATION.SHORT], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Remix\"\r\n              active={duration.includes(DURATION.REMIX)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.REMIX]\r\n                    : _.without([DURATION.REMIX], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Full\"\r\n              active={duration.includes(DURATION.FULL)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.FULL]\r\n                    : _.without([DURATION.FULL], duration),\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Overlay>\r\n    </div>\r\n  );\r\n}\r\n","export const fetchJson = async ({ url }) => {\r\n  try {\r\n    const response = await fetch(url);\r\n    if (response.status >= 200 && response.status < 300) {\r\n      const data = await response.json();\r\n      return data;\r\n    } else {\r\n      throw Error('HTTP Status ' + response.status);\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n","if (localStorage) {\r\n  window.debugOn = () => {\r\n    localStorage.setItem('debug', 1);\r\n  };\r\n  window.debugOff = () => {\r\n    localStorage.removeItem('debug');\r\n  };\r\n}\r\n\r\nexport const DEBUG = localStorage && localStorage.getItem('debug');\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\n\r\nimport { DEBUG } from 'constants/env';\r\n\r\nconst SET_RANKINGS = `RANKINGS/SET_RANKINGS`;\r\nconst RANKING_CHANGE_SET = `RANKINGS/RANKING_CHANGE_SET`;\r\n\r\nconst isFullScore = score => {\r\n  return (\r\n    _.isInteger(score.perfect) &&\r\n    _.isInteger(score.great) &&\r\n    _.isInteger(score.good) &&\r\n    _.isInteger(score.bad) &&\r\n    _.isInteger(score.miss) &&\r\n    _.isInteger(score.score)\r\n  );\r\n};\r\n\r\nconst getMaxScore = score => {\r\n  const maxScoreAccuracy = ((score.score / score.accuracyRaw) * 100) / (score.isRank ? 1.2 : 1);\r\n\r\n  return maxScoreAccuracy;\r\n};\r\n\r\nexport default function reducer(state = {}, action) {\r\n  switch (action.type) {\r\n    case SET_RANKINGS:\r\n      return {\r\n        ...state,\r\n        data: action.ranking,\r\n      };\r\n    case RANKING_CHANGE_SET:\r\n      const hasPrevList = !_.isEmpty(action.listPrev);\r\n      return {\r\n        ...state,\r\n        data: _.map(playerOriginal => {\r\n          const player = {\r\n            ...playerOriginal,\r\n            prevRating: _.get(playerOriginal.name, action.rankingsPointsMap),\r\n          };\r\n          if (!hasPrevList) {\r\n            return player; // First time opening this thing and we didn't have any previous data\r\n          }\r\n          if (!_.includes(player.name, action.listPrev)) {\r\n            return { ...player, change: 'NEW' };\r\n          } else if (!_.includes(player.name, action.listNow)) {\r\n            // Should NEVER happen, idk if this is possible\r\n            return { ...player, change: '?' };\r\n          } else {\r\n            return {\r\n              ...player,\r\n              change:\r\n                _.indexOf(player.name, action.listPrev) - _.indexOf(player.name, action.listNow),\r\n            };\r\n          }\r\n        }, state.data),\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const getRankings = (data, { players }, profiles) => {\r\n  const defaultInfo = {\r\n    count: 0,\r\n    battleCount: 0,\r\n    countAcc: 0,\r\n    // rating: 1000,\r\n    grades: { F: 0, D: 0, C: 0, B: 0, A: 0, S: 0, SS: 0, SSS: 0 },\r\n    totalScore: { S: 0, D: 0, calories: 0 },\r\n    sumAccuracy: 0,\r\n    history: [],\r\n    ratingHistory: [],\r\n    lastPlace: null,\r\n    lastBattleDate: 0,\r\n  };\r\n  const setupDefaultInfo = id => {\r\n    return {\r\n      ..._.cloneDeep(defaultInfo),\r\n      rating: 850 + profiles[id].progress.bonus,\r\n    };\r\n  };\r\n  const playerInfo = {};\r\n  const battles = [];\r\n  data.forEach(song => {\r\n    const validResults = [];\r\n    _.orderBy(['score'], ['desc'], song.results).forEach(score => {\r\n      if (!score.nickname.includes('???')) {\r\n        validResults.push(score);\r\n\r\n        if (!playerInfo[score.playerId]) {\r\n          playerInfo[score.playerId] = setupDefaultInfo(score.playerId);\r\n        }\r\n        const p1 = playerInfo[score.playerId];\r\n        p1.count++;\r\n        if (score.accuracy) {\r\n          p1.countAcc++;\r\n          p1.sumAccuracy += score.accuracy;\r\n        }\r\n        p1.totalScore[song.chartType] += score.score;\r\n        score.calories && (p1.totalScore.calories += score.calories);\r\n        p1.grades[score.grade.replace('+', '')]++;\r\n      }\r\n      if (!song.maxScore && isFullScore(score)) {\r\n        song.maxScore = getMaxScore(score, song);\r\n      }\r\n    });\r\n\r\n    validResults.forEach((score, scoreIndex) => {\r\n      const enemyScores = validResults.length > 1 ? validResults.slice(scoreIndex + 1) : [];\r\n\r\n      enemyScores.forEach(enemyScore => {\r\n        if (score.isRank === enemyScore.isRank && score.playerId !== enemyScore.playerId) {\r\n          battles.push([score, enemyScore, song]);\r\n        }\r\n      });\r\n    });\r\n  });\r\n  _.flow([\r\n    // Apply battles chronologically instead of randomly\r\n    _.sortBy(([s1, s2]) => Math.max(s1.dateObject.getTime(), s2.dateObject.getTime())),\r\n    _.forEach(([score, enemyScore, song]) => {\r\n      // For each battle\r\n      if (!playerInfo[enemyScore.playerId]) {\r\n        playerInfo[enemyScore.playerId] = setupDefaultInfo(enemyScore.playerId);\r\n      }\r\n      const p1 = playerInfo[score.playerId];\r\n      const p2 = playerInfo[enemyScore.playerId];\r\n\r\n      const scoreMultiplier = score.isRank ? 1.2 : 1;\r\n      let maxScore = null;\r\n      if (song.maxScore) {\r\n        maxScore = song.maxScore * scoreMultiplier;\r\n        if (\r\n          Math.max(maxScore, score.score, enemyScore.score) !== maxScore &&\r\n          !score.isRank &&\r\n          (!score.isExactDate || !enemyScore.isExactDate)\r\n        ) {\r\n          maxScore *= 1.2;\r\n          // Rank from machine best wasn't recognized most likely.\r\n          // Increasing max score by 20% is fine\r\n        }\r\n        if (Math.max(maxScore, score.score, enemyScore.score) !== maxScore) {\r\n          // If calculated max score isn't max score anyway, use current scores as max + cherry on top\r\n          maxScore = Math.max(..._.map('score', song.results));\r\n        }\r\n      }\r\n      // Rating at the start of battle for this score\r\n      score.startingRating = p1.rating;\r\n      enemyScore.startingRating = p2.rating;\r\n      // Counting the number of battles\r\n      p1.battleCount++;\r\n      p2.battleCount++;\r\n\r\n      // This is one match between two players\r\n      //// Elo formula\r\n      const r1 = p1.rating;\r\n      const r2 = p2.rating;\r\n      const R1 = 10 ** (r1 / 400);\r\n      const R2 = 10 ** (r2 / 400);\r\n      const E1 = R1 / (R1 + R2);\r\n      const E2 = R2 / (R1 + R2);\r\n      let A = score.score;\r\n      let B = enemyScore.score;\r\n      let S1, S2;\r\n      if (A === B) {\r\n        S1 = S2 = 0.5;\r\n      } else if (maxScore && A !== 0 && B !== 0) {\r\n        A = maxScore / A - 1;\r\n        B = maxScore / B - 1;\r\n        S1 = (B / (A + B) - 0.5) * 5 + 0.5;\r\n        S2 = (A / (A + B) - 0.5) * 5 + 0.5;\r\n      } else {\r\n        S1 = A > B ? 1 : B < A ? 0 : 0.5;\r\n        S2 = 1 - S1;\r\n      }\r\n      S1 = Math.max(0, Math.min(1, S1)); // Set strict boundaries to [0, 1]\r\n      S2 = Math.max(0, Math.min(1, S2));\r\n\r\n      const kRating1 = Math.max(0, Math.min(1, (r1 - 700) / 800));\r\n      const kRating2 = Math.max(0, Math.min(1, (r2 - 700) / 800));\r\n      const maxK1 = 30 + 20 * kRating1;\r\n      const maxK2 = 30 + 20 * kRating2;\r\n      const kLevel1 = Math.max(\r\n        1,\r\n        Math.min(maxK1, (song.chartLevel / 25) ** ((kRating1 - 0.5) * 5 + 2.5) * maxK1)\r\n      );\r\n      const kLevel2 = Math.max(\r\n        1,\r\n        Math.min(maxK2, (song.chartLevel / 25) ** ((kRating2 - 0.5) * 5 + 2.5) * maxK2)\r\n      );\r\n      const kLevel = Math.min(kLevel1, kLevel2);\r\n\r\n      const K1 = kLevel;\r\n      const K2 = kLevel;\r\n      let dr1 = K1 * (S1 - E1);\r\n      let dr2 = K2 * (S2 - E2);\r\n      // Do not decrease rating if you have SSS - RIP zero-sum algorithm\r\n      dr1 = dr1 < 0 && score.grade === 'SSS' ? 0 : dr1;\r\n      dr2 = dr2 < 0 && enemyScore.grade === 'SSS' ? 0 : dr2;\r\n      // Recording this value for display\r\n      score.ratingDiff = (score.ratingDiff || 0) + dr1;\r\n      enemyScore.ratingDiff = (enemyScore.ratingDiff || 0) + dr2;\r\n      score.ratingDiffLast = dr1;\r\n      enemyScore.ratingDiffLast = dr2;\r\n\r\n      if (DEBUG) {\r\n        // if (song.song === 'Club Night') {\r\n        // if (score.nickname === 'Liza' || enemyScore.nickname === 'Liza') {\r\n        // if (!song.maxScore) {\r\n        console.log(\r\n          `${song.chartLabel} - ${score.nickname} / ${enemyScore.nickname} - ${song.song}`\r\n        );\r\n        console.log(\r\n          `- ${score.score} / ${enemyScore.score} (${maxScore}) - R ${S1.toFixed(2)}/${S2.toFixed(\r\n            2\r\n          )} E ${E1.toFixed(2)} / ${E2.toFixed(2)}`\r\n        );\r\n        // console.log(`- old R ${S1old.toFixed(2)}/${S2old.toFixed(2)}`);\r\n        console.log(\r\n          `- Rating ${r1.toFixed(2)} / ${r2.toFixed(2)} - ${dr1.toFixed(2)} / ${dr2.toFixed(\r\n            2\r\n          )} - K ${K1.toFixed(2)} ${K2.toFixed(2)}`\r\n        );\r\n        // }\r\n      }\r\n\r\n      // Change rating as a result of this battle\r\n      p1.rating = r1 + dr1;\r\n      p2.rating = r2 + dr2;\r\n      // Rating floor\r\n      p1.rating = Math.max(100, p1.rating);\r\n      p2.rating = Math.max(100, p2.rating);\r\n\r\n      const playersSorted = _.flow(\r\n        _.keys,\r\n        _.map(id => ({ id, rating: playerInfo[id].rating })),\r\n        _.orderBy(['rating'], ['desc'])\r\n      )(playerInfo);\r\n      const battleDate =\r\n        score.dateObject > enemyScore.dateObject ? score.dateObject : enemyScore.dateObject;\r\n      playersSorted.forEach((player, index) => {\r\n        const lastPlace = playerInfo[player.id].lastPlace;\r\n        if (lastPlace !== index + 1) {\r\n          playerInfo[player.id].history.push({\r\n            place: index + 1,\r\n            date: battleDate.getTime(),\r\n          });\r\n          playerInfo[player.id].lastPlace = index + 1;\r\n        }\r\n      });\r\n\r\n      const p1LastRating = _.last(p1.ratingHistory);\r\n      const p2LastRating = _.last(p2.ratingHistory);\r\n      if (p1LastRating !== p1.rating) {\r\n        p1.ratingHistory.push({\r\n          rating: p1.rating,\r\n          date: battleDate.getTime(),\r\n        });\r\n      }\r\n      if (p2LastRating !== p2.rating) {\r\n        p2.ratingHistory.push({\r\n          rating: p2.rating,\r\n          date: battleDate.getTime(),\r\n        });\r\n      }\r\n    }),\r\n  ])(battles);\r\n\r\n  const ranking = _.flow(\r\n    _.keys,\r\n    _.map(key => ({\r\n      ..._.omit(['countAcc', 'sumAccuracy'], playerInfo[key]),\r\n      id: _.toInteger(key),\r\n      name: players[key].nickname,\r\n      nameArcade: players[key].arcade_name,\r\n      accuracy:\r\n        playerInfo[key].countAcc > 0\r\n          ? Math.round((playerInfo[key].sumAccuracy / playerInfo[key].countAcc) * 100) / 100\r\n          : null,\r\n      rating: Math.round(playerInfo[key].rating),\r\n      ratingRaw: playerInfo[key].rating,\r\n    })),\r\n    _.remove(i => i.battleCount < 20),\r\n    _.orderBy(['ratingRaw'], ['desc'])\r\n  )(playerInfo);\r\n  return ranking;\r\n};\r\n\r\nexport const setRankingsAction = ranking => ({\r\n  type: SET_RANKINGS,\r\n  ranking,\r\n});\r\n\r\nconst getListOfNames = _.map('name');\r\nconst getMapOfRatings = _.flow(\r\n  _.map(q => [q.name, q.rating]),\r\n  _.fromPairs\r\n);\r\nexport const setRankings = ranking => {\r\n  return async (dispatch, getState) => {\r\n    dispatch(setRankingsAction(ranking));\r\n    try {\r\n      const [lastChangedRanking, lastChangedRankingPoints, lastFetchedRanking] = await Promise.all([\r\n        localForage.getItem('lastChangedRanking_v2'),\r\n        localForage.getItem('lastChangedRankingPoints_v2'),\r\n        localForage.getItem('lastFetchedRanking_v2'),\r\n      ]);\r\n      // console.log(ranking);\r\n      const listNow = getListOfNames(ranking);\r\n      const listLastFetched = getListOfNames(lastFetchedRanking);\r\n      const listLastChanged = getListOfNames(lastChangedRanking);\r\n      const mapPointsNow = getMapOfRatings(ranking);\r\n      const mapPointsLastFetched = getMapOfRatings(lastFetchedRanking);\r\n      const mapPointsLastChanged = getMapOfRatings(lastChangedRankingPoints);\r\n      let rankingsPointsMap = mapPointsLastChanged;\r\n      // console.log(mapPointsNow, mapPointsLastFetched, mapPointsLastChanged);\r\n      if (!_.isEqual(mapPointsNow, mapPointsLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRankingPoints_v2', lastFetchedRanking);\r\n        rankingsPointsMap = mapPointsLastFetched;\r\n      }\r\n      let listPrev = listLastChanged;\r\n      if (!_.isEqual(listNow, listLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRanking_v2', lastFetchedRanking);\r\n        listPrev = listLastFetched;\r\n      }\r\n      dispatch({\r\n        type: RANKING_CHANGE_SET,\r\n        listNow,\r\n        listPrev,\r\n        rankingsPointsMap,\r\n      });\r\n      localForage.setItem('lastFetchedRanking_v2', ranking);\r\n      // console.log(listNow, listLastFetched, listLastChanged);\r\n    } catch (error) {\r\n      console.warn('Cannot get ranking from local storage', error);\r\n    }\r\n  };\r\n};\r\n","export const GRADES = ['F', 'F+', 'D', 'D+', 'C', 'C+', 'B', 'B+', 'A', 'A+', 'S', 'SS', 'SSS'];\r\n","import _ from 'lodash/fp';\r\n// import localForage from 'localforage';\r\n//\r\nimport { GRADES } from 'constants/grades';\r\n\r\nconst SET_PROFILES = `PROFILES/SET_PROFILES`;\r\nconst SET_FILTER = `PROFILES/SET_FILTER`;\r\nconst RESET_FILTER = `PROFILES/RESET_FILTER`;\r\n\r\nexport const defaultFilter = {};\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n  filter: defaultFilter,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case SET_PROFILES:\r\n      return {\r\n        ...state,\r\n        data: action.data,\r\n      };\r\n    case SET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: action.filter,\r\n      };\r\n    case RESET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: defaultFilter,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const getProfiles = (profiles, data, ranking) => {\r\n  const addHistoryData = profile => {\r\n    const id = _.values(profile.resultsByGrade)[0][0].result.playerId;\r\n    profile.ratingHistory =\r\n      _.flow(\r\n        _.find({ id }),\r\n        _.get('ratingHistory')\r\n      )(ranking) || [];\r\n    profile.rankingHistory =\r\n      _.flow(\r\n        _.find({ id }),\r\n        _.get('history'),\r\n        history =>\r\n          history && [...history, { place: _.get('place', _.last(history)), date: Date.now() }]\r\n      )(ranking) || [];\r\n    return profile;\r\n  };\r\n  return _.mapValues(addHistoryData, profiles);\r\n};\r\n\r\nexport const getInitialProfiles = (data, tracklist) => {\r\n  // console.log(tracklist);\r\n  let profiles = {};\r\n  const initializeProfile = id => {\r\n    const resultsByLevel = _.fromPairs(Array.from({ length: 28 }).map((x, i) => [i + 1, []]));\r\n    profiles[id] = { resultsByGrade: {}, resultsByLevel, lastResultDate: null };\r\n  };\r\n  const addResultData = (chart, result) => {\r\n    if (!profiles[result.playerId]) {\r\n      initializeProfile(result.playerId);\r\n    }\r\n    const profile = profiles[result.playerId];\r\n    profile.resultsByGrade[result.grade] = [\r\n      ...(profile.resultsByGrade[result.grade] || []),\r\n      { result, chart },\r\n    ];\r\n    const resultsOfThisPlayer = _.filter({ playerId: result.playerId }, chart.results);\r\n    if (resultsOfThisPlayer[0] === result) {\r\n      // Only apply one result\r\n      let bestGradeResult = result;\r\n      if (resultsOfThisPlayer.length > 1) {\r\n        bestGradeResult = resultsOfThisPlayer.sort(\r\n          (a, b) => GRADES.indexOf(b.grade) - GRADES.indexOf(a.grade)\r\n        )[0];\r\n      }\r\n      profile.resultsByLevel[chart.chartLevel] = [\r\n        ...(profile.resultsByLevel[chart.chartLevel] || []),\r\n        { result: bestGradeResult, chart },\r\n      ];\r\n    }\r\n    if (result.isExactDate && profile.lastResultDate < result.dateObject) {\r\n      profile.lastResultDate = result.dateObject;\r\n    }\r\n  };\r\n  data.forEach(chart => {\r\n    chart.results.forEach(result => {\r\n      addResultData(chart, result);\r\n    });\r\n  });\r\n\r\n  const getBonusForLevel = level => (30 * (1 + 2 ** (level / 4))) / 11;\r\n  const getMinimumNumber = totalCharts =>\r\n    Math.round(\r\n      Math.min(totalCharts, 1 + totalCharts / 20 + Math.sqrt(Math.max(totalCharts - 1, 0)) * 0.7)\r\n    );\r\n\r\n  profiles = _.mapValues(profile => {\r\n    const neededGrades = ['A', 'A+', 'S', 'SS', 'SSS'];\r\n    profile.progress = {\r\n      double: {\r\n        SS: {},\r\n        S: {},\r\n        'A+': {},\r\n        A: {},\r\n      },\r\n      single: {\r\n        SS: {},\r\n        S: {},\r\n        'A+': {},\r\n        A: {},\r\n      },\r\n    };\r\n    const gradeIncrementMap = {\r\n      SSS: ['SS', 'S', 'A+', 'A'],\r\n      SS: ['SS', 'S', 'A+', 'A'],\r\n      S: ['S', 'A+', 'A'],\r\n      'A+': ['A+', 'A'],\r\n      A: ['A'],\r\n    };\r\n    const incrementLevel = (l, g, isS) => {\r\n      const prog = isS ? profile.progress.single : profile.progress.double;\r\n      prog[g][l] = prog[g][l] ? prog[g][l] + 1 : 1;\r\n    };\r\n    _.keys(profile.resultsByLevel).forEach(level => {\r\n      profile.resultsByLevel[level].forEach(res => {\r\n        const thisGrade = res.result.grade;\r\n        const thisPlayerId = res.result.playerId;\r\n        const otherResults = res.chart.results.filter(r => r.playerId === thisPlayerId);\r\n        if (otherResults.length > 1) {\r\n          const sortedResults = otherResults.sort(\r\n            (a, b) => neededGrades.indexOf(b.grade) - neededGrades.indexOf(a.grade)\r\n          );\r\n          if (sortedResults[0].grade !== thisGrade) {\r\n            return; // Don't do anything when we have a different result with better grade\r\n          }\r\n        }\r\n        const gradeIncArray = gradeIncrementMap[thisGrade];\r\n        if (gradeIncArray) {\r\n          gradeIncArray.forEach(gradeInc => {\r\n            incrementLevel(level, gradeInc, res.chart.chartType === 'S');\r\n          });\r\n        }\r\n      });\r\n    });\r\n    // console.log(profile.progress);\r\n    ['single', 'double'].forEach(chartType => {\r\n      profile.progress[`${chartType}-bonus`] = 0;\r\n      _.keys(profile.progress[chartType]).forEach(grade => {\r\n        profile.progress[chartType][`${grade}-bonus`] = 0;\r\n        _.keys(profile.progress[chartType][grade]).forEach(level => {\r\n          const number = profile.progress[chartType][grade][level];\r\n          const totalCharts = tracklist.data[`${chartType}sLevels`][level];\r\n          const minimumNumber = getMinimumNumber(totalCharts);\r\n          const bonusCoefficientNumber = Math.min(1, number / minimumNumber);\r\n          const rawBonus = getBonusForLevel(level);\r\n          const bonus = rawBonus * bonusCoefficientNumber;\r\n          profile.progress[chartType][grade][`${level}-bonus`] = bonus;\r\n          profile.progress[chartType][grade][`${level}-bonus-coef`] = bonusCoefficientNumber;\r\n          profile.progress[chartType][grade][`${level}-min-number`] = minimumNumber;\r\n          profile.progress[chartType][grade][`${level}-achieved-number`] = number;\r\n          if (bonus >= profile.progress[chartType][`${grade}-bonus`]) {\r\n            profile.progress[chartType][`${grade}-bonus`] = bonus;\r\n            profile.progress[chartType][`${grade}-bonus-level`] = level;\r\n            profile.progress[chartType][`${grade}-bonus-level-coef`] = bonusCoefficientNumber;\r\n            profile.progress[chartType][`${grade}-bonus-level-min-number`] = minimumNumber;\r\n            profile.progress[chartType][`${grade}-bonus-level-achieved-number`] = number;\r\n          }\r\n        });\r\n        profile.progress[`${chartType}-bonus`] += profile.progress[chartType][`${grade}-bonus`];\r\n      });\r\n    });\r\n    profile.progress.bonus = profile.progress['double-bonus'] + profile.progress['single-bonus'];\r\n    // console.log(profile.progress);\r\n    return profile;\r\n  }, profiles);\r\n  // const formatProfile = profile => {\r\n  //   // console.log(profile);\r\n  //   // const id = _.values(profile.resultsByGrade)[0][0].result.playerId;\r\n  //   const name = _.values(profile.resultsByGrade)[0][0].result.nickname;\r\n  //   return `${name} - ${profile.progress.bonus}\r\n  // S: A (${profile.progress.single['A-bonus'].toFixed(1)}) A+ (${profile.progress.single[\r\n  //     'A+-bonus'\r\n  //   ].toFixed(1)}) S (${profile.progress.single['S-bonus'].toFixed(\r\n  //     1\r\n  //   )}) SS (${profile.progress.single['SS-bonus'].toFixed(1)})\r\n  // D: A (${profile.progress.double['A-bonus'].toFixed(1)}) A+ (${profile.progress.double[\r\n  //     'A+-bonus'\r\n  //   ].toFixed(1)}) S (${profile.progress.double['S-bonus'].toFixed(\r\n  //     1\r\n  //   )}) SS (${profile.progress.double['SS-bonus'].toFixed(1)})`;\r\n  // };\r\n  // console.log(\r\n  //   _.join(\r\n  //     '\\n',\r\n  //     _.map(formatProfile, _.values(profiles).sort((a, b) => b.progress.bonus - a.progress.bonus))\r\n  //   )\r\n  // );\r\n  return profiles;\r\n};\r\n\r\nexport const setProfiles = data => ({\r\n  type: SET_PROFILES,\r\n  data,\r\n});\r\n\r\nexport const setProfilesFilter = filter => ({\r\n  type: SET_FILTER,\r\n  filter,\r\n});\r\n\r\nexport const resetProfilesFilter = () => ({\r\n  type: RESET_FILTER,\r\n});\r\n\r\nexport const calculateProfileData = profileId => (dispatch, getState) => {};\r\n","export const HOST = 'https://vps720616.ovh.net:5000';\r\n","import _ from 'lodash/fp';\r\n\r\nimport { fetchJson } from 'utils/fetch';\r\n\r\nimport { getRankings, setRankings } from './ranking';\r\nimport { getProfiles, getInitialProfiles, setProfiles } from './profiles';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `TOP/LOADING`;\r\nconst SUCCESS = `TOP/SUCCESS`;\r\nconst ERROR = `TOP/ERROR`;\r\nconst SET_FILTER = `TOP/SET_FILTER`;\r\nconst RESET_FILTER = `TOP/RESET_FILTER`;\r\n\r\nexport const defaultFilter = { showRank: true, showRankAndNorank: true };\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n  filter: defaultFilter,\r\n};\r\n\r\nconst preprocessData = data =>\r\n  _.flow(\r\n    _.get('top'),\r\n    _.values,\r\n    _.map(item => {\r\n      const fullRes = _.find(\r\n        r => _.every(_.isNumber, [r.perfects, r.greats, r.goods, r.bads, r.misses]),\r\n        item.results\r\n      );\r\n      const stepSum =\r\n        fullRes &&\r\n        [fullRes.perfects, fullRes.greats, fullRes.goods, fullRes.bads, fullRes.misses].reduce(\r\n          (sum, n) => sum + n,\r\n          0\r\n        );\r\n\r\n      const [chartType, chartLevel] = item.chart_label.match(/(\\D+)|(\\d+)/g);\r\n\r\n      return {\r\n        song: item.track,\r\n        chartLabel: item.chart_label,\r\n        chartLevel,\r\n        chartType,\r\n        mix: item.mix,\r\n        duration: item.duration,\r\n        results: item.results.map((res, index) => {\r\n          let resultInfoOverrides = {};\r\n          if (stepSum) {\r\n            const infos = [res.perfects, res.greats, res.goods, res.bads, res.misses];\r\n            let fixableIndex = -1;\r\n            let localStepSum = 0;\r\n            const canFix =\r\n              infos.filter((numb, index) => {\r\n                if (!_.isNumber(numb)) {\r\n                  fixableIndex = index;\r\n                  return true;\r\n                }\r\n                localStepSum += numb;\r\n                return false;\r\n              }).length === 1;\r\n            if (canFix) {\r\n              resultInfoOverrides[['perfect', 'great', 'good', 'bad', 'miss'][fixableIndex]] =\r\n                stepSum - localStepSum;\r\n            }\r\n          }\r\n          return {\r\n            id: res.id,\r\n            playerId: res.player,\r\n            nickname: data.players[res.player].nickname,\r\n            nicknameArcade: data.players[res.player].arcade_name,\r\n            originalChartMix: res.originalChartMix,\r\n            originalChartLabel: res.originalChartLabel,\r\n            originalScore: res.originalScore,\r\n            date: res.gained,\r\n            dateObject: new Date(res.gained),\r\n            grade: res.grade,\r\n            isExactDate: !!res.exact_gain_date,\r\n            score: res.score,\r\n            scoreIncrease: res.score_increase,\r\n            calories: res.calories && res.calories / 1000,\r\n            perfect: res.perfects,\r\n            great: res.greats,\r\n            good: res.goods,\r\n            bad: res.bads,\r\n            miss: res.misses,\r\n            combo: res.max_combo,\r\n            mods: res.mods_list,\r\n            isRank: !!res.rank_mode,\r\n            isHJ: (res.mods_list || '').split(' ').includes('HJ'),\r\n            ...resultInfoOverrides,\r\n          };\r\n        }),\r\n      };\r\n    }),\r\n    _.map(song => {\r\n      return {\r\n        ...song,\r\n        latestScoreDate: song.results.reduce(\r\n          (latest, current) => (current.date > latest ? current.date : latest),\r\n          song.results[0].date\r\n        ),\r\n        results: song.results.map(res => {\r\n          const perfects = (Math.sqrt(res.perfect) * _.toInteger(song.chartLevel)) / 2;\r\n          const acc = perfects\r\n            ? Math.floor(\r\n                ((perfects * 100 + res.great * 60 + res.good * 30 + res.miss * -20) /\r\n                  (perfects + res.great + res.good + res.bad + res.miss)) *\r\n                  100\r\n              ) / 100\r\n            : null;\r\n          const accRaw = res.perfect\r\n            ? Math.floor(\r\n                ((res.perfect * 100 + res.great * 60 + res.good * 30 + res.miss * -20) /\r\n                  (res.perfect + res.great + res.good + res.bad + res.miss)) *\r\n                  100\r\n              ) / 100\r\n            : null;\r\n          return {\r\n            ...res,\r\n            accuracy: acc < 0 ? 0 : accRaw === 100 ? 100 : acc && +acc.toFixed(2),\r\n            accuracyRaw: accRaw,\r\n            hasRankScore: _.some({ playerId: res.playerId, isRank: true }, song.results),\r\n          };\r\n        }),\r\n      };\r\n    }),\r\n    _.orderBy(['latestScoreDate', 'song', 'chartLevel'], ['desc', 'asc', 'desc'])\r\n  )(data);\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n        players: action.players,\r\n      };\r\n    case SET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: action.filter,\r\n      };\r\n    case RESET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: defaultFilter,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchTopScores = () => {\r\n  return async (dispatch, getState) => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await fetchJson({\r\n        url: `${HOST}/top/v2`,\r\n      });\r\n      // const data = jsonData;\r\n      const processedData = preprocessData(data);\r\n      const initialProfiles = getInitialProfiles(processedData, getState().tracklist);\r\n      const rankings = getRankings(processedData, data, initialProfiles);\r\n      dispatch({\r\n        type: SUCCESS,\r\n        data: processedData,\r\n        players: _.flow(\r\n          _.toPairs,\r\n          _.map(([id, player]) => ({ ...player, id: _.toInteger(id) }))\r\n        )(data.players),\r\n      });\r\n      dispatch(setRankings(rankings));\r\n      const profiles = getProfiles(initialProfiles, processedData, rankings);\r\n      dispatch(setProfiles(profiles));\r\n      return processedData;\r\n    } catch (error) {\r\n      console.log(error);\r\n      dispatch({ type: ERROR, error });\r\n    }\r\n  };\r\n};\r\n\r\nexport const setFilter = filter => ({\r\n  type: SET_FILTER,\r\n  filter,\r\n});\r\nexport const resetFilter = () => ({\r\n  type: RESET_FILTER,\r\n});\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\n\r\nimport { setFilter } from 'reducers/top';\r\n\r\nconst SELECT_PRESET = `PRESETS/SELECT_PRESET`;\r\nconst LOAD_PRESETS = `PRESETS/LOAD_PRESETS`;\r\nconst LOADING_START = `PRESETS/LOADING_START`;\r\nconst LOADING_END = `PRESETS/LOADING_END`;\r\n\r\nconst initialState = {\r\n  presets: [],\r\n  currentPreset: null,\r\n  isLoading: false,\r\n};\r\n\r\nconst itemToOption = item =>\r\n  item && {\r\n    ...item,\r\n    label: item.name,\r\n    value: item.name,\r\n  };\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOAD_PRESETS:\r\n      const currentPreset = _.find({ name: _.get('name', state.currentPreset) }, action.presets);\r\n      return {\r\n        ...state,\r\n        currentPreset: itemToOption(currentPreset) || null,\r\n        presets: _.map(itemToOption, action.presets),\r\n      };\r\n    case SELECT_PRESET:\r\n      return {\r\n        ...state,\r\n        currentPreset: itemToOption(action.currentPreset),\r\n      };\r\n    case LOADING_START:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case LOADING_END:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nconst reloadPresets = presets => ({ type: LOAD_PRESETS, presets: presets || [] });\r\n\r\nconst startLoading = () => ({\r\n  type: LOADING_START,\r\n});\r\n\r\nconst endLoading = () => ({\r\n  type: LOADING_END,\r\n});\r\n\r\nexport const selectPreset = currentPreset => ({\r\n  type: SELECT_PRESET,\r\n  currentPreset,\r\n});\r\n\r\nexport const loadPresets = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    dispatch(reloadPresets(presets));\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const savePreset = name => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const { filter } = getState().top;\r\n    const newPreset = { name, filter };\r\n    if (!_.some({ name }, presets)) {\r\n      const newPresets = [...(presets || []), newPreset];\r\n      dispatch(reloadPresets(newPresets));\r\n      dispatch(selectPreset(newPreset));\r\n      localForage.setItem('filterPresets', newPresets);\r\n    } else if (window.confirm('Preset with this name already exists, replace it?')) {\r\n      const withoutOldPreset = _.remove({ name }, presets);\r\n      const newPresets = [...withoutOldPreset, newPreset];\r\n      dispatch(reloadPresets(newPresets));\r\n      localForage.setItem('filterPresets', newPresets);\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const openPreset = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  const currentPreset = getState().presets.currentPreset;\r\n  const name = _.get('name', currentPreset);\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const preset = name && _.find({ name }, presets);\r\n    if (preset) {\r\n      dispatch(selectPreset(currentPreset));\r\n      dispatch(setFilter(currentPreset.filter));\r\n    } else {\r\n      // Preset not found for some reason, update list\r\n      dispatch(reloadPresets(presets));\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const deletePreset = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  const name = _.get('name', getState().presets.currentPreset);\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const preset = _.find({ name }, presets);\r\n    if (preset && window.confirm('Are you sure you want to delete selected preset?')) {\r\n      const withoutOldPreset = _.remove({ name }, presets);\r\n      dispatch(reloadPresets(withoutOldPreset));\r\n      localForage.setItem('filterPresets', withoutOldPreset);\r\n    } else {\r\n      // Preset not found for some reason, update list\r\n      dispatch(reloadPresets(presets));\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { FaLayerGroup, FaFolderOpen, FaSave, FaPlus, FaTrashAlt } from 'react-icons/fa';\r\nimport Select from 'react-select';\r\n\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport Input from 'components/Shared/Input/Input';\r\n\r\nimport { loadPresets, savePreset, selectPreset, openPreset, deletePreset } from 'reducers/presets';\r\n\r\nconst overlayItem = (\r\n  <button className=\"btn btn-sm btn-dark btn-icon _margin-right\">\r\n    <FaLayerGroup />\r\n    пресеты\r\n  </button>\r\n);\r\n\r\nconst noPresetsMessage = () => 'пусто';\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    ...state.presets,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  loadPresets,\r\n  savePreset,\r\n  openPreset,\r\n  deletePreset,\r\n  selectPreset,\r\n};\r\n\r\nclass PresetsControl extends React.Component {\r\n  state = {};\r\n\r\n  componentDidMount() {\r\n    this.props.loadPresets();\r\n  }\r\n\r\n  onChangeSelection = selected => {\r\n    this.props.selectPreset(selected.name);\r\n  };\r\n\r\n  onRewritePreset = () => {\r\n    const { currentPreset } = this.props;\r\n    this.props.savePreset(currentPreset.name);\r\n  };\r\n\r\n  onSavePreset = () => {\r\n    const { name } = this.state;\r\n    this.props.savePreset(name);\r\n    this.setState({ isAddingNew: false });\r\n  };\r\n\r\n  render() {\r\n    const { presets, currentPreset, isLoading } = this.props;\r\n    const { name, isAddingNew } = this.state;\r\n    return (\r\n      <div>\r\n        <Overlay overlayItem={overlayItem}>\r\n          <div className=\"presets-control-overlay\">\r\n            <Select\r\n              className=\"select _margin-bottom\"\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"пресеты...\"\r\n              options={presets}\r\n              value={currentPreset}\r\n              onChange={this.props.selectPreset}\r\n              noOptionsMessage={noPresetsMessage}\r\n            />\r\n            {currentPreset && (\r\n              <div className=\"buttons-presets _margin-bottom\">\r\n                <div className=\"_flex-fill\" />\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n                  onClick={this.props.openPreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaFolderOpen /> открыть\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n                  onClick={this.onRewritePreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaSave /> перезаписать\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon\"\r\n                  onClick={this.props.deletePreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaTrashAlt /> удалить\r\n                </button>\r\n              </div>\r\n            )}\r\n            {!isAddingNew && (\r\n              <div className=\"buttons-presets _margin-bottom\">\r\n                <div className=\"_flex-fill\" />\r\n\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left _self-align-end\"\r\n                  onClick={() => this.setState({ isAddingNew: true })}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaPlus /> добавить\r\n                </button>\r\n              </div>\r\n            )}\r\n            {isAddingNew && (\r\n              <div className=\"adding-new _margin-bottom\">\r\n                <Input\r\n                  value={name}\r\n                  placeholder=\"имя пресета...\"\r\n                  className=\"form-control\"\r\n                  onChange={name => this.setState({ name })}\r\n                />\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left\"\r\n                  onClick={this.onSavePreset}\r\n                  disabled={!name || isLoading}\r\n                >\r\n                  <FaSave /> сохранить\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left\"\r\n                  onClick={() => this.setState({ isAddingNew: false })}\r\n                  disabled={isLoading}\r\n                >\r\n                  отмена\r\n                </button>\r\n              </div>\r\n            )}\r\n            {/* <div>\r\n              <Toggle\r\n                checked={false}\r\n                onToggle={active => {\r\n                  localForage.setItem('showTabs', active);\r\n                }}\r\n              >\r\n                показывать табы с пресетами\r\n              </Toggle>\r\n            </div> */}\r\n          </div>\r\n        </Overlay>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(PresetsControl);\r\n","import React from 'react';\r\nimport TimeAgo from 'javascript-time-ago';\r\nimport ru from 'javascript-time-ago/locale/ru';\r\nimport { convenient } from 'javascript-time-ago/gradation';\r\nimport moment from 'moment';\r\n\r\nTimeAgo.addLocale(ru);\r\nconst timeAgo = new TimeAgo('ru-RU');\r\n\r\nconst timeStyle = {\r\n  flavour: 'long',\r\n  gradation: convenient,\r\n  units: ['day', 'week', 'month'],\r\n};\r\nexport const tooltipFormatter = date => date.toLocaleDateString();\r\nexport const tooltipFormatterForBests = date => (\r\n  <div style={{ display: 'flex', alignItems: 'center', flexDirection: 'column' }}>\r\n    <div>точная дата взятия неизвестна</div>\r\n    <div>скор был записан с my best или machine best</div>\r\n    <div>дата записи: {date.toLocaleDateString()}</div>\r\n  </div>\r\n);\r\n\r\nexport const getTimeAgo = date => {\r\n  const dayDiff = moment()\r\n    .startOf('day')\r\n    .diff(moment(date).startOf('day'), 'days');\r\n  return dayDiff === 0 ? 'сегодня' : dayDiff === 1 ? 'вчера' : timeAgo.format(date, timeStyle);\r\n};\r\n","export const colorsArray = [\r\n  '#4DB3FF',\r\n  '#80B300',\r\n  '#FF6655',\r\n  '#FF99E6',\r\n  '#33FFCC',\r\n  '#e633c8',\r\n  '#dbe812',\r\n  '#FF1A66',\r\n  '#991AFF',\r\n  '#E6B333',\r\n  '#1AB399',\r\n  '#4D8066',\r\n  '#CC9999',\r\n  '#00E680',\r\n  '#809980',\r\n  '#E6FF80',\r\n  '#1AFF33',\r\n  '#999933',\r\n  '#E6331A',\r\n  '#CCCC00',\r\n  '#66E64D',\r\n  '#4D80CC',\r\n  '#9900B3',\r\n  '#4DB380',\r\n  '#FF4D4D',\r\n];\r\n","import _ from 'lodash/fp';\r\nimport { createSelector } from 'reselect';\r\nimport matchSorter from 'match-sorter';\r\n\r\nimport { SORT, CHART_MIN_MAX, DURATION_DEFAULT } from 'constants/leaderboard';\r\n\r\nexport const playersSelector = createSelector(\r\n  state => state.top.players,\r\n  _.flow(\r\n    _.toPairs,\r\n    _.map(([id, { nickname, arcade_name }]) => ({\r\n      label: `${nickname} (${arcade_name})`,\r\n      value: nickname,\r\n    })),\r\n    _.sortBy(it => _.toLower(it.label))\r\n  )\r\n);\r\n\r\nconst filterCharts = (filter, rows) => {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filter);\r\n  const type = _.getOr(null, 'type', filter);\r\n  const duration = _.getOr(DURATION_DEFAULT, 'duration', filter);\r\n\r\n  return _.filter(row => {\r\n    if (duration !== DURATION_DEFAULT && !duration.includes(row.duration)) {\r\n      return false;\r\n    }\r\n    return (\r\n      row.chartLevel >= range[0] &&\r\n      row.chartLevel <= range[1] &&\r\n      (!type || row.chartType.startsWith(type))\r\n    );\r\n  }, rows);\r\n};\r\n\r\nconst getFilteredData = (data, filter) => {\r\n  // const start = performance.now();\r\n  const names = _.map('value', filter.players);\r\n  const namesOr = _.map('value', filter.playersOr);\r\n  const namesNot = _.map('value', filter.playersNot);\r\n  const sortingType = _.get('value', filter.sortingType);\r\n  const protagonist = _.get('value', filter.protagonist);\r\n  const excludeAntagonists = _.map('value', filter.excludeAntagonists);\r\n\r\n  const defaultSorting = [_.orderBy(['latestScoreDate'], ['desc'])];\r\n  const newScoresProtagonistSorting = !protagonist\r\n    ? defaultSorting\r\n    : [\r\n        _.orderBy(\r\n          [\r\n            song =>\r\n              _.max(\r\n                _.map(\r\n                  res => (res.nickname === protagonist ? res.dateObject.getTime() : 0),\r\n                  song.results\r\n                )\r\n              ),\r\n          ],\r\n          ['desc']\r\n        ),\r\n      ];\r\n  const protagonistSorting = [\r\n    _.filter(row => _.map('nickname', row.results).includes(protagonist)),\r\n    _.map(row => {\r\n      const protIndex = _.findIndex({ nickname: protagonist }, row.results);\r\n      const protScore = row.results[protIndex].score;\r\n      const enemies = _.flow([\r\n        _.take(protIndex),\r\n        _.uniqBy('nickname'),\r\n        _.remove(res => excludeAntagonists.includes(res.nickname) || res.score === protScore),\r\n      ])(row.results);\r\n      const distance = Math.sqrt(\r\n        _.reduce((dist, enemy) => dist + (enemy.score / protScore - 0.99) ** 2, 0, enemies)\r\n      );\r\n      return {\r\n        ...row,\r\n        distanceFromProtagonist: distance,\r\n      };\r\n    }),\r\n    _.orderBy(['distanceFromProtagonist'], ['desc']),\r\n  ];\r\n  const getScoreSorting = direction => [\r\n    _.filter(row => _.map('nickname', row.results).includes(protagonist)),\r\n    _.orderBy(\r\n      [\r\n        row => {\r\n          return _.getOr(\r\n            direction === 'asc' ? Infinity : -Infinity,\r\n            'ratingDiff',\r\n            _.find({ nickname: protagonist }, row.results)\r\n          );\r\n        },\r\n      ],\r\n      [direction]\r\n    ),\r\n  ];\r\n  const sortingFunctions =\r\n    {\r\n      [SORT.DEFAULT]: defaultSorting,\r\n      [SORT.NEW_SCORES_PLAYER]: newScoresProtagonistSorting,\r\n      [SORT.PROTAGONIST]: protagonistSorting,\r\n      [SORT.RANK_ASC]: getScoreSorting('asc'),\r\n      [SORT.RANK_DESC]: getScoreSorting('desc'),\r\n    }[sortingType] || defaultSorting;\r\n\r\n  const result = _.flow(\r\n    _.compact([\r\n      filter.chartRange && (items => filterCharts(filter.chartRange, items)),\r\n      !filter.showRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => !res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        filter.showOnlyRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        !filter.showOnlyRank &&\r\n        !filter.showRankAndNorank &&\r\n        _.map(row => {\r\n          const occuredNames = [];\r\n          return {\r\n            ...row,\r\n            results: _.filter(res => {\r\n              const alreadyOccured = occuredNames.includes(res.nickname);\r\n              occuredNames.push(res.nickname);\r\n              return !alreadyOccured;\r\n            }, row.results),\r\n          };\r\n        }),\r\n      (names.length || namesOr.length || namesNot.length) &&\r\n        _.filter(row => {\r\n          const rowNames = _.map('nickname', row.results);\r\n          return (\r\n            (!names.length || _.every(name => rowNames.includes(name), names)) &&\r\n            (!namesOr.length || _.some(name => rowNames.includes(name), namesOr)) &&\r\n            (!namesNot.length || !_.some(name => rowNames.includes(name), namesNot))\r\n          );\r\n        }),\r\n      _.filter(row => _.size(row.results)),\r\n      ...sortingFunctions,\r\n      filter.song && (items => matchSorter(items, filter.song, { keys: ['song'] })),\r\n    ])\r\n  )(data);\r\n  // console.log('Elapsed:', performance.now() - start);\r\n  return result;\r\n};\r\n\r\nexport const filteredDataSelector = createSelector(\r\n  state => state.top.data,\r\n  state => state.top.filter,\r\n  getFilteredData\r\n);\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport _ from 'lodash/fp';\r\nimport Select from 'react-select';\r\nimport classNames from 'classnames';\r\nimport numeral from 'numeral';\r\nimport localForage from 'localforage';\r\nimport { NavLink } from 'react-router-dom';\r\nimport Tooltip from 'react-responsive-ui/modules/Tooltip';\r\nimport {\r\n  FaRedoAlt,\r\n  FaExclamationTriangle,\r\n  FaSearch,\r\n  FaYoutube,\r\n  FaAngleDoubleUp,\r\n} from 'react-icons/fa';\r\n\r\n// styles\r\nimport 'react-responsive-ui/style.css';\r\nimport './leaderboard.scss';\r\n\r\n// components\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Loader from 'components/Shared/Loader';\r\nimport Input from 'components/Shared/Input/Input';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\nimport CollapsibleBar from 'components/Shared/CollapsibleBar';\r\nimport ChartFilter from './ChartFilter';\r\nimport PresetsControl from './PresetsControl';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\nimport { SORT } from 'constants/leaderboard';\r\nimport { DEBUG } from 'constants/env';\r\n\r\n// reducers\r\nimport { fetchTopScores, setFilter, resetFilter, defaultFilter } from 'reducers/top';\r\nimport { selectPreset, openPreset } from 'reducers/presets';\r\n\r\n// utils\r\nimport { tooltipFormatter, tooltipFormatterForBests, getTimeAgo } from 'utils/leaderboards';\r\nimport { colorsArray } from 'utils/colors';\r\nimport { playersSelector, filteredDataSelector } from 'reducers/selectors';\r\n\r\n// code\r\nconst sortingOptions = [\r\n  {\r\n    label: 'от новых скоров',\r\n    value: SORT.DEFAULT,\r\n  },\r\n  {\r\n    label: 'от новых скоров конкретного игрока',\r\n    value: SORT.NEW_SCORES_PLAYER,\r\n  },\r\n  // {\r\n  //   label: 'отставанию от остальных',\r\n  //   value: SORT.PROTAGONIST,\r\n  // },\r\n  // ...(DEBUG\r\n  //   ? [\r\n  {\r\n    label: 'от худших результатов',\r\n    value: SORT.RANK_ASC,\r\n  },\r\n  {\r\n    label: 'от лучших результатов',\r\n    value: SORT.RANK_DESC,\r\n  },\r\n  //   ]\r\n  // : []),\r\n];\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    players: playersSelector(state),\r\n    filteredData: filteredDataSelector(state),\r\n    data: state.top.data,\r\n    filter: state.top.filter,\r\n    error: state.top.error,\r\n    isLoading: state.top.isLoading,\r\n    presets: state.presets.presets,\r\n    currentPreset: state.presets.currentPreset,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchTopScores,\r\n  setFilter,\r\n  resetFilter,\r\n  selectPreset,\r\n  openPreset,\r\n};\r\n\r\nclass Leaderboard extends Component {\r\n  static propTypes = {\r\n    match: toBe.object,\r\n    data: toBe.array,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  state = { showItemsCount: 20 };\r\n\r\n  setFilter = _.curry((name, value) => {\r\n    const filter = { ...this.props.filter, [name]: value };\r\n    this.props.setFilter(filter);\r\n    localForage.setItem('filter', filter);\r\n  });\r\n\r\n  resetFilter = () => {\r\n    this.props.resetFilter();\r\n    localForage.setItem('filter', defaultFilter);\r\n  };\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchTopScores();\r\n  };\r\n\r\n  onTypeSongName = _.debounce(300, value => {\r\n    this.setFilter('song', value);\r\n  });\r\n\r\n  renderSimpleSearch() {\r\n    const { isLoading, filter } = this.props;\r\n    return (\r\n      <div className=\"simple-search\">\r\n        <div className=\"song-name _margin-right _margin-bottom\">\r\n          <Input\r\n            value={filter.song || ''}\r\n            placeholder=\"название песни...\"\r\n            className=\"form-control\"\r\n            onChange={this.onTypeSongName}\r\n          />\r\n        </div>\r\n        <div className=\"chart-range _margin-right _margin-bottom\">\r\n          <ChartFilter filterValue={filter.chartRange} onChange={this.setFilter('chartRange')} />\r\n        </div>\r\n        <div className=\"_flex-fill\" />\r\n        <div className=\"_flex-row _margin-bottom\">\r\n          <PresetsControl />\r\n          <button className=\"btn btn-sm btn-dark btn-icon _margin-right\" onClick={this.resetFilter}>\r\n            <FaRedoAlt /> сбросить фильтры\r\n          </button>\r\n          <button\r\n            disabled={isLoading}\r\n            className=\"btn btn-sm btn-dark btn-icon\"\r\n            onClick={this.onRefresh}\r\n          >\r\n            <FaSearch /> обновить\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderFilters() {\r\n    const { players, filter } = this.props;\r\n\r\n    return (\r\n      <div className=\"filters\">\r\n        <div className=\"people-filters\">\r\n          <label className=\"label\">показывать чарты, которые сыграл:</label>\r\n          <div className=\"players-block\">\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">каждый из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'players', filter)}\r\n                onChange={this.setFilter('players')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и хоть один из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersOr', filter)}\r\n                onChange={this.setFilter('playersOr')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и никто из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersNot', filter)}\r\n                onChange={this.setFilter('playersNot')}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Toggle\r\n            checked={_.getOr(false, 'showRank', filter)}\r\n            onChange={this.setFilter('showRank')}\r\n          >\r\n            показывать скоры на ранке\r\n          </Toggle>\r\n        </div>\r\n        {_.get('showRank', filter) && (\r\n          <>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showOnlyRank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showOnlyRank', value);\r\n                  if (_.get('showRankAndNorank', filter)) {\r\n                    this.setFilter('showRankAndNorank', false);\r\n                  }\r\n                }}\r\n              >\r\n                <strong>только</strong> на ранке\r\n              </Toggle>\r\n            </div>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showRankAndNorank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showRankAndNorank', value);\r\n                  if (_.get('showOnlyRank', filter)) {\r\n                    this.setFilter('showOnlyRank', false);\r\n                  }\r\n                }}\r\n              >\r\n                показывать лучшие скоры с ранком и без\r\n              </Toggle>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderSortings() {\r\n    const { players, filter } = this.props;\r\n    return (\r\n      <div className=\"sortings\">\r\n        <div>\r\n          <label className=\"label\">сортировка:</label>\r\n          <Select\r\n            placeholder=\"выберите сортировку\"\r\n            className=\"select\"\r\n            classNamePrefix=\"select\"\r\n            isClearable={false}\r\n            options={sortingOptions}\r\n            value={_.getOr(sortingOptions[0], 'sortingType', filter)}\r\n            onChange={this.setFilter('sortingType')}\r\n          />\r\n        </div>\r\n        {[SORT.PROTAGONIST, SORT.RANK_ASC, SORT.RANK_DESC, SORT.NEW_SCORES_PLAYER].includes(\r\n          _.get('sortingType.value', filter)\r\n        ) && (\r\n          <div>\r\n            <label className=\"label\">игрок:</label>\r\n            <Select\r\n              className={classNames('select players', {\r\n                'red-border': !_.get('protagonist', filter),\r\n              })}\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"игроки...\"\r\n              options={players}\r\n              value={_.getOr(null, 'protagonist', filter)}\r\n              onChange={this.setFilter('protagonist')}\r\n            />\r\n          </div>\r\n        )}\r\n        {[SORT.PROTAGONIST].includes(_.get('sortingType.value', filter)) && (\r\n          <div>\r\n            <label className=\"label\">не учитывать в сравнении:</label>\r\n            <Select\r\n              closeMenuOnSelect={false}\r\n              className=\"select players\"\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"игроки...\"\r\n              options={players}\r\n              isMulti\r\n              value={_.getOr([], 'excludeAntagonists', filter)}\r\n              onChange={this.setFilter('excludeAntagonists')}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, filteredData, error, filter } = this.props;\r\n    const { showItemsCount } = this.state;\r\n    const canShowMore = filteredData.length > showItemsCount;\r\n    const visibleData = _.slice(0, showItemsCount, filteredData);\r\n\r\n    const showProtagonistRatingChange = [SORT.PROTAGONIST, SORT.RANK_ASC, SORT.RANK_DESC].includes(\r\n      _.get('sortingType.value', filter)\r\n    );\r\n    const highlightProtagonist = [\r\n      SORT.PROTAGONIST,\r\n      SORT.RANK_ASC,\r\n      SORT.RANK_DESC,\r\n      SORT.NEW_SCORES_PLAYER,\r\n    ].includes(_.get('sortingType.value', filter));\r\n    const protagonistName = _.get('protagonist.value', filter);\r\n    const uniqueSelectedNames = _.slice(\r\n      0,\r\n      colorsArray.length,\r\n      _.uniq(\r\n        _.compact([\r\n          highlightProtagonist && protagonistName,\r\n          ..._.map('value', filter.players),\r\n          ..._.map('value', filter.playersOr),\r\n        ])\r\n      )\r\n    );\r\n\r\n    return (\r\n      <div className=\"leaderboard-page\">\r\n        <div className=\"content\">\r\n          <div className=\"search-block\">\r\n            {this.renderSimpleSearch()}\r\n            <CollapsibleBar title=\"фильтры\">{this.renderFilters()}</CollapsibleBar>\r\n            <CollapsibleBar title=\"сортировка\">{this.renderSortings()}</CollapsibleBar>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          {!!this.props.presets.length && (\r\n            <div className=\"presets-buttons\">\r\n              <span>пресеты:</span>\r\n              {this.props.presets.map(preset => (\r\n                <ToggleButton\r\n                  key={preset.name}\r\n                  text={preset.name}\r\n                  className=\"btn btn-sm btn-dark _margin-right\"\r\n                  active={_.get('filter', preset) === this.props.filter}\r\n                  onToggle={() => {\r\n                    this.props.selectPreset(preset);\r\n                    this.props.openPreset();\r\n                  }}\r\n                ></ToggleButton>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <div className=\"top-list\">\r\n            {_.isEmpty(filteredData) && !isLoading && (error ? error.message : 'ничего не найдено')}\r\n            {!isLoading &&\r\n              visibleData.map((chart, chartIndex) => {\r\n                let topPlace = 1;\r\n                const occuredNicknames = [];\r\n                const results = chart.results.map((res, index) => {\r\n                  const isSecondOccurenceInResults = occuredNicknames.includes(res.nickname);\r\n                  occuredNicknames.push(res.nickname);\r\n                  if (index === 0) {\r\n                    topPlace = 1;\r\n                  } else if (\r\n                    !isSecondOccurenceInResults &&\r\n                    res.score !== _.get([index - 1, 'score'], chart.results)\r\n                  ) {\r\n                    topPlace += 1;\r\n                  }\r\n                  return {\r\n                    ...res,\r\n                    topPlace,\r\n                    isSecondOccurenceInResults,\r\n                  };\r\n                });\r\n                return (\r\n                  <div className=\"song-block\" key={chart.song + chart.chartLabel}>\r\n                    <div className=\"song-name\">\r\n                      <div\r\n                        className={classNames('chart-name', {\r\n                          single: chart.chartType === 'S',\r\n                          singlep: chart.chartType === 'SP',\r\n                          doublep: chart.chartType === 'DP',\r\n                          double: chart.chartType === 'D',\r\n                          coop: chart.chartType === 'COOP',\r\n                        })}\r\n                      >\r\n                        <span className=\"chart-letter\">{chart.chartType}</span>\r\n                        <span className=\"chart-number\">{chart.chartLevel}</span>\r\n                      </div>\r\n                      <div>{chart.song}</div>\r\n                      <div className=\"youtube-link\">\r\n                        <a\r\n                          href={`https://youtube.com/results?search_query=${chart.song\r\n                            .replace(/ /g, '+')\r\n                            .replace(/-/g, '')}+${chart.chartLabel}`}\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                        >\r\n                          <FaYoutube />\r\n                        </a>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"charts\">\r\n                      <div className=\"chart\">\r\n                        <div className=\"results\">\r\n                          <table>\r\n                            {chartIndex === 0 && (\r\n                              <thead>\r\n                                <tr>\r\n                                  <th className=\"place\"></th>\r\n                                  <th className=\"nickname\"></th>\r\n                                  <th className=\"judge\"></th>\r\n                                  <th className=\"score\">score</th>\r\n                                  <th className=\"grade\"></th>\r\n                                  <th className=\"number\">miss</th>\r\n                                  <th className=\"number\">bad</th>\r\n                                  <th className=\"number\">good</th>\r\n                                  <th className=\"number\">great</th>\r\n                                  <th className=\"number\">perfect</th>\r\n                                  <th className=\"combo\">combo</th>\r\n                                  <th className=\"accuracy\">accuracy</th>\r\n                                  <th className=\"date\"></th>\r\n                                </tr>\r\n                              </thead>\r\n                            )}\r\n                            <tbody>\r\n                              {results.map((res, index) => {\r\n                                const nameIndex = uniqueSelectedNames.indexOf(res.nickname);\r\n                                let placeDifference, newIndex;\r\n                                if (res.scoreIncrease && res.date === chart.latestScoreDate) {\r\n                                  const prevScore = res.score - res.scoreIncrease;\r\n                                  newIndex = _.findLastIndex(res => res.score > prevScore, results);\r\n                                  placeDifference = newIndex - index;\r\n                                }\r\n                                return (\r\n                                  <tr\r\n                                    key={res.score + res.nickname}\r\n                                    className={classNames({\r\n                                      empty: !res.isExactDate,\r\n                                      latest: res.date === chart.latestScoreDate,\r\n                                    })}\r\n                                  >\r\n                                    <td className=\"place\">\r\n                                      {res.isSecondOccurenceInResults ? '' : `#${res.topPlace}`}\r\n                                    </td>\r\n                                    <td\r\n                                      className=\"nickname\"\r\n                                      style={\r\n                                        nameIndex > -1\r\n                                          ? { fontWeight: 'bold', color: colorsArray[nameIndex] }\r\n                                          : {}\r\n                                      }\r\n                                    >\r\n                                      {res.nickname}\r\n                                      {!!placeDifference && (\r\n                                        <span className=\"change-holder up\">\r\n                                          <span>{placeDifference}</span>\r\n                                          <FaAngleDoubleUp />\r\n                                        </span>\r\n                                      )}\r\n                                      {DEBUG && (\r\n                                        <span>\r\n                                          {' '}\r\n                                          {res.startingRating &&\r\n                                            Math.round(res.startingRating)}{' '}\r\n                                          {res.ratingDiff && Math.round(res.ratingDiff)}{' '}\r\n                                          {res.ratingDiffLast && Math.round(res.ratingDiffLast)}\r\n                                        </span>\r\n                                      )}\r\n                                      {!DEBUG &&\r\n                                        showProtagonistRatingChange &&\r\n                                        res.nickname === protagonistName &&\r\n                                        res.ratingDiff && (\r\n                                          <span>\r\n                                            {` (${res.ratingDiff > 0 ? '+' : ''}${Math.round(\r\n                                              res.ratingDiff\r\n                                            )})`}\r\n                                          </span>\r\n                                        )}\r\n                                      {_.get('sortingType.value', filter) === SORT.PROTAGONIST &&\r\n                                        res.nickname === protagonistName &&\r\n                                        chart.distanceFromProtagonist > 0 && (\r\n                                          <span className=\"protagonist-diff\">\r\n                                            {' '}\r\n                                            -{(chart.distanceFromProtagonist * 100).toFixed(1)}%\r\n                                          </span>\r\n                                        )}\r\n                                    </td>\r\n                                    <td\r\n                                      className={classNames('judge', {\r\n                                        vj: res.isRank,\r\n                                        hj: res.isHJ,\r\n                                      })}\r\n                                    >\r\n                                      {res.isRank && (\r\n                                        <div className=\"inner\">\r\n                                          {res.isExactDate ? (\r\n                                            'VJ'\r\n                                          ) : (\r\n                                            <Tooltip\r\n                                              content={\r\n                                                <div>\r\n                                                  наличие ранка на этом результате было угадано,\r\n                                                  основываясь на скоре\r\n                                                </div>\r\n                                              }\r\n                                              tooltipClassName=\"timeago-tooltip\"\r\n                                            >\r\n                                              VJ?\r\n                                            </Tooltip>\r\n                                          )}\r\n                                        </div>\r\n                                      )}\r\n                                      {res.isHJ && <div className=\"inner\">HJ</div>}\r\n                                    </td>\r\n                                    <td className=\"score\">\r\n                                      <Overlay\r\n                                        overlayClassName=\"score-overlay-outer\"\r\n                                        overlayItem={\r\n                                          <span className=\"score-span\">\r\n                                            {/* {res.scoreIncrease > res.score * 0.8 && <FaPlus />} */}\r\n                                            {res.scoreIncrease > res.score * 0.8 && '*'}\r\n                                            {numeral(res.score).format('0,0')}\r\n                                          </span>\r\n                                        }\r\n                                        placement=\"top\"\r\n                                      >\r\n                                        <div className=\"score-overlay\">\r\n                                          {DEBUG && (\r\n                                            <>\r\n                                              <div>\r\n                                                <span className=\"_grey\">result id: </span>\r\n                                                {res.id}\r\n                                              </div>\r\n                                              <div>\r\n                                                <span className=\"_grey\">player id: </span>\r\n                                                {res.playerId}\r\n                                              </div>\r\n                                            </>\r\n                                          )}\r\n                                          <div>\r\n                                            <span className=\"_grey\">игрок: </span>\r\n                                            <NavLink\r\n                                              exact\r\n                                              to={routes.profile.getPath({ id: res.playerId })}\r\n                                            >\r\n                                              {res.nickname} ({res.nicknameArcade})\r\n                                            </NavLink>\r\n                                          </div>\r\n                                          {!res.isExactDate && (\r\n                                            <div className=\"warning\">\r\n                                              <FaExclamationTriangle />\r\n                                              рекорд взят с my best. часть данных недоступна\r\n                                            </div>\r\n                                          )}\r\n                                          {res.isExactDate && (\r\n                                            <>\r\n                                              {res.mods && (\r\n                                                <div>\r\n                                                  <span className=\"_grey\">моды: </span>\r\n                                                  {res.mods}\r\n                                                </div>\r\n                                              )}\r\n                                              {res.calories && (\r\n                                                <div>\r\n                                                  <span className=\"_grey\">ккал: </span>\r\n                                                  {res.calories}\r\n                                                </div>\r\n                                              )}\r\n                                              {res.scoreIncrease && (\r\n                                                <div>\r\n                                                  <span className=\"_grey\">прирост: </span>+\r\n                                                  {numeral(res.scoreIncrease).format('0,0')}\r\n                                                </div>\r\n                                              )}\r\n                                              {res.originalChartMix && (\r\n                                                <div>\r\n                                                  <div className=\"warning\">\r\n                                                    <FaExclamationTriangle />\r\n                                                    было сыграно на {res.originalChartMix}\r\n                                                  </div>\r\n                                                  {res.originalChartLabel && (\r\n                                                    <div>\r\n                                                      <span className=\"_grey\">\r\n                                                        оригинальный чарт:{' '}\r\n                                                      </span>\r\n                                                      {res.originalChartLabel}\r\n                                                    </div>\r\n                                                  )}\r\n                                                  {res.originalScore && (\r\n                                                    <div>\r\n                                                      <span className=\"_grey\">\r\n                                                        оригинальный скор:{' '}\r\n                                                      </span>\r\n                                                      {res.originalScore}\r\n                                                    </div>\r\n                                                  )}\r\n                                                </div>\r\n                                              )}\r\n                                              {res.scoreIncrease > res.score * 0.8 && '* сайтрид'}\r\n                                            </>\r\n                                          )}\r\n                                        </div>\r\n                                      </Overlay>\r\n                                    </td>\r\n                                    <td className=\"grade\">\r\n                                      <div className=\"img-holder\">\r\n                                        {res.grade && res.grade !== '?' && (\r\n                                          <img\r\n                                            src={`${process.env.PUBLIC_URL}/grades/${res.grade}.png`}\r\n                                            alt={res.grade}\r\n                                          />\r\n                                        )}\r\n                                        {res.grade === '?' && null}\r\n                                      </div>\r\n                                    </td>\r\n                                    <td className=\"number miss\">{res.miss}</td>\r\n                                    <td className=\"number bad\">{res.bad}</td>\r\n                                    <td className=\"number good\">{res.good}</td>\r\n                                    <td className=\"number great\">{res.great}</td>\r\n                                    <td className=\"number perfect\">{res.perfect}</td>\r\n                                    <td className=\"combo\">\r\n                                      {res.combo}\r\n                                      {res.combo ? 'x' : ''}\r\n                                    </td>\r\n                                    <td className=\"accuracy\">\r\n                                      {res.accuracy}\r\n                                      {res.accuracy ? '%' : ''}\r\n                                    </td>\r\n                                    <td\r\n                                      className={classNames('date', {\r\n                                        latest: res.date === chart.latestScoreDate,\r\n                                      })}\r\n                                    >\r\n                                      <Tooltip\r\n                                        content={\r\n                                          res.isExactDate\r\n                                            ? tooltipFormatter(res.dateObject)\r\n                                            : tooltipFormatterForBests(res.dateObject)\r\n                                        }\r\n                                        tooltipClassName=\"timeago-tooltip\"\r\n                                      >\r\n                                        {getTimeAgo(res.dateObject)}\r\n                                        {res.isExactDate ? '' : '?'}\r\n                                      </Tooltip>\r\n                                    </td>\r\n                                  </tr>\r\n                                );\r\n                              })}\r\n                            </tbody>\r\n                          </table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            {!isLoading && canShowMore && (\r\n              <button\r\n                className=\"btn btn-sm btn-primary\"\r\n                onClick={() =>\r\n                  this.setState(state => ({ showItemsCount: state.showItemsCount + 10 }))\r\n                }\r\n              >\r\n                show more...\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Leaderboard);\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\n// import numeral from 'numeral';\r\nimport classNames from 'classnames';\r\nimport { GiQueenCrown } from 'react-icons/gi';\r\nimport { FaAngleDoubleUp, FaAngleDoubleDown } from 'react-icons/fa';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nimport { routes } from 'constants/routes';\r\n\r\nimport Loader from 'components/Shared/Loader';\r\n\r\nconst getGradeImg = grade => (\r\n  <img src={`${process.env.PUBLIC_URL}/grades/${grade}.png`} alt={grade} />\r\n);\r\n\r\nexport default function RankingList({ ranking, isLoading }) {\r\n  return (\r\n    <div className=\"ranking-list\">\r\n      {_.isEmpty(ranking) && !isLoading && 'ничего не найдено'}\r\n      {isLoading && <Loader />}\r\n      {!isLoading && (\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th className=\"place\"></th>\r\n              <th className=\"change\"></th>\r\n              <th className=\"name\">name</th>\r\n              <th className=\"name2\">piu name</th>\r\n              <th className=\"rating\">elo</th>\r\n              <th className=\"rating-change-cell\"></th>\r\n              {/* <th className=\"total-score\">total score</th> */}\r\n              <th className=\"grades sss\">{getGradeImg('SSS')}</th>\r\n              <th className=\"grades ss\">{getGradeImg('SS')}</th>\r\n              <th className=\"grades s\">{getGradeImg('S')}</th>\r\n              <th className=\"grades a\">{getGradeImg('A+')}</th>\r\n              <th className=\"grades b\">{getGradeImg('B')}</th>\r\n              <th className=\"grades c\">{getGradeImg('C')}</th>\r\n              <th className=\"grades d\">{getGradeImg('D')}</th>\r\n              <th className=\"grades f\">{getGradeImg('F')}</th>\r\n              <th className=\"playcount\">scores</th>\r\n              {/* <th className=\"calories\">kcal</th> */}\r\n              <th className=\"accuracy\">accuracy</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {ranking.map((player, playerIndex) => {\r\n              return (\r\n                <tr className=\"player\" key={player.name}>\r\n                  <td className=\"place\">\r\n                    {playerIndex === 0 ? <GiQueenCrown /> : `#${playerIndex + 1}`}\r\n                  </td>\r\n                  <td className=\"change\">\r\n                    {player.change > 0 && (\r\n                      <div className=\"change-holder up\">\r\n                        <span>{player.change}</span>\r\n                        <FaAngleDoubleUp />\r\n                      </div>\r\n                    )}\r\n                    {player.change < 0 && (\r\n                      <div className=\"change-holder down\">\r\n                        <span>{-player.change}</span>\r\n                        <FaAngleDoubleDown />\r\n                      </div>\r\n                    )}\r\n                    {!!player.change && _.isString(player.change) && (\r\n                      <div className=\"change-holder text\">\r\n                        <span>{player.change}</span>\r\n                      </div>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"name\">\r\n                    <NavLink exact to={routes.profile.getPath({ id: player.id })}>\r\n                      {player.name}\r\n                    </NavLink>\r\n                  </td>\r\n                  <td className=\"name\">\r\n                    <NavLink exact to={routes.profile.getPath({ id: player.id })}>\r\n                      {player.nameArcade}\r\n                    </NavLink>\r\n                  </td>\r\n                  <td className=\"rating\">{player.rating}</td>\r\n                  <td className=\"rating-change-cell\">\r\n                    {!!player.prevRating && player.prevRating !== player.rating && (\r\n                      <span\r\n                        className={classNames('rating-change', {\r\n                          down: player.prevRating > player.rating,\r\n                          up: player.prevRating < player.rating,\r\n                        })}\r\n                      >\r\n                        {player.prevRating < player.rating ? '+' : ''}\r\n                        {player.rating - player.prevRating}\r\n                      </span>\r\n                    )}\r\n                  </td>\r\n                  {/* <td className=\"total-score\">\r\n                    <div>S: {numeral(player.totalScore.S).format('0,0')}</div>\r\n                    <div>D: {numeral(player.totalScore.D).format('0,0')}</div>\r\n                  </td> */}\r\n                  <td className=\"grades sss\">{player.grades.SSS}</td>\r\n                  <td className=\"grades ss\">{player.grades.SS}</td>\r\n                  <td className=\"grades s\">{player.grades.S}</td>\r\n                  <td className=\"grades a\">{player.grades.A}</td>\r\n                  <td className=\"grades b\">{player.grades.B}</td>\r\n                  <td className=\"grades c\">{player.grades.C}</td>\r\n                  <td className=\"grades d\">{player.grades.D}</td>\r\n                  <td className=\"grades f\">{player.grades.F}</td>\r\n                  <td className=\"playcount\">{player.count}</td>\r\n                  {/* <td className=\"calories\">{numeral(player.totalScore.calories).format('0,0')}</td> */}\r\n                  <td className=\"accuracy\">\r\n                    {player.accuracy ? `${player.accuracy.toFixed(2)}%` : ''}\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function RankingFaq() {\r\n  return (\r\n    <div className=\"faq\">\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Как считается рейтинг?</div>\r\n        <div className=\"answer\">\r\n          A: Используется <a href=\"https://en.wikipedia.org/wiki/Elo_rating_system\">рейтинг Эло</a>,\r\n          широко используемый в шахматах и других играх, слегка модицированный под условия игры на\r\n          пампе. Средний рейтинг - 1000. Коэффициент К зависит от уровня чарта (более сложные чарты\r\n          сильнее влияют на рейтинг). Количество очков влияет на заработанный рейтинг (маленький\r\n          отрыв от противника не даст так много очков как большой отрыв).\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Система Эло используется для игр 1 на 1, как она используется на пампе, где на одном\r\n          чарте играет много игроков?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: Рекорды на одном чарте делятся на несколько игр 1 на 1. Если есть 3 игрока: A, B, C; то\r\n          считается, что было 3 отдельные игры: A vs B, A vs C, B vs C.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Учитываются ли рекорды на ранке в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: Да. Как минимум потому что у нас есть много рекордов, взятых с машин бестов, и мы не\r\n          знаем наверняка, на ранке они или нет. Если у игрока в топе есть два скора - на ранке и\r\n          без ранка, используется тот, где больше очков.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Почему меня нет в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: В таблицу попадают только те, у кого есть хотя бы 20 игр 1 на 1. Первые 20 игр\r\n          используются для определения изначального рейтинга.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Почему суммарное количество оценок S-A-B не совпадает с общим количеством скоров?\r\n        </div>\r\n        <div className=\"answer\">A: Не для каждого результата известна оценка.</div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Если у меня есть несколько рекордов на А, несколько на А+, как считается суммарное\r\n          количество грейдов в таблице?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: В каждой колонке учитываются обе буквы - и треснутые, и с удержанным лайфом. То есть и\r\n          А, и А+ идут в колонку А. Точно так же для B, C, D.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Убери аккураси из таблицы!</div>\r\n        <div className=\"answer\">A: Грем, это секция для вопросов.</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch, FaQuestionCircle } from 'react-icons/fa';\r\nimport { Link, Route, withRouter } from 'react-router-dom';\r\n\r\n// styles\r\nimport 'react-responsive-ui/style.css';\r\nimport './ranking.scss';\r\n\r\n// components\r\nimport RankingList from './RankingList';\r\nimport RankingFaq from './RankingFaq';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\n\r\n// reducers\r\nimport { fetchTopScores } from 'reducers/top';\r\n\r\n// utils\r\n\r\n// code\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    ranking: state.ranking.data,\r\n    error: state.top.error,\r\n    isLoading: state.top.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchTopScores,\r\n};\r\n\r\nclass Ranking extends Component {\r\n  static propTypes = {\r\n    ranking: toBe.array,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    ranking: [],\r\n  };\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchTopScores();\r\n  };\r\n\r\n  render() {\r\n    const { isLoading, ranking, error } = this.props;\r\n\r\n    return (\r\n      <div className=\"ranking-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.path}\r\n              render={() => (\r\n                <>\r\n                  <Link to={routes.ranking.faq.path}>\r\n                    <button className=\"btn btn-sm btn-dark btn-icon _margin-right\">\r\n                      <FaQuestionCircle /> faq\r\n                    </button>\r\n                  </Link>\r\n                  <button\r\n                    disabled={isLoading}\r\n                    className=\"btn btn-sm btn-dark btn-icon\"\r\n                    onClick={this.onRefresh}\r\n                  >\r\n                    <FaSearch /> обновить\r\n                  </button>\r\n                </>\r\n              )}\r\n            />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.faq.path}\r\n              render={() => (\r\n                <Link to={routes.ranking.path}>\r\n                  <button className=\"btn btn-sm btn-dark btn-icon\">назад</button>\r\n                </Link>\r\n              )}\r\n            />\r\n          </div>\r\n          <Route\r\n            exact\r\n            path={routes.ranking.path}\r\n            render={() => <RankingList ranking={ranking} isLoading={isLoading} />}\r\n          />\r\n          <Route exact path={routes.ranking.faq.path} component={RankingFaq} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(Ranking));\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch } from 'react-icons/fa';\r\nimport { withRouter } from 'react-router-dom';\r\nimport classNames from 'classnames';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  LineChart,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip,\r\n  ReferenceLine,\r\n  CartesianGrid,\r\n  Line,\r\n  Legend,\r\n  ResponsiveContainer,\r\n  Label,\r\n} from 'recharts';\r\nimport { createSelector } from 'reselect';\r\nimport _ from 'lodash/fp';\r\n\r\n// styles\r\nimport 'react-responsive-ui/style.css';\r\nimport './profile.scss';\r\n\r\n// constants\r\n\r\n// components\r\nimport Range from 'components/Shared/Range';\r\nimport Loader from 'components/Shared/Loader';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\n\r\n// reducers\r\nimport { fetchTopScores } from 'reducers/top';\r\nimport { setProfilesFilter, resetProfilesFilter } from 'reducers/profiles';\r\n\r\n// utils\r\nimport { getTimeAgo } from 'utils/leaderboards';\r\n\r\n// code\r\nconst MIN_GRAPH_HEIGHT = undefined;\r\nconst defaultGradesDistribution = {\r\n  SSS: 0,\r\n  SS: 0,\r\n  S: 0,\r\n  'A+': 0,\r\n  A: 0,\r\n  B: 0,\r\n  C: 0,\r\n  D: 0,\r\n  F: 0,\r\n};\r\nconst defaultGradesWithLevelsDistribution = _.flow(\r\n  _.flatMap(type => {\r\n    return _.flow(\r\n      _.toPairs,\r\n      _.map(([grade, value]) => [`${type}-${grade}`, value])\r\n    )(defaultGradesDistribution);\r\n  }),\r\n  _.fromPairs\r\n)(['S', 'D']);\r\n\r\nconst cutRange = (array, range) => {\r\n  const startIndex = _.findIndex(item => item.date > range[0], array);\r\n  const endIndex = _.findLastIndex(item => item.date < range[1], array);\r\n  let firstElement =\r\n    startIndex > 0 ? array[startIndex - 1] : startIndex === 0 ? array[startIndex] : _.last(array);\r\n  let lastElement = endIndex > -1 ? array[endIndex] : _.first(array);\r\n  firstElement = { ...firstElement, date: range[0] };\r\n  lastElement = { ...lastElement, date: range[1] };\r\n  const middleElements =\r\n    startIndex > -1 && endIndex > -1 ? array.slice(startIndex, endIndex + 1) : [];\r\n  return [firstElement, ...middleElements, lastElement];\r\n};\r\nconst profileSelector = createSelector(\r\n  (state, props) => _.toInteger(props.match.params.id),\r\n  state => state.profiles.data,\r\n  state => state.profiles.filter,\r\n  state => state.top.players,\r\n  state => state.ranking.data,\r\n  state => state.tracklist.data,\r\n  (id, data, filter, players, ranking, tracklist) => {\r\n    const profile = data[id];\r\n    if (_.isEmpty(profile)) {\r\n      return null;\r\n    }\r\n    const levelsDistribution = _.flow(\r\n      _.get('resultsByLevel'),\r\n      _.toPairs,\r\n      _.map(([x, y]) => ({\r\n        x: _.toInteger(x),\r\n        S:\r\n          (_.size(_.filter(res => res.chart.chartType === 'S', y)) / tracklist.singlesLevels[x]) *\r\n          100,\r\n        D:\r\n          (-_.size(_.filter(res => res.chart.chartType === 'D', y)) / tracklist.doublesLevels[x]) *\r\n          100,\r\n      }))\r\n    )(profile);\r\n    const gradesData = _.flow(\r\n      _.get('resultsByLevel'),\r\n      _.toPairs,\r\n      _.map(\r\n        _.update('[1].result.grade', grade =>\r\n          grade && grade.includes('+') && grade !== 'A+' ? grade.replace('+', '') : grade\r\n        )\r\n      )\r\n    )(profile);\r\n    const gradesDistribution = _.flow(\r\n      _.map(([x, y]) => ({\r\n        x: _.toInteger(x),\r\n        ...defaultGradesDistribution,\r\n        ..._.omit('?', _.mapValues(_.size, _.groupBy('result.grade', y))),\r\n      })),\r\n      _.map(item => {\r\n        const grades = _.pick(Object.keys(defaultGradesDistribution), item);\r\n        const sum = _.sum(_.values(grades));\r\n        return {\r\n          ...item,\r\n          gradesValues: grades,\r\n          ...(sum === 0 ? grades : _.mapValues(value => (100 * value) / sum, grades)),\r\n        };\r\n      })\r\n    )(gradesData);\r\n    const gradesAndLevelsDistribution = _.flow(\r\n      _.map(([x, y]) => {\r\n        const groupedResults = _.groupBy('result.grade', y);\r\n        const counts = _.omit('?', _.mapValues(_.countBy('chart.chartType'), groupedResults));\r\n        const reduced = _.reduce(\r\n          (acc, [grade, levelsData]) => {\r\n            const accData = _.flow(\r\n              _.toPairs,\r\n              _.map(([type, count]) => [\r\n                `${type}-${grade}`,\r\n                type === 'S'\r\n                  ? (count / tracklist.singlesLevels[x]) * 100\r\n                  : (-count / tracklist.doublesLevels[x]) * 100,\r\n              ]),\r\n              _.fromPairs\r\n            )(levelsData);\r\n            return { ...acc, ...accData };\r\n          },\r\n          {},\r\n          _.toPairs(counts)\r\n        );\r\n\r\n        return {\r\n          x: _.toInteger(x),\r\n          ...defaultGradesWithLevelsDistribution,\r\n          ...reduced,\r\n        };\r\n      })\r\n    )(gradesData);\r\n    const lastTickRating = _.last(profile.ratingHistory).date;\r\n    const lastTickRanking = _.last(profile.rankingHistory).date;\r\n    const lastTick = lastTickRating > lastTickRanking ? lastTickRating : lastTickRanking; // End graph at either point\r\n    const firstTick = _.first(profile.ratingHistory).date; // Start graph from the first battle of this player\r\n\r\n    const minMaxRange = [firstTick / 1000 / 60 / 60 / 24, lastTick / 1000 / 60 / 60 / 24];\r\n    const filterRange = filter.dayRange || minMaxRange;\r\n    const dayRangeMs = [filterRange[0] * 1000 * 60 * 60 * 24, filterRange[1] * 1000 * 60 * 60 * 24];\r\n    const placesChanges = cutRange(profile.rankingHistory, dayRangeMs);\r\n    const ratingChanges = cutRange(profile.ratingHistory, dayRangeMs);\r\n    const rankingIndex = _.findIndex({ id }, ranking);\r\n    return {\r\n      ...profile,\r\n      minMaxRange,\r\n      levelsDistribution,\r\n      gradesDistribution,\r\n      gradesAndLevelsDistribution,\r\n      placesChanges,\r\n      ratingChanges,\r\n      player: {\r\n        ..._.find({ id }, players),\r\n        rank: rankingIndex + 1,\r\n        ranking: ranking[rankingIndex],\r\n      },\r\n    };\r\n  }\r\n);\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    profile: profileSelector(state, props),\r\n    tracklist: state.tracklist.data,\r\n    filter: state.profiles.filter,\r\n    error: state.top.error,\r\n    isLoading: state.top.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchTopScores,\r\n  setProfilesFilter,\r\n  resetProfilesFilter,\r\n};\r\n\r\nclass Profile extends Component {\r\n  static propTypes = {\r\n    profile: toBe.object,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    profile: {},\r\n  };\r\n\r\n  state = {\r\n    isLevelGraphCombined: true,\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    this.props.resetProfilesFilter();\r\n  }\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchTopScores();\r\n  };\r\n\r\n  onChangeDayRange = range => {\r\n    const { filter } = this.props;\r\n    this.props.setProfilesFilter({\r\n      ...filter,\r\n      dayRange: range,\r\n    });\r\n  };\r\n\r\n  renderRankingHistory() {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart data={profile.ratingChanges} margin={{ top: 5, bottom: 5, right: 5, left: 0 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"date\"\r\n            type=\"number\"\r\n            domain={['dataMin', 'dataMax']}\r\n            tickFormatter={value => new Date(value).toLocaleDateString()}\r\n          />\r\n          <YAxis\r\n            allowDecimals={false}\r\n            domain={['dataMin - 100', 'dataMax + 100']}\r\n            tickFormatter={Math.round}\r\n            width={40}\r\n          />\r\n          <ReferenceLine y={1000} stroke=\"white\" />\r\n          <Tooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>{new Date(payload[0].payload.date).toLocaleDateString()}</div>\r\n                  {payload && payload[0] && <div>Rating: {Math.round(payload[0].value)}</div>}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <Line\r\n            type=\"monotone\"\r\n            isAnimationActive={false}\r\n            dataKey=\"rating\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderPlaceHistory() {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart data={profile.placesChanges} margin={{ top: 5, bottom: 5, right: 5, left: 0 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"date\"\r\n            type=\"number\"\r\n            domain={['dataMin', 'dataMax']}\r\n            tickFormatter={value => new Date(value).toLocaleDateString()}\r\n          />\r\n          <YAxis\r\n            allowDecimals={false}\r\n            domain={[1, dataMax => (dataMax < 3 ? dataMax + 2 : dataMax + 1)]}\r\n            interval={0}\r\n            reversed\r\n            width={40}\r\n          />\r\n          <Tooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>{new Date(payload[0].payload.date).toLocaleDateString()}</div>\r\n                  {payload && payload[0] && <div>Place: #{payload[0].value}</div>}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <Line\r\n            isAnimationActive={false}\r\n            type=\"stepAfter\"\r\n            dataKey=\"place\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGrades() {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <BarChart\r\n          data={profile.gradesDistribution}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <Tooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {_.filter(item => item.value > 0, payload).map(item => (\r\n                    <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                      {item.name}: {payload[0].payload.gradesValues[item.name]}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis\r\n            domain={[0, 100]}\r\n            ticks={[0, 50, 100]}\r\n            tickFormatter={x => `${Math.round(x)}%`}\r\n            width={40}\r\n          />\r\n          <Legend />\r\n          <Bar dataKey=\"SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"F\" fill=\"#774949\" stackId=\"stack\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGradesWithLevels() {\r\n    const { profile, tracklist } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={0.74}>\r\n        <BarChart\r\n          data={profile.gradesAndLevelsDistribution}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n          stackOffset=\"sign\"\r\n        >\r\n          <Tooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              const doubleItems = _.filter(\r\n                item => item.value !== 0 && item.dataKey.startsWith('D'),\r\n                payload\r\n              );\r\n              const singleItems = _.filter(\r\n                item => item.value !== 0 && item.dataKey.startsWith('S'),\r\n                payload\r\n              );\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {!!singleItems.length && (\r\n                    <>\r\n                      <div>Single:</div>\r\n                      {singleItems.map(item => (\r\n                        <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                          {item.name.slice(2)}: {Math.round(Math.abs(item.value))}% (\r\n                          {Math.round((tracklist.singlesLevels[item.payload.x] * item.value) / 100)}\r\n                          /{tracklist.singlesLevels[item.payload.x]})\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                  {!!doubleItems.length && (\r\n                    <>\r\n                      <div>Double:</div>\r\n                      {doubleItems.map(item => (\r\n                        <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                          {item.name.slice(2)}: {Math.round(Math.abs(item.value))}% (\r\n                          {Math.round(\r\n                            (tracklist.doublesLevels[item.payload.x] * -item.value) / 100\r\n                          )}\r\n                          /{tracklist.doublesLevels[item.payload.x]})\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis tickFormatter={x => `${Math.round(x)}%`} width={40} />\r\n          <Bar dataKey=\"S-SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-F\" fill=\"#774949\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-F\" fill=\"#774949\" stackId=\"stack\" />\r\n          <Label value=\"Double\" offset={0} position=\"insideBottomLeft\" />\r\n          <Label value=\"Single\" offset={0} position=\"insideTopLeft\" />\r\n          <ReferenceLine y={0} stroke=\"#bbb\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderLevels() {\r\n    const { profile, tracklist } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <BarChart\r\n          data={profile.levelsDistribution}\r\n          stackOffset=\"sign\"\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <Tooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              const totalD = tracklist.doublesLevels[payload[0].payload.x];\r\n              const totalS = tracklist.singlesLevels[payload[0].payload.x];\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {totalS > 0 && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[1].color }}>\r\n                      Single: {Math.abs(payload[1].value).toFixed(1)}% (\r\n                      {Math.round((payload[1].value * totalS) / 100)}/{totalS})\r\n                    </div>\r\n                  )}\r\n                  {totalD > 0 && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[0].color }}>\r\n                      Double: {Math.abs(payload[0].value).toFixed(1)}% (\r\n                      {Math.round((Math.abs(payload[0].value) * totalD) / 100)}/{totalD})\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis tickFormatter={x => Math.abs(x) + '%'} width={40} />\r\n          <Tooltip />\r\n          <ReferenceLine y={0} stroke=\"#555\" />\r\n          <Legend />\r\n          <Bar dataKey=\"D\" fill=\"#169c16\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S\" fill=\"#af2928\" stackId=\"stack\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGradeBlock(type, grade) {\r\n    const { profile } = this.props;\r\n    const obj = profile.progress[type];\r\n    const typeLetter = type === 'double' ? 'D' : 'S';\r\n    const progr = Math.floor((obj[`${grade}-bonus-level-coef`] || 0) * 100);\r\n    const minNumber = obj[`${grade}-bonus-level-min-number`];\r\n    const currentNumber = obj[`${grade}-bonus-level-achieved-number`];\r\n    const levelString = obj[`${grade}-bonus-level`]\r\n      ? `${typeLetter}${obj[`${grade}-bonus-level`]}`\r\n      : '?';\r\n    return (\r\n      <div className=\"grade-block\">\r\n        <div className=\"grade-letter\">\r\n          <img src={`${process.env.PUBLIC_URL}/grades/${grade}.png`} alt={grade} />\r\n        </div>\r\n        <div className=\"grade-level\">{levelString}</div>\r\n        <div className=\"grade-progress\">\r\n          {progr}% ({progr === 100 ? minNumber : currentNumber}/{minNumber})\r\n        </div>\r\n        <div className=\"grade-progress\">бонус: +{Math.floor(obj[`${grade}-bonus`])}</div>\r\n        <div\r\n          className={classNames('progress-background', {\r\n            complete: progr === 100,\r\n            zero: progr === 0,\r\n          })}\r\n          style={{\r\n            height: `${progr}%`,\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, profile, error, filter } = this.props;\r\n    const { isLevelGraphCombined } = this.state;\r\n\r\n    if (_.isEmpty(profile)) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div className=\"profile-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            {/* <div className=\"beta\">страница в бета-версии</div> */}\r\n            <button\r\n              disabled={isLoading}\r\n              className=\"btn btn-sm btn-dark btn-icon\"\r\n              onClick={this.onRefresh}\r\n            >\r\n              <FaSearch /> обновить\r\n            </button>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          {!isLoading && (\r\n            <div className=\"profile\">\r\n              <div className=\"profile-header\">\r\n                <div className=\"profile-name text-with-header\">\r\n                  <div className=\"text-header\">игрок</div>\r\n                  <div>{profile.player.nickname}</div>\r\n                </div>\r\n                <div className=\"text-with-header\">\r\n                  <div className=\"text-header\">ранк</div>\r\n                  <div>#{profile.player.rank}</div>\r\n                </div>\r\n                <div className=\"text-with-header\">\r\n                  <div className=\"text-header\">эло</div>\r\n                  <div>{profile.player.ranking.rating}</div>\r\n                </div>\r\n                <div className=\"text-with-header\">\r\n                  <div className=\"text-header\">последняя игра</div>\r\n                  <div>\r\n                    {profile.lastResultDate ? getTimeAgo(profile.lastResultDate) : 'никогда'}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section-horizontal-container\">\r\n                <div className=\"profile-section\">\r\n                  <div className=\"profile-section-content\">\r\n                    {!isLevelGraphCombined ? (\r\n                      <>\r\n                        <div className=\"profile-section-2\">\r\n                          <div className=\"profile-sm-section-header flex\">\r\n                            <span>уровни</span>\r\n                            <div className=\"toggle-holder\">\r\n                              <Toggle\r\n                                className=\"combine-toggle\"\r\n                                checked={isLevelGraphCombined}\r\n                                onChange={() =>\r\n                                  this.setState(state => ({\r\n                                    isLevelGraphCombined: !state.isLevelGraphCombined,\r\n                                  }))\r\n                                }\r\n                              >\r\n                                объединить графики\r\n                              </Toggle>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"chart-container\">{this.renderLevels()}</div>\r\n                        </div>\r\n                        <div className=\"profile-section-2\">\r\n                          <div className=\"profile-sm-section-header\">\r\n                            <span>оценки</span>\r\n                          </div>\r\n                          <div className=\"chart-container\">{this.renderGrades()}</div>\r\n                        </div>\r\n                      </>\r\n                    ) : (\r\n                      <div className=\"profile-section-2\">\r\n                        <div className=\"profile-sm-section-header flex\">\r\n                          <span>оценки</span>\r\n                          <div className=\"toggle-holder\">\r\n                            <Toggle\r\n                              className=\"combine-toggle\"\r\n                              checked={isLevelGraphCombined}\r\n                              onChange={() =>\r\n                                this.setState(state => ({\r\n                                  isLevelGraphCombined: !state.isLevelGraphCombined,\r\n                                }))\r\n                              }\r\n                            >\r\n                              объединить графики\r\n                            </Toggle>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"chart-container single-double-labels\">\r\n                          {this.renderGradesWithLevels()}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"profile-section\">\r\n                  <div className=\"profile-section-content\">\r\n                    <div className=\"profile-section-2\">\r\n                      <div className=\"profile-sm-section-header\">\r\n                        <span>эло</span>\r\n                      </div>\r\n                      <div className=\"chart-container\">{this.renderRankingHistory()}</div>\r\n                    </div>\r\n                    <div className=\"profile-section-2\">\r\n                      <div className=\"profile-sm-section-header\">\r\n                        <span>место в топе</span>\r\n                      </div>\r\n                      <div className=\"chart-container\">{this.renderPlaceHistory()}</div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"range-container\">\r\n                    <Range\r\n                      range={filter.dayRange || profile.minMaxRange}\r\n                      min={profile.minMaxRange[0]}\r\n                      max={profile.minMaxRange[1]}\r\n                      onChange={this.onChangeDayRange}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section progress-section\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>ачивки по уровням</span>\r\n                </div>\r\n                <div className=\"progress-blocks-single-double\">\r\n                  <div className=\"progress-block\">\r\n                    <div className=\"achievements-grades single\">\r\n                      {this.renderGradeBlock('single', 'A')}\r\n                      {this.renderGradeBlock('single', 'A+')}\r\n                      {this.renderGradeBlock('single', 'S')}\r\n                      {this.renderGradeBlock('single', 'SS')}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"progress-block\">\r\n                    <div className=\"achievements-grades double\">\r\n                      {this.renderGradeBlock('double', 'A')}\r\n                      {this.renderGradeBlock('double', 'A+')}\r\n                      {this.renderGradeBlock('double', 'S')}\r\n                      {this.renderGradeBlock('double', 'SS')}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"bonus-faq\">\r\n                  * суммарный бонус (+{Math.round(profile.progress.bonus)}) добавляется к стартовому\r\n                  Эло\r\n                  <br />* для получения ачивки нужно сыграть около 10% всех чартов данного левела на\r\n                  нужный грейд\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(Profile));\r\n","import React, { Component } from 'react';\r\n// import toBe from 'prop-types';\r\n// import classNames from 'classnames';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nimport './top-bar.scss';\r\n\r\nimport { routes } from 'constants/routes';\r\n\r\nclass TopBar extends Component {\r\n  static propTypes = {};\r\n\r\n  render() {\r\n    return (\r\n      <header className=\"top-bar\">\r\n        <nav>\r\n          <ul>\r\n            <li>\r\n              <NavLink exact to={routes.leaderboard.path}>\r\n                leaderboard\r\n              </NavLink>\r\n            </li>\r\n            <li>\r\n              <NavLink exact to={routes.ranking.path}>\r\n                ranking\r\n              </NavLink>\r\n            </li>\r\n          </ul>\r\n        </nav>\r\n      </header>\r\n    );\r\n  }\r\n}\r\n\r\nexport default TopBar;\r\n","import React, { Component } from 'react';\r\nimport { Route, Redirect } from 'react-router-dom';\r\n\r\nimport './App.scss';\r\n\r\nimport { routes } from 'constants/routes';\r\n\r\nimport Leaderboard from 'components/Leaderboard/Leaderboard';\r\nimport Ranking from 'components/Ranking/Ranking';\r\nimport Profile from 'components/Profile/Profile';\r\nimport TopBar from 'components/Shared/TopBar/TopBar';\r\n\r\nclass App extends Component {\r\n  render() {\r\n    return (\r\n      <div className=\"container\">\r\n        <TopBar />\r\n        <Route exact path=\"/\" render={() => <Redirect to={routes.leaderboard.path} />} />\r\n        <Route path={routes.leaderboard.path} component={Leaderboard} />\r\n        <Route path={routes.ranking.path} component={Ranking} />\r\n        <Route path={routes.profile.path} component={Profile} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `TRACKLIST/LOADING`;\r\nconst SUCCESS = `TRACKLIST/SUCCESS`;\r\nconst ERROR = `TRACKLIST/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchTracklist = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await fetchJson({ url: `${HOST}/tracklist/stats/XX` });\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import { combineReducers, createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\n\r\nimport top from 'reducers/top';\r\nimport tracklist from 'reducers/tracklist';\r\nimport ranking from 'reducers/ranking';\r\nimport profiles from 'reducers/profiles';\r\nimport presets from 'reducers/presets';\r\n\r\nconst rootReducer = combineReducers({\r\n  presets,\r\n  profiles,\r\n  ranking,\r\n  top,\r\n  tracklist,\r\n});\r\n\r\nexport const store = createStore(\r\n  rootReducer,\r\n  window.__REDUX_DEVTOOLS_EXTENSION__ && process.env.NODE_ENV === 'development'\r\n    ? compose(\r\n        applyMiddleware(thunk),\r\n        window.__REDUX_DEVTOOLS_EXTENSION__({\r\n          stateSanitizer: state => ({\r\n            ...state,\r\n          }),\r\n        })\r\n      )\r\n    : applyMiddleware(thunk)\r\n);\r\n","import 'promise-polyfill';\r\nimport 'whatwg-fetch';\r\nimport 'utils/polyfills';\r\n\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { HashRouter } from 'react-router-dom';\r\nimport { Provider } from 'react-redux';\r\nimport localForage from 'localforage';\r\nimport _ from 'lodash/fp';\r\n\r\nimport './index.scss';\r\nimport App from 'components/App';\r\n\r\nimport { CHART_MIN_MAX } from 'constants/leaderboard';\r\n\r\nimport { store } from 'reducers';\r\nimport { fetchTopScores, setFilter } from 'reducers/top';\r\nimport { fetchTracklist } from 'reducers/tracklist';\r\n\r\nlocalForage\r\n  .getItem('filter')\r\n  .then(filter => {\r\n    if (filter) {\r\n      store.dispatch(\r\n        setFilter({\r\n          ...filter,\r\n          chartRange: filter.chartRange && {\r\n            ...filter.chartRange,\r\n            range: _.every(\r\n              r => r >= CHART_MIN_MAX[0] && r <= CHART_MIN_MAX[1],\r\n              filter.chartRange.range\r\n            )\r\n              ? filter.chartRange.range\r\n              : CHART_MIN_MAX,\r\n          },\r\n        })\r\n      );\r\n    }\r\n  })\r\n  .catch(error => console.error('Cannot get filter from local storage', error));\r\n\r\nstore.dispatch(fetchTracklist()).then(() => {\r\n  store.dispatch(fetchTopScores());\r\n});\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <HashRouter>\r\n      <App />\r\n    </HashRouter>\r\n  </Provider>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}