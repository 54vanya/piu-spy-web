{"version":3,"sources":["webpack:///./src/utils/workers/profilesPostProcess.js?f05c","utils/polyfills.js","constants/routes.js","constants/leaderboard.js","components/Shared/Loader/index.js","reducers/user/resetAction.js","utils/fetch.js","constants/backend.js","reducers/trackStats/mostPlayed.js","reducers/trackStats/mostPlayedMonth.js","reducers/trackStats/leastPlayed.js","utils/leaderboards.js","utils/date.js","components/SongsTop/SongsTop.js","components/Shared/Overlay/Overlay.js","components/Shared/ToggleButton/ToggleButton.js","components/Shared/Input/Input.js","components/Shared/Toggle/Toggle.js","components/Shared/CollapsibleBar/index.js","components/Shared/Range/index.js","components/Leaderboard/ChartFilter.js","utils/expRanks.js","utils/exp.js","utils/achievements.js","utils/score.js","utils/workers/profilesPostProcess.js","constants/env.js","reducers/results.js","reducers/presets.js","components/Leaderboard/PresetsControl.js","utils/colors.js","reducers/selectors.js","components/Leaderboard/Leaderboard.js","components/Ranking/RankingList.js","components/Ranking/RankingFaq.js","components/Ranking/Ranking.js","components/Profile/MostPlayed.js","components/Profile/ExpFaq.js","reducers/profiles.js","utils/profiles.js","components/Profile/Profile.js","components/ProfileCompare/ProfileCompare.js","reducers/user/index.js","reducers/login.js","components/Shared/TopBar/TopBar.js","components/LoginScreen/LoginScreen.js","reducers/topPerSong.js","reducers/tracklist.js","components/SocketTracker/helpers.js","components/SocketTracker/SocketTracker.js","components/App.js","reducers/trackStats/index.js","reducers/index.js","index.js"],"names":["addMethods","methods","module","exports","w","Worker","name","Number","isNaN","value","Math","sign","x","Array","prototype","findIndex","Object","defineProperty","predicate","this","TypeError","o","len","length","thisArg","arguments","k","kValue","call","configurable","writable","routes","leaderboard","path","songs","ranking","faq","profile","getPath","params","id","compare","compareToId","SORT","DEFAULT","PROTAGONIST","RANK_ASC","RANK_DESC","NEW_SCORES_PLAYER","EASIEST_SONGS","HARDEST_SONGS","CHART_MIN_MAX","DURATION","STD","SHORT","REMIX","FULL","DURATION_DEFAULT","_","values","Loader","className","width","height","viewBox","xmlns","fill","cx","cy","r","attributeName","from","to","begin","dur","calcMode","repeatCount","fillOpacity","RESET","resetUser","type","fetchJson","url","request","method","postJson","body","JSON","stringify","headers","defaultHeaders","async","dispatch","getState","session","cookies","get","response","fetch","credentials","status","json","error","isObject","isString","Error","message","Promise","reject","HOST","SOCKET_SERVER_IP","LOADING","SUCCESS","ERROR","initialState","isLoading","data","TimeAgo","addLocale","ru","timeAgo","timeStyle","flavour","gradation","convenient","units","tooltipFormatter","result","isExactDate","dateObject","toLocaleDateString","resultType","undefined","isMyBest","isMachineBest","style","display","alignItems","flexDirection","getTimeAgo","date","dayDiff","moment","startOf","diff","hour","format","parseDate","textDate","toDate","Date","TopList","fetchList","title","renderRightSide","useState","setData","setLoading","getRightSide","item","countplay","useEffect","then","success","catch","map","index","key","classNames","best","full_name","leastPlayedRightSide","last_play","connect","fetchMostPlayed","fetchMostPlayedMonth","fetchLeastPlayed","POPPER_MODIFIERS","preventOverflow","enabled","padding","boundariesElement","PLACEMENT_ARROW_MAPPING","right","left","top","bottom","getArrowPlacement","placement","split","Overlay","state","isVisible","containerItemRef","React","createRef","renderPopper","bind","toggleOverlayVisibility","setState","event","target","closest","hideOverlay","ref","arrowProps","outOfBoundaries","scheduleUpdate","props","children","hideWhenOutOfBounds","data-placement","overlayClassName","overlayItem","Fragment","onClick","ReactDOM","createPortal","container","document","modifiers","referenceElement","current","PureComponent","defaultTypes","listensToClickOutside","ToggleButton","active","onToggle","text","Input","isNil","defaultValue","bindAll","prevProps","e","newValue","onChange","numericValue","min","max","onBlur","handleBlur","omit","onKeyPress","handleKeyPress","onInput","handleChange","noop","Component","defaultProps","Toggle","checked","uniqueId","htmlFor","CollapsibleBar","open","defaultOpen","Range","range","step","renderTrack","onMouseDown","onTouchStart","position","borderRadius","background","getTrackBackground","colors","alignSelf","renderThumb","isDragged","backgroundColor","justifyContent","boxShadow","ChartFilter","filterValue","onChangeEx","getOr","duration","buttonText","t","isEqual","isEmpty","newMin","newMax","includes","without","ranks","threshold","iconName","color","gradeValue","F","D","C","B","A","S","SS","SSS","getExp","chart","isBestGradeOnChart","chartType","chartLevel","grade","getRankImg","rank","src","process","alt","achievements","icon","GiRank1","description","resultFunction","progress","combo","GiRank2","GiRank3","GiSmokingFinger","playedSongs","songsToPlay","song","uniq","GiRetroController","GiLoveSong","Улитка","GiSnail","charts","some","songToPlay","chartLabel","GiPodiumSecond","miss","bad","GiLifeBar","GiWoodenPegleg","good","great","initialAchievementState","getScoreWithoutBonus","score","postProcessProfiles","profiles","tracklist","mapValues","neededGrades","expRank","findLast","exp","expRanks","expRankNext","find","double","single","gradeIncrementMap","accuracyByLevel","keys","resultsByLevel","forEach","level","count","sum","average","res","isRank","accuracy","thisGrade","thisPlayerId","playerId","otherResults","results","filter","sort","a","b","indexOf","gradeIncArray","gradeInc","l","g","prog","incrementLevel","points","flow","toPairs","toNumber","accuracyPoints","number","minimumNumber","totalCharts","round","sqrt","getMinimumNumber","bonusCoefficientNumber","bonus","getBonusForLevel","achievementBonus","countAcc","sumAccuracy","interpolateDifficulties","sharedCharts","processedProfiles","sums","accData","accuracyPointsInterpolated","i","regression","predict","equation","f","calculated","yx","push","interpolatedPoint","pair","avgAccuracy","interpolatedDifficulty","weight","identity","reduce","acc","diffSum","weightSum","averageDifficulty","getProcessedProfiles","originalProfiles","newSharedCharts","resultInfo","chartId","chartResults","maxPP","maxNonRankScore","maxScore","accuracyRaw","K2","K3","scoreRaw","K","pp","kX","ppPotential","ppRatio","ppFixed","toFixed","scores","pp_","s","ratingRaw","toInteger","rating","processPP","localStorage","window","debugOn","setItem","debugOff","removeItem","DEBUG","getItem","SET_FILTER","RESET_FILTER","RANKING_CHANGE_SET","PROFILES_UPDATE","defaultFilter","showRank","showRankAndNorank","isLoadingRanking","players","gradeComparator","guessGrade","misses","bads","goods","greats","mapResult","recognition_notes","isUnknownPlayer","player","arcade_name","isIntermediateResult","sharedChartId","shared_chart","nickname","nicknameArcade","gained","exact_gain_date","rank_mode","_r","originalChartMix","original_mix","originalChartLabel","original_label","originalScore","original_score","max_score","scoreIncrease","score_increase","calories","perfect","perfects","max_combo","mods","mods_list","isHJ","maxTotalSteps","infos","fixableIndex","absentNumbersCount","localStepSum","isNumber","tryFixIncompleteResult","floor","accRaw","getMaxScore","getMaxRawScore","initializeProfile","fromPairs","nameArcade","resultsByGrade","lastResultDate","battleCount","grades","rankingHistory","ratingHistory","lastPlace","lastBattleDate","achName","getProfileInfoFromResult","replace","convert","cap","achState","fetchResults","processResultsData","console","log","shared_charts","mappedResults","getTopResultId","getBestGradeResultId","topResults","bestGradeResults","resRaw","sharedChart","label","toUpper","chart_label","match","track_name","max_total_steps","totalResultsCount","chartTop","topResultId","currentTopResult","oldScoreIndex","splice","newScoreIndex","sortedLastIndexBy","latestScoreDate","bestGradeResultId","currentBestGradeRes","maxScoreWithAccuracy","maxScoreResult","maxNonRankScoreResult","processData","originalData","input","promise","worker","WorkerProfilesProcessing","profilesProcessing","q","calculateRankingChanges","terminate","setFilter","getListOfNames","getMapOfRatings","orderBy","all","localForage","lastChangedRanking","lastChangedRankingPoints","lastFetchedRanking","listNow","listLastFetched","listLastChanged","mapPointsNow","mapPointsLastFetched","rankingsPointsMap","listPrev","warn","SELECT_PRESET","LOAD_PRESETS","LOADING_START","LOADING_END","presets","currentPreset","itemToOption","reloadPresets","startLoading","endLoading","selectPreset","openPreset","noPresetsMessage","mapDispatchToProps","loadPresets","savePreset","newPreset","confirm","withoutOldPreset","remove","newPresets","deletePreset","PresetsControl","onChangeSelection","selected","onRewritePreset","onSavePreset","isAddingNew","classNamePrefix","placeholder","options","noOptionsMessage","disabled","colorsArray","playersSelector","createSelector","user","isCurrentPlayer","sortBy","it","toLower","filteredDataSelector","names","namesOr","playersOr","namesNot","playersNot","sortingType","protagonist","excludeAntagonists","defaultSorting","newScoresProtagonistSorting","getTime","protagonistSorting","row","protIndex","protScore","enemies","take","uniqBy","distanceFromProtagonist","dist","enemy","getScoreSorting","field","direction","info","Infinity","getDiffSorting","chartInfo","sortingFunctions","compact","chartRange","items","rows","startsWith","filterCharts","showOnlyRank","occuredNames","alreadyOccured","rowNames","every","size","matchSorter","trim","ANIMATION_DURATION","sortingOptions","resetFilter","Leaderboard","showItemsCount","chartOverrides","curry","onRefresh","onTypeSongName","debounce","onRedoLatestResult","throttle","overrides","drop","onUndoLatestResult","undoedResult","maxBy","undoedPlayerId","previousPlayerResult","newResults","latestScore","overrideChart","renderSimpleSearch","renderFilters","closeMenuOnSelect","isMulti","renderSortings","isClearable","render","filteredData","canShowMore","visibleData","slice","highlightProtagonist","protagonistName","uniqueSelectedNames","preset","chartOriginal","chartIndex","first","topPlace","occuredNicknames","isSecondOccurenceInResults","singlep","doublep","coop","href","rel","isActive","currentIndex","canUndo","enterAnimation","leaveAnimation","typeName","maintainContainerHeight","nameIndex","placeDifference","newIndex","prevScore","findLastIndex","inf","empty","latest","fontWeight","vj","hj","content","tooltipClassName","numeral","exact","getGradeImg","RankingList","playerIndex","change","prevRating","down","up","RankingFaq","rankingSelector","Ranking","component","withRouter","limit","setLimit","latestDate","ExpFaq","setProfilesFilter","resetProfilesFilter","defaultGradesDistribution","defaultGradesWithLevelsDistribution","flatMap","profileSelectorCreator","idParamName","levelsDistribution","y","singlesLevels","doublesLevels","gradesData","update","gradesDistribution","groupBy","pick","gradesValues","gradesAndLevelsDistribution","groupedResults","counts","countBy","reduced","levelsData","MIN_GRAPH_HEIGHT","profileSelector","otherPlayersSelector","ind","Profile","isLevelGraphCombined","showFaq","onChangeDayRange","dayRange","onShowFaq","onHideFaq","componentWillUnmount","renderRankingHistory","minHeight","aspect","margin","strokeDasharray","dataKey","domain","tickFormatter","allowDecimals","stroke","isAnimationActive","payload","strokeWidth","dot","renderPlaceHistory","renderGrades","ticks","stackId","renderGradesWithLevels","stackOffset","doubleItems","singleItems","abs","dataMin","dataMax","offset","renderLevels","totalD","totalS","renderGradeBlock","obj","typeLetter","progr","minNumber","currentNumber","levelString","complete","zero","renderAchievement","achievement","Icon","renderProfile","otherPlayers","expProgress","history","ariaHideApp","isOpen","onRequestClose","ceil","MostPlayed","BARS_MODES","SINGLE_TWO","SINGLE_FIVE","DOUBLE_TWO","DOUBLE_FIVE","BOTH_TWO","BOTH_FIVE","getCompareBars","mode","profile1Selector","profile2Selector","getCombinedData","memoize","p1","p2","perLevelComparison","p1win","p1notPlayed","p2win","p2notPlayed","notPlayed","twoBars","p1index","p2index","perType","normalizeTwo","dataObj","totalPlayed","normalizeFive","total","chartLevels","ProfileCompare","compareBarsMode","rhMargin","rhXDomain","rhYDomain","rhXTickFormatter","rhTooltip","profile2","p1Name","p2Name","plcMargin","plcTooltip","isTwo","renderLegendItem","plcXDomain","plcXTicks","plcXFormatter","combinedData","ratingChanges","placesChanges","interval","reversed","renderPerLevelComparison","layout","profile1","fetchUser","login","googleResponse","token","tokenId","set","expires","loginACs","logout","isLoadingLogin","isLoadingUser","isClown","setClown","onGoogleResponse","clientId","onSuccess","onFailure","cookiePolicy","fetchingParams","fetchTracklist","preprocessData","fullRes","stepSum","n","track","mix","resultInfoOverrides","numb","hasRankScore","STATE_RESET_TIMEOUT","fetchTopPerSong","songName","leftLabel","rightLabel","queryString","song_name","join","appendNewResults","lastDate","start_date","appendedResults","currentResults","mergedData","renderChartLabel","topPerSong","songTopData","setMessage","socketErrorMessage","setSocketErrorMessage","isSocketReady","setSocketReady","isAlive","setAlive","setLeftLabel","setRightLabel","leftPlayer","setLeftPlayer","rightPlayer","setRightPlayer","recognizedSongName","setRecognizedSongName","socketRef","useRef","timeoutResetTokenRef","leftChart","rightChart","chartsToShow","topPlayersList","place","leftProfile","rightProfile","minBy","p","lev","leftData","setLeftData","rightData","setRightData","restartTimeout","useCallback","clearTimeout","setTimeout","prevRatingRaw","prevExp","WebSocket","onerror","onopen","onmessage","parse","newSongName","resultsContainerRef","leftResultRef","rightResultRef","totalSize","clientWidth","h","clientHeight","scaleHH","offsetWidth","scaleHW","offsetHeight","scaleWH","scaleWW","transform","scaleW","scaleH","renderPlayer","isLeft","renderDeltaText","prevN","delta","closestPlayers","takenWidth","emptyWidth","diffWidth","renderExpLine","pl","REACT_APP_SOCKET","SocketTracker","SongsTop","combineReducers","mostPlayed","action","mostPlayedMonth","leastPlayed","rootReducer","scoreInfo","hasPrevList","playerOriginal","trackStats","store","createStore","__REDUX_DEVTOOLS_EXTENSION__","applyMiddleware","thunk","getElementById"],"mappings":"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AU,SAAAD,GACRU,EAAS,CACP0C,SAAUpD,EAAM,uBACRoD,GADQ,CACEnO,EAASI,OACvBE,IAAEqO,QAAQ,CAAC3O,EAASI,MAAO+N,Y,wBClL1C,MAAMS,GAAQ,CACnB,CACEC,UAAW,EACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,QACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UAET,CACEF,UAAW,IACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,IACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,IACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,IACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,IACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,IACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,QAET,CACEF,UAAW,KACXC,SAAU,SACVC,MAAO,UCzIEC,GAA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","file":"static/js/main.5b17889c.chunk.js","sourcesContent":["\n\t\t\t\tvar addMethods = require(\"../../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"getProcessedProfiles\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"b48fbd52d70c8cf64eea.worker.js\", { name: \"[hash].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","/* eslint-disable */\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isNaN\r\nNumber.isNaN =\r\n  Number.isNaN ||\r\n  function(value) {\r\n    return value !== value;\r\n  };\r\n\r\nif (typeof Math.sign === 'undefined') {\r\n  Math.sign = function(x) {\r\n    return x > 0 ? 1 : x < 0 ? -1 : x;\r\n  };\r\n}\r\n\r\n// https://tc39.github.io/ecma262/#sec-array.prototype.findindex\r\nif (!Array.prototype.findIndex) {\r\n  Object.defineProperty(Array.prototype, 'findIndex', {\r\n    value: function(predicate) {\r\n      // 1. Let O be ? ToObject(this value).\r\n      if (this == null) {\r\n        throw new TypeError('\"this\" is null or not defined');\r\n      }\r\n\r\n      var o = Object(this);\r\n\r\n      // 2. Let len be ? ToLength(? Get(O, \"length\")).\r\n      var len = o.length >>> 0;\r\n\r\n      // 3. If IsCallable(predicate) is false, throw a TypeError exception.\r\n      if (typeof predicate !== 'function') {\r\n        throw new TypeError('predicate must be a function');\r\n      }\r\n\r\n      // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\r\n      var thisArg = arguments[1];\r\n\r\n      // 5. Let k be 0.\r\n      var k = 0;\r\n\r\n      // 6. Repeat, while k < len\r\n      while (k < len) {\r\n        // a. Let Pk be ! ToString(k).\r\n        // b. Let kValue be ? Get(O, Pk).\r\n        // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).\r\n        // d. If testResult is true, return k.\r\n        var kValue = o[k];\r\n        if (predicate.call(thisArg, kValue, k, o)) {\r\n          return k;\r\n        }\r\n        // e. Increase k by 1.\r\n        k++;\r\n      }\r\n\r\n      // 7. Return -1.\r\n      return -1;\r\n    },\r\n    configurable: true,\r\n    writable: true,\r\n  });\r\n}\r\n","export const routes = {\r\n  leaderboard: {\r\n    path: `/leaderboard`,\r\n  },\r\n  songs: {\r\n    path: `/songs`,\r\n  },\r\n  ranking: {\r\n    path: `/ranking`,\r\n    faq: {\r\n      path: '/ranking/faq',\r\n    },\r\n  },\r\n  profile: {\r\n    path: `/profiles/:id`,\r\n    getPath: params => `/profiles/${params.id}`,\r\n    compare: {\r\n      path: `/profiles/:id/vs/:compareToId`,\r\n      getPath: params => `/profiles/${params.id}/vs/${params.compareToId}`,\r\n    },\r\n  },\r\n};\r\n","import _ from 'lodash/fp';\r\n\r\nexport const SORT = {\r\n  DEFAULT: 'default',\r\n  PROTAGONIST: 'protagonist',\r\n  RANK_ASC: 'rankAsc',\r\n  RANK_DESC: 'rankDesc',\r\n  NEW_SCORES_PLAYER: 'newScoresPlayer',\r\n  EASIEST_SONGS: 'easiestSongs',\r\n  HARDEST_SONGS: 'hardestSongs',\r\n};\r\n\r\nexport const CHART_MIN_MAX = [1, 28];\r\nexport const DURATION = {\r\n  STD: 'Standard',\r\n  SHORT: 'Short',\r\n  REMIX: 'Remix',\r\n  FULL: 'Full',\r\n};\r\nexport const DURATION_DEFAULT = _.values(DURATION);\r\n","import React from 'react';\r\n\r\nimport './loader.scss';\r\n\r\nexport default function Loader() {\r\n  return (\r\n    <div className=\"loader\">\r\n      <svg\r\n        width=\"40\"\r\n        height=\"12\"\r\n        viewBox=\"0 0 120 30\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        fill=\"#eee\"\r\n      >\r\n        <circle cx=\"15\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"60\" cy=\"15\" r=\"9\" fillOpacity=\"0.3\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"9\"\r\n            to=\"9\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"9;15;9\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"0.5\"\r\n            to=\"0.5\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\".5;1;.5\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"105\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n      </svg>\r\n    </div>\r\n  );\r\n}\r\n","export const RESET = `USER/RESET`;\r\nexport const resetUser = () => ({ type: RESET });\r\n","import _ from 'lodash/fp';\r\nimport cookies from 'browser-cookies';\r\n\r\nimport { resetUser } from 'reducers/user/resetAction';\r\n\r\nexport const fetchJson = ({ url }) => request({ url, method: 'get' });\r\nexport const postJson = ({ url, body }) =>\r\n  request({\r\n    url,\r\n    method: 'post',\r\n    body: JSON.stringify(body),\r\n    headers: {\r\n      'Content-Type': 'application/json;charset=utf-8',\r\n    },\r\n  });\r\n\r\nconst defaultHeaders = {};\r\n\r\nexport const request = ({ url, method, body, headers }) => async (dispatch, getState) => {\r\n  try {\r\n    const session = cookies.get('session');\r\n    if (session) {\r\n      defaultHeaders['Session'] = session;\r\n    }\r\n    const response = await fetch(url, {\r\n      method,\r\n      body,\r\n      headers: { ...defaultHeaders, ...headers },\r\n      credentials: 'include',\r\n    });\r\n    if (response.status >= 200 && response.status < 300) {\r\n      const data = await response.json();\r\n      return data;\r\n    } else {\r\n      const error = await response.json();\r\n      if (_.isObject(error) && _.isString(error.error)) {\r\n        throw new Error(error.error);\r\n      } else if (_.isString(error)) {\r\n        throw new Error(error);\r\n      } else {\r\n        throw new Error('HTTP Status ' + response.status);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    if (error.message === 'Invalid session') {\r\n      dispatch(resetUser());\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n","// export const HOST = 'http://localhost:5000';\r\nexport const HOST = 'https://vps720616.ovh.net:5000';\r\nexport const SOCKET_SERVER_IP = 'ws://127.0.0.1:6789';\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `MOST_PLAYED/LOADING`;\r\nconst SUCCESS = `MOST_PLAYED/SUCCESS`;\r\nconst ERROR = `MOST_PLAYED/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchMostPlayed = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/track-stats/most-played` }));\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `MOST_PLAYED_MONTH/LOADING`;\r\nconst SUCCESS = `MOST_PLAYED_MONTH/SUCCESS`;\r\nconst ERROR = `MOST_PLAYED_MONTH/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchMostPlayedMonth = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/track-stats/most-played-month` }));\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `LEAST_PLAYED/LOADING`;\r\nconst SUCCESS = `LEAST_PLAYED/SUCCESS`;\r\nconst ERROR = `LEAST_PLAYED/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchLeastPlayed = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/track-stats/most-time-not-played` }));\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import React from 'react';\r\nimport TimeAgo from 'javascript-time-ago';\r\nimport ru from 'javascript-time-ago/locale/ru';\r\nimport { convenient } from 'javascript-time-ago/gradation';\r\nimport moment from 'moment';\r\n\r\nTimeAgo.addLocale(ru);\r\nconst timeAgo = new TimeAgo('ru-RU');\r\n\r\nconst timeStyle = {\r\n  flavour: 'long',\r\n  gradation: convenient,\r\n  units: ['day', 'week', 'month'],\r\n};\r\nexport const tooltipFormatter = result => {\r\n  if (!result.isExactDate) {\r\n    const resultType =\r\n      result.isMyBest === undefined && result.isMachineBest === undefined\r\n        ? 'с my best или machine best'\r\n        : result.isMyBest\r\n        ? 'с my best'\r\n        : result.isMachineBest\r\n        ? 'с machine best'\r\n        : 'хз откуда';\r\n    return (\r\n      <div style={{ display: 'flex', alignItems: 'center', flexDirection: 'column' }}>\r\n        <div>точная дата взятия неизвестна</div>\r\n        <div>скор был записан {resultType}</div>\r\n        <div>дата записи: {result.dateObject.toLocaleDateString()}</div>\r\n      </div>\r\n    );\r\n  } else {\r\n    return result.dateObject.toLocaleDateString();\r\n  }\r\n};\r\n\r\nexport const getTimeAgo = date => {\r\n  const dayDiff = moment()\r\n    .startOf('day')\r\n    .diff(moment(date).startOf('day'), 'days');\r\n  const hour = moment(date).hour();\r\n  if (moment().hour() < 5) {\r\n    return dayDiff <= 1 ? 'сегодня' : timeAgo.format(date, timeStyle);\r\n  }\r\n  return dayDiff === 0\r\n    ? hour < 5\r\n      ? 'вчера ночью'\r\n      : 'сегодня'\r\n    : dayDiff === 1\r\n    ? 'вчера'\r\n    : timeAgo.format(date, timeStyle);\r\n};\r\n","import moment from 'moment';\r\n\r\nexport const parseDate = textDate => {\r\n  if (typeof textDate === 'string') {\r\n    return moment(textDate, 'YYYY-MM-DD HH:mm:ss').toDate();\r\n  } else {\r\n    return new Date(textDate);\r\n  }\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { FaPlay } from 'react-icons/fa';\r\nimport classNames from 'classnames';\r\n\r\n// styles\r\nimport './songs-top.scss';\r\n\r\n// components\r\nimport Loader from 'components/Shared/Loader';\r\n\r\n// constants\r\n\r\n// reducers\r\nimport { fetchMostPlayed } from 'reducers/trackStats/mostPlayed';\r\nimport { fetchMostPlayedMonth } from 'reducers/trackStats/mostPlayedMonth';\r\nimport { fetchLeastPlayed } from 'reducers/trackStats/leastPlayed';\r\n\r\n// utils\r\nimport { getTimeAgo } from 'utils/leaderboards';\r\nimport { parseDate } from 'utils/date';\r\n\r\n// code\r\nfunction TopList({ fetchList, title, renderRightSide }) {\r\n  const [data, setData] = useState([]);\r\n  const [isLoading, setLoading] = useState(false);\r\n\r\n  const getRightSide =\r\n    renderRightSide ||\r\n    (item => (\r\n      <div className=\"playcount\">\r\n        <FaPlay />\r\n        <span>{item.countplay}</span>\r\n      </div>\r\n    ));\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    fetchList()\r\n      .then(data => {\r\n        data.success && setData(data.data);\r\n        setLoading(false);\r\n      })\r\n      .catch(() => {\r\n        setLoading(false);\r\n      });\r\n  }, [fetchList]);\r\n\r\n  return (\r\n    <div className=\"top-songs-list\">\r\n      <div className=\"top-songs-header\">\r\n        <span>{title}</span>\r\n      </div>\r\n      {isLoading && <Loader />}\r\n      {!isLoading &&\r\n        data.map((item, index) => {\r\n          return (\r\n            <div key={item.id} className=\"top-songs-item\">\r\n              <div className={classNames('place', `top-${index + 1}`, { best: index < 3 })}>\r\n                <span>{index + 1}.</span>\r\n              </div>\r\n              <div className=\"song-name\">{item.full_name}</div>\r\n              {getRightSide(item)}\r\n            </div>\r\n          );\r\n        })}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst leastPlayedRightSide = item => (\r\n  <div className=\"date\">\r\n    <span>{item.last_play ? getTimeAgo(parseDate(item.last_play)) : 'никогда'}</span>\r\n  </div>\r\n);\r\n\r\nexport default connect(\r\n  null,\r\n  {\r\n    fetchMostPlayed,\r\n    fetchMostPlayedMonth,\r\n    fetchLeastPlayed,\r\n  }\r\n)(function SongsTop({ fetchMostPlayed, fetchMostPlayedMonth, fetchLeastPlayed }) {\r\n  return (\r\n    <div className=\"songs-top-page\">\r\n      <TopList fetchList={fetchMostPlayed} title=\"топ популярных треков\" />\r\n      <TopList fetchList={fetchMostPlayedMonth} title=\"топ популярных треков за месяц\" />\r\n      <TopList\r\n        fetchList={fetchLeastPlayed}\r\n        title=\"треки, которые долго не играли\"\r\n        renderRightSide={leastPlayedRightSide}\r\n      />\r\n      <div className=\"top-songs-list -placeholder\" />\r\n    </div>\r\n  );\r\n});\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport toBe from 'prop-types';\r\nimport { Popper } from 'react-popper';\r\nimport classNames from 'classnames';\r\nimport listensToClickOutside from 'react-onclickoutside';\r\n\r\nimport './overlay.scss';\r\n\r\nconst POPPER_MODIFIERS = {\r\n  preventOverflow: {\r\n    enabled: true,\r\n    padding: 10,\r\n    boundariesElement: 'viewport',\r\n  },\r\n};\r\n\r\nconst PLACEMENT_ARROW_MAPPING = {\r\n  right: 'left',\r\n  left: 'right',\r\n  top: 'bottom',\r\n  bottom: 'top',\r\n};\r\n\r\nconst getArrowPlacement = placement => {\r\n  return placement && PLACEMENT_ARROW_MAPPING[placement.split('-')[0]];\r\n};\r\n\r\nclass Overlay extends React.PureComponent {\r\n  static propTypes = {\r\n    placement: toBe.string,\r\n    overlayItem: toBe.any,\r\n    hideWhenOutOfBounds: toBe.bool,\r\n  };\r\n\r\n  static defaultTypes = {\r\n    placement: 'bottom',\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      isVisible: false,\r\n    };\r\n    this.containerItemRef = React.createRef();\r\n    this.renderPopper = this.renderPopper.bind(this);\r\n    this.toggleOverlayVisibility = this.toggleOverlayVisibility.bind(this);\r\n  }\r\n\r\n  hideOverlay() {\r\n    this.setState({\r\n      isVisible: false,\r\n    });\r\n  }\r\n\r\n  toggleOverlayVisibility() {\r\n    this.setState({\r\n      isVisible: !this.state.isVisible,\r\n    });\r\n  }\r\n\r\n  handleClickOutside(event) {\r\n    const preventHiding = event && event.target.closest('.inner-popper-overlay'); // prevent overlays from hiding when a modal is opened within overlay\r\n\r\n    if (!preventHiding) {\r\n      this.hideOverlay();\r\n    }\r\n  }\r\n\r\n  renderPopper({ ref, style, placement, arrowProps, scheduleUpdate, outOfBoundaries }) {\r\n    const { children, hideWhenOutOfBounds } = this.props;\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        style={style}\r\n        data-placement={placement}\r\n        className={classNames(\r\n          'inner-popper-overlay',\r\n          `arrow-${getArrowPlacement(placement)}`,\r\n          this.props.overlayClassName,\r\n          { 'out-of-bounds': outOfBoundaries && hideWhenOutOfBounds }\r\n        )}\r\n      >\r\n        <div className=\"arrow-hider\">\r\n          <div className=\"arrow\" ref={arrowProps.ref} style={arrowProps.style} />\r\n        </div>\r\n        <div\r\n          className=\"inner-popper-content\"\r\n          // ref={ref => this.setupPopperContentRef(scheduleUpdate, ref)}\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { placement, overlayItem } = this.props;\r\n    const { isVisible } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <div\r\n          className=\"overlay-item\"\r\n          ref={this.containerItemRef}\r\n          onClick={this.toggleOverlayVisibility}\r\n        >\r\n          {overlayItem}\r\n        </div>\r\n        {isVisible &&\r\n          ReactDOM.createPortal(\r\n            <Popper\r\n              container={document.body}\r\n              modifiers={POPPER_MODIFIERS}\r\n              placement={placement}\r\n              referenceElement={this.containerItemRef.current}\r\n            >\r\n              {this.renderPopper}\r\n            </Popper>,\r\n            document.body\r\n          )}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default listensToClickOutside(Overlay);\r\n","import React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nimport './toggle-button.scss';\r\n\r\nexport default class ToggleButton extends React.PureComponent {\r\n  static propTypes = {\r\n    text: toBe.string,\r\n    onToggle: toBe.func,\r\n    active: toBe.bool,\r\n  };\r\n\r\n  render() {\r\n    const { active, onToggle, text } = this.props;\r\n    return (\r\n      <div\r\n        className={classNames('toggle-button', { active: active })}\r\n        onClick={() => onToggle(!active)}\r\n      >\r\n        {text}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/* eslint-disable react/no-deprecated */\r\n// imports from vendor deps\r\nimport React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash/fp';\r\n\r\n// imports from styles\r\nexport default class Input extends React.Component {\r\n  static propTypes = {\r\n    value: toBe.any,\r\n    defaultValue: toBe.any,\r\n    onChange: toBe.func,\r\n    onBlur: toBe.func,\r\n    type: toBe.string,\r\n    className: toBe.string,\r\n    trimOnBlur: toBe.bool,\r\n  };\r\n\r\n  static defaultProps = {\r\n    value: null,\r\n    type: 'text',\r\n    onChange: _.noop,\r\n    onBlur: _.noop,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      value: (!_.isNil(props.value) ? props.value : props.defaultValue) || '',\r\n    };\r\n    _.bindAll(['handleChange', 'handleBlur', 'handleKeyPress'], this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.value !== this.props.value) {\r\n      this.setState({ value: this.props.value });\r\n    }\r\n  }\r\n\r\n  handleChange(e) {\r\n    const newValue = e.target.value;\r\n    this.setState({ value: newValue }, () => this.props.onChange(newValue));\r\n  }\r\n\r\n  handleBlur(e) {\r\n    const { type } = this.props;\r\n    const { value } = this.state;\r\n    if (type === 'number') {\r\n      const numericValue = Number(value);\r\n      if (numericValue >= Number(e.target.min) && numericValue <= Number(e.target.max)) {\r\n        this.props.onBlur(numericValue, e);\r\n      } else {\r\n        this.setState({ value: this.props.value });\r\n        this.props.onBlur(this.props.value, e);\r\n      }\r\n    }\r\n  }\r\n\r\n  handleKeyPress(e) {\r\n    if (e.key === 'Enter') {\r\n      this.handleBlur(e);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { className } = this.props;\r\n\r\n    // HACK: This component uses onInput instead of onChange\r\n    // because IE11 fails to call onChange events when you paste/cut using context menu (RMB)\r\n    // We're using onInput because it works fine, and because for text input\r\n    // there's no difference between how onChange and onInput work\r\n    return (\r\n      <input\r\n        {..._.omit(['defaultValue', 'onChange'], this.props)}\r\n        className={classNames(className, 'text-input')}\r\n        value={this.state.value}\r\n        onBlur={this.handleBlur}\r\n        onKeyPress={this.handleKeyPress}\r\n        onInput={this.handleChange}\r\n        onChange={_.noop} // Handled by onInput\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\n\r\nimport './toggle.scss';\r\n\r\n// imports from styles\r\nexport default class Toggle extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.id = _.uniqueId();\r\n  }\r\n\r\n  onChange = e => {\r\n    this.props.onChange(e.target.checked);\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"toggle-checkbox\">\r\n        <input\r\n          type=\"checkbox\"\r\n          className=\"toggle-checkbox-cb\"\r\n          id={this.id}\r\n          onChange={this.onChange}\r\n          checked={this.props.checked}\r\n        />\r\n        <label htmlFor={this.id} className=\"toggle\">\r\n          <span></span>\r\n        </label>\r\n        <label htmlFor={this.id} className=\"text-label\">\r\n          {this.props.children}\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { FaChevronRight } from 'react-icons/fa';\r\nimport classNames from 'classnames';\r\n\r\nimport './styles.scss';\r\n\r\nexport default class CollapsibleBar extends PureComponent {\r\n  static propTypes = {\r\n    className: toBe.string,\r\n    children: toBe.any,\r\n    title: toBe.any,\r\n    defaultOpen: toBe.bool,\r\n  };\r\n\r\n  constructor(props) {\r\n    super();\r\n    this.state = { open: props.defaultOpen || false };\r\n  }\r\n\r\n  render() {\r\n    const { children, title, className } = this.props;\r\n    const { open } = this.state;\r\n\r\n    return (\r\n      <div className={classNames('collapsible-bar', className, { open })}>\r\n        <div className=\"header\" onClick={() => this.setState(state => ({ open: !state.open }))}>\r\n          <div className=\"collapse-button\">\r\n            <FaChevronRight />\r\n          </div>\r\n          <div className=\"title\">{title}</div>\r\n        </div>\r\n        {children && <div className=\"collapsible-children\">{children}</div>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { Range as ReactRange, getTrackBackground } from 'react-range';\r\n\r\nexport default function Range({ range, min, max, onChange }) {\r\n  return (\r\n    <ReactRange\r\n      values={range}\r\n      step={1}\r\n      min={min}\r\n      max={max}\r\n      onChange={onChange}\r\n      renderTrack={({ props, children }) => (\r\n        <div\r\n          onMouseDown={props.onMouseDown}\r\n          onTouchStart={props.onTouchStart}\r\n          style={{\r\n            ...props.style,\r\n            position: 'relative',\r\n            height: '10px',\r\n            display: 'flex',\r\n            width: '100%',\r\n          }}\r\n        >\r\n          <div\r\n            ref={props.ref}\r\n            style={{\r\n              height: '6px',\r\n              width: '100%',\r\n              borderRadius: '3px',\r\n              background: getTrackBackground({\r\n                values: range,\r\n                colors: ['#ccc', '#88d3ff', '#ccc'],\r\n                min,\r\n                max,\r\n              }),\r\n              alignSelf: 'center',\r\n            }}\r\n          >\r\n            {children}\r\n          </div>\r\n        </div>\r\n      )}\r\n      renderThumb={({ props, isDragged }) => (\r\n        <div\r\n          {...props}\r\n          style={{\r\n            ...props.style,\r\n            height: '12px',\r\n            width: '12px',\r\n            borderRadius: '6px',\r\n            backgroundColor: '#FFF',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            boxShadow: '0px 2px 3px #AAA',\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              height: '6px',\r\n              width: '6px',\r\n              borderRadius: '3px',\r\n              backgroundColor: isDragged ? '#88d3ff' : '#CCC',\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n    />\r\n  );\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\nimport { FaCaretLeft, FaCaretRight } from 'react-icons/fa';\r\n\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Input from 'components/Shared/Input/Input';\r\nimport Range from 'components/Shared/Range';\r\n\r\nimport { CHART_MIN_MAX, DURATION_DEFAULT, DURATION } from 'constants/leaderboard';\r\n\r\nexport default function ChartFilter({ filterValue, onChange: onChangeEx }) {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filterValue);\r\n  const type = _.getOr(null, 'type', filterValue);\r\n  const duration = _.getOr(DURATION_DEFAULT, 'duration', filterValue);\r\n\r\n  let buttonText = 'фильтр чартов';\r\n  if (filterValue) {\r\n    const t = type || '';\r\n    buttonText = range[0] === range[1] ? `${t}${range[0]}` : `${t}${range[0]} - ${t}${range[1]}`;\r\n    buttonText = 'чарты: ' + buttonText;\r\n    if (!_.isEqual(duration, DURATION_DEFAULT)) {\r\n      buttonText += ' ***';\r\n      // buttonText += ` (${_.values(DURATION)\r\n      //   .filter(dur => duration.includes(dur))\r\n      //   .map(s => s.slice(0, 2))\r\n      //   .join('-')})`;\r\n    }\r\n  }\r\n\r\n  const onChange = value => {\r\n    onChangeEx({\r\n      range,\r\n      type,\r\n      ...value,\r\n      duration: _.isEmpty(value.duration) ? duration : value.duration,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Overlay\r\n        overlayClassName=\"chart-range-overlay-outer\"\r\n        overlayItem={\r\n          <button className=\"filter-charts-button btn btn-sm btn-dark\">{buttonText}</button>\r\n        }\r\n      >\r\n        <div className=\"chart-range-overlay\">\r\n          <div className=\"buttons\">\r\n            <ToggleButton\r\n              text=\"Single\"\r\n              active={type === 'S'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  type: active ? 'S' : null,\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Double\"\r\n              active={type === 'D'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  type: active ? 'D' : null,\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n          <Range\r\n            range={range}\r\n            min={CHART_MIN_MAX[0]}\r\n            max={CHART_MIN_MAX[1]}\r\n            onChange={r => onChange({ range: r })}\r\n          />\r\n          <div className=\"inputs\">\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  range: [Math.max(range[0] - 1, CHART_MIN_MAX[0]), range[1]],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={CHART_MIN_MAX[0]}\r\n              max={Math.min(CHART_MIN_MAX[1], range[1])}\r\n              value={range[0]}\r\n              onBlur={value => {\r\n                onChange({ range: [value, range[1]] });\r\n              }}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMin = Math.min(range[0] + 1, CHART_MIN_MAX[1]);\r\n                onChange({\r\n                  range: [newMin, range[1] < newMin ? newMin : range[1]],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n            <div className=\"_flex-fill\" />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMax = Math.max(range[1] - 1, CHART_MIN_MAX[0]);\r\n                onChange({\r\n                  range: [range[0] > newMax ? newMax : range[0], newMax],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={Math.max(CHART_MIN_MAX[0], range[0])}\r\n              max={CHART_MIN_MAX[1]}\r\n              value={range[1]}\r\n              onBlur={value => onChange({ range: [range[0], value] })}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  range: [range[0], Math.min(range[1] + 1, CHART_MIN_MAX[1])],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n          </div>\r\n          <div className=\"buttons-duration\">\r\n            <ToggleButton\r\n              text=\"Standard\"\r\n              active={duration.includes(DURATION.STD)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.STD]\r\n                    : _.without([DURATION.STD], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Short\"\r\n              active={duration.includes(DURATION.SHORT)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.SHORT]\r\n                    : _.without([DURATION.SHORT], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Remix\"\r\n              active={duration.includes(DURATION.REMIX)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.REMIX]\r\n                    : _.without([DURATION.REMIX], duration),\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"Full\"\r\n              active={duration.includes(DURATION.FULL)}\r\n              onToggle={active => {\r\n                onChange({\r\n                  duration: active\r\n                    ? [...duration, DURATION.FULL]\r\n                    : _.without([DURATION.FULL], duration),\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Overlay>\r\n    </div>\r\n  );\r\n}\r\n","export const ranks = [\r\n  {\r\n    threshold: 0,\r\n    iconName: '0.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 1000,\r\n    iconName: '1.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 2000,\r\n    iconName: '2.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 3000,\r\n    iconName: '3.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 4000,\r\n    iconName: '4.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 5000,\r\n    iconName: '5.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 6250,\r\n    iconName: '6.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 7500,\r\n    iconName: '7.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 8750,\r\n    iconName: '8.png',\r\n    color: 'bronze',\r\n  },\r\n  {\r\n    threshold: 10000,\r\n    iconName: '9.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 12000,\r\n    iconName: '10.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 14000,\r\n    iconName: '11.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 16000,\r\n    iconName: '12.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 18000,\r\n    iconName: '13.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 22000,\r\n    iconName: '14.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 26000,\r\n    iconName: '15.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 30000,\r\n    iconName: '16.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 35000,\r\n    iconName: '17.png',\r\n    color: 'silver',\r\n  },\r\n  {\r\n    threshold: 40000,\r\n    iconName: '18.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 50000,\r\n    iconName: '19.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 60000,\r\n    iconName: '20.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 70000,\r\n    iconName: '21.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 80000,\r\n    iconName: '22.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 100000,\r\n    iconName: '23.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 120000,\r\n    iconName: '24.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 140000,\r\n    iconName: '25.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 160000,\r\n    iconName: '26.png',\r\n    color: 'gold',\r\n  },\r\n  {\r\n    threshold: 180000,\r\n    iconName: '27.png',\r\n    color: 'green',\r\n  },\r\n];\r\n","import React from 'react';\r\n\r\nexport const gradeValue = {\r\n  F: 0.1,\r\n  D: 0.2,\r\n  'D+': 0.3,\r\n  C: 0.3,\r\n  'C+': 0.5,\r\n  B: 0.5,\r\n  'B+': 0.8,\r\n  A: 0.8,\r\n  'A+': 1,\r\n  S: 1.1,\r\n  SS: 1.2,\r\n  SSS: 1.2,\r\n};\r\n\r\nexport const getExp = (result, chart) => {\r\n  if (!result.isBestGradeOnChart) {\r\n    return 0;\r\n  }\r\n  if (chart.chartType === 'COOP') {\r\n    return (chart.chartLevel * 1000 * (gradeValue[result.grade] || 0.8)) / 8;\r\n  }\r\n  const exp = (chart.chartLevel ** 2.31 * (gradeValue[result.grade] || 0.8)) / 9;\r\n  return exp;\r\n};\r\n\r\nexport const getRankImg = rank =>\r\n  rank && (\r\n    <img\r\n      className={rank.color}\r\n      src={`${process.env.PUBLIC_URL}/ranks/${rank.iconName}`}\r\n      alt={rank.threshold}\r\n    />\r\n  );\r\n\r\nexport { ranks } from './expRanks';\r\n","import _ from 'lodash/fp';\r\n\r\nimport {\r\n  GiLoveSong,\r\n  GiLifeBar,\r\n  GiSmokingFinger,\r\n  GiSnail,\r\n  GiRetroController,\r\n  GiRank1,\r\n  GiRank2,\r\n  GiRank3,\r\n  GiWoodenPegleg,\r\n  GiPodiumSecond,\r\n} from 'react-icons/gi';\r\n\r\nexport const achievements = {\r\n  '500 комбо': {\r\n    icon: GiRank1,\r\n    description: 'Заработать 500+ комбо на любом чарте',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.combo >= 500 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  '1000 комбо': {\r\n    icon: GiRank2,\r\n    description: 'Заработать 1000+ комбо на любом чарте',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.combo >= 1000 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  '2000 комбо': {\r\n    icon: GiRank3,\r\n    description: 'Заработать 2000+ комбо на любом чарте',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.combo >= 2000 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  'Мастер фингеринга': {\r\n    icon: GiSmokingFinger,\r\n    description: 'Сыграть все Fingers треки',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: ['Monkey Fingers', 'Kimchi Fingers', 'Monkey Fingers 2', 'Money Fingers'],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.includes(chart.song)\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  '8-bit': {\r\n    icon: GiRetroController,\r\n    description: 'Сыграть Seize My Day, Tales of Pumpnia и Pumptris (8bit ver.)',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: ['Seize My Day', 'Tales of Pumpnia', 'Pumptris (8bit ver.)'],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.includes(chart.song)\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  'Love is...': {\r\n    icon: GiLoveSong,\r\n    description: 'Сыграть все Love is a Danger Zone треки',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: [\r\n        'Love is a Danger Zone',\r\n        'Love is a Danger Zone [SHORT]',\r\n        'Love is a Danger Zone (Cranky Mix)',\r\n        'Love is a Danger Zone 2',\r\n        'Love is a Danger Zone 2 [SHORT]',\r\n        'Love is a Danger Zone 2 [FULL]',\r\n        'Love is a Danger Zone 2 (D&G Ver.)',\r\n        'Love is a Danger Zone (try to B.P.M.)',\r\n      ],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.includes(chart.song)\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  Улитка: {\r\n    icon: GiSnail,\r\n    description:\r\n      'Мастер замедлений: сыграть старшие чарты Twist of Fate, Karyawisata, Awakening и Moonlight',\r\n    initialState: {\r\n      progress: 0,\r\n      playedSongs: [],\r\n      songsToPlay: [\r\n        { song: 'Twist of Fate (feat. Ruriling)', charts: ['D20', 'S19'] },\r\n        { song: 'Karyawisata', charts: ['S20', 'D16'] },\r\n        { song: 'Awakening', charts: ['S19', 'D20'] },\r\n        { song: 'Moonlight', charts: ['S19', 'D21'] },\r\n      ],\r\n    },\r\n    resultFunction: (result, chart, state) => {\r\n      const playedSongs = state.songsToPlay.some(\r\n        songToPlay => chart.song === songToPlay.song && songToPlay.charts.includes(chart.chartLabel)\r\n      )\r\n        ? _.uniq([...state.playedSongs, chart.song])\r\n        : state.playedSongs;\r\n      return {\r\n        playedSongs,\r\n        songsToPlay: state.songsToPlay,\r\n        progress: (100 * playedSongs.length) / state.songsToPlay.length,\r\n      };\r\n    },\r\n  },\r\n  'Коричневая S': {\r\n    icon: GiPodiumSecond,\r\n    description: 'Получить S, но 5+ бэдов',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress: state.progress === 100 ? 100 : result.miss === 0 && result.bad >= 5 ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  'Мы выживали как могли': {\r\n    icon: GiLifeBar,\r\n    description: 'Получить B или ниже, но удержать лайфбар',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress:\r\n          state.progress === 100 ? 100 : ['B+', 'C+', 'D+'].includes(result.grade) ? 100 : 0,\r\n      };\r\n    },\r\n  },\r\n  'Падовый мисс': {\r\n    icon: GiWoodenPegleg,\r\n    description: 'Когда от SSS тебя удерживают только миссы из-за плохого моддинга падов',\r\n    resultFunction: (result, chart, state) => {\r\n      return {\r\n        progress:\r\n          state.progress === 100\r\n            ? 100\r\n            : result.miss > 0 && result.bad === 0 && result.good === 0 && result.great === 0\r\n            ? 100\r\n            : 0,\r\n      };\r\n    },\r\n  },\r\n};\r\n\r\nexport const initialAchievementState = {\r\n  progress: 0,\r\n};\r\n","export const getScoreWithoutBonus = (score, grade) => {\r\n  if (grade === 'SSS') return score - 300000;\r\n  if (grade === 'SS') return score - 150000;\r\n  if (grade === 'S') return score - 100000;\r\n  return score;\r\n};\r\n","import _ from 'lodash/fp';\r\nimport regression from 'regression';\r\nimport interpolate from 'interpolating-polynomial';\r\n\r\nimport { ranks as expRanks } from 'utils/expRanks';\r\n\r\nconst postProcessProfiles = (profiles, tracklist) => {\r\n  const getBonusForLevel = level => (30 * (1 + 2 ** (level / 4))) / 11;\r\n  const getMinimumNumber = totalCharts =>\r\n    Math.round(\r\n      Math.min(totalCharts, 1 + totalCharts / 20 + Math.sqrt(Math.max(totalCharts - 1, 0)) * 0.7)\r\n    );\r\n\r\n  const newProfiles = _.mapValues(profile => {\r\n    const neededGrades = ['A', 'A+', 'S', 'SS', 'SSS'];\r\n    profile.expRank = _.findLast(rank => rank.threshold <= profile.exp, expRanks);\r\n    profile.expRankNext = _.find(rank => rank.threshold > profile.exp, expRanks);\r\n    profile.progress = {\r\n      double: {\r\n        SS: {},\r\n        S: {},\r\n        'A+': {},\r\n        A: {},\r\n      },\r\n      single: {\r\n        SS: {},\r\n        S: {},\r\n        'A+': {},\r\n        A: {},\r\n      },\r\n    };\r\n    const gradeIncrementMap = {\r\n      SSS: ['SS', 'S', 'A+', 'A'],\r\n      SS: ['SS', 'S', 'A+', 'A'],\r\n      S: ['S', 'A+', 'A'],\r\n      'A+': ['A+', 'A'],\r\n      A: ['A'],\r\n    };\r\n    const incrementLevel = (l, g, chartType) => {\r\n      const prog =\r\n        chartType === 'S' || chartType === 'SP'\r\n          ? profile.progress.single\r\n          : chartType === 'D' || chartType === 'DP'\r\n          ? profile.progress.double\r\n          : null;\r\n      if (prog) {\r\n        prog[g][l] = prog[g][l] ? prog[g][l] + 1 : 1;\r\n      }\r\n    };\r\n    profile.accuracyByLevel = {};\r\n    _.keys(profile.resultsByLevel).forEach(level => {\r\n      profile.accuracyByLevel[level] = { count: 0, sum: 0, average: null };\r\n      profile.resultsByLevel[level].forEach(res => {\r\n        if (!res.result.isRank && res.result.accuracy) {\r\n          profile.accuracyByLevel[level].count++;\r\n          profile.accuracyByLevel[level].sum += res.result.accuracy;\r\n        }\r\n\r\n        const thisGrade = res.result.grade;\r\n        const thisPlayerId = res.result.playerId;\r\n        const otherResults = res.chart.results.filter(r => r.playerId === thisPlayerId);\r\n        if (otherResults.length > 1) {\r\n          const sortedResults = otherResults.sort(\r\n            (a, b) => neededGrades.indexOf(b.grade) - neededGrades.indexOf(a.grade)\r\n          );\r\n          if (sortedResults[0].grade !== thisGrade) {\r\n            return; // Don't do anything when we have a different result with better grade\r\n          }\r\n        }\r\n        const gradeIncArray = gradeIncrementMap[thisGrade];\r\n        if (gradeIncArray) {\r\n          gradeIncArray.forEach(gradeInc => {\r\n            incrementLevel(level, gradeInc, res.chart.chartType);\r\n          });\r\n        }\r\n      });\r\n      profile.accuracyByLevel[level].average =\r\n        profile.accuracyByLevel[level].count === 0\r\n          ? null\r\n          : profile.accuracyByLevel[level].sum / profile.accuracyByLevel[level].count;\r\n    });\r\n    const points = _.flow(\r\n      _.toPairs,\r\n      _.filter(([level, data]) => data.average && data.count > 10),\r\n      _.map(([level, data]) => [_.toNumber(level), data.average])\r\n    )(profile.accuracyByLevel);\r\n    profile.accuracyPoints = points;\r\n    ['single', 'double'].forEach(chartType => {\r\n      profile.progress[`${chartType}-bonus`] = 0;\r\n      _.keys(profile.progress[chartType]).forEach(grade => {\r\n        profile.progress[chartType][`${grade}-bonus`] = 0;\r\n        _.keys(profile.progress[chartType][grade]).forEach(level => {\r\n          const number = profile.progress[chartType][grade][level];\r\n          const totalCharts = tracklist.data[`${chartType}sLevels`][level];\r\n          const minimumNumber = getMinimumNumber(totalCharts);\r\n          const bonusCoefficientNumber = Math.min(1, number / minimumNumber);\r\n          const rawBonus = getBonusForLevel(level);\r\n          const bonus = rawBonus * bonusCoefficientNumber;\r\n          profile.progress[chartType][grade][`${level}-bonus`] = bonus;\r\n          profile.progress[chartType][grade][`${level}-bonus-coef`] = bonusCoefficientNumber;\r\n          profile.progress[chartType][grade][`${level}-min-number`] = minimumNumber;\r\n          profile.progress[chartType][grade][`${level}-achieved-number`] = number;\r\n          if (bonus >= profile.progress[chartType][`${grade}-bonus`]) {\r\n            profile.progress[chartType][`${grade}-bonus`] = bonus;\r\n            profile.progress[chartType][`${grade}-bonus-level`] = level;\r\n            profile.progress[chartType][`${grade}-bonus-level-coef`] = bonusCoefficientNumber;\r\n            profile.progress[chartType][`${grade}-bonus-level-min-number`] = minimumNumber;\r\n            profile.progress[chartType][`${grade}-bonus-level-achieved-number`] = number;\r\n          }\r\n        });\r\n        profile.progress[`${chartType}-bonus`] += profile.progress[chartType][`${grade}-bonus`];\r\n      });\r\n    });\r\n    profile.progress.bonus = profile.progress['double-bonus'] + profile.progress['single-bonus'];\r\n    profile.achievementBonus = profile.progress.bonus;\r\n    profile.accuracy =\r\n      profile.countAcc > 0\r\n        ? Math.round((profile.sumAccuracy / profile.countAcc) * 100) / 100\r\n        : null;\r\n    return profile;\r\n  }, profiles);\r\n  return newProfiles;\r\n};\r\n\r\nconst processPP = ({ profiles, sharedCharts }) => {\r\n  const resultInfo = {};\r\n  for (const chartId in sharedCharts) {\r\n    const chart = sharedCharts[chartId];\r\n    const chartResults = chart.results;\r\n    const chartLevel = Number(chart.interpolatedDifficulty || chart.chartLevel);\r\n    const maxPP = chartLevel ** 2.2 / 8; // divide by 4 for normalization, to align with previous elo versrion\r\n    if (chart.maxNonRankScore) {\r\n      const maxScore = chart.maxNonRankScore;\r\n      for (const result of chartResults) {\r\n        if (!result.isRank && result.accuracyRaw && result.grade && maxScore) {\r\n          let K2 = {\r\n            SSS: 1,\r\n            SS: 0.97,\r\n            S: 0.95,\r\n            'A+': 0.9,\r\n            A: 0.84,\r\n            B: 0.77,\r\n            C: 0.63,\r\n            D: 0.4,\r\n            F: 0,\r\n          }[result.grade];\r\n          K2 = K2 === undefined ? 0.4 : K2;\r\n          const K3 = Math.max(0, Math.min(1, result.scoreRaw / maxScore - 0.3) / 0.7);\r\n          const K = K2 * K3;\r\n\r\n          // Final PP value\r\n          const pp = K * maxPP;\r\n          // Record result data\r\n          resultInfo[result.id] = {\r\n            pp: {\r\n              pp,\r\n              k: K,\r\n              kX: { K2, K3 },\r\n              maxScore,\r\n              maxPP,\r\n              ppPotential: maxPP - pp,\r\n              ppRatio: pp / maxPP,\r\n              ppFixed: Number(pp.toFixed(1)),\r\n            },\r\n          };\r\n          const profile = profiles[result.playerId];\r\n          if (profile) {\r\n            if (!profile.pp) {\r\n              profile.pp = { scores: [], pp: 0 };\r\n            }\r\n            profile.pp.scores.push({\r\n              pp_: Number(pp.toFixed(1)),\r\n              s: chart.song,\r\n              l: chart.chartLabel,\r\n              pp,\r\n              result,\r\n              chart,\r\n              k: { K2, K3, K },\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // Calculate total pp\r\n  for (const playerId in profiles) {\r\n    const profile = profiles[playerId];\r\n    if (profile.pp) {\r\n      profile.pp.scores.sort((a, b) => b.pp - a.pp);\r\n      profile.pp.pp = 0;\r\n      profile.pp.scores.forEach((score, index) => {\r\n        profile.pp.pp += 0.96 ** index * score.pp;\r\n      });\r\n      profile.ratingRaw = profile.pp.pp;\r\n    } else {\r\n      profile.ratingRaw = 0;\r\n    }\r\n    profile.id = _.toInteger(playerId);\r\n    profile.accuracy =\r\n      profile.countAcc > 0\r\n        ? Math.round((profile.sumAccuracy / profile.countAcc) * 100) / 100\r\n        : null;\r\n    profile.rating = Math.round(profile.ratingRaw);\r\n  }\r\n  return { resultInfo, profiles };\r\n};\r\n\r\nconst interpolateDifficulties = (sharedCharts, processedProfiles) => {\r\n  let newSharedCharts = _.mapValues(chart => {\r\n    const datas = chart.results\r\n      .map(r => {\r\n        const profile = processedProfiles[r.playerId];\r\n        if (!profile || !r.accuracy || r.isRank || _.isEmpty(profile.accuracyPoints)) {\r\n          return null;\r\n        }\r\n        const accData = profile.accuracyByLevel[chart.chartLevel];\r\n        if (!profile.accuracyPointsInterpolated) {\r\n          let points = [...profile.accuracyPoints, [30, 0]];\r\n          for (let i = profile.accuracyPoints[0][0]; i > 0; i--) {\r\n            points = [[i, 100], ...points];\r\n          }\r\n          const result = regression('polynomial', points, 3);\r\n          // console.log(result);\r\n          const predict = x => {\r\n            return (\r\n              result.equation[0] +\r\n              result.equation[1] * x +\r\n              result.equation[2] * x * x +\r\n              result.equation[3] * x * x * x\r\n            );\r\n          };\r\n\r\n          // const f_1 = interpolate(profile.accuracyPoints);\r\n          const f = x => {\r\n            if (x <= profile.accuracyPoints[0][0]) {\r\n              return 100;\r\n            }\r\n            // const calculated = f_1(x);\r\n            const calculated = predict(x);\r\n            return Math.max(0, Math.min(calculated, 100));\r\n          };\r\n          const yx = [];\r\n          for (let i = 1; i <= 28; i += 0.05) {\r\n            yx.push([i, f(i)]);\r\n          }\r\n          // console.log(JSON.stringify(yx, null, 1));\r\n          profile.accuracyPointsInterpolated = yx;\r\n        }\r\n        const interpolatedPoint = _.find(\r\n          pair => pair[1] < r.accuracy,\r\n          profile.accuracyPointsInterpolated\r\n        );\r\n        return {\r\n          id: r.playerId,\r\n          accuracy: r.accuracy,\r\n          avgAccuracy: accData.average,\r\n          interpolatedDifficulty: interpolatedPoint && interpolatedPoint[0],\r\n          weight:\r\n            r.accuracy > 98\r\n              ? 1 - (r.accuracy - 98) / (100 - 98)\r\n              : r.accuracy < 80\r\n              ? Math.max(0, (r.accuracy - 70) / (80 - 70))\r\n              : 1,\r\n        };\r\n      })\r\n      .filter(_.identity);\r\n    const sums = datas.reduce(\r\n      (acc, item) => {\r\n        if (!item.interpolatedDifficulty) {\r\n          return acc;\r\n        }\r\n        return {\r\n          diffSum: acc.diffSum + item.interpolatedDifficulty * item.weight,\r\n          weightSum: acc.weightSum + item.weight,\r\n        };\r\n      },\r\n      { diffSum: 0, weightSum: 0 }\r\n    );\r\n    sums.diffSum += _.toNumber(chart.chartLevel);\r\n    sums.weightSum += 1;\r\n    const averageDifficulty = sums.diffSum / sums.weightSum;\r\n    // console.log(chart.song, chart.chartLabel, JSON.stringify(datas), averageDifficulty);\r\n\r\n    return {\r\n      ...chart,\r\n      interpolatedDifficulty: averageDifficulty,\r\n    };\r\n  }, sharedCharts);\r\n  return newSharedCharts;\r\n};\r\n\r\nexport const getProcessedProfiles = ({ profiles: originalProfiles, sharedCharts, tracklist }) => {\r\n  // Calculate Progress achievements and bonus for starting Elo\r\n  let profiles = postProcessProfiles(originalProfiles, tracklist);\r\n\r\n  // Recalculate chart difficulty\r\n  let newSharedCharts = interpolateDifficulties(sharedCharts, profiles);\r\n\r\n  // Calculate ELO\r\n  // const { logText, scoreInfo } = processBattles({ battles, profiles: processedProfiles, debug });\r\n\r\n  // Calculate PP\r\n  const { resultInfo, profiles: processedProfiles } = processPP({\r\n    profiles,\r\n    sharedCharts: newSharedCharts,\r\n  });\r\n\r\n  return { processedProfiles, resultInfo, sharedCharts: newSharedCharts };\r\n};\r\n","if (localStorage) {\r\n  window.debugOn = () => {\r\n    localStorage.setItem('debug', 1);\r\n  };\r\n  window.debugOff = () => {\r\n    localStorage.removeItem('debug');\r\n  };\r\n}\r\n\r\nexport const DEBUG = localStorage && localStorage.getItem('debug');\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\nimport queryString from 'query-string';\r\n\r\nimport { fetchJson } from 'utils/fetch';\r\nimport { getExp } from 'utils/exp';\r\nimport { achievements, initialAchievementState } from 'utils/achievements';\r\nimport { parseDate } from 'utils/date';\r\nimport { getScoreWithoutBonus } from 'utils/score';\r\n\r\nimport WorkerProfilesProcessing from 'workerize-loader!utils/workers/profilesPostProcess'; // eslint-disable-line import/no-webpack-loader-syntax\r\nimport * as profilesProcessing from 'utils/workers/profilesPostProcess';\r\n\r\nimport { HOST } from 'constants/backend';\r\nimport { DEBUG } from 'constants/env';\r\n\r\nconst LOADING = `TOP/LOADING`;\r\nconst SUCCESS = `TOP/SUCCESS`;\r\nconst ERROR = `TOP/ERROR`;\r\nconst SET_FILTER = `TOP/SET_FILTER`;\r\nconst RESET_FILTER = `TOP/RESET_FILTER`;\r\nconst RANKING_CHANGE_SET = `TOP/RANKING_CHANGE_SET`;\r\nconst PROFILES_UPDATE = `TOP/PROFILES_UPDATE`;\r\n\r\nexport const defaultFilter = { showRank: true, showRankAndNorank: true };\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  isLoadingRanking: false,\r\n  data: [],\r\n  filter: defaultFilter,\r\n  players: {},\r\n  profiles: {},\r\n  results: [],\r\n  resultInfo: {},\r\n  sharedCharts: {},\r\n};\r\n\r\nexport const gradeComparator = {\r\n  '?': 0,\r\n  F: 1,\r\n  D: 2,\r\n  'D+': 3,\r\n  C: 4,\r\n  'C+': 5,\r\n  B: 6,\r\n  'B+': 7,\r\n  A: 8,\r\n  'A+': 9,\r\n  S: 10,\r\n  SS: 11,\r\n  SSS: 12,\r\n};\r\n\r\nconst tryFixIncompleteResult = (result, maxTotalSteps) => {\r\n  if (!maxTotalSteps) {\r\n    return;\r\n  }\r\n  const infos = [result.perfect, result.great, result.good, result.bad, result.miss];\r\n  let fixableIndex = -1,\r\n    absentNumbersCount = 0,\r\n    localStepSum = 0;\r\n  for (let i = 0; i < 5; ++i) {\r\n    if (!_.isNumber(infos[i])) {\r\n      fixableIndex = i;\r\n      absentNumbersCount++;\r\n    } else {\r\n      localStepSum += infos[i];\r\n    }\r\n  }\r\n  if (absentNumbersCount === 1) {\r\n    result[['perfect', 'great', 'good', 'bad', 'miss'][fixableIndex]] =\r\n      maxTotalSteps - localStepSum;\r\n  }\r\n};\r\n\r\nconst guessGrade = result => {\r\n  if (result.misses === 0 && result.bads === 0 && result.goods === 0) {\r\n    if (result.greats === 0) {\r\n      return 'SSS';\r\n    } else {\r\n      return 'SS';\r\n    }\r\n  }\r\n  return result.grade;\r\n};\r\n\r\nconst mapResult = (res, players, chart) => {\r\n  if (typeof res.recognition_notes === 'undefined') {\r\n    // Short result, minimum info, only for ELO calculation\r\n    // Will be replaced with better result later\r\n    return {\r\n      id: res.id,\r\n      isUnknownPlayer: players[res.player].arcade_name === 'PUMPITUP',\r\n      isIntermediateResult: true,\r\n      sharedChartId: res.shared_chart,\r\n      playerId: res.player,\r\n      nickname: players[res.player].nickname,\r\n      nicknameArcade: players[res.player].arcade_name,\r\n      date: res.gained,\r\n      dateObject: parseDate(res.gained),\r\n      grade: res.grade,\r\n      isExactDate: !!res.exact_gain_date,\r\n      score: res.score,\r\n      scoreRaw: getScoreWithoutBonus(res.score, res.grade),\r\n      isRank: !!res.rank_mode,\r\n    };\r\n  }\r\n  // Full best result\r\n  let _r = {\r\n    isUnknownPlayer: players[res.player].arcade_name === 'PUMPITUP',\r\n    isIntermediateResult: false,\r\n    sharedChartId: res.shared_chart,\r\n    id: res.id,\r\n    playerId: res.player,\r\n    nickname: players[res.player].nickname,\r\n    nicknameArcade: players[res.player].arcade_name,\r\n    originalChartMix: res.original_mix,\r\n    originalChartLabel: res.original_label,\r\n    originalScore: res.original_score,\r\n    date: res.gained,\r\n    dateObject: parseDate(res.gained),\r\n    grade: res.grade !== '?' ? res.grade : guessGrade(res),\r\n    isExactDate: !!res.exact_gain_date,\r\n    score: res.score,\r\n    scoreRaw: getScoreWithoutBonus(res.score, res.grade),\r\n    maxScore: res.max_score,\r\n    scoreIncrease: res.score_increase,\r\n    calories: res.calories && res.calories / 1000,\r\n    perfect: res.perfects,\r\n    great: res.greats,\r\n    good: res.goods,\r\n    bad: res.bads,\r\n    miss: res.misses,\r\n    combo: res.max_combo,\r\n    mods: res.mods_list,\r\n    isRank: !!res.rank_mode,\r\n    isHJ: (res.mods_list || '').split(' ').includes('HJ'),\r\n    isMachineBest: res.recognition_notes === 'machine_best',\r\n    isMyBest: res.recognition_notes === 'personal_best',\r\n  };\r\n\r\n  tryFixIncompleteResult(_r, chart.maxTotalSteps);\r\n\r\n  const perfects = Math.sqrt(_r.perfect) * 10;\r\n  const acc = perfects\r\n    ? Math.floor(\r\n        ((perfects * 100 + _r.great * 60 + _r.good * 30 + _r.miss * -20) /\r\n          (perfects + _r.great + _r.good + _r.bad + _r.miss)) *\r\n          100\r\n      ) / 100\r\n    : null;\r\n  const accRaw = _r.perfect\r\n    ? Math.floor(\r\n        ((_r.perfect * 100 + _r.great * 60 + _r.good * 30 + _r.miss * -20) /\r\n          (_r.perfect + _r.great + _r.good + _r.bad + _r.miss)) *\r\n          100\r\n      ) / 100\r\n    : null;\r\n\r\n  _r.accuracy = acc < 0 ? 0 : accRaw === 100 ? 100 : acc && +acc.toFixed(2);\r\n  _r.accuracyRaw = accRaw;\r\n  return _r;\r\n};\r\n\r\nconst getMaxScore = score => {\r\n  return ((score.score / score.accuracyRaw) * 100) / (score.isRank ? 1.2 : 1);\r\n};\r\nconst getMaxRawScore = score => {\r\n  return ((score.scoreRaw / score.accuracy) * 100) / (score.isRank ? 1.2 : 1);\r\n};\r\n\r\nconst initializeProfile = (result, profiles) => {\r\n  const id = result.playerId;\r\n  const resultsByLevel = _.fromPairs(Array.from({ length: 28 }).map((x, i) => [i + 1, []]));\r\n  profiles[id] = {\r\n    name: result.nickname,\r\n    nameArcade: result.nicknameArcade,\r\n    resultsByGrade: {},\r\n    resultsByLevel,\r\n    lastResultDate: result.dateObject,\r\n    count: 0,\r\n    battleCount: 0,\r\n    countAcc: 0,\r\n    grades: { F: 0, D: 0, C: 0, B: 0, A: 0, S: 0, SS: 0, SSS: 0 },\r\n    sumAccuracy: 0,\r\n    rankingHistory: [],\r\n    ratingHistory: [],\r\n    lastPlace: null,\r\n    lastBattleDate: 0,\r\n  };\r\n  profiles[id].achievements = _.flow(\r\n    _.keys,\r\n    _.map(achName => [\r\n      achName,\r\n      { ...(achievements[achName].initialState || initialAchievementState) },\r\n    ]),\r\n    _.fromPairs\r\n  )(achievements);\r\n  profiles[id].exp = 0;\r\n};\r\n\r\nconst getProfileInfoFromResult = (result, chart, profiles) => {\r\n  const profile = profiles[result.playerId];\r\n\r\n  profile.count++;\r\n  if (result.accuracy) {\r\n    profile.countAcc++;\r\n    profile.sumAccuracy += result.accuracy;\r\n  }\r\n  profile.grades[result.grade.replace('+', '')]++;\r\n  if (chart.chartType !== 'COOP' && result.isBestGradeOnChart) {\r\n    profile.resultsByGrade[result.grade] = [\r\n      ...(profile.resultsByGrade[result.grade] || []),\r\n      { result, chart },\r\n    ];\r\n    profile.resultsByLevel[chart.chartLevel] = [\r\n      ...(profile.resultsByLevel[chart.chartLevel] || []),\r\n      { result, chart },\r\n    ];\r\n  }\r\n  if (result.isExactDate && profile.lastResultDate < result.dateObject) {\r\n    profile.lastResultDate = result.dateObject;\r\n  }\r\n  profile.achievements = _.mapValues.convert({ cap: false })((achState, achName) => {\r\n    return achievements[achName].resultFunction(result, chart, achState, profile);\r\n  }, profile.achievements);\r\n  profile.exp += getExp(result, chart);\r\n};\r\n\r\nconst processData = (data, tracklist) => {\r\n  const { players, results, shared_charts } = data;\r\n  //// Initialization\r\n  // Init for TOP\r\n  const mappedResults = [];\r\n  const getTopResultId = result => `${result.sharedChartId}-${result.playerId}-${result.isRank}`;\r\n  const getBestGradeResultId = result => `${result.sharedChartId}-${result.playerId}`;\r\n  const topResults = {}; // Temp object\r\n  const bestGradeResults = {}; // Temp object\r\n  const top = {}; // Main top scores pbject\r\n\r\n  // Profiles for every player\r\n  let profiles = {};\r\n\r\n  // Loop 1\r\n  for (let resRaw of results) {\r\n    const sharedChartId = resRaw.shared_chart;\r\n    // Initialize Song\r\n    if (!top[sharedChartId]) {\r\n      const sharedChart = shared_charts[sharedChartId];\r\n      const label = _.toUpper(sharedChart.chart_label);\r\n      const [chartType, chartLevel] = label.match(/(\\D+)|(\\d+)/g);\r\n      top[sharedChartId] = {\r\n        song: sharedChart.track_name,\r\n        chartLabel: label,\r\n        chartLevel,\r\n        chartType,\r\n        duration: sharedChart.duration,\r\n        sharedChartId: sharedChartId,\r\n        maxTotalSteps: sharedChart.max_total_steps,\r\n        results: [],\r\n        totalResultsCount: 0,\r\n      };\r\n    }\r\n\r\n    // Getting current chart and result (mapped)\r\n    const chartTop = top[sharedChartId];\r\n    const result = mapResult(resRaw, players, chartTop);\r\n    mappedResults.push(result);\r\n\r\n    // Inserting result into TOP\r\n    const topResultId = getTopResultId(result);\r\n    const currentTopResult = topResults[topResultId];\r\n    if (!currentTopResult || currentTopResult.score < result.score) {\r\n      if (currentTopResult) {\r\n        const oldScoreIndex = chartTop.results.indexOf(currentTopResult);\r\n        if (oldScoreIndex !== -1) {\r\n          chartTop.results.splice(oldScoreIndex, 1);\r\n        }\r\n      }\r\n      const newScoreIndex = _.sortedLastIndexBy(r => -r.score, result, chartTop.results);\r\n      if (!result.isUnknownPlayer || newScoreIndex === 0) {\r\n        chartTop.results.splice(newScoreIndex, 0, result);\r\n        chartTop.latestScoreDate = result.date;\r\n        chartTop.totalResultsCount++;\r\n        topResults[topResultId] = result;\r\n      }\r\n    }\r\n\r\n    // Getting best grade of player on this chart\r\n    if (!result.isIntermediateResult) {\r\n      const bestGradeResultId = getBestGradeResultId(result);\r\n      const currentBestGradeRes = bestGradeResults[bestGradeResultId];\r\n      if (\r\n        !currentBestGradeRes ||\r\n        gradeComparator[currentBestGradeRes.grade] <= gradeComparator[result.grade]\r\n      ) {\r\n        // Using <= here, so newer scores always win and rewrite old scores\r\n        currentBestGradeRes && (currentBestGradeRes.isBestGradeOnChart = false);\r\n        result.isBestGradeOnChart = true;\r\n        bestGradeResults[bestGradeResultId] = result;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Loop 2, when the TOP is already set up\r\n  for (let chartId in top) {\r\n    const chart = top[chartId];\r\n    chart.maxScoreWithAccuracy = 0;\r\n    chart.maxNonRankScore = 0;\r\n    for (let result of chart.results) {\r\n      if (result.accuracyRaw && chart.maxScoreWithAccuracy < result.score) {\r\n        chart.maxScoreResult = result;\r\n        chart.maxScoreWithAccuracy = result.score;\r\n      }\r\n      if (result.accuracyRaw && !result.isRank && chart.maxNonRankScore < result.score) {\r\n        chart.maxNonRankScoreResult = result;\r\n        chart.maxNonRankScore = result.score;\r\n      }\r\n      // Getting some info about players\r\n      if (!result.isUnknownPlayer && !result.isIntermediateResult) {\r\n        if (!profiles[result.playerId]) {\r\n          initializeProfile(result, profiles);\r\n        }\r\n        getProfileInfoFromResult(result, chart, profiles);\r\n      }\r\n    }\r\n    if (chart.maxScoreWithAccuracy) {\r\n      chart.maxScore = getMaxScore(chart.maxScoreResult, chart);\r\n    }\r\n    if (chart.maxNonRankScore) {\r\n      chart.maxNonRankScore = getMaxRawScore(chart.maxNonRankScoreResult, chart);\r\n    }\r\n  }\r\n\r\n  return { mappedResults, profiles, sharedCharts: top };\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n        data: initialState.data,\r\n        players: initialState.players,\r\n        profiles: initialState.profiles,\r\n        results: initialState.results,\r\n        sharedCharts: initialState.sharedCharts,\r\n        scoreInfo: {},\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        isLoadingRanking: true,\r\n        data: action.data,\r\n        players: action.players,\r\n        profiles: action.profiles,\r\n        results: action.results,\r\n        sharedCharts: action.sharedCharts,\r\n        originalData: action.originalData,\r\n        scoreInfo: {},\r\n      };\r\n    case PROFILES_UPDATE:\r\n      return {\r\n        ...state,\r\n        isLoadingRanking: false,\r\n        profiles: action.profiles,\r\n        resultInfo: action.resultInfo,\r\n        sharedCharts: action.sharedCharts,\r\n      };\r\n    case SET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: action.filter,\r\n      };\r\n    case RESET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: defaultFilter,\r\n      };\r\n    case RANKING_CHANGE_SET:\r\n      const hasPrevList = !_.isEmpty(action.listPrev);\r\n      return {\r\n        ...state,\r\n        profiles: _.mapValues(playerOriginal => {\r\n          const player = {\r\n            ...playerOriginal,\r\n            prevRating: _.get(playerOriginal.id, action.rankingsPointsMap),\r\n          };\r\n          if (!hasPrevList) {\r\n            return player; // First time opening this thing and we didn't have any previous data\r\n          }\r\n          if (!_.includes(player.id, action.listPrev)) {\r\n            return { ...player, change: 'NEW' };\r\n          } else if (!_.includes(player.id, action.listNow)) {\r\n            // Should NEVER happen, idk if this is possible\r\n            return { ...player, change: '?' };\r\n          } else {\r\n            return {\r\n              ...player,\r\n              change: _.indexOf(player.id, action.listPrev) - _.indexOf(player.id, action.listNow),\r\n            };\r\n          }\r\n        }, state.profiles),\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchResults = () => {\r\n  return async (dispatch, getState) => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(\r\n        fetchJson({\r\n          url: `${HOST}/results/highscores`,\r\n        })\r\n      );\r\n      if (data.error) {\r\n        throw new Error(data.error);\r\n      }\r\n      // HACK for test\r\n      // data.results = _.dropRight(500, data.results);\r\n      dispatch(processResultsData(data));\r\n    } catch (error) {\r\n      console.log(error);\r\n      dispatch({ type: ERROR, error });\r\n    }\r\n  };\r\n};\r\n\r\nexport const appendNewResults = lastDate => {\r\n  return async (dispatch, getState) => {\r\n    const { originalData, sharedCharts } = getState().results;\r\n    if (!lastDate) {\r\n      return dispatch(fetchResults());\r\n    }\r\n\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(\r\n        fetchJson({\r\n          url: `${HOST}/results/highscores?${queryString.stringify({ start_date: lastDate })}`,\r\n        })\r\n      );\r\n      if (data.error) {\r\n        throw new Error(data.error);\r\n      }\r\n\r\n      const appendedResults = _.filter(result => {\r\n        const currentResults = sharedCharts[result.shared_chart];\r\n        if (!currentResults) {\r\n          return true;\r\n        }\r\n        return !_.some(\r\n          r =>\r\n            r.playerId === result.player &&\r\n            r.isRank === !!result.rank_mode &&\r\n            r.score > result.score,\r\n          currentResults.results\r\n        );\r\n      }, data.results);\r\n\r\n      console.log('Received results:', data, '; Will append:', appendedResults);\r\n\r\n      const mergedData = {\r\n        players: data.players,\r\n        results: [...originalData.results, ...appendedResults],\r\n        shared_charts: { ...originalData.shared_charts, ...data.shared_charts },\r\n      };\r\n      dispatch(processResultsData(mergedData));\r\n    } catch (error) {\r\n      console.log(error);\r\n      dispatch({ type: ERROR, error });\r\n    }\r\n  };\r\n};\r\n\r\nconst processResultsData = data => {\r\n  return async (dispatch, getState) => {\r\n    const { tracklist } = getState();\r\n    const { sharedCharts, mappedResults, profiles } = processData(data, tracklist);\r\n\r\n    dispatch({\r\n      type: SUCCESS,\r\n      data: _.values(sharedCharts),\r\n      players: _.flow(\r\n        _.toPairs,\r\n        _.map(([id, player]) => ({ ...player, id: _.toInteger(id) }))\r\n      )(data.players),\r\n      results: mappedResults,\r\n      profiles,\r\n      sharedCharts,\r\n      originalData: data,\r\n    });\r\n\r\n    // Parallelized calculation of ELO and profile data\r\n    const input = { sharedCharts, profiles, tracklist };\r\n    let promise, worker;\r\n    if (window.Worker) {\r\n      worker = new WorkerProfilesProcessing();\r\n      promise = worker.getProcessedProfiles(input);\r\n    } else {\r\n      promise = new Promise(res => res(profilesProcessing.getProcessedProfiles(input)));\r\n    }\r\n\r\n    const { processedProfiles, resultInfo, sharedCharts: newSharedCharts } = await promise;\r\n    DEBUG &&\r\n      console.log(\r\n        'Processed profiles:',\r\n        Object.values(processedProfiles)\r\n          .filter(q => q.pp)\r\n          .sort((a, b) => b.pp.pp - a.pp.pp)\r\n      );\r\n\r\n    dispatch({\r\n      type: PROFILES_UPDATE,\r\n      profiles: processedProfiles,\r\n      resultInfo,\r\n      sharedCharts: newSharedCharts,\r\n    });\r\n    dispatch(calculateRankingChanges(processedProfiles));\r\n    if (worker) worker.terminate();\r\n  };\r\n};\r\n\r\nexport const setFilter = filter => ({\r\n  type: SET_FILTER,\r\n  filter,\r\n});\r\n\r\nexport const resetFilter = () => ({\r\n  type: RESET_FILTER,\r\n});\r\n\r\nconst getListOfNames = _.map('id');\r\nconst getMapOfRatings = _.flow(\r\n  _.map(q => [q.id, q.rating]),\r\n  _.fromPairs\r\n);\r\n\r\nexport const calculateRankingChanges = profiles => {\r\n  return async (dispatch, getState) => {\r\n    try {\r\n      const ranking = _.orderBy('ratingRaw', 'desc', _.values(profiles));\r\n      const [lastChangedRanking, lastChangedRankingPoints, lastFetchedRanking] = await Promise.all([\r\n        localForage.getItem('lastChangedRanking_v3'),\r\n        localForage.getItem('lastChangedRankingPoints_v3'),\r\n        localForage.getItem('lastFetchedRanking_v3'),\r\n      ]);\r\n      const listNow = getListOfNames(ranking);\r\n      const listLastFetched = getListOfNames(lastFetchedRanking);\r\n      const listLastChanged = getListOfNames(lastChangedRanking);\r\n      const mapPointsNow = getMapOfRatings(ranking);\r\n      const mapPointsLastFetched = getMapOfRatings(lastFetchedRanking);\r\n      const mapPointsLastChanged = getMapOfRatings(lastChangedRankingPoints);\r\n\r\n      let rankingsPointsMap = mapPointsLastChanged;\r\n      // console.log(listNow, listLastFetched, listLastChanged);\r\n      // console.log(mapPointsNow, mapPointsLastFetched, mapPointsLastChanged);\r\n      if (!_.isEqual(mapPointsNow, mapPointsLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRankingPoints_v3', lastFetchedRanking);\r\n        rankingsPointsMap = mapPointsLastFetched;\r\n      }\r\n      let listPrev = listLastChanged;\r\n      if (!_.isEqual(listNow, listLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        localForage.setItem('lastChangedRanking_v3', lastFetchedRanking);\r\n        listPrev = listLastFetched;\r\n      }\r\n      dispatch({\r\n        type: RANKING_CHANGE_SET,\r\n        listNow,\r\n        listPrev,\r\n        rankingsPointsMap,\r\n      });\r\n      localForage.setItem('lastFetchedRanking_v3', ranking);\r\n    } catch (error) {\r\n      console.warn('Cannot get ranking from local storage', error);\r\n    }\r\n  };\r\n};\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\n\r\nimport { setFilter } from 'reducers/results';\r\n\r\nconst SELECT_PRESET = `PRESETS/SELECT_PRESET`;\r\nconst LOAD_PRESETS = `PRESETS/LOAD_PRESETS`;\r\nconst LOADING_START = `PRESETS/LOADING_START`;\r\nconst LOADING_END = `PRESETS/LOADING_END`;\r\n\r\nconst initialState = {\r\n  presets: [],\r\n  currentPreset: null,\r\n  isLoading: false,\r\n};\r\n\r\nconst itemToOption = item =>\r\n  item && {\r\n    ...item,\r\n    label: item.name,\r\n    value: item.name,\r\n  };\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOAD_PRESETS:\r\n      const currentPreset = _.find({ name: _.get('name', state.currentPreset) }, action.presets);\r\n      return {\r\n        ...state,\r\n        currentPreset: itemToOption(currentPreset) || null,\r\n        presets: _.map(itemToOption, action.presets),\r\n      };\r\n    case SELECT_PRESET:\r\n      return {\r\n        ...state,\r\n        currentPreset: itemToOption(action.currentPreset),\r\n      };\r\n    case LOADING_START:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case LOADING_END:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nconst reloadPresets = presets => ({ type: LOAD_PRESETS, presets: presets || [] });\r\n\r\nconst startLoading = () => ({\r\n  type: LOADING_START,\r\n});\r\n\r\nconst endLoading = () => ({\r\n  type: LOADING_END,\r\n});\r\n\r\nexport const selectPreset = currentPreset => ({\r\n  type: SELECT_PRESET,\r\n  currentPreset,\r\n});\r\n\r\nexport const loadPresets = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    dispatch(reloadPresets(presets));\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const savePreset = name => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const { filter } = getState().top;\r\n    const newPreset = { name, filter };\r\n    if (!_.some({ name }, presets)) {\r\n      const newPresets = [...(presets || []), newPreset];\r\n      dispatch(reloadPresets(newPresets));\r\n      dispatch(selectPreset(newPreset));\r\n      localForage.setItem('filterPresets', newPresets);\r\n    } else if (window.confirm('Preset with this name already exists, replace it?')) {\r\n      const withoutOldPreset = _.remove({ name }, presets);\r\n      const newPresets = [...withoutOldPreset, newPreset];\r\n      dispatch(reloadPresets(newPresets));\r\n      localForage.setItem('filterPresets', newPresets);\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const openPreset = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  const currentPreset = getState().presets.currentPreset;\r\n  const name = _.get('name', currentPreset);\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const preset = name && _.find({ name }, presets);\r\n    if (preset) {\r\n      dispatch(selectPreset(currentPreset));\r\n      dispatch(setFilter(currentPreset.filter));\r\n    } else {\r\n      // Preset not found for some reason, update list\r\n      dispatch(reloadPresets(presets));\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n\r\nexport const deletePreset = () => (dispatch, getState) => {\r\n  dispatch(startLoading());\r\n  const name = _.get('name', getState().presets.currentPreset);\r\n  return localForage.getItem('filterPresets').then(presets => {\r\n    const preset = _.find({ name }, presets);\r\n    if (preset && window.confirm('Are you sure you want to delete selected preset?')) {\r\n      const withoutOldPreset = _.remove({ name }, presets);\r\n      dispatch(reloadPresets(withoutOldPreset));\r\n      localForage.setItem('filterPresets', withoutOldPreset);\r\n    } else {\r\n      // Preset not found for some reason, update list\r\n      dispatch(reloadPresets(presets));\r\n    }\r\n    dispatch(endLoading());\r\n  });\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { FaLayerGroup, FaFolderOpen, FaSave, FaPlus, FaTrashAlt } from 'react-icons/fa';\r\nimport Select from 'react-select';\r\n\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport Input from 'components/Shared/Input/Input';\r\n\r\nimport { loadPresets, savePreset, selectPreset, openPreset, deletePreset } from 'reducers/presets';\r\n\r\nconst overlayItem = (\r\n  <button className=\"btn btn-sm btn-dark btn-icon _margin-right\">\r\n    <FaLayerGroup />\r\n    пресеты\r\n  </button>\r\n);\r\n\r\nconst noPresetsMessage = () => 'пусто';\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    ...state.presets,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  loadPresets,\r\n  savePreset,\r\n  openPreset,\r\n  deletePreset,\r\n  selectPreset,\r\n};\r\n\r\nclass PresetsControl extends React.Component {\r\n  state = {};\r\n\r\n  componentDidMount() {\r\n    this.props.loadPresets();\r\n  }\r\n\r\n  onChangeSelection = selected => {\r\n    this.props.selectPreset(selected.name);\r\n  };\r\n\r\n  onRewritePreset = () => {\r\n    const { currentPreset } = this.props;\r\n    this.props.savePreset(currentPreset.name);\r\n  };\r\n\r\n  onSavePreset = () => {\r\n    const { name } = this.state;\r\n    this.props.savePreset(name);\r\n    this.setState({ isAddingNew: false });\r\n  };\r\n\r\n  render() {\r\n    const { presets, currentPreset, isLoading } = this.props;\r\n    const { name, isAddingNew } = this.state;\r\n    return (\r\n      <div>\r\n        <Overlay overlayItem={overlayItem}>\r\n          <div className=\"presets-control-overlay\">\r\n            <Select\r\n              className=\"select _margin-bottom\"\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"пресеты...\"\r\n              options={presets}\r\n              value={currentPreset}\r\n              onChange={this.props.selectPreset}\r\n              noOptionsMessage={noPresetsMessage}\r\n            />\r\n            {currentPreset && (\r\n              <div className=\"buttons-presets _margin-bottom\">\r\n                <div className=\"_flex-fill\" />\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n                  onClick={this.props.openPreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaFolderOpen /> открыть\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n                  onClick={this.onRewritePreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaSave /> перезаписать\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon\"\r\n                  onClick={this.props.deletePreset}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaTrashAlt /> удалить\r\n                </button>\r\n              </div>\r\n            )}\r\n            {!isAddingNew && (\r\n              <div className=\"buttons-presets _margin-bottom\">\r\n                <div className=\"_flex-fill\" />\r\n\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left _self-align-end\"\r\n                  onClick={() => this.setState({ isAddingNew: true })}\r\n                  disabled={isLoading}\r\n                >\r\n                  <FaPlus /> добавить\r\n                </button>\r\n              </div>\r\n            )}\r\n            {isAddingNew && (\r\n              <div className=\"adding-new _margin-bottom\">\r\n                <Input\r\n                  value={name}\r\n                  placeholder=\"имя пресета...\"\r\n                  className=\"form-control\"\r\n                  onChange={name => this.setState({ name })}\r\n                />\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left\"\r\n                  onClick={this.onSavePreset}\r\n                  disabled={!name || isLoading}\r\n                >\r\n                  <FaSave /> сохранить\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-dark btn-icon _margin-left\"\r\n                  onClick={() => this.setState({ isAddingNew: false })}\r\n                  disabled={isLoading}\r\n                >\r\n                  отмена\r\n                </button>\r\n              </div>\r\n            )}\r\n            {/* <div>\r\n              <Toggle\r\n                checked={false}\r\n                onToggle={active => {\r\n                  localForage.setItem('showTabs', active);\r\n                }}\r\n              >\r\n                показывать табы с пресетами\r\n              </Toggle>\r\n            </div> */}\r\n          </div>\r\n        </Overlay>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(PresetsControl);\r\n","export const colorsArray = [\r\n  '#4DB3FF',\r\n  '#80B300',\r\n  '#FF6655',\r\n  '#FF99E6',\r\n  '#33FFCC',\r\n  '#e633c8',\r\n  '#dbe812',\r\n  '#FF1A66',\r\n  '#991AFF',\r\n  '#E6B333',\r\n  '#1AB399',\r\n  '#4D8066',\r\n  '#CC9999',\r\n  '#00E680',\r\n  '#809980',\r\n  '#E6FF80',\r\n  '#1AFF33',\r\n  '#999933',\r\n  '#E6331A',\r\n  '#CCCC00',\r\n  '#66E64D',\r\n  '#4D80CC',\r\n  '#9900B3',\r\n  '#4DB380',\r\n  '#FF4D4D',\r\n];\r\n","import _ from 'lodash/fp';\r\nimport { createSelector } from 'reselect';\r\nimport matchSorter from 'match-sorter';\r\n\r\nimport { SORT, CHART_MIN_MAX, DURATION_DEFAULT } from 'constants/leaderboard';\r\n\r\nexport const playersSelector = createSelector(\r\n  state => state.results.players,\r\n  state => state.user.data.player.id,\r\n  (players, playerId) =>\r\n    _.flow(\r\n      _.toPairs,\r\n      _.map(([, { nickname, arcade_name, id }]) => ({\r\n        label: `${nickname} (${arcade_name})`,\r\n        value: nickname,\r\n        isCurrentPlayer: playerId === id,\r\n      })),\r\n      _.sortBy(it => (it.isCurrentPlayer ? '!' : _.toLower(it.label)))\r\n    )(players)\r\n);\r\n\r\nconst filterCharts = (filter, rows) => {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filter);\r\n  const type = _.getOr(null, 'type', filter);\r\n  const duration = _.getOr(DURATION_DEFAULT, 'duration', filter);\r\n\r\n  return _.filter(row => {\r\n    if (duration !== DURATION_DEFAULT && !duration.includes(row.duration)) {\r\n      return false;\r\n    }\r\n    return (\r\n      row.chartLevel >= range[0] &&\r\n      row.chartLevel <= range[1] &&\r\n      (!type || row.chartType.startsWith(type))\r\n    );\r\n  }, rows);\r\n};\r\n\r\nconst getFilteredData = (data, sharedCharts, filter, resultInfo = {}) => {\r\n  // const start = performance.now();\r\n  const names = _.map('value', filter.players);\r\n  const namesOr = _.map('value', filter.playersOr);\r\n  const namesNot = _.map('value', filter.playersNot);\r\n  const sortingType = _.get('value', filter.sortingType);\r\n  const protagonist = _.get('value', filter.protagonist);\r\n  const excludeAntagonists = _.map('value', filter.excludeAntagonists);\r\n\r\n  const defaultSorting = [_.orderBy(['latestScoreDate'], ['desc'])];\r\n  const newScoresProtagonistSorting = !protagonist\r\n    ? defaultSorting\r\n    : [\r\n        _.orderBy(\r\n          [\r\n            song =>\r\n              _.max(\r\n                _.map(\r\n                  res => (res.nickname === protagonist ? res.dateObject.getTime() : 0),\r\n                  song.results\r\n                )\r\n              ),\r\n          ],\r\n          ['desc']\r\n        ),\r\n      ];\r\n  const protagonistSorting = [\r\n    _.filter(row => _.map('nickname', row.results).includes(protagonist)),\r\n    _.map(row => {\r\n      const protIndex = _.findIndex({ nickname: protagonist }, row.results);\r\n      const protScore = row.results[protIndex].score;\r\n      const enemies = _.flow([\r\n        _.take(protIndex),\r\n        _.uniqBy('nickname'),\r\n        _.remove(res => excludeAntagonists.includes(res.nickname) || res.score === protScore),\r\n      ])(row.results);\r\n      const distance = Math.sqrt(\r\n        _.reduce((dist, enemy) => dist + (enemy.score / protScore - 0.99) ** 2, 0, enemies)\r\n      );\r\n      return {\r\n        ...row,\r\n        distanceFromProtagonist: distance,\r\n      };\r\n    }),\r\n    _.orderBy(['distanceFromProtagonist'], ['desc']),\r\n  ];\r\n  const getScoreSorting = (field, direction = 'desc') => [\r\n    _.filter(row => _.map('nickname', row.results).includes(protagonist)),\r\n    _.orderBy(\r\n      [\r\n        row => {\r\n          const result = _.find({ nickname: protagonist }, row.results);\r\n          const info = resultInfo[result.id] || {};\r\n          return _.getOr(direction === 'desc' ? -Infinity : Infinity, field, info);\r\n        },\r\n      ],\r\n      [direction]\r\n    ),\r\n  ];\r\n  const getDiffSorting = (direction = 'desc') => [\r\n    _.orderBy(\r\n      [\r\n        row => {\r\n          const chartInfo = sharedCharts[row.sharedChartId];\r\n          return _.getOr(_.toNumber(row.chartLevel), 'interpolatedDifficulty', chartInfo);\r\n        },\r\n      ],\r\n      [direction]\r\n    ),\r\n  ];\r\n  const sortingFunctions =\r\n    {\r\n      [SORT.DEFAULT]: defaultSorting,\r\n      [SORT.NEW_SCORES_PLAYER]: newScoresProtagonistSorting,\r\n      [SORT.PROTAGONIST]: protagonistSorting,\r\n      [SORT.RANK_ASC]: getScoreSorting('pp.ppRatio', 'asc'),\r\n      [SORT.RANK_DESC]: getScoreSorting('pp.pp'),\r\n      [SORT.EASIEST_SONGS]: getDiffSorting('asc'),\r\n      [SORT.HARDEST_SONGS]: getDiffSorting('desc'),\r\n    }[sortingType] || defaultSorting;\r\n\r\n  const result = _.flow(\r\n    _.compact([\r\n      _.map(row => ({\r\n        ...row,\r\n        results: row.results.filter(\r\n          (res, index) => !res.isUnknownPlayer || index === 0,\r\n          row.results\r\n        ),\r\n      })),\r\n      filter.chartRange && (items => filterCharts(filter.chartRange, items)),\r\n      !filter.showRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => !res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        filter.showOnlyRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        !filter.showOnlyRank &&\r\n        !filter.showRankAndNorank &&\r\n        _.map(row => {\r\n          const occuredNames = [];\r\n          return {\r\n            ...row,\r\n            results: _.filter(res => {\r\n              const alreadyOccured = occuredNames.includes(res.nickname);\r\n              occuredNames.push(res.nickname);\r\n              return !alreadyOccured;\r\n            }, row.results),\r\n          };\r\n        }),\r\n      (names.length || namesOr.length || namesNot.length) &&\r\n        _.filter(row => {\r\n          const rowNames = _.map('nickname', row.results);\r\n          return (\r\n            (!names.length || _.every(name => rowNames.includes(name), names)) &&\r\n            (!namesOr.length || _.some(name => rowNames.includes(name), namesOr)) &&\r\n            (!namesNot.length || !_.some(name => rowNames.includes(name), namesNot))\r\n          );\r\n        }),\r\n      _.filter(row => _.size(row.results)),\r\n      ...sortingFunctions,\r\n      filter.song && (items => matchSorter(items, filter.song.trim(), { keys: ['song'] })),\r\n    ])\r\n  )(data);\r\n  // console.log('Elapsed:', performance.now() - start);\r\n  return result;\r\n};\r\n\r\nexport const filteredDataSelector = createSelector(\r\n  state => state.results.data,\r\n  state => state.results.sharedCharts,\r\n  state => state.results.filter,\r\n  state => state.results.resultInfo,\r\n  getFilteredData\r\n);\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport _ from 'lodash/fp';\r\nimport Select from 'react-select';\r\nimport classNames from 'classnames';\r\nimport numeral from 'numeral';\r\nimport localForage from 'localforage';\r\nimport { NavLink } from 'react-router-dom';\r\nimport Tooltip from 'react-responsive-ui/modules/Tooltip';\r\nimport {\r\n  FaRedoAlt,\r\n  FaExclamationTriangle,\r\n  FaSearch,\r\n  FaYoutube,\r\n  FaAngleDoubleUp,\r\n  FaBackward,\r\n  FaForward,\r\n} from 'react-icons/fa';\r\nimport FlipMove from 'react-flip-move';\r\n\r\n// styles\r\nimport './leaderboard.scss';\r\n\r\n// components\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Loader from 'components/Shared/Loader';\r\nimport Input from 'components/Shared/Input/Input';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\nimport CollapsibleBar from 'components/Shared/CollapsibleBar';\r\nimport ChartFilter from './ChartFilter';\r\nimport PresetsControl from './PresetsControl';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\nimport { SORT } from 'constants/leaderboard';\r\nimport { DEBUG } from 'constants/env';\r\n\r\n// reducers\r\nimport { fetchResults, setFilter, resetFilter, defaultFilter } from 'reducers/results';\r\nimport { selectPreset, openPreset } from 'reducers/presets';\r\n\r\n// utils\r\nimport { getExp } from 'utils/exp';\r\nimport { tooltipFormatter, getTimeAgo } from 'utils/leaderboards';\r\nimport { colorsArray } from 'utils/colors';\r\nimport { playersSelector, filteredDataSelector } from 'reducers/selectors';\r\n\r\n// code\r\nconst ANIMATION_DURATION = 250;\r\nconst sortingOptions = [\r\n  {\r\n    label: 'от новых скоров',\r\n    value: SORT.DEFAULT,\r\n  },\r\n  {\r\n    label: 'от новых скоров конкретного игрока',\r\n    value: SORT.NEW_SCORES_PLAYER,\r\n  },\r\n  // {\r\n  //   label: 'отставанию от остальных',\r\n  //   value: SORT.PROTAGONIST,\r\n  // },\r\n  {\r\n    label: 'от худших результатов',\r\n    value: SORT.RANK_ASC,\r\n  },\r\n  {\r\n    label: 'от лучших результатов',\r\n    value: SORT.RANK_DESC,\r\n  },\r\n  {\r\n    label: 'от лёгких чартов',\r\n    value: SORT.EASIEST_SONGS,\r\n  },\r\n  {\r\n    label: 'от сложных чартов',\r\n    value: SORT.HARDEST_SONGS,\r\n  },\r\n];\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    players: playersSelector(state),\r\n    resultInfo: state.results.resultInfo,\r\n    results: state.results.results,\r\n    sharedCharts: state.results.sharedCharts,\r\n    filteredData: filteredDataSelector(state),\r\n    data: state.results.data,\r\n    filter: state.results.filter,\r\n    error: state.results.error || state.tracklist.error,\r\n    isLoading: state.results.isLoading || state.tracklist.isLoading,\r\n    presets: state.presets.presets,\r\n    currentPreset: state.presets.currentPreset,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n  setFilter,\r\n  resetFilter,\r\n  selectPreset,\r\n  openPreset,\r\n};\r\n\r\nclass Leaderboard extends Component {\r\n  static propTypes = {\r\n    match: toBe.object,\r\n    resultInfo: toBe.object,\r\n    data: toBe.array,\r\n    error: toBe.object,\r\n    results: toBe.array,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  state = { showItemsCount: 20, chartOverrides: {} };\r\n\r\n  setFilter = _.curry((name, value) => {\r\n    const filter = { ...this.props.filter, [name]: value };\r\n    this.props.setFilter(filter);\r\n    localForage.setItem('filter', filter);\r\n  });\r\n\r\n  resetFilter = () => {\r\n    this.props.resetFilter();\r\n    this.setState({ chartOverrides: {} });\r\n    localForage.setItem('filter', defaultFilter);\r\n  };\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    this.setState({ chartOverrides: {} });\r\n    !isLoading && this.props.fetchResults();\r\n  };\r\n\r\n  onTypeSongName = _.debounce(300, value => {\r\n    this.setFilter('song', value);\r\n  });\r\n\r\n  onRedoLatestResult = _.throttle(ANIMATION_DURATION + 10, chart => {\r\n    const overrides = _.drop(1, this.state.chartOverrides[chart.sharedChartId]);\r\n    this.setState(state => ({\r\n      chartOverrides: {\r\n        ...state.chartOverrides,\r\n        [chart.sharedChartId]: _.size(overrides) === 1 ? null : overrides,\r\n      },\r\n    }));\r\n  });\r\n\r\n  onUndoLatestResult = _.throttle(ANIMATION_DURATION + 10, chart => {\r\n    if (_.isEmpty(chart.results)) {\r\n      this.setState(state => ({\r\n        chartOverrides: _.omit(chart.sharedChartId, state.chartOverrides),\r\n      }));\r\n    }\r\n    const undoedResult = _.maxBy('date', chart.results);\r\n    if (!undoedResult) return;\r\n\r\n    const { results } = this.props;\r\n    const undoedPlayerId = undoedResult.playerId;\r\n    const previousPlayerResult = _.findLast(\r\n      res =>\r\n        res.playerId === undoedPlayerId &&\r\n        res.sharedChartId === chart.sharedChartId &&\r\n        res.isRank === undoedResult.isRank &&\r\n        res.date < undoedResult.date,\r\n      results\r\n    );\r\n    const newResults = _.orderBy(\r\n      'score',\r\n      'desc',\r\n      _.compact(_.map(res => (res === undoedResult ? previousPlayerResult : res), chart.results))\r\n    );\r\n    const latestScore = _.maxBy('date', newResults);\r\n    const overrideChart = {\r\n      ...chart,\r\n      latestScoreDate: latestScore && latestScore.date,\r\n      results: newResults,\r\n    };\r\n    if (_.isEmpty(newResults)) {\r\n      this.setState(state => ({\r\n        chartOverrides: {\r\n          ...state.chartOverrides,\r\n          [chart.sharedChartId]: null,\r\n        },\r\n      }));\r\n    } else {\r\n      this.setState(state => ({\r\n        chartOverrides: {\r\n          ...state.chartOverrides,\r\n          [chart.sharedChartId]: [\r\n            overrideChart,\r\n            ...(state.chartOverrides[chart.sharedChartId] || [chart]),\r\n          ],\r\n        },\r\n      }));\r\n    }\r\n  });\r\n\r\n  renderSimpleSearch() {\r\n    const { isLoading, filter } = this.props;\r\n    return (\r\n      <div className=\"simple-search\">\r\n        <div className=\"song-name _margin-right _margin-bottom\">\r\n          <Input\r\n            value={filter.song || ''}\r\n            placeholder=\"название песни...\"\r\n            className=\"form-control\"\r\n            onChange={this.onTypeSongName}\r\n          />\r\n        </div>\r\n        <div className=\"chart-range _margin-right _margin-bottom\">\r\n          <ChartFilter filterValue={filter.chartRange} onChange={this.setFilter('chartRange')} />\r\n        </div>\r\n        <div className=\"_flex-fill\" />\r\n        <div className=\"_flex-row _margin-bottom\">\r\n          <PresetsControl />\r\n          <button className=\"btn btn-sm btn-dark btn-icon _margin-right\" onClick={this.resetFilter}>\r\n            <FaRedoAlt /> сбросить фильтры\r\n          </button>\r\n          <button\r\n            disabled={isLoading}\r\n            className=\"btn btn-sm btn-dark btn-icon\"\r\n            onClick={this.onRefresh}\r\n          >\r\n            <FaSearch /> обновить\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderFilters() {\r\n    const { players, filter } = this.props;\r\n    return (\r\n      <div className=\"filters\">\r\n        <div className=\"people-filters\">\r\n          <label className=\"label\">показывать чарты, которые сыграл:</label>\r\n          <div className=\"players-block\">\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">каждый из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'players', filter)}\r\n                onChange={this.setFilter('players')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и хоть один из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersOr', filter)}\r\n                onChange={this.setFilter('playersOr')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и никто из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersNot', filter)}\r\n                onChange={this.setFilter('playersNot')}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Toggle\r\n            checked={_.getOr(false, 'showRank', filter)}\r\n            onChange={this.setFilter('showRank')}\r\n          >\r\n            показывать скоры на ранке\r\n          </Toggle>\r\n        </div>\r\n        {_.get('showRank', filter) && (\r\n          <>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showOnlyRank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showOnlyRank', value);\r\n                  if (_.get('showRankAndNorank', filter)) {\r\n                    this.setFilter('showRankAndNorank', false);\r\n                  }\r\n                }}\r\n              >\r\n                <strong>только</strong> на ранке\r\n              </Toggle>\r\n            </div>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showRankAndNorank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showRankAndNorank', value);\r\n                  if (_.get('showOnlyRank', filter)) {\r\n                    this.setFilter('showOnlyRank', false);\r\n                  }\r\n                }}\r\n              >\r\n                показывать лучшие скоры с ранком и без\r\n              </Toggle>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderSortings() {\r\n    const { players, filter } = this.props;\r\n    return (\r\n      <div className=\"sortings\">\r\n        <div>\r\n          <label className=\"label\">сортировка:</label>\r\n          <Select\r\n            placeholder=\"выберите сортировку\"\r\n            className=\"select\"\r\n            classNamePrefix=\"select\"\r\n            isClearable={false}\r\n            options={sortingOptions}\r\n            value={_.getOr(sortingOptions[0], 'sortingType', filter)}\r\n            onChange={this.setFilter('sortingType')}\r\n          />\r\n        </div>\r\n        {[SORT.PROTAGONIST, SORT.RANK_ASC, SORT.RANK_DESC, SORT.NEW_SCORES_PLAYER].includes(\r\n          _.get('sortingType.value', filter)\r\n        ) && (\r\n          <div>\r\n            <label className=\"label\">игрок:</label>\r\n            <Select\r\n              className={classNames('select players', {\r\n                'red-border': !_.get('protagonist', filter),\r\n              })}\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"игроки...\"\r\n              options={players}\r\n              value={_.getOr(null, 'protagonist', filter)}\r\n              onChange={this.setFilter('protagonist')}\r\n            />\r\n          </div>\r\n        )}\r\n        {[SORT.PROTAGONIST].includes(_.get('sortingType.value', filter)) && (\r\n          <div>\r\n            <label className=\"label\">не учитывать в сравнении:</label>\r\n            <Select\r\n              closeMenuOnSelect={false}\r\n              className=\"select players\"\r\n              classNamePrefix=\"select\"\r\n              placeholder=\"игроки...\"\r\n              options={players}\r\n              isMulti\r\n              value={_.getOr([], 'excludeAntagonists', filter)}\r\n              onChange={this.setFilter('excludeAntagonists')}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, filteredData, error, filter, resultInfo, sharedCharts } = this.props;\r\n    const { showItemsCount, chartOverrides } = this.state;\r\n    const canShowMore = filteredData.length > showItemsCount;\r\n    const visibleData = _.slice(0, showItemsCount, filteredData);\r\n\r\n    const sortingType = _.get('sortingType.value', filter);\r\n    const highlightProtagonist = [\r\n      SORT.PROTAGONIST,\r\n      SORT.RANK_ASC,\r\n      SORT.RANK_DESC,\r\n      SORT.NEW_SCORES_PLAYER,\r\n    ].includes(sortingType);\r\n    const protagonistName = _.get('protagonist.value', filter);\r\n    const uniqueSelectedNames = _.slice(\r\n      0,\r\n      colorsArray.length,\r\n      _.uniq(\r\n        _.compact([\r\n          highlightProtagonist && protagonistName,\r\n          ..._.map('value', filter.players),\r\n          ..._.map('value', filter.playersOr),\r\n        ])\r\n      )\r\n    );\r\n\r\n    return (\r\n      <div className=\"leaderboard-page\">\r\n        <div className=\"content\">\r\n          <div className=\"search-block\">\r\n            {this.renderSimpleSearch()}\r\n            <CollapsibleBar title=\"фильтры\">{this.renderFilters()}</CollapsibleBar>\r\n            <CollapsibleBar title=\"сортировка\">{this.renderSortings()}</CollapsibleBar>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          {!!this.props.presets.length && (\r\n            <div className=\"presets-buttons\">\r\n              <span>пресеты:</span>\r\n              {this.props.presets.map(preset => (\r\n                <ToggleButton\r\n                  key={preset.name}\r\n                  text={preset.name}\r\n                  className=\"btn btn-sm btn-dark _margin-right\"\r\n                  active={_.get('filter', preset) === this.props.filter}\r\n                  onToggle={() => {\r\n                    this.props.selectPreset(preset);\r\n                    this.props.openPreset();\r\n                  }}\r\n                ></ToggleButton>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <div className=\"top-list\">\r\n            {_.isEmpty(filteredData) && !isLoading && (error ? error.message : 'ничего не найдено')}\r\n            {!isLoading &&\r\n              visibleData.map((chartOriginal, chartIndex) => {\r\n                const overrides = chartOverrides[chartOriginal.sharedChartId];\r\n                const chart = _.first(overrides) || chartOriginal;\r\n                if (DEBUG) console.log(chart);\r\n                let topPlace = 1;\r\n                const occuredNicknames = [];\r\n                const results = chart.results.map((res, index) => {\r\n                  const isSecondOccurenceInResults = occuredNicknames.includes(res.nickname);\r\n                  occuredNicknames.push(res.nickname);\r\n                  if (index === 0) {\r\n                    topPlace = 1;\r\n                  } else if (\r\n                    !isSecondOccurenceInResults &&\r\n                    res.score !== _.get([index - 1, 'score'], chart.results)\r\n                  ) {\r\n                    topPlace += 1;\r\n                  }\r\n                  return {\r\n                    ...res,\r\n                    topPlace,\r\n                    isSecondOccurenceInResults,\r\n                  };\r\n                });\r\n                const interpolatedDifficulty =\r\n                  sharedCharts[chart.sharedChartId] &&\r\n                  sharedCharts[chart.sharedChartId].interpolatedDifficulty;\r\n                return (\r\n                  <div className=\"song-block\" key={chart.sharedChartId}>\r\n                    <div className=\"song-name\">\r\n                      <div\r\n                        className={classNames('chart-name', {\r\n                          single: chart.chartType === 'S',\r\n                          singlep: chart.chartType === 'SP',\r\n                          doublep: chart.chartType === 'DP',\r\n                          double: chart.chartType === 'D',\r\n                          coop: chart.chartType === 'COOP',\r\n                        })}\r\n                      >\r\n                        <span className=\"chart-letter\">{chart.chartType}</span>\r\n                        <span className=\"chart-number\">{chart.chartLevel}</span>\r\n                      </div>\r\n                      <div>\r\n                        {chart.song}{' '}\r\n                        <span className=\"_grey-text\">\r\n                          ({interpolatedDifficulty && interpolatedDifficulty.toFixed(2)})\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"youtube-link\">\r\n                        <a\r\n                          href={`https://youtube.com/results?search_query=${chart.song\r\n                            .replace(/ /g, '+')\r\n                            .replace(/-/g, '')}+${chart.chartLabel}`}\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                        >\r\n                          <FaYoutube />\r\n                        </a>\r\n                      </div>\r\n                      <div className=\"_flex-fill\" />\r\n                      {(() => {\r\n                        const isActive = !_.isEmpty(overrides);\r\n                        const currentIndex = isActive\r\n                          ? 1 + chart.totalResultsCount - _.size(overrides)\r\n                          : chart.totalResultsCount;\r\n                        const canUndo = !(currentIndex === 1 && chart.totalResultsCount === 1);\r\n                        return (\r\n                          <div\r\n                            className={classNames('undo-result-button', {\r\n                              active: isActive,\r\n                            })}\r\n                          >\r\n                            <FaBackward\r\n                              className={classNames('backward-btn', { disabled: !canUndo })}\r\n                              onClick={() => canUndo && this.onUndoLatestResult(chart)}\r\n                            />\r\n                            <span className=\"number\">\r\n                              {currentIndex}/{chart.totalResultsCount}\r\n                            </span>\r\n                            <FaForward\r\n                              className={classNames('forward-btn', { disabled: !isActive })}\r\n                              onClick={() => isActive && this.onRedoLatestResult(chart)}\r\n                            />\r\n                          </div>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                    <div className=\"charts\">\r\n                      {!_.isEmpty(results) && (\r\n                        <div className=\"chart\">\r\n                          <div className=\"results\">\r\n                            <table>\r\n                              {chartIndex === 0 && (\r\n                                <thead>\r\n                                  <tr>\r\n                                    <th className=\"place\"></th>\r\n                                    <th className=\"nickname\"></th>\r\n                                    <th className=\"judge\"></th>\r\n                                    <th className=\"score\">score</th>\r\n                                    <th className=\"grade\"></th>\r\n                                    <th className=\"number\">miss</th>\r\n                                    <th className=\"number\">bad</th>\r\n                                    <th className=\"number\">good</th>\r\n                                    <th className=\"number\">great</th>\r\n                                    <th className=\"number\">perfect</th>\r\n                                    <th className=\"combo\">combo</th>\r\n                                    <th className=\"accuracy\">accuracy</th>\r\n                                    <th className=\"date\"></th>\r\n                                  </tr>\r\n                                </thead>\r\n                              )}\r\n                              <FlipMove\r\n                                enterAnimation=\"fade\"\r\n                                leaveAnimation=\"fade\"\r\n                                typeName=\"tbody\"\r\n                                maintainContainerHeight\r\n                                duration={ANIMATION_DURATION}\r\n                              >\r\n                                {results.map((res, index) => {\r\n                                  if (res.isUnknownPlayer && index !== 0) {\r\n                                    return null;\r\n                                  }\r\n                                  const nameIndex = uniqueSelectedNames.indexOf(res.nickname);\r\n                                  let placeDifference, newIndex;\r\n                                  if (res.scoreIncrease && res.date === chart.latestScoreDate) {\r\n                                    const prevScore = res.score - res.scoreIncrease;\r\n                                    newIndex = _.findLastIndex(\r\n                                      res => res.score > prevScore,\r\n                                      results\r\n                                    );\r\n                                    placeDifference = newIndex - index;\r\n                                  }\r\n                                  const inf = resultInfo[res.id] || {};\r\n                                  return (\r\n                                    <tr\r\n                                      key={res.isRank + '_' + res.nickname}\r\n                                      className={classNames({\r\n                                        empty: !res.isExactDate,\r\n                                        latest: res.date === chart.latestScoreDate,\r\n                                      })}\r\n                                    >\r\n                                      <td className=\"place\">\r\n                                        {res.isSecondOccurenceInResults ? '' : `#${res.topPlace}`}\r\n                                      </td>\r\n                                      <td\r\n                                        className=\"nickname\"\r\n                                        style={\r\n                                          nameIndex > -1\r\n                                            ? { fontWeight: 'bold', color: colorsArray[nameIndex] }\r\n                                            : {}\r\n                                        }\r\n                                      >\r\n                                        {res.nickname}\r\n                                        {!!placeDifference && (\r\n                                          <span className=\"change-holder up\">\r\n                                            <span>{placeDifference}</span>\r\n                                            <FaAngleDoubleUp />\r\n                                          </span>\r\n                                        )}\r\n                                        {/* {res.pp && DEBUG && (\r\n                                          <span className=\"debug-elo-info\">\r\n                                            {' '}\r\n                                            {res.pp.ppFixed}pp\r\n                                          </span>\r\n                                        )} */}\r\n                                        {inf.pp &&\r\n                                        (sortingType === SORT.RANK_DESC ||\r\n                                          sortingType === SORT.RANK_ASC) &&\r\n                                        res.nickname === protagonistName ? (\r\n                                          <span> ({inf.pp.ppFixed}pp)</span>\r\n                                        ) : (\r\n                                          inf.pp && (\r\n                                            <span className=\"debug-elo-info\">\r\n                                              {' '}\r\n                                              {inf.pp.ppFixed}pp\r\n                                            </span>\r\n                                          )\r\n                                        )}\r\n                                      </td>\r\n                                      <td\r\n                                        className={classNames('judge', {\r\n                                          vj: res.isRank,\r\n                                          hj: res.isHJ,\r\n                                        })}\r\n                                      >\r\n                                        {res.isRank && (\r\n                                          <div className=\"inner\">\r\n                                            {res.isExactDate ? (\r\n                                              'VJ'\r\n                                            ) : (\r\n                                              <Tooltip\r\n                                                content={\r\n                                                  <div>\r\n                                                    наличие ранка на этом результате было угадано,\r\n                                                    основываясь на скоре\r\n                                                  </div>\r\n                                                }\r\n                                                tooltipClassName=\"pumpking-tooltip\"\r\n                                              >\r\n                                                VJ?\r\n                                              </Tooltip>\r\n                                            )}\r\n                                          </div>\r\n                                        )}\r\n                                        {res.isHJ && <div className=\"inner\">HJ</div>}\r\n                                      </td>\r\n                                      <td className=\"score\">\r\n                                        <Overlay\r\n                                          overlayClassName=\"score-overlay-outer\"\r\n                                          overlayItem={\r\n                                            <span className=\"score-span\">\r\n                                              {/* {res.scoreIncrease > res.score * 0.8 && <FaPlus />} */}\r\n                                              {res.scoreIncrease > res.score * 0.8 && '*'}\r\n                                              {numeral(res.score).format('0,0')}\r\n                                            </span>\r\n                                          }\r\n                                          placement=\"top\"\r\n                                        >\r\n                                          <div className=\"score-overlay\">\r\n                                            {DEBUG && (\r\n                                              <>\r\n                                                <div>\r\n                                                  <span className=\"_grey\">result id: </span>\r\n                                                  {res.id}\r\n                                                </div>\r\n                                                <div>\r\n                                                  <span className=\"_grey\">player id: </span>\r\n                                                  {res.playerId}\r\n                                                </div>\r\n                                              </>\r\n                                            )}\r\n                                            <div>\r\n                                              <span className=\"_grey\">игрок: </span>\r\n                                              <NavLink\r\n                                                exact\r\n                                                to={routes.profile.getPath({ id: res.playerId })}\r\n                                              >\r\n                                                {res.nickname} ({res.nicknameArcade})\r\n                                              </NavLink>\r\n                                            </div>\r\n                                            {!!getExp(res, chart) && (\r\n                                              <div className=\"important\">\r\n                                                <span className=\"_grey\">опыт: </span>+\r\n                                                {numeral(getExp(res, chart)).format('0,0')}\r\n                                              </div>\r\n                                            )}\r\n                                            {inf.pp && (\r\n                                              <div className=\"important\">\r\n                                                <span className=\"_grey\">pp: </span>\r\n                                                <span>{inf.pp.ppFixed}pp</span>\r\n                                              </div>\r\n                                            )}\r\n                                            {!res.isExactDate && (\r\n                                              <div className=\"warning\">\r\n                                                <FaExclamationTriangle />\r\n                                                рекорд взят с my best. часть данных недоступна\r\n                                              </div>\r\n                                            )}\r\n                                            {!!res.isExactDate && (\r\n                                              <>\r\n                                                {!!res.mods && (\r\n                                                  <div>\r\n                                                    <span className=\"_grey\">моды: </span>\r\n                                                    {res.mods}\r\n                                                  </div>\r\n                                                )}\r\n                                                {!!res.calories && (\r\n                                                  <div>\r\n                                                    <span className=\"_grey\">ккал: </span>\r\n                                                    {res.calories}\r\n                                                  </div>\r\n                                                )}\r\n                                                {!!res.scoreIncrease && (\r\n                                                  <div>\r\n                                                    <span className=\"_grey\">прирост: </span>+\r\n                                                    {numeral(res.scoreIncrease).format('0,0')}\r\n                                                  </div>\r\n                                                )}\r\n                                                {res.originalChartMix && (\r\n                                                  <div>\r\n                                                    <div className=\"warning\">\r\n                                                      <FaExclamationTriangle />\r\n                                                      было сыграно на {res.originalChartMix}\r\n                                                    </div>\r\n                                                    {res.originalChartLabel && (\r\n                                                      <div>\r\n                                                        <span className=\"_grey\">\r\n                                                          оригинальный чарт:{' '}\r\n                                                        </span>\r\n                                                        {res.originalChartLabel}\r\n                                                      </div>\r\n                                                    )}\r\n                                                    {res.originalScore && (\r\n                                                      <div>\r\n                                                        <span className=\"_grey\">\r\n                                                          оригинальный скор:{' '}\r\n                                                        </span>\r\n                                                        {res.originalScore}\r\n                                                      </div>\r\n                                                    )}\r\n                                                  </div>\r\n                                                )}\r\n                                                {res.scoreIncrease > res.score * 0.8 && '* сайтрид'}\r\n                                              </>\r\n                                            )}\r\n                                          </div>\r\n                                        </Overlay>\r\n                                      </td>\r\n                                      <td className=\"grade\">\r\n                                        <div className=\"img-holder\">\r\n                                          {res.grade && res.grade !== '?' && (\r\n                                            <img\r\n                                              src={`${process.env.PUBLIC_URL}/grades/${res.grade}.png`}\r\n                                              alt={res.grade}\r\n                                            />\r\n                                          )}\r\n                                          {res.grade === '?' && null}\r\n                                        </div>\r\n                                      </td>\r\n                                      <td className=\"number miss\">{res.miss}</td>\r\n                                      <td className=\"number bad\">{res.bad}</td>\r\n                                      <td className=\"number good\">{res.good}</td>\r\n                                      <td className=\"number great\">{res.great}</td>\r\n                                      <td className=\"number perfect\">{res.perfect}</td>\r\n                                      <td className=\"combo\">\r\n                                        {res.combo}\r\n                                        {res.combo ? 'x' : ''}\r\n                                      </td>\r\n                                      <td className=\"accuracy\">\r\n                                        {res.accuracy}\r\n                                        {res.accuracy ? '%' : ''}\r\n                                      </td>\r\n                                      <td\r\n                                        className={classNames('date', {\r\n                                          latest: res.date === chart.latestScoreDate,\r\n                                        })}\r\n                                      >\r\n                                        <Tooltip\r\n                                          content={tooltipFormatter(res)}\r\n                                          tooltipClassName=\"pumpking-tooltip\"\r\n                                        >\r\n                                          {getTimeAgo(res.dateObject)}\r\n                                          {res.isExactDate ? '' : '?'}\r\n                                        </Tooltip>\r\n                                      </td>\r\n                                    </tr>\r\n                                  );\r\n                                })}\r\n                              </FlipMove>\r\n                            </table>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            {!isLoading && canShowMore && (\r\n              <button\r\n                className=\"btn btn-sm btn-primary\"\r\n                onClick={() =>\r\n                  this.setState(state => ({ showItemsCount: state.showItemsCount + 10 }))\r\n                }\r\n              >\r\n                show more...\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Leaderboard);\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\n// import numeral from 'numeral';\r\nimport classNames from 'classnames';\r\nimport { GiQueenCrown } from 'react-icons/gi';\r\nimport { FaAngleDoubleUp, FaAngleDoubleDown } from 'react-icons/fa';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nimport { routes } from 'constants/routes';\r\n\r\nimport Loader from 'components/Shared/Loader';\r\n\r\nimport { getRankImg } from 'utils/exp';\r\n\r\nconst getGradeImg = grade => (\r\n  <img src={`${process.env.PUBLIC_URL}/grades/${grade}.png`} alt={grade} />\r\n);\r\n\r\nexport default function RankingList({ ranking, isLoading }) {\r\n  return (\r\n    <div className=\"ranking-list\">\r\n      {_.isEmpty(ranking) && !isLoading && 'ничего не найдено'}\r\n      {isLoading && <Loader />}\r\n      {!isLoading && (\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th className=\"place\"></th>\r\n              <th className=\"change\"></th>\r\n              <th className=\"exp-rank\">rank</th>\r\n              <th className=\"name\">name</th>\r\n              <th className=\"name2\">piu name</th>\r\n              <th className=\"rating\">pp</th>\r\n              <th className=\"rating-change-cell\"></th>\r\n              {/* <th className=\"total-score\">total score</th> */}\r\n              <th className=\"grades sss\">{getGradeImg('SSS')}</th>\r\n              <th className=\"grades ss\">{getGradeImg('SS')}</th>\r\n              <th className=\"grades s\">{getGradeImg('S')}</th>\r\n              <th className=\"grades a\">{getGradeImg('A+')}</th>\r\n              <th className=\"grades b\">{getGradeImg('B')}</th>\r\n              <th className=\"grades c\">{getGradeImg('C')}</th>\r\n              <th className=\"grades d\">{getGradeImg('D')}</th>\r\n              <th className=\"grades f\">{getGradeImg('F')}</th>\r\n              <th className=\"playcount\">scores</th>\r\n              {/* <th className=\"calories\">kcal</th> */}\r\n              <th className=\"accuracy\">accuracy</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {ranking.map((player, playerIndex) => {\r\n              return (\r\n                <tr className=\"player\" key={player.name}>\r\n                  <td className=\"place\">\r\n                    {playerIndex === 0 ? <GiQueenCrown /> : `#${playerIndex + 1}`}\r\n                  </td>\r\n                  <td className=\"change\">\r\n                    {player.change > 0 && (\r\n                      <div className=\"change-holder up\">\r\n                        <span>{player.change}</span>\r\n                        <FaAngleDoubleUp />\r\n                      </div>\r\n                    )}\r\n                    {player.change < 0 && (\r\n                      <div className=\"change-holder down\">\r\n                        <span>{-player.change}</span>\r\n                        <FaAngleDoubleDown />\r\n                      </div>\r\n                    )}\r\n                    {!!player.change && _.isString(player.change) && (\r\n                      <div className=\"change-holder text\">\r\n                        <span>{player.change}</span>\r\n                      </div>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"exp-rank\">{getRankImg(player.expRank)}</td>\r\n                  <td className=\"name\">\r\n                    <NavLink exact to={routes.profile.getPath({ id: player.id })}>\r\n                      {player.name}\r\n                    </NavLink>\r\n                  </td>\r\n                  <td className=\"name\">\r\n                    <NavLink exact to={routes.profile.getPath({ id: player.id })}>\r\n                      {player.nameArcade}\r\n                    </NavLink>\r\n                  </td>\r\n                  <td className=\"rating\">{Math.round(player.pp.pp)}</td>\r\n                  <td className=\"rating-change-cell\">\r\n                    {!!player.prevRating && player.prevRating !== player.rating && (\r\n                      <span\r\n                        className={classNames('rating-change', {\r\n                          down: player.prevRating > player.rating,\r\n                          up: player.prevRating < player.rating,\r\n                        })}\r\n                      >\r\n                        {player.prevRating < player.rating ? '+' : ''}\r\n                        {player.rating - player.prevRating}\r\n                      </span>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"grades sss\">{player.grades.SSS}</td>\r\n                  <td className=\"grades ss\">{player.grades.SS}</td>\r\n                  <td className=\"grades s\">{player.grades.S}</td>\r\n                  <td className=\"grades a\">{player.grades.A}</td>\r\n                  <td className=\"grades b\">{player.grades.B}</td>\r\n                  <td className=\"grades c\">{player.grades.C}</td>\r\n                  <td className=\"grades d\">{player.grades.D}</td>\r\n                  <td className=\"grades f\">{player.grades.F}</td>\r\n                  <td className=\"playcount\">{player.count}</td>\r\n                  <td className=\"accuracy\">\r\n                    {player.accuracy ? `${player.accuracy.toFixed(2)}%` : ''}\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function RankingFaq() {\r\n  return (\r\n    <div className=\"faq\">\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Как считается рейтинг?</div>\r\n        <div className=\"answer\">\r\n          A: Используется <a href=\"https://en.wikipedia.org/wiki/Elo_rating_system\">рейтинг Эло</a>,\r\n          широко используемый в шахматах и других играх, слегка модицированный под условия игры на\r\n          пампе. Средний рейтинг - 1000. Коэффициент К зависит от уровня чарта (более сложные чарты\r\n          сильнее влияют на рейтинг). Количество очков влияет на заработанный рейтинг (маленький\r\n          отрыв от противника не даст так много очков как большой отрыв).\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Система Эло используется для игр 1 на 1, как она используется на пампе, где на одном\r\n          чарте играет много игроков?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: Рекорды на одном чарте делятся на несколько игр 1 на 1. Если есть 3 игрока: A, B, C; то\r\n          считается, что было 3 отдельные игры: A vs B, A vs C, B vs C.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Учитываются ли рекорды на ранке в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: Да. Как минимум потому что у нас есть много рекордов, взятых с машин бестов, и мы не\r\n          знаем наверняка, на ранке они или нет. Если у игрока в топе есть два скора - на ранке и\r\n          без ранка, используется тот, где больше очков.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Почему меня нет в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: В таблицу попадают только те, у кого есть хотя бы 20 игр 1 на 1. Первые 20 игр\r\n          используются для определения изначального рейтинга.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Почему суммарное количество оценок S-A-B не совпадает с общим количеством скоров?\r\n        </div>\r\n        <div className=\"answer\">A: Не для каждого результата известна оценка.</div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Если у меня есть несколько рекордов на А, несколько на А+, как считается суммарное\r\n          количество грейдов в таблице?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: В каждой колонке учитываются обе буквы - и треснутые, и с удержанным лайфом. То есть и\r\n          А, и А+ идут в колонку А. Точно так же для B, C, D.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Убери аккураси из таблицы!</div>\r\n        <div className=\"answer\">A: Грем, это секция для вопросов.</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch, FaQuestionCircle } from 'react-icons/fa';\r\nimport { Link, Route, withRouter } from 'react-router-dom';\r\nimport { createSelector } from 'reselect';\r\nimport _ from 'lodash/fp';\r\n\r\n// styles\r\nimport './ranking.scss';\r\n\r\n// components\r\nimport RankingList from './RankingList';\r\nimport RankingFaq from './RankingFaq';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\n\r\n// reducers\r\nimport { fetchResults } from 'reducers/results';\r\n\r\n// utils\r\n\r\n// code\r\nconst rankingSelector = createSelector(\r\n  state => state.results.profiles,\r\n  _.flow(\r\n    _.values,\r\n    _.remove(profile => !profile.pp),\r\n    _.orderBy(['pp.pp'], ['desc'])\r\n  )\r\n);\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    ranking: rankingSelector(state),\r\n    error: state.results.error || state.tracklist.error,\r\n    isLoading:\r\n      state.results.isLoading || state.results.isLoadingRanking || state.tracklist.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n};\r\n\r\nclass Ranking extends Component {\r\n  static propTypes = {\r\n    ranking: toBe.array,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    ranking: [],\r\n  };\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchResults();\r\n  };\r\n\r\n  render() {\r\n    const { isLoading, ranking, error } = this.props;\r\n\r\n    return (\r\n      <div className=\"ranking-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.path}\r\n              render={() => (\r\n                <>\r\n                  <Link to={routes.ranking.faq.path}>\r\n                    <button className=\"btn btn-sm btn-dark btn-icon _margin-right\">\r\n                      <FaQuestionCircle /> faq\r\n                    </button>\r\n                  </Link>\r\n                  <button\r\n                    disabled={isLoading}\r\n                    className=\"btn btn-sm btn-dark btn-icon\"\r\n                    onClick={this.onRefresh}\r\n                  >\r\n                    <FaSearch /> обновить\r\n                  </button>\r\n                </>\r\n              )}\r\n            />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.faq.path}\r\n              render={() => (\r\n                <Link to={routes.ranking.path}>\r\n                  <button className=\"btn btn-sm btn-dark btn-icon\">назад</button>\r\n                </Link>\r\n              )}\r\n            />\r\n          </div>\r\n          <Route\r\n            exact\r\n            path={routes.ranking.path}\r\n            render={() => <RankingList ranking={ranking} isLoading={isLoading} />}\r\n          />\r\n          <Route exact path={routes.ranking.faq.path} component={RankingFaq} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(Ranking));\r\n","import React, { useState, useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash/fp';\r\nimport { FaPlay } from 'react-icons/fa';\r\nimport { MdExpandMore } from 'react-icons/md';\r\n\r\nimport { fetchJson } from 'utils/fetch';\r\nimport { getTimeAgo } from 'utils/leaderboards';\r\nimport { parseDate } from 'utils/date';\r\n\r\nimport Loader from 'components/Shared/Loader';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nimport './most-played.scss';\r\n\r\nexport default connect(\r\n  state => ({ charts: state.results.sharedCharts }),\r\n  { fetchJson }\r\n)(({ playerId, charts, fetchJson }) => {\r\n  const [isLoading, setLoading] = useState(false);\r\n  const [limit, setLimit] = useState(10);\r\n  const [data, setData] = useState([]);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    fetchJson({\r\n      url: `${HOST}/player/${playerId}/mostPlayed?limit=${limit}`,\r\n    })\r\n      .then(result => {\r\n        setLoading(false);\r\n        if (result.success) {\r\n          setData(result.data);\r\n        }\r\n      })\r\n      .catch(() => {\r\n        setLoading(false);\r\n      });\r\n  }, [playerId, limit, fetchJson]);\r\n\r\n  return (\r\n    <div className=\"most-played\">\r\n      {isLoading && <Loader />}\r\n      {data.map(item => {\r\n        const chart = charts[item.shared_chart];\r\n        return (\r\n          <div className=\"chart\" key={item.shared_chart}>\r\n            <div\r\n              className={classNames('chart-name', {\r\n                single: chart.chartType === 'S',\r\n                singlep: chart.chartType === 'SP',\r\n                doublep: chart.chartType === 'DP',\r\n                double: chart.chartType === 'D',\r\n                coop: chart.chartType === 'COOP',\r\n              })}\r\n            >\r\n              <span className=\"chart-letter\">{chart.chartType}</span>\r\n              <span className=\"chart-number\">{chart.chartLevel}</span>\r\n            </div>\r\n            <div className=\"song-name\">{chart.song}</div>\r\n            <div className=\"date\">\r\n              {item.latestDate ? getTimeAgo(parseDate(item.latestDate)) : null}\r\n            </div>\r\n            <div className=\"playcount\">\r\n              <FaPlay />\r\n              <span>{item.count}</span>\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n      {limit === _.size(data) && (\r\n        <button\r\n          className=\"show-more btn btn-sm btn-dark btn-icon\"\r\n          onClick={() => setLimit(limit + 10)}\r\n        >\r\n          <MdExpandMore /> больше\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\n","import React from 'react';\r\n\r\nimport { ranks, getRankImg } from 'utils/exp';\r\n\r\nexport default function ExpFaq() {\r\n  return (\r\n    <div className=\"faq-exp\">\r\n      <div className=\"faq-header\">\r\n        <strong>Опыт</strong> игрока основывается на количестве сыгранных песен и чартов.\r\n        <br />\r\n        Чем выше уровень чарта и чем лучше оценка на чарте, тем больше опыта он даёт.\r\n        <br />\r\n        Повторные попытки на тех же чартах не дают больше опыта. Чтобы поднимать свой уровень, играй\r\n        новые треки и чарты.\r\n      </div>\r\n      <div className=\"faq-header\">Список уровней и необходимый опыт для их получения:</div>\r\n      <div className=\"ranks-list\">\r\n        {ranks.map(rank => (\r\n          <div key={rank.threshold} className=\"rank\">\r\n            <div className=\"exp-rank\">{getRankImg(rank)}</div>\r\n            <div className=\"threshold\">{rank.threshold}</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","const SET_FILTER = `PROFILES/SET_FILTER`;\r\nconst RESET_FILTER = `PROFILES/RESET_FILTER`;\r\n\r\nexport const defaultFilter = {};\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  filter: defaultFilter,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case SET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: action.filter,\r\n      };\r\n    case RESET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: defaultFilter,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const setProfilesFilter = filter => ({\r\n  type: SET_FILTER,\r\n  filter,\r\n});\r\n\r\nexport const resetProfilesFilter = () => ({\r\n  type: RESET_FILTER,\r\n});\r\n","import _ from 'lodash/fp';\r\nimport { createSelector } from 'reselect';\r\n\r\nconst defaultGradesDistribution = {\r\n  SSS: 0,\r\n  SS: 0,\r\n  S: 0,\r\n  'A+': 0,\r\n  A: 0,\r\n  B: 0,\r\n  C: 0,\r\n  D: 0,\r\n  F: 0,\r\n};\r\nconst defaultGradesWithLevelsDistribution = _.flow(\r\n  _.flatMap(type => {\r\n    return _.flow(\r\n      _.toPairs,\r\n      _.map(([grade, value]) => [`${type}-${grade}`, value])\r\n    )(defaultGradesDistribution);\r\n  }),\r\n  _.fromPairs\r\n)(['S', 'D']);\r\n\r\nexport const profileSelectorCreator = idParamName =>\r\n  createSelector(\r\n    (state, props) => _.toInteger(props.match.params[idParamName]),\r\n    state => state.results.isLoading || state.results.isLoadingRanking,\r\n    state => state.results.profiles,\r\n    state => state.profiles.filter,\r\n    state => state.tracklist.data,\r\n    (id, isLoading, profiles, filter, tracklist) => {\r\n      const profile = profiles[id];\r\n      if (_.isEmpty(profile) || isLoading) {\r\n        return null;\r\n      }\r\n      const levelsDistribution = _.flow(\r\n        _.get('resultsByLevel'),\r\n        _.toPairs,\r\n        _.map(([x, y]) => ({\r\n          x: _.toInteger(x),\r\n          S:\r\n            (_.size(\r\n              _.filter(res => res.chart.chartType === 'S' || res.chart.chartType === 'SP', y)\r\n            ) /\r\n              tracklist.singlesLevels[x]) *\r\n            100,\r\n          D:\r\n            (-_.size(\r\n              _.filter(res => res.chart.chartType === 'D' || res.chart.chartType === 'DP', y)\r\n            ) /\r\n              tracklist.doublesLevels[x]) *\r\n            100,\r\n        }))\r\n      )(profile);\r\n      const gradesData = _.flow(\r\n        _.get('resultsByLevel'),\r\n        _.toPairs,\r\n        _.map(\r\n          _.update('[1].result.grade', grade =>\r\n            grade && grade.includes('+') && grade !== 'A+' ? grade.replace('+', '') : grade\r\n          )\r\n        )\r\n      )(profile);\r\n      const gradesDistribution = _.flow(\r\n        _.map(([x, y]) => ({\r\n          x: _.toInteger(x),\r\n          ...defaultGradesDistribution,\r\n          ..._.omit('?', _.mapValues(_.size, _.groupBy('result.grade', y))),\r\n        })),\r\n        _.map(item => {\r\n          const grades = _.pick(Object.keys(defaultGradesDistribution), item);\r\n          const sum = _.sum(_.values(grades));\r\n          return {\r\n            ...item,\r\n            gradesValues: grades,\r\n            ...(sum === 0 ? grades : _.mapValues(value => (100 * value) / sum, grades)),\r\n          };\r\n        })\r\n      )(gradesData);\r\n      const gradesAndLevelsDistribution = _.flow(\r\n        _.map(([x, y]) => {\r\n          const groupedResults = _.groupBy('result.grade', y);\r\n          const counts = _.omit(\r\n            '?',\r\n            _.mapValues(\r\n              _.countBy(res => {\r\n                return res.chart.chartType === 'S' || res.chart.chartType === 'SP'\r\n                  ? 'S'\r\n                  : res.chart.chartType === 'D' || res.chart.chartType === 'DP'\r\n                  ? 'D'\r\n                  : 'Other';\r\n              }),\r\n              groupedResults\r\n            )\r\n          );\r\n          const reduced = _.reduce(\r\n            (acc, [grade, levelsData]) => {\r\n              const accData = _.flow(\r\n                _.toPairs,\r\n                _.map(([type, count]) => [\r\n                  `${type}-${grade}`,\r\n                  type === 'S'\r\n                    ? (count / tracklist.singlesLevels[x]) * 100\r\n                    : (-count / tracklist.doublesLevels[x]) * 100,\r\n                ]),\r\n                _.fromPairs\r\n              )(levelsData);\r\n              return { ...acc, ...accData };\r\n            },\r\n            {},\r\n            _.toPairs(counts)\r\n          );\r\n\r\n          return {\r\n            x: _.toInteger(x),\r\n            ...defaultGradesWithLevelsDistribution,\r\n            ...reduced,\r\n          };\r\n        })\r\n      )(gradesData);\r\n      const rank = 1 + _.findIndex({ id }, _.orderBy(['ratingRaw'], ['desc'], _.values(profiles)));\r\n\r\n      return {\r\n        ...profile,\r\n        rank,\r\n        levelsDistribution,\r\n        gradesDistribution,\r\n        gradesAndLevelsDistribution,\r\n      };\r\n    }\r\n  );\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch, FaQuestionCircle, FaTimes } from 'react-icons/fa';\r\nimport { withRouter } from 'react-router-dom';\r\nimport classNames from 'classnames';\r\nimport ReactModal from 'react-modal';\r\nimport Tooltip from 'react-responsive-ui/modules/Tooltip';\r\nimport Select from 'react-select';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  LineChart,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip as RechartsTooltip,\r\n  ReferenceLine,\r\n  CartesianGrid,\r\n  Line,\r\n  Legend,\r\n  ResponsiveContainer,\r\n  Label,\r\n} from 'recharts';\r\nimport _ from 'lodash/fp';\r\nimport { createSelector } from 'reselect';\r\n\r\n// styles\r\nimport './profile.scss';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\nimport { DEBUG } from 'constants/env';\r\n\r\n// components\r\nimport Loader from 'components/Shared/Loader';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\nimport MostPlayed from './MostPlayed';\r\nimport ExpFaq from './ExpFaq';\r\n\r\n// reducers\r\nimport { fetchResults } from 'reducers/results';\r\nimport { setProfilesFilter, resetProfilesFilter } from 'reducers/profiles';\r\n\r\n// utils\r\nimport { profileSelectorCreator } from 'utils/profiles';\r\nimport { parseDate } from 'utils/date';\r\nimport { getTimeAgo } from 'utils/leaderboards';\r\nimport { achievements } from 'utils/achievements';\r\nimport { getRankImg } from 'utils/exp';\r\n\r\n// code\r\nconst MIN_GRAPH_HEIGHT = undefined;\r\n\r\nconst profileSelector = profileSelectorCreator('id');\r\n\r\nexport const otherPlayersSelector = createSelector(\r\n  state => state.results.players,\r\n  (state, props) => _.toNumber(props.match.params.id),\r\n  (players, id) =>\r\n    _.flow(\r\n      _.toPairs,\r\n      _.map(([ind, { nickname, arcade_name, id }]) => ({\r\n        label: `${nickname} (${arcade_name})`,\r\n        value: nickname,\r\n        id: _.toNumber(id),\r\n      })),\r\n      _.remove(it => it.id === id),\r\n      _.sortBy(it => _.toLower(it.label))\r\n    )(players)\r\n);\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    profile: profileSelector(state, props),\r\n    otherPlayers: otherPlayersSelector(state, props),\r\n    tracklist: state.tracklist.data,\r\n    filter: state.profiles.filter,\r\n    error: state.results.error || state.tracklist.error,\r\n    isLoading:\r\n      state.results.isLoading || state.results.isLoadingRanking || state.tracklist.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n  setProfilesFilter,\r\n  resetProfilesFilter,\r\n};\r\n\r\nclass Profile extends Component {\r\n  static propTypes = {\r\n    profile: toBe.object,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    profile: {},\r\n  };\r\n\r\n  state = {\r\n    isLevelGraphCombined: true,\r\n    showFaq: false,\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    this.props.resetProfilesFilter();\r\n  }\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchResults();\r\n  };\r\n\r\n  onChangeDayRange = range => {\r\n    const { filter } = this.props;\r\n    this.props.setProfilesFilter({\r\n      ...filter,\r\n      dayRange: range,\r\n    });\r\n  };\r\n\r\n  onShowFaq = () => {\r\n    this.setState({ showFaq: true });\r\n  };\r\n\r\n  onHideFaq = () => {\r\n    this.setState({ showFaq: false });\r\n  };\r\n\r\n  renderRankingHistory() {\r\n    // const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart\r\n          data={/*profile.ratingChanges*/ []}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"date\"\r\n            type=\"number\"\r\n            domain={['dataMin', 'dataMax']}\r\n            tickFormatter={value => parseDate(value).toLocaleDateString()}\r\n          />\r\n          <YAxis\r\n            allowDecimals={false}\r\n            domain={['dataMin - 100', 'dataMax + 100']}\r\n            tickFormatter={Math.round}\r\n            width={40}\r\n          />\r\n          <ReferenceLine y={1000} stroke=\"white\" />\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>{parseDate(payload[0].payload.date).toLocaleDateString()}</div>\r\n                  {payload && payload[0] && <div>Rating: {Math.round(payload[0].value)}</div>}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <Line\r\n            type=\"monotone\"\r\n            isAnimationActive={false}\r\n            dataKey=\"rating\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderPlaceHistory(q) {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart\r\n          data={q ? profile.accuracyPointsInterpolated : profile.accuracyPoints}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"[0]\"\r\n            type=\"number\"\r\n            domain={[1, 28]}\r\n            tickFormatter={value => Math.round(value)}\r\n          />\r\n          <YAxis\r\n            domain={[0, 100]}\r\n            // allowDecimals={false}\r\n            // domain={[1, dataMax => (dataMax < 3 ? dataMax + 2 : dataMax + 1)]}\r\n            // interval={0}\r\n            // reversed\r\n            width={40}\r\n          />\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>{payload[0].payload[0]}</div>\r\n                  {payload && payload[0] && <div>Acc: #{payload[0].value}</div>}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <Line\r\n            isAnimationActive={false}\r\n            // type=\"stepAfter\"\r\n            dataKey=\"[1]\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGrades() {\r\n    const { profile } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <BarChart\r\n          data={profile.gradesDistribution}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {_.filter(item => item.value > 0, payload).map(item => (\r\n                    <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                      {item.name}: {payload[0].payload.gradesValues[item.name]}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis\r\n            domain={[0, 100]}\r\n            ticks={[0, 50, 100]}\r\n            tickFormatter={x => `${Math.round(x)}%`}\r\n            width={40}\r\n          />\r\n          <Legend />\r\n          <Bar dataKey=\"SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"F\" fill=\"#774949\" stackId=\"stack\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGradesWithLevels() {\r\n    const { profile, tracklist } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={0.74}>\r\n        <BarChart\r\n          data={profile.gradesAndLevelsDistribution}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n          stackOffset=\"sign\"\r\n        >\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              const doubleItems = _.filter(\r\n                item => item.value !== 0 && item.dataKey.startsWith('D'),\r\n                payload\r\n              );\r\n              const singleItems = _.filter(\r\n                item => item.value !== 0 && item.dataKey.startsWith('S'),\r\n                payload\r\n              );\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {!!singleItems.length && (\r\n                    <>\r\n                      <div>Single:</div>\r\n                      {singleItems.map(item => (\r\n                        <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                          {item.name.slice(2)}: {Math.round(Math.abs(item.value))}% (\r\n                          {Math.round((tracklist.singlesLevels[item.payload.x] * item.value) / 100)}\r\n                          /{tracklist.singlesLevels[item.payload.x]})\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                  {!!doubleItems.length && (\r\n                    <>\r\n                      <div>Double:</div>\r\n                      {doubleItems.map(item => (\r\n                        <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n                          {item.name.slice(2)}: {Math.round(Math.abs(item.value))}% (\r\n                          {Math.round(\r\n                            (tracklist.doublesLevels[item.payload.x] * -item.value) / 100\r\n                          )}\r\n                          /{tracklist.doublesLevels[item.payload.x]})\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis\r\n            tickFormatter={x => `${Math.round(Math.abs(x))}%`}\r\n            width={40}\r\n            domain={[dataMin => Math.min(dataMin, -10), dataMax => Math.max(10, dataMax)]}\r\n          />\r\n          <Bar dataKey=\"S-SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S-F\" fill=\"#774949\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-SSS\" fill=\"#ffd700\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-SS\" fill=\"#dab800\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-S\" fill=\"#b19500\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-A+\" fill=\"#396eef\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-A\" fill=\"#828fb7\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-B\" fill=\"#7a6490\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-C\" fill=\"#6d5684\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-D\" fill=\"#5d4e6d\" stackId=\"stack\" />\r\n          <Bar dataKey=\"D-F\" fill=\"#774949\" stackId=\"stack\" />\r\n          <Label value=\"Double\" offset={0} position=\"insideBottomLeft\" />\r\n          <Label value=\"Single\" offset={0} position=\"insideTopLeft\" />\r\n          <ReferenceLine y={0} stroke=\"#bbb\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderLevels() {\r\n    const { profile, tracklist } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <BarChart\r\n          data={profile.levelsDistribution}\r\n          stackOffset=\"sign\"\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              const totalD = tracklist.doublesLevels[payload[0].payload.x];\r\n              const totalS = tracklist.singlesLevels[payload[0].payload.x];\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>Level: {payload[0].payload.x}</div>\r\n                  {totalS > 0 && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[1].color }}>\r\n                      Single: {Math.abs(payload[1].value).toFixed(1)}% (\r\n                      {Math.round((payload[1].value * totalS) / 100)}/{totalS})\r\n                    </div>\r\n                  )}\r\n                  {totalD > 0 && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[0].color }}>\r\n                      Double: {Math.abs(payload[0].value).toFixed(1)}% (\r\n                      {Math.round((Math.abs(payload[0].value) * totalD) / 100)}/{totalD})\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <XAxis dataKey=\"x\" />\r\n          <YAxis\r\n            tickFormatter={x => Math.round(Math.abs(x)) + '%'}\r\n            width={40}\r\n            domain={[dataMin => Math.min(dataMin, -10), dataMax => Math.max(10, dataMax)]}\r\n          />\r\n          <RechartsTooltip />\r\n          <ReferenceLine y={0} stroke=\"#555\" />\r\n          <Legend />\r\n          <Bar dataKey=\"D\" fill=\"#169c16\" stackId=\"stack\" />\r\n          <Bar dataKey=\"S\" fill=\"#af2928\" stackId=\"stack\" />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderGradeBlock(type, grade) {\r\n    const { profile } = this.props;\r\n    const obj = profile.progress[type];\r\n    const typeLetter = type === 'double' ? 'D' : 'S';\r\n    const progr = Math.floor((obj[`${grade}-bonus-level-coef`] || 0) * 100);\r\n    const minNumber = obj[`${grade}-bonus-level-min-number`];\r\n    const currentNumber = obj[`${grade}-bonus-level-achieved-number`];\r\n    const levelString = obj[`${grade}-bonus-level`]\r\n      ? `${typeLetter}${obj[`${grade}-bonus-level`]}`\r\n      : '?';\r\n    return (\r\n      <div className=\"grade-block\">\r\n        <div className=\"grade-letter\">\r\n          <img src={`${process.env.PUBLIC_URL}/grades/${grade}.png`} alt={grade} />\r\n        </div>\r\n        <div className=\"grade-level\">{levelString}</div>\r\n        <div className=\"grade-progress\">\r\n          {progr}% ({progr === 100 ? minNumber : currentNumber}/{minNumber})\r\n        </div>\r\n        <div\r\n          className={classNames('progress-background', {\r\n            complete: progr === 100,\r\n            zero: progr === 0,\r\n          })}\r\n          style={{\r\n            height: `${progr}%`,\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderAchievement(achName, achievement) {\r\n    const Icon = achievements[achName].icon;\r\n    const description = achievements[achName].description;\r\n    return (\r\n      <Tooltip\r\n        key={achName}\r\n        content={<div>{description}</div>}\r\n        tooltipClassName=\"pumpking-tooltip achievement-tooltip\"\r\n      >\r\n        <div className=\"ach-block\">\r\n          {Icon && (\r\n            <div className=\"ach-icon\">\r\n              <Icon />\r\n            </div>\r\n          )}\r\n          <div className=\"ach-name\">{achName}</div>\r\n          <div\r\n            className={classNames('progress-background', {\r\n              complete: achievement.progress === 100,\r\n              zero: achievement.progress === 0,\r\n            })}\r\n            style={{\r\n              height: `${Math.round(achievement.progress)}%`,\r\n            }}\r\n          />\r\n        </div>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  renderProfile() {\r\n    const { profile, otherPlayers } = this.props;\r\n    const { isLevelGraphCombined } = this.state;\r\n    const expProgress = profile.expRankNext\r\n      ? (profile.exp - profile.expRank.threshold) /\r\n        (profile.expRankNext.threshold - profile.expRank.threshold)\r\n      : 100;\r\n    return (\r\n      <div className=\"profile\">\r\n        <div className=\"profile-header\">\r\n          <div className=\"profile-name text-with-header\">\r\n            <div className=\"text-header\">игрок</div>\r\n            <div>{profile.name}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">ранк</div>\r\n            <div>#{profile.rank}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">pp</div>\r\n            <div>{profile.rating}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">последняя игра</div>\r\n            <div>{profile.lastResultDate ? getTimeAgo(profile.lastResultDate) : 'никогда'}</div>\r\n          </div>\r\n          <div className=\"_flex-fill\"></div>\r\n          <div className=\"text-with-header -select\">\r\n            <div className=\"text-header\">сравнить с</div>\r\n            <div>\r\n              <Select\r\n                closeMenuOnSelect\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                options={otherPlayers}\r\n                onChange={value => {\r\n                  this.props.history.push(\r\n                    routes.profile.compare.getPath({ id: profile.id, compareToId: value.id })\r\n                  );\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"profile-section\">\r\n          <div className=\"profile-sm-section-header _flex-row _align-center\">\r\n            <span>опыт</span>\r\n            <div className=\"_flex-fill\" />\r\n            <div onClick={this.onShowFaq} className=\"_clickable\">\r\n              <FaQuestionCircle onClick={this.onShowFaq} />\r\n            </div>\r\n            <ReactModal\r\n              ariaHideApp={false}\r\n              className=\"Modal faq-modal\"\r\n              overlayClassName=\"Overlay\"\r\n              isOpen={this.state.showFaq}\r\n              onRequestClose={this.onHideFaq}\r\n            >\r\n              <div className=\"close-btn\" onClick={this.onHideFaq}>\r\n                <FaTimes />\r\n              </div>{' '}\r\n              <ExpFaq />\r\n            </ReactModal>\r\n          </div>\r\n          <div className=\"exp-range\">\r\n            <div className=\"rank exp-rank\">\r\n              {getRankImg(profile.expRank)}\r\n              {profile.expRank && <div>{profile.expRank.threshold}</div>}\r\n            </div>\r\n            <div className=\"exp-line-with-label\">\r\n              <div className=\"exp-label\">\r\n                {profile.expRankNext ? (\r\n                  <>\r\n                    <span className=\"taken-num\">\r\n                      {Math.round(profile.exp - profile.expRank.threshold)}\r\n                    </span>\r\n                    {` / ${profile.expRankNext.threshold - profile.expRank.threshold}`}\r\n                  </>\r\n                ) : null}\r\n              </div>\r\n              <div className=\"exp-line\">\r\n                <div className=\"taken\" style={{ width: Math.floor(100 * expProgress) + '%' }}></div>\r\n                <div\r\n                  className=\"rest\"\r\n                  style={{ width: 100 - Math.ceil(100 * expProgress) + '%' }}\r\n                ></div>\r\n              </div>\r\n              <div className=\"exp-label\">\r\n                total: <span className=\"taken-num\">{Math.round(profile.exp)}</span>\r\n              </div>\r\n            </div>\r\n            {profile.expRankNext && (\r\n              <div className=\"rank exp-rank\">\r\n                {getRankImg(profile.expRankNext)}\r\n                {profile.expRankNext && <div>{profile.expRankNext.threshold}</div>}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"profile-section-horizontal-container\">\r\n          <div className=\"profile-section\">\r\n            <div className=\"profile-section-content\">\r\n              {!isLevelGraphCombined ? (\r\n                <>\r\n                  <div className=\"profile-section-2\">\r\n                    <div className=\"profile-sm-section-header flex\">\r\n                      <span>уровни</span>\r\n                      <div className=\"toggle-holder\">\r\n                        <Toggle\r\n                          className=\"combine-toggle\"\r\n                          checked={isLevelGraphCombined}\r\n                          onChange={() =>\r\n                            this.setState(state => ({\r\n                              isLevelGraphCombined: !state.isLevelGraphCombined,\r\n                            }))\r\n                          }\r\n                        >\r\n                          объединить графики\r\n                        </Toggle>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"chart-container\">{this.renderLevels()}</div>\r\n                  </div>\r\n                  <div className=\"profile-section-2\">\r\n                    <div className=\"profile-sm-section-header\">\r\n                      <span>оценки</span>\r\n                    </div>\r\n                    <div className=\"chart-container\">{this.renderGrades()}</div>\r\n                  </div>\r\n                </>\r\n              ) : (\r\n                <div className=\"profile-section-2\">\r\n                  <div className=\"profile-sm-section-header flex\">\r\n                    <span>оценки</span>\r\n                    <div className=\"toggle-holder\">\r\n                      <Toggle\r\n                        className=\"combine-toggle\"\r\n                        checked={isLevelGraphCombined}\r\n                        onChange={() =>\r\n                          this.setState(state => ({\r\n                            isLevelGraphCombined: !state.isLevelGraphCombined,\r\n                          }))\r\n                        }\r\n                      >\r\n                        объединить графики\r\n                      </Toggle>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"chart-container single-double-labels\">\r\n                    {this.renderGradesWithLevels()}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"profile-section\">\r\n            <div className=\"profile-section-content\">\r\n              <div className=\"profile-section-2\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>эло (временно отключено)</span>\r\n                  {this.renderPlaceHistory()}\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section-2\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>место в топе (временно отключено)</span>\r\n                  {this.renderPlaceHistory(1)}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"profile-section progress-section\">\r\n          <div className=\"profile-sm-section-header\">\r\n            <span>достижения по уровням</span>\r\n          </div>\r\n          <div className=\"progress-blocks-single-double\">\r\n            <div className=\"progress-block\">\r\n              <div className=\"achievements-grades single\">\r\n                {this.renderGradeBlock('single', 'A')}\r\n                {this.renderGradeBlock('single', 'A+')}\r\n                {this.renderGradeBlock('single', 'S')}\r\n                {this.renderGradeBlock('single', 'SS')}\r\n              </div>\r\n            </div>\r\n            <div className=\"progress-block\">\r\n              <div className=\"achievements-grades double\">\r\n                {this.renderGradeBlock('double', 'A')}\r\n                {this.renderGradeBlock('double', 'A+')}\r\n                {this.renderGradeBlock('double', 'S')}\r\n                {this.renderGradeBlock('double', 'SS')}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"bonus-faq\">\r\n            * для получения ачивки нужно сыграть около 10% всех чартов данного левела на нужный\r\n            грейд\r\n          </div>\r\n        </div>\r\n        <div className=\"profile-section\">\r\n          <div className=\"profile-sm-section-header\">\r\n            <span>достижения</span>\r\n          </div>\r\n          <div className=\"achievements\">\r\n            {_.keys(profile.achievements).map(achName =>\r\n              this.renderAchievement(achName, profile.achievements[achName])\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"profile-section\">\r\n          <div className=\"profile-sm-section-header\">\r\n            <span>часто играемые чарты</span>\r\n          </div>\r\n          <MostPlayed playerId={profile.id} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, profile, error } = this.props;\r\n    DEBUG && console.log('profile:', profile);\r\n    return (\r\n      <div className=\"profile-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            <button\r\n              disabled={isLoading}\r\n              className=\"btn btn-sm btn-dark btn-icon\"\r\n              onClick={this.onRefresh}\r\n            >\r\n              <FaSearch /> обновить\r\n            </button>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          {!isLoading && _.isEmpty(profile) && <div className=\"profile\">Profile not found</div>}\r\n          {!isLoading && !_.isEmpty(profile) && this.renderProfile()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(Profile));\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch } from 'react-icons/fa';\r\nimport { withRouter } from 'react-router-dom';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  LineChart,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip as RechartsTooltip,\r\n  ReferenceLine,\r\n  CartesianGrid,\r\n  Line,\r\n  ResponsiveContainer,\r\n} from 'recharts';\r\nimport _ from 'lodash/fp';\r\nimport memoize from 'lru-memoize';\r\n\r\n// styles\r\nimport './profile-compare.scss';\r\n\r\n// constants\r\nimport { DEBUG } from 'constants/env';\r\n\r\n// components\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\nimport Loader from 'components/Shared/Loader';\r\n\r\n// reducers\r\nimport { fetchResults } from 'reducers/results';\r\nimport { setProfilesFilter, resetProfilesFilter } from 'reducers/profiles';\r\n\r\n// utils\r\nimport { profileSelectorCreator } from 'utils/profiles';\r\nimport { parseDate } from 'utils/date';\r\nimport { getTimeAgo } from 'utils/leaderboards';\r\n\r\n// code\r\nconst BARS_MODES = {\r\n  SINGLE_TWO: 'SINGLE_TWO',\r\n  SINGLE_FIVE: 'SINGLE_FIVE',\r\n  DOUBLE_TWO: 'DOUBLE_TWO',\r\n  DOUBLE_FIVE: 'DOUBLE_FIVE',\r\n  BOTH_TWO: 'BOTH_TWO',\r\n  BOTH_FIVE: 'BOTH_FIVE',\r\n};\r\nconst getCompareBars = mode => {\r\n  switch (mode) {\r\n    case BARS_MODES.SINGLE_TWO:\r\n      return [\r\n        <Bar\r\n          key=\"11\"\r\n          dataKey=\"single.twoBars.p1win\"\r\n          fill=\"#4696f0\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar\r\n          key=\"22\"\r\n          dataKey=\"single.twoBars.p2win\"\r\n          fill=\"#eda338\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n      ];\r\n    case BARS_MODES.SINGLE_FIVE:\r\n      return [\r\n        <Bar key=\"1\" dataKey=\"single.p1win\" fill=\"#4696f0\" stackId=\"stack\" isAnimationActive />,\r\n        <Bar\r\n          key=\"2\"\r\n          dataKey=\"single.p2notPlayed\"\r\n          fill=\"#899db3\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar\r\n          key=\"3\"\r\n          dataKey=\"single.notPlayed\"\r\n          fill=\"#70707060\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar\r\n          key=\"4\"\r\n          dataKey=\"single.p1notPlayed\"\r\n          fill=\"#bfa988\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar key=\"5\" dataKey=\"single.p2win\" fill=\"#eda338\" stackId=\"stack\" isAnimationActive />,\r\n      ];\r\n    case BARS_MODES.DOUBLE_TWO:\r\n      return [\r\n        <Bar\r\n          key=\"11\"\r\n          dataKey=\"double.twoBars.p1win\"\r\n          fill=\"#4696f0\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar\r\n          key=\"22\"\r\n          dataKey=\"double.twoBars.p2win\"\r\n          fill=\"#eda338\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n      ];\r\n    case BARS_MODES.DOUBLE_FIVE:\r\n      return [\r\n        <Bar key=\"1\" dataKey=\"double.p1win\" fill=\"#4696f0\" stackId=\"stack\" isAnimationActive />,\r\n        <Bar\r\n          key=\"2\"\r\n          dataKey=\"double.p2notPlayed\"\r\n          fill=\"#899db3\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar\r\n          key=\"3\"\r\n          dataKey=\"double.notPlayed\"\r\n          fill=\"#70707060\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar\r\n          key=\"4\"\r\n          dataKey=\"double.p1notPlayed\"\r\n          fill=\"#bfa988\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar key=\"5\" dataKey=\"double.p2win\" fill=\"#eda338\" stackId=\"stack\" isAnimationActive />,\r\n      ];\r\n    case BARS_MODES.BOTH_TWO:\r\n      return [\r\n        <Bar\r\n          key=\"11\"\r\n          dataKey=\"all.twoBars.p1win\"\r\n          fill=\"#4696f0\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n        <Bar\r\n          key=\"22\"\r\n          dataKey=\"all.twoBars.p2win\"\r\n          fill=\"#eda338\"\r\n          stackId=\"stack\"\r\n          isAnimationActive\r\n        />,\r\n      ];\r\n    case BARS_MODES.BOTH_FIVE:\r\n      return [\r\n        <Bar key=\"1\" dataKey=\"all.p1win\" fill=\"#4696f0\" stackId=\"stack\" isAnimationActive />,\r\n        <Bar key=\"2\" dataKey=\"all.p2notPlayed\" fill=\"#899db3\" stackId=\"stack\" isAnimationActive />,\r\n        <Bar key=\"3\" dataKey=\"all.notPlayed\" fill=\"#70707060\" stackId=\"stack\" isAnimationActive />,\r\n        <Bar key=\"4\" dataKey=\"all.p1notPlayed\" fill=\"#bfa988\" stackId=\"stack\" isAnimationActive />,\r\n        <Bar key=\"5\" dataKey=\"all.p2win\" fill=\"#eda338\" stackId=\"stack\" isAnimationActive />,\r\n      ];\r\n    default:\r\n      return null;\r\n  }\r\n};\r\n\r\nconst MIN_GRAPH_HEIGHT = undefined;\r\n\r\nconst profile1Selector = profileSelectorCreator('id');\r\nconst profile2Selector = profileSelectorCreator('compareToId');\r\n\r\nconst getCombinedData = memoize()((p1, p2, tracklist) => {\r\n  if (!p1 || !p2) {\r\n    return {};\r\n  }\r\n\r\n  const perLevelComparison = _.fromPairs(Array.from({ length: 28 }).map((x, i) => [i + 1, {}]));\r\n  _.keys(perLevelComparison).forEach(level => {\r\n    const charts = _.flow(\r\n      _.map('chart'),\r\n      _.uniqBy('sharedChartId')\r\n    )([...p1.resultsByLevel[level], ...p2.resultsByLevel[level]]);\r\n    const data = {\r\n      x: level,\r\n      all: {\r\n        p1win: 0,\r\n        p1notPlayed: 0,\r\n        p2win: 0,\r\n        p2notPlayed: 0,\r\n        notPlayed: 0,\r\n        twoBars: {},\r\n      },\r\n      double: {\r\n        p1win: 0,\r\n        p1notPlayed: 0,\r\n        p2win: 0,\r\n        p2notPlayed: 0,\r\n        notPlayed: 0,\r\n        twoBars: {},\r\n      },\r\n      single: {\r\n        p1win: 0,\r\n        p1notPlayed: 0,\r\n        p2win: 0,\r\n        p2notPlayed: 0,\r\n        notPlayed: 0,\r\n        twoBars: {},\r\n      },\r\n    };\r\n    charts.forEach(chart => {\r\n      const p1index = chart.results.findIndex(r => r.playerId === p1.id);\r\n      const p2index = chart.results.findIndex(r => r.playerId === p2.id);\r\n      const perType = chart.chartType.startsWith('D') ? data.double : data.single;\r\n      if (p1index < 0 && p2index < 0) {\r\n        console.log('wtf?');\r\n      } else if (p1index < 0) {\r\n        data.all.p1notPlayed++;\r\n        perType.p1notPlayed++;\r\n      } else if (p2index < 0) {\r\n        data.all.p2notPlayed++;\r\n        perType.p2notPlayed++;\r\n      } else if (p1index < p2index) {\r\n        data.all.p1win++;\r\n        perType.p1win++;\r\n      } else if (p2index < p1index) {\r\n        data.all.p2win++;\r\n        perType.p2win++;\r\n      }\r\n    });\r\n\r\n    const normalizeTwo = dataObj => {\r\n      const totalPlayed = dataObj.p1win + dataObj.p2win || 1; // in case of divide by 0\r\n      dataObj.twoBars.p1win = dataObj.p1win / totalPlayed;\r\n      dataObj.twoBars.p2win = dataObj.p2win / totalPlayed;\r\n    };\r\n    normalizeTwo(data.all);\r\n    normalizeTwo(data.single);\r\n    normalizeTwo(data.double);\r\n\r\n    const normalizeFive = (dataObj, total) => {\r\n      dataObj.p1win = dataObj.p1win / total;\r\n      dataObj.p1notPlayed = dataObj.p1notPlayed / total;\r\n      dataObj.p2win = dataObj.p2win / total;\r\n      dataObj.p2notPlayed = dataObj.p2notPlayed / total;\r\n      dataObj.notPlayed =\r\n        1 - dataObj.p1win - dataObj.p1notPlayed - dataObj.p2win - dataObj.p2notPlayed;\r\n    };\r\n    normalizeFive(data.all, tracklist.chartLevels[level]);\r\n    normalizeFive(data.double, tracklist.doublesLevels[level]);\r\n    normalizeFive(data.single, tracklist.singlesLevels[level]);\r\n\r\n    perLevelComparison[level] = data;\r\n  });\r\n\r\n  return {\r\n    perLevelComparison: _.values(perLevelComparison),\r\n  };\r\n});\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  const profile1 = profile1Selector(state, props);\r\n  const profile2 = profile2Selector(state, props);\r\n  return {\r\n    profile: profile1,\r\n    profile2,\r\n    combinedData: getCombinedData(profile1, profile2, state.tracklist.data),\r\n    tracklist: state.tracklist.data,\r\n    filter: state.profiles.filter,\r\n    error: state.results.error || state.tracklist.error,\r\n    isLoading:\r\n      state.results.isLoading || state.results.isLoadingRanking || state.tracklist.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n  setProfilesFilter,\r\n  resetProfilesFilter,\r\n};\r\n\r\nclass ProfileCompare extends Component {\r\n  static propTypes = {\r\n    profile: toBe.object,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    profile: {},\r\n    profile2: {},\r\n    combinedData: {},\r\n  };\r\n\r\n  state = {\r\n    isLevelGraphCombined: true,\r\n    compareBarsMode: BARS_MODES.BOTH_TWO,\r\n  };\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    !isLoading && this.props.fetchResults();\r\n  };\r\n\r\n  onChangeDayRange = range => {\r\n    const { filter } = this.props;\r\n    this.props.setProfilesFilter({\r\n      ...filter,\r\n      dayRange: range,\r\n    });\r\n  };\r\n\r\n  rhMargin = { top: 5, bottom: 5, right: 5, left: 0 };\r\n  rhXDomain = ['dataMin', 'dataMax'];\r\n  rhYDomain = ['dataMin - 100', 'dataMax + 100'];\r\n  rhXTickFormatter = value => parseDate(value).toLocaleDateString();\r\n  rhTooltip = ({ active, payload, label }) => {\r\n    const { profile, profile2 } = this.props;\r\n    const p1Name = profile.name;\r\n    const p2Name = profile2.name;\r\n    if (!payload || !payload[0]) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div className=\"history-tooltip\">\r\n        <div>{parseDate(payload[0].payload.date).toLocaleDateString()}</div>\r\n        {payload[1] && (\r\n          <div style={{ fontWeight: 'bold', color: payload[1].color }}>\r\n            {p1Name}: {Math.round(payload[1].value)}\r\n          </div>\r\n        )}\r\n        {payload[0] && (\r\n          <div style={{ fontWeight: 'bold', color: payload[0].color }}>\r\n            {p2Name}: {Math.round(payload[0].value)}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderRankingHistory() {\r\n    const { combinedData } = this.props;\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart data={combinedData.ratingChanges} margin={this.rhMargin}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"date\"\r\n            type=\"number\"\r\n            domain={this.rhXDomain}\r\n            tickFormatter={this.rhXTickFormatter}\r\n          />\r\n          <YAxis\r\n            allowDecimals={false}\r\n            domain={this.rhYDomain}\r\n            tickFormatter={Math.round}\r\n            width={40}\r\n          />\r\n          <ReferenceLine y={1000} stroke=\"white\" />\r\n          <RechartsTooltip isAnimationActive={false} content={this.rhTooltip} />\r\n          <Line\r\n            type=\"monotone\"\r\n            isAnimationActive={false}\r\n            dataKey=\"rating2\"\r\n            stroke=\"#ffd388\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n          <Line\r\n            type=\"monotone\"\r\n            isAnimationActive={false}\r\n            dataKey=\"rating1\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderPlaceHistory() {\r\n    const { combinedData, profile, profile2 } = this.props;\r\n    const p1Name = profile.name;\r\n    const p2Name = profile2.name;\r\n\r\n    return (\r\n      <ResponsiveContainer minHeight={MIN_GRAPH_HEIGHT} aspect={1.6}>\r\n        <LineChart\r\n          data={combinedData.placesChanges}\r\n          margin={{ top: 5, bottom: 5, right: 5, left: 0 }}\r\n        >\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis\r\n            dataKey=\"date\"\r\n            type=\"number\"\r\n            domain={['dataMin', 'dataMax']}\r\n            tickFormatter={value => parseDate(value).toLocaleDateString()}\r\n          />\r\n          <YAxis\r\n            allowDecimals={false}\r\n            domain={[1, dataMax => (dataMax < 3 ? dataMax + 2 : dataMax + 1)]}\r\n            interval={0}\r\n            reversed\r\n            width={40}\r\n          />\r\n          <RechartsTooltip\r\n            isAnimationActive={false}\r\n            content={({ active, payload, label }) => {\r\n              if (!payload || !payload[0]) {\r\n                return null;\r\n              }\r\n              return (\r\n                <div className=\"history-tooltip\">\r\n                  <div>{parseDate(payload[0].payload.date).toLocaleDateString()}</div>\r\n                  {payload[1] && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[1].color }}>\r\n                      {p1Name}: #{payload[1].value}\r\n                    </div>\r\n                  )}\r\n                  {payload[0] && (\r\n                    <div style={{ fontWeight: 'bold', color: payload[0].color }}>\r\n                      {p2Name}: #{payload[0].value}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            }}\r\n          />\r\n          <Line\r\n            isAnimationActive={false}\r\n            type=\"stepAfter\"\r\n            dataKey=\"place2\"\r\n            stroke=\"#ffd388\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n          <Line\r\n            isAnimationActive={false}\r\n            type=\"stepAfter\"\r\n            dataKey=\"place1\"\r\n            stroke=\"#88d3ff\"\r\n            strokeWidth={3}\r\n            dot={false}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  plcMargin = { top: 5, bottom: 5, right: 5, left: 0 };\r\n  plcTooltip = ({ active, payload, label }) => {\r\n    const { profile, profile2 } = this.props;\r\n    const { compareBarsMode } = this.state;\r\n    const isTwo = [BARS_MODES.SINGLE_TWO, BARS_MODES.DOUBLE_TWO, BARS_MODES.BOTH_TWO].includes(\r\n      compareBarsMode\r\n    );\r\n    const p1Name = profile.name;\r\n    const p2Name = profile2.name;\r\n\r\n    if (!payload || !payload[0]) {\r\n      return null;\r\n    }\r\n    const renderLegendItem = (item, label) => (\r\n      <div key={item.name} style={{ fontWeight: 'bold', color: item.color }}>\r\n        {label}: {Math.round(_.get(item.dataKey, item.payload) * 100)}%\r\n      </div>\r\n    );\r\n    return (\r\n      <div className=\"history-tooltip\">\r\n        <div>Level: {payload[0].payload.x}</div>\r\n        {renderLegendItem(payload[0], `${p1Name} wins`)}\r\n        {!isTwo && renderLegendItem(payload[1], `${p2Name} has no score`)}\r\n        {!isTwo && renderLegendItem(payload[2], `Both have no score`)}\r\n        {!isTwo && renderLegendItem(payload[3], `${p1Name} has no score`)}\r\n        {renderLegendItem(isTwo ? payload[1] : payload[4], `${p2Name} wins`)}\r\n      </div>\r\n    );\r\n  };\r\n  plcXDomain = [0, 1];\r\n  plcXTicks = [0, 0.5, 1];\r\n  plcXFormatter = x => `${Math.round(x * 100)}%`;\r\n\r\n  renderPerLevelComparison() {\r\n    const { combinedData } = this.props;\r\n    const { compareBarsMode } = this.state;\r\n\r\n    return (\r\n      <ResponsiveContainer width=\"100%\" aspect={0.7}>\r\n        <BarChart\r\n          layout=\"vertical\"\r\n          data={[...combinedData.perLevelComparison]}\r\n          margin={this.plcMargin}\r\n        >\r\n          <RechartsTooltip isAnimationActive={false} content={this.plcTooltip} />\r\n          <YAxis reversed dataKey=\"x\" type=\"category\" width={23} />\r\n          <XAxis\r\n            type=\"number\"\r\n            domain={this.plcXDomain}\r\n            ticks={this.plcXTicks}\r\n            tickFormatter={this.plcXFormatter}\r\n          />\r\n          <ReferenceLine x={0.5} stroke=\"#666\" />\r\n          {getCompareBars(compareBarsMode)}\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  renderProfile() {\r\n    const { profile, profile2 } = this.props;\r\n    const { compareBarsMode } = this.state;\r\n    return (\r\n      <div className=\"profile\">\r\n        <div className=\"profile-header\">\r\n          <div className=\"profile-name text-with-header blue\">\r\n            <div className=\"text-header\">игрок</div>\r\n            <div>{profile.name}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">ранк</div>\r\n            <div>#{profile.rank}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">эло</div>\r\n            <div>{profile.rating}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">последняя игра</div>\r\n            <div>{profile.lastResultDate ? getTimeAgo(profile.lastResultDate) : 'никогда'}</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"profile-header right-align\">\r\n          <div className=\"profile-name text-with-header orange\">\r\n            <div className=\"text-header\">игрок</div>\r\n            <div>{profile2.name}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">ранк</div>\r\n            <div>#{profile2.rank}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">эло</div>\r\n            <div>{profile2.rating}</div>\r\n          </div>\r\n          <div className=\"text-with-header\">\r\n            <div className=\"text-header\">последняя игра</div>\r\n            <div>{profile2.lastResultDate ? getTimeAgo(profile2.lastResultDate) : 'никогда'}</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"profile-section-horizontal-container\">\r\n          <div className=\"profile-section\">\r\n            <div className=\"profile-section-content\">\r\n              <div className=\"profile-section-2\">\r\n                <div className=\"profile-sm-section-header flex\">\r\n                  <span>победы по уровням</span>\r\n                </div>\r\n                <div className=\"profile-sm-section-header flex\">\r\n                  {(() => {\r\n                    const isTwo = [\r\n                      BARS_MODES.SINGLE_TWO,\r\n                      BARS_MODES.DOUBLE_TWO,\r\n                      BARS_MODES.BOTH_TWO,\r\n                    ].includes(compareBarsMode);\r\n                    return (\r\n                      <div className=\"toggle-holder\">\r\n                        <Toggle\r\n                          className=\"combine-toggle\"\r\n                          checked={!isTwo}\r\n                          onChange={() =>\r\n                            this.setState(state => ({\r\n                              compareBarsMode: {\r\n                                [BARS_MODES.SINGLE_TWO]: BARS_MODES.SINGLE_FIVE,\r\n                                [BARS_MODES.DOUBLE_TWO]: BARS_MODES.DOUBLE_FIVE,\r\n                                [BARS_MODES.BOTH_TWO]: BARS_MODES.BOTH_FIVE,\r\n                                [BARS_MODES.SINGLE_FIVE]: BARS_MODES.SINGLE_TWO,\r\n                                [BARS_MODES.DOUBLE_FIVE]: BARS_MODES.DOUBLE_TWO,\r\n                                [BARS_MODES.BOTH_FIVE]: BARS_MODES.BOTH_TWO,\r\n                              }[state.compareBarsMode],\r\n                            }))\r\n                          }\r\n                        >\r\n                          подробно\r\n                        </Toggle>\r\n                        <div className=\"tabs-holder\">\r\n                          <ToggleButton\r\n                            text=\"все\"\r\n                            active={[BARS_MODES.BOTH_TWO, BARS_MODES.BOTH_FIVE].includes(\r\n                              compareBarsMode\r\n                            )}\r\n                            onToggle={() => {\r\n                              this.setState(state => ({\r\n                                compareBarsMode: isTwo ? BARS_MODES.BOTH_TWO : BARS_MODES.BOTH_FIVE,\r\n                              }));\r\n                            }}\r\n                          />\r\n                          <ToggleButton\r\n                            text=\"синглы\"\r\n                            active={[BARS_MODES.SINGLE_TWO, BARS_MODES.SINGLE_FIVE].includes(\r\n                              compareBarsMode\r\n                            )}\r\n                            onToggle={active => {\r\n                              this.setState(state => ({\r\n                                compareBarsMode: isTwo\r\n                                  ? BARS_MODES.SINGLE_TWO\r\n                                  : BARS_MODES.SINGLE_FIVE,\r\n                              }));\r\n                            }}\r\n                          />\r\n                          <ToggleButton\r\n                            text=\"даблы\"\r\n                            active={[BARS_MODES.DOUBLE_TWO, BARS_MODES.DOUBLE_FIVE].includes(\r\n                              compareBarsMode\r\n                            )}\r\n                            onToggle={active => {\r\n                              this.setState(state => ({\r\n                                compareBarsMode: isTwo\r\n                                  ? BARS_MODES.DOUBLE_TWO\r\n                                  : BARS_MODES.DOUBLE_FIVE,\r\n                              }));\r\n                            }}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })()}\r\n                </div>\r\n                <div className=\"chart-container\">{this.renderPerLevelComparison()}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"profile-section\">\r\n            <div className=\"profile-section-content\">\r\n              <div className=\"profile-section-2\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>эло</span>\r\n                </div>\r\n              </div>\r\n              <div className=\"profile-section-2\">\r\n                <div className=\"profile-sm-section-header\">\r\n                  <span>место в топе</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, profile, error } = this.props;\r\n    DEBUG && console.log('profile:', profile);\r\n    return (\r\n      <div className=\"profile-compare-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            <button\r\n              disabled={isLoading}\r\n              className=\"btn btn-sm btn-dark btn-icon\"\r\n              onClick={this.onRefresh}\r\n            >\r\n              <FaSearch /> обновить\r\n            </button>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          {!isLoading && _.isEmpty(profile) && <div className=\"profile\">Profile not found</div>}\r\n          {!isLoading && !_.isEmpty(profile) && this.renderProfile()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(ProfileCompare));\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\nimport { RESET } from './resetAction';\r\n\r\nconst LOADING = `USER/LOADING`;\r\nconst SUCCESS = `USER/SUCCESS`;\r\nconst ERROR = `USER/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: null,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n        data: null,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n        data: null,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    case RESET:\r\n      return initialState;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchUser = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/profile` }));\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n\r\nexport { resetUser } from './resetAction';\r\n","import cookies from 'browser-cookies';\r\n\r\nimport { postJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nimport { fetchUser, resetUser } from 'reducers/user';\r\n\r\nconst LOADING = `LOGIN/LOADING`;\r\nconst SUCCESS = `LOGIN/SUCCESS`;\r\nconst ERROR = `LOGIN/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: null,\r\n  error: null,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n        data: null,\r\n        error: null,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n        data: null,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const login = googleResponse => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(\r\n        postJson({\r\n          url: `${HOST}/login/google`,\r\n          body: { token: googleResponse.tokenId },\r\n        })\r\n      );\r\n      cookies.set('session', data.session, { expires: 30 });\r\n      dispatch({ type: SUCCESS, data });\r\n      dispatch(fetchUser());\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n\r\nexport const logout = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    dispatch(resetUser());\r\n    try {\r\n      const data = await dispatch(\r\n        postJson({\r\n          url: `${HOST}/logout`,\r\n        })\r\n      );\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { NavLink } from 'react-router-dom';\r\nimport _ from 'lodash/fp';\r\n\r\nimport './top-bar.scss';\r\n\r\n// routes\r\nimport { routes } from 'constants/routes';\r\n\r\n// reducers\r\nimport * as loginACs from 'reducers/login';\r\n\r\n// redux\r\nconst mapStateToProps = state => {\r\n  return {\r\n    isLoadingLogin: state.login.isLoading,\r\n    isLoadingUser: state.user.isLoading,\r\n    user: state.user.data,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  login: loginACs.login,\r\n  logout: loginACs.logout,\r\n};\r\n\r\nfunction TopBar({ isLoadingLogin, isLoadingUser, user, login, logout }) {\r\n  return (\r\n    <header className=\"top-bar\">\r\n      <nav>\r\n        <ul>\r\n          <li>\r\n            <NavLink exact to={routes.leaderboard.path}>\r\n              leaderboard\r\n            </NavLink>\r\n          </li>\r\n          <li>\r\n            <NavLink exact to={routes.ranking.path}>\r\n              ranking\r\n            </NavLink>\r\n          </li>\r\n          <li>\r\n            <NavLink exact to={routes.songs.path}>\r\n              songs\r\n            </NavLink>\r\n          </li>\r\n        </ul>\r\n      </nav>\r\n      <div className=\"_flex-fill\" />\r\n      <div className=\"login-container\">\r\n        <NavLink\r\n          className=\"player-info\"\r\n          exact\r\n          to={routes.profile.getPath({ id: _.get('player.id', user) })}\r\n        >\r\n          {_.getOr('', 'player.nickname', user)}\r\n        </NavLink>\r\n        <button\r\n          className=\"btn btn-dark btn-icon btn-sm\"\r\n          onClick={logout}\r\n          disabled={isLoadingLogin || isLoadingUser}\r\n        >\r\n          <span> logout</span>\r\n        </button>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(TopBar);\r\n","import React, { useState } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { GoogleLogin } from 'react-google-login';\r\nimport { FaGoogle } from 'react-icons/fa';\r\nimport Emoji from 'react-emoji-render';\r\n\r\nimport './login-screen.scss';\r\n\r\n// reducers\r\nimport * as loginACs from 'reducers/login';\r\n\r\n// redux\r\nconst mapStateToProps = state => {\r\n  return {\r\n    isLoading: state.login.isLoading,\r\n    error: state.login.error,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  login: loginACs.login,\r\n};\r\n\r\nfunction LoginScreen({ isLoading, error, login }) {\r\n  const [isClown, setClown] = useState(false);\r\n  const onGoogleResponse = res => {\r\n    if (res.error) {\r\n      console.log('Google login response error:', res);\r\n    } else {\r\n      login(res);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-screen\">\r\n      <div className=\"site-name\">pumpking</div>\r\n      <div className=\"login-button\">\r\n        <GoogleLogin\r\n          clientId=\"197132042723-cmibep21qf6dald9l2l01rif7l5dtd4s.apps.googleusercontent.com\"\r\n          buttonText=\"Login\"\r\n          onSuccess={onGoogleResponse}\r\n          onFailure={onGoogleResponse}\r\n          cookiePolicy={'single_host_origin'}\r\n          render={({ onClick, disabled }) => (\r\n            <button\r\n              className=\"btn btn-dark btn-icon btn-sm\"\r\n              onClick={onClick}\r\n              disabled={disabled || isLoading}\r\n            >\r\n              <FaGoogle />\r\n              <span> login</span>\r\n            </button>\r\n          )}\r\n        />\r\n      </div>\r\n      {error && <div className=\"error\">{error.message}</div>}\r\n      <div className=\"footer\">\r\n        By logging in, you agree to our{' '}\r\n        {isClown ? (\r\n          <Emoji text=\"🤡\" className=\"clown\" />\r\n        ) : (\r\n          <span onClick={() => setClown(true)} className=\"link-style\">\r\n            Privacy Policy\r\n          </span>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(LoginScreen);\r\n","import { fetchJson } from 'utils/fetch';\r\nimport queryString from 'query-string';\r\nimport _ from 'lodash/fp';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `TOP_PER_SONG/LOADING`;\r\nconst SUCCESS = `TOP_PER_SONG/SUCCESS`;\r\nconst ERROR = `TOP_PER_SONG/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: null,\r\n  error: null,\r\n  fetchingParams: null,\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n        fetchingParams: action.fetchingParams,\r\n        data: null,\r\n        error: null,\r\n      };\r\n    case ERROR:\r\n      return action.fetchingParams === state.fetchingParams\r\n        ? {\r\n            ...state,\r\n            isLoading: false,\r\n            error: action.error,\r\n            data: null,\r\n            fetchingParams: null,\r\n          }\r\n        : state;\r\n    case SUCCESS:\r\n      return action.fetchingParams === state.fetchingParams\r\n        ? {\r\n            ...state,\r\n            isLoading: false,\r\n            data: action.data,\r\n            fetchingParams: null,\r\n          }\r\n        : state;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchTopPerSong = (songName, leftLabel, rightLabel) => {\r\n  const fetchingParams = queryString.stringify({\r\n    song_name: songName,\r\n    charts: _.compact(_.uniq([leftLabel, rightLabel])).join(','),\r\n  });\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING, fetchingParams });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/topPerSong?${fetchingParams}` }));\r\n      dispatch({ type: SUCCESS, data, fetchingParams });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error, fetchingParams });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `TRACKLIST/LOADING`;\r\nconst SUCCESS = `TRACKLIST/SUCCESS`;\r\nconst ERROR = `TRACKLIST/ERROR`;\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n};\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        data: action.data,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchTracklist = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await dispatch(fetchJson({ url: `${HOST}/tracklist/stats/XX` }));\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n      return null;\r\n    }\r\n  };\r\n};\r\n","import { useState, useEffect } from 'react';\r\nimport _ from 'lodash/fp';\r\nimport TimeAgo from 'javascript-time-ago';\r\nimport ru from 'javascript-time-ago/locale/ru';\r\nimport { convenient } from 'javascript-time-ago/gradation';\r\nimport moment from 'moment';\r\n\r\nTimeAgo.addLocale(ru);\r\nconst timeAgo = new TimeAgo('ru-RU');\r\nconst timeStyle = {\r\n  flavour: 'long',\r\n  gradation: convenient,\r\n  units: ['day', 'week', 'month'],\r\n};\r\nexport const getTimeAgo = date => {\r\n  const dayDiff = moment()\r\n    .startOf('day')\r\n    .diff(moment(date).startOf('day'), 'days');\r\n  return dayDiff === 0 ? 'сегодня' : dayDiff === 1 ? 'вчера' : timeAgo.format(date, timeStyle);\r\n};\r\n\r\nexport const preprocessData = data => ({\r\n  ...data,\r\n  results: _.flow(\r\n    _.get('results'),\r\n    _.values,\r\n    _.map(item => {\r\n      const fullRes = _.find(\r\n        r => _.every(_.isNumber, [r.perfects, r.greats, r.goods, r.bads, r.misses]),\r\n        item.results\r\n      );\r\n      const stepSum =\r\n        fullRes &&\r\n        [fullRes.perfects, fullRes.greats, fullRes.goods, fullRes.bads, fullRes.misses].reduce(\r\n          (sum, n) => sum + n,\r\n          0\r\n        );\r\n\r\n      const [chartType, chartLevel] = item.chart_label.match(/(\\D+)|(\\d+)/g);\r\n\r\n      return {\r\n        song: item.track,\r\n        chartLabel: item.chart_label,\r\n        chartLevel,\r\n        chartType,\r\n        mix: item.mix,\r\n        duration: item.duration,\r\n        results: item.results.map((res, index) => {\r\n          let resultInfoOverrides = {};\r\n          if (stepSum) {\r\n            const infos = [res.perfects, res.greats, res.goods, res.bads, res.misses];\r\n            let fixableIndex = -1;\r\n            let localStepSum = 0;\r\n            const canFix =\r\n              infos.filter((numb, index) => {\r\n                if (!_.isNumber(numb)) {\r\n                  fixableIndex = index;\r\n                  return true;\r\n                }\r\n                localStepSum += numb;\r\n                return false;\r\n              }).length === 1;\r\n            if (canFix) {\r\n              resultInfoOverrides[['perfect', 'great', 'good', 'bad', 'miss'][fixableIndex]] =\r\n                stepSum - localStepSum;\r\n            }\r\n          }\r\n          return {\r\n            id: res.id,\r\n            playerId: res.player,\r\n            nickname: data.players[res.player].nickname,\r\n            nicknameArcade: data.players[res.player].arcade_name,\r\n            originalChartMix: res.originalChartMix,\r\n            originalChartLabel: res.originalChartLabel,\r\n            originalScore: res.originalScore,\r\n            date: res.gained,\r\n            dateObject: new Date(res.gained),\r\n            grade: res.grade,\r\n            isExactDate: !!res.exact_gain_date,\r\n            score: res.score,\r\n            scoreIncrease: res.score_increase,\r\n            calories: res.calories && res.calories / 1000,\r\n            perfect: res.perfects,\r\n            great: res.greats,\r\n            good: res.goods,\r\n            bad: res.bads,\r\n            miss: res.misses,\r\n            combo: res.max_combo,\r\n            mods: res.mods_list,\r\n            isRank: !!res.rank_mode,\r\n            isHJ: (res.mods_list || '').split(' ').includes('HJ'),\r\n            ...resultInfoOverrides,\r\n          };\r\n        }),\r\n      };\r\n    }),\r\n    _.map(song => {\r\n      return {\r\n        ...song,\r\n        latestScoreDate: song.results.reduce(\r\n          (latest, current) => (current.date > latest ? current.date : latest),\r\n          song.results[0].date\r\n        ),\r\n        results: song.results.map(res => {\r\n          const perfects = (Math.sqrt(res.perfect) * _.toInteger(song.chartLevel)) / 2;\r\n          const acc = perfects\r\n            ? Math.floor(\r\n                ((perfects * 100 + res.great * 60 + res.good * 30 + res.miss * -20) /\r\n                  (perfects + res.great + res.good + res.bad + res.miss)) *\r\n                  100\r\n              ) / 100\r\n            : null;\r\n          const accRaw = res.perfect\r\n            ? Math.floor(\r\n                ((res.perfect * 100 + res.great * 60 + res.good * 30 + res.miss * -20) /\r\n                  (res.perfect + res.great + res.good + res.bad + res.miss)) *\r\n                  100\r\n              ) / 100\r\n            : null;\r\n          return {\r\n            ...res,\r\n            accuracy: acc < 0 ? 0 : accRaw === 100 ? 100 : acc && +acc.toFixed(2),\r\n            accuracyRaw: accRaw,\r\n            hasRankScore: _.some({ playerId: res.playerId, isRank: true }, song.results),\r\n          };\r\n        }),\r\n      };\r\n    }),\r\n    _.orderBy(['latestScoreDate', 'song', 'chartLevel'], ['desc', 'asc', 'desc'])\r\n  )(data),\r\n});\r\n\r\nexport const useTracked = (data, onChange) => {\r\n  const [prevData, setPrevData] = useState(data);\r\n  const [currData, setCurrData] = useState(data);\r\n\r\n  useEffect(() => {\r\n    if (!_.isEmpty(data) && data !== currData) {\r\n      setPrevData(currData);\r\n      setCurrData(data);\r\n      onChange(data, currData);\r\n    }\r\n  }, [data, onChange, currData, prevData]);\r\n\r\n  return [currData, prevData];\r\n};\r\n","import React, { useEffect, useState, useRef, useCallback } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport classNames from 'classnames';\r\nimport numeral from 'numeral';\r\nimport _ from 'lodash/fp';\r\nimport { FaAngleDoubleUp } from 'react-icons/fa';\r\nimport lev from 'fast-levenshtein';\r\n\r\nimport './socket.scss';\r\n\r\nimport { SOCKET_SERVER_IP } from 'constants/backend';\r\nimport Loader from 'components/Shared/Loader';\r\n\r\nimport { fetchResults, appendNewResults } from 'reducers/results';\r\nimport { fetchTopPerSong } from 'reducers/topPerSong';\r\nimport { fetchTracklist } from 'reducers/tracklist';\r\n\r\nimport { getRankImg } from 'utils/exp';\r\nimport { preprocessData, getTimeAgo } from './helpers';\r\n\r\n// code\r\nconst STATE_RESET_TIMEOUT = 10 * 60 * 1000; // 5 minutes\r\n\r\n// redux\r\nconst mapStateToProps = state => {\r\n  return {\r\n    isLoading: state.topPerSong.isLoading,\r\n    songTopData: state.topPerSong.data,\r\n    error: state.topPerSong.error,\r\n    profiles: state.results.profiles,\r\n    resultInfo: state.results.resultInfo,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchResults,\r\n  fetchTopPerSong,\r\n  fetchTracklist,\r\n  appendNewResults,\r\n};\r\n\r\n// component\r\nconst renderChartLabel = (type, level) => {\r\n  return (\r\n    <div\r\n      className={classNames('chart-name', {\r\n        single: type === 'S',\r\n        singlep: type === 'SP',\r\n        doublep: type === 'DP',\r\n        double: type === 'D',\r\n        coop: type === 'COOP',\r\n      })}\r\n    >\r\n      <span className=\"chart-letter\">{type}</span>\r\n      <span className=\"chart-number\">{level}</span>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction TrackerApp({\r\n  isLoading,\r\n  fetchResults,\r\n  fetchTracklist,\r\n  fetchTopPerSong,\r\n  appendNewResults,\r\n  songTopData,\r\n  error,\r\n  profiles,\r\n  resultInfo = {},\r\n}) {\r\n  const [message, setMessage] = useState('');\r\n  const [socketErrorMessage, setSocketErrorMessage] = useState('');\r\n  const [isSocketReady, setSocketReady] = useState(false);\r\n  const [isAlive, setAlive] = useState(false);\r\n  const [leftLabel, setLeftLabel] = useState(null);\r\n  const [rightLabel, setRightLabel] = useState(null);\r\n  const [leftPlayer, setLeftPlayer] = useState(null);\r\n  const [rightPlayer, setRightPlayer] = useState(null);\r\n  const [recognizedSongName, setRecognizedSongName] = useState('');\r\n\r\n  const socketRef = useRef(null);\r\n  const timeoutResetTokenRef = useRef(null);\r\n\r\n  const charts = _.values(_.get('results', preprocessData(songTopData)));\r\n  const leftChart = _.find({ chartLabel: leftLabel }, charts);\r\n  const rightChart = _.find({ chartLabel: rightLabel }, charts);\r\n  const chartsToShow = _.uniq(_.compact([leftChart, rightChart]));\r\n\r\n  const topPlayersList = _.flow(\r\n    _.values,\r\n    _.orderBy('ratingRaw', 'desc'),\r\n    items => items.map((it, index) => ({ place: index + 1, ...it }))\r\n  )(profiles);\r\n\r\n  let leftProfile = {};\r\n  let rightProfile = {};\r\n\r\n  if (leftPlayer) {\r\n    leftProfile = _.minBy(p => lev.get(p.nameArcade, leftPlayer), _.values(profiles)) || {};\r\n  }\r\n  if (rightPlayer) {\r\n    rightProfile = _.minBy(p => lev.get(p.nameArcade, rightPlayer), _.values(profiles)) || {};\r\n  }\r\n\r\n  const [leftData, setLeftData] = useState({ name: leftProfile.name, ratingRaw: null, exp: null });\r\n  const [rightData, setRightData] = useState({\r\n    name: rightProfile.name,\r\n    ratingRaw: null,\r\n    exp: null,\r\n  });\r\n\r\n  const restartTimeout = useCallback(() => {\r\n    setAlive(true);\r\n    if (timeoutResetTokenRef.current) {\r\n      clearTimeout(timeoutResetTokenRef.current);\r\n    }\r\n    timeoutResetTokenRef.current = setTimeout(() => {\r\n      // TODO: reset page\r\n      // this.setState(defaultState);\r\n    }, STATE_RESET_TIMEOUT);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (leftProfile.ratingRaw && leftProfile.ratingRaw !== leftData.ratingRaw) {\r\n      setLeftData({\r\n        ...leftData,\r\n        ratingRaw: leftProfile.ratingRaw,\r\n        prevRatingRaw: leftData.ratingRaw,\r\n        expRank: leftProfile.expRank,\r\n        expRankNext: leftProfile.expRankNext,\r\n      });\r\n    }\r\n    if (leftProfile.exp && leftProfile.exp !== leftData.exp) {\r\n      setLeftData({\r\n        ...leftData,\r\n        exp: leftProfile.exp,\r\n        prevExp: leftData.exp,\r\n        expRank: leftProfile.expRank || leftData.expRank,\r\n        expRankNext: leftProfile.expRankNext || leftData.expRankNext,\r\n      });\r\n    }\r\n    if (rightProfile.ratingRaw && rightProfile.ratingRaw !== rightData.ratingRaw) {\r\n      setRightData({\r\n        ...rightData,\r\n        ratingRaw: rightProfile.ratingRaw,\r\n        prevRatingRaw: rightData.ratingRaw,\r\n        expRank: rightProfile.expRank,\r\n        expRankNext: rightProfile.expRankNext,\r\n      });\r\n    }\r\n    if (rightProfile.exp && rightProfile.exp !== rightData.exp) {\r\n      setRightData({\r\n        ...rightData,\r\n        exp: rightProfile.exp,\r\n        prevExp: rightData.exp,\r\n        expRank: rightProfile.expRank || rightData.expRank,\r\n        expRankNext: rightProfile.expRankNext || rightData.expRankNext,\r\n      });\r\n    }\r\n    if (leftData.name !== leftProfile.name) {\r\n      setLeftData({\r\n        ...leftData,\r\n        ratingRaw: leftProfile.ratingRaw,\r\n        prevRatingRaw: null,\r\n        exp: leftProfile.exp,\r\n        expRank: leftProfile.expRank,\r\n        expRankNext: leftProfile.expRankNext,\r\n        prevExp: null,\r\n        name: leftProfile.name,\r\n      });\r\n    }\r\n    if (rightData.name !== rightProfile.name) {\r\n      setRightData({\r\n        ...rightData,\r\n        ratingRaw: rightProfile.ratingRaw,\r\n        prevRatingRaw: null,\r\n        exp: rightProfile.exp,\r\n        expRank: rightProfile.expRank,\r\n        expRankNext: rightProfile.expRankNext,\r\n        prevExp: null,\r\n        name: rightProfile.name,\r\n      });\r\n    }\r\n    /* eslint-disable */\r\n  }, [\r\n    leftProfile.ratingRaw,\r\n    rightProfile.ratingRaw,\r\n    leftProfile.exp,\r\n    rightProfile.exp,\r\n    leftProfile.name,\r\n    rightProfile.name,\r\n    leftData,\r\n    rightData,\r\n  ]);\r\n  /* eslint-enable */\r\n\r\n  useEffect(() => {\r\n    socketRef.current = new WebSocket(SOCKET_SERVER_IP);\r\n    socketRef.current.onerror = () => {\r\n      setMessage(`Cannot connect to websocket server, please reload the page`);\r\n    };\r\n    socketRef.current.onopen = e => {\r\n      setSocketReady(true);\r\n    };\r\n  }, []); // eslint-disable-line\r\n\r\n  useEffect(() => {\r\n    socketRef.current.onmessage = event => {\r\n      restartTimeout();\r\n      try {\r\n        const data = event && event.data && JSON.parse(event.data);\r\n        console.log(data);\r\n\r\n        if (data.type === 'result_screen') {\r\n          const songName = data.data.track_name;\r\n          const leftLabel = _.get('left.chart_label', data.data);\r\n          const rightLabel = _.get('right.chart_label', data.data);\r\n          const leftPlayer = _.get('left.result.player_name', data.data);\r\n          const rightPlayer = _.get('right.result.player_name', data.data);\r\n          setLeftPlayer(leftPlayer);\r\n          setRightPlayer(rightPlayer);\r\n          setLeftLabel(leftLabel);\r\n          setRightLabel(rightLabel);\r\n          setRecognizedSongName(songName);\r\n          appendNewResults(data.data.gained); // Fetch results that we don't have here yet (to calculate elo)\r\n          fetchTopPerSong(songName, leftLabel, rightLabel);\r\n        } else if (data.type === 'chart_selected') {\r\n          setSocketErrorMessage(data.data.error || '');\r\n          if (data.data.leftPlayer || data.data.rightPlayer) {\r\n            setLeftPlayer(data.data.leftPlayer);\r\n            setRightPlayer(data.data.rightPlayer);\r\n          }\r\n          if (data.data.leftLabel || data.data.rightLabel) {\r\n            setLeftLabel(data.data.leftLabel);\r\n            setRightLabel(data.data.rightLabel);\r\n            if (data.data.text) {\r\n              // If we have full info, try to fetch if needed\r\n              const newSongName = data.data.text;\r\n              setRecognizedSongName(newSongName);\r\n              console.log('song name', newSongName, recognizedSongName);\r\n              if (recognizedSongName !== newSongName) {\r\n                fetchTopPerSong(newSongName, data.data.leftLabel, data.data.rightLabel);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.log('on message error', e);\r\n        setMessage(`Error: ${e.message}`);\r\n      }\r\n    };\r\n  }, [recognizedSongName, fetchTopPerSong, restartTimeout, appendNewResults]);\r\n\r\n  // useEffect(() => {\r\n  //   setTimeout(() => {\r\n  //     socketRef.current.onmessage({\r\n  //       data:\r\n  //         '{\"type\": \"chart_selected\", \"data\": {\"text\": \"Uranium\", \"leftLabel\": \"D17\", \"rightLabel\": \"D20\", \"leftPlayer\": \"GRUMD\", \"rightPlayer\": \"DINO\"}}',\r\n  //     });\r\n  //   }, 2000);\r\n  // }, []);\r\n\r\n  const resultsContainerRef = useRef(null);\r\n  const leftResultRef = useRef(null);\r\n  const rightResultRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (resultsContainerRef.current && leftResultRef.current) {\r\n      if (rightResultRef.current) {\r\n        // Both refs\r\n        const left = leftResultRef.current;\r\n        const right = rightResultRef.current;\r\n        const totalSize = {\r\n          w: resultsContainerRef.current.clientWidth,\r\n          h: resultsContainerRef.current.clientHeight,\r\n        };\r\n        const scaleHH = totalSize.w / (left.offsetWidth + right.offsetWidth);\r\n        const scaleHW = totalSize.h / Math.max(left.offsetHeight, right.offsetHeight);\r\n        const scaleWH = totalSize.w / Math.max(left.offsetWidth, right.offsetWidth);\r\n        const scaleWW = totalSize.h / (left.offsetHeight + right.offsetHeight);\r\n        // console.log(scaleHH, scaleHW, scaleWH, scaleWW);\r\n        if (Math.min(scaleHH, scaleHW) > Math.min(scaleWH, scaleWW)) {\r\n          resultsContainerRef.current.style.flexDirection = 'row';\r\n          resultsContainerRef.current.style.alignItems = 'center';\r\n          if (scaleHH > scaleHW) {\r\n            resultsContainerRef.current.style.transform = `scale(${0.98 * scaleHW})`;\r\n          } else {\r\n            resultsContainerRef.current.style.transform = `scale(${0.98 * scaleHH})`;\r\n          }\r\n        } else {\r\n          resultsContainerRef.current.style.flexDirection = 'column';\r\n          resultsContainerRef.current.style.alignItems = 'center';\r\n          if (scaleWH > scaleWW) {\r\n            resultsContainerRef.current.style.transform = `scale(${0.98 * scaleWW})`;\r\n          } else {\r\n            resultsContainerRef.current.style.transform = `scale(${0.98 * scaleWH})`;\r\n          }\r\n        }\r\n      } else {\r\n        // One ref\r\n        const left = leftResultRef.current;\r\n        const totalSize = {\r\n          w: resultsContainerRef.current.clientWidth,\r\n          h: resultsContainerRef.current.clientHeight,\r\n        };\r\n        const scaleW = totalSize.w / left.offsetWidth;\r\n        const scaleH = totalSize.h / left.offsetHeight;\r\n        if (scaleW < scaleH) {\r\n          resultsContainerRef.current.style.transform = `scale(${0.98 * scaleW})`;\r\n        } else {\r\n          resultsContainerRef.current.style.transform = `scale(${0.98 * scaleH})`;\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  const renderPlayer = ({ player, profile, label, data, isLeft = false }) => {\r\n    const renderDeltaText = (n, prevN) => {\r\n      if (!prevN || prevN === n) {\r\n        return null;\r\n      }\r\n      const delta = n - prevN;\r\n      return (\r\n        <span className={`change ${delta >= 0 ? 'pos' : 'neg'}`}>\r\n          {delta < 0 ? delta.toFixed(1) : `+${delta.toFixed(1)}`}\r\n        </span>\r\n      );\r\n    };\r\n\r\n    const renderExpLine = () => {\r\n      if (!data.expRank || !data.exp) {\r\n        return null;\r\n      }\r\n\r\n      let takenWidth = data.expRankNext\r\n        ? (data.exp - data.expRank.threshold) /\r\n          (data.expRankNext.threshold - data.expRank.threshold)\r\n        : 1;\r\n      const emptyWidth = 1 - takenWidth;\r\n      let diffWidth = 0;\r\n\r\n      if (data.prevExp) {\r\n        takenWidth = data.expRankNext\r\n          ? (data.prevExp - data.expRank.threshold) /\r\n            (data.expRankNext.threshold - data.expRank.threshold)\r\n          : 1;\r\n        diffWidth = 1 - emptyWidth - takenWidth;\r\n      }\r\n      return (\r\n        <div className=\"exp-line\">\r\n          <div className=\"taken\" style={{ width: Math.floor(100 * takenWidth) + '%' }}></div>\r\n          <div className=\"diff\" style={{ width: Math.ceil(100 * diffWidth) + '%' }}></div>\r\n          <div className=\"rest\" style={{ width: Math.ceil(100 * emptyWidth) + '%' }}></div>\r\n        </div>\r\n      );\r\n    };\r\n\r\n    const playerIndex = _.findIndex({ id: profile.id }, topPlayersList);\r\n    const closestPlayers = topPlayersList.slice(\r\n      Math.max(0, playerIndex - 1),\r\n      Math.min(playerIndex + 2, topPlayersList.length)\r\n    );\r\n\r\n    return (\r\n      <div className={`player-container ${isLeft ? 'left' : 'right'}`}>\r\n        {player && (\r\n          <>\r\n            <div className=\"title-header\">player {isLeft ? 1 : 2}:</div>\r\n            <div className=\"name-with-label\">\r\n              <div className=\"name\">{profile.name || player}</div>\r\n              <div className=\"chart-label\">\r\n                {label && renderChartLabel(...label.match(/(\\D+)|(\\d+)/g))}\r\n              </div>\r\n            </div>\r\n            {data.exp && data.expRank && (\r\n              <div className=\"exp exp-rank\">\r\n                {getRankImg(data.expRank)}\r\n                {renderExpLine()}\r\n              </div>\r\n            )}\r\n            {data.exp && (\r\n              <div className=\"exp-text\">\r\n                <span className=\"_grey-text\">exp:</span> {Math.round(data.exp)}{' '}\r\n                {renderDeltaText(data.exp, data.prevExp)}\r\n              </div>\r\n            )}\r\n            {data.ratingRaw && (\r\n              <div className=\"rating\">\r\n                <span className=\"_grey-text\">pp:</span> {Math.round(data.ratingRaw)}{' '}\r\n                {renderDeltaText(data.ratingRaw, data.prevRatingRaw)}\r\n              </div>\r\n            )}\r\n            <div className=\"closest-players\">\r\n              {_.map(pl => {\r\n                return (\r\n                  <div className={`closest-player ${profile.id === pl.id ? 'current-player' : ''}`}>\r\n                    <div className=\"place\">#{pl.place}</div>\r\n                    <div className=\"name\">{pl.name}</div>\r\n                    <div className=\"elo\">{pl.rating}</div>\r\n                  </div>\r\n                );\r\n              }, closestPlayers)}\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"tracker-container\">\r\n      <div className=\"sidebar\">\r\n        {renderPlayer({\r\n          player: leftPlayer,\r\n          profile: leftProfile,\r\n          label: leftLabel,\r\n          data: leftData,\r\n          isLeft: true,\r\n        })}\r\n        {/* <div className=\"song-name\">{socketErrorMessage || recognizedSongName}</div> */}\r\n        {renderPlayer({\r\n          player: rightPlayer,\r\n          profile: rightProfile,\r\n          label: rightLabel,\r\n          data: rightData,\r\n        })}\r\n      </div>\r\n      <div className=\"results\" ref={resultsContainerRef}>\r\n        {(error || message) && (\r\n          <div className=\"error\">\r\n            {message}\r\n            <br />\r\n            {error && error.message}\r\n          </div>\r\n        )}\r\n        {isSocketReady &&\r\n          !leftPlayer &&\r\n          !rightPlayer &&\r\n          !socketErrorMessage &&\r\n          !isLoading &&\r\n          _.isEmpty(chartsToShow) &&\r\n          (isAlive ? (\r\n            <div className=\"msg\">Waiting for chart select...</div>\r\n          ) : (\r\n            <div className=\"offline msg\">Recognizer is offline</div>\r\n          ))}\r\n        {isSocketReady &&\r\n          (leftLabel || rightLabel) &&\r\n          !socketErrorMessage &&\r\n          !isLoading &&\r\n          _.isEmpty(chartsToShow) &&\r\n          'No results for this chart'}\r\n        {isLoading && <Loader />}\r\n        {!isLoading &&\r\n          chartsToShow.map((chart, chartIndex) => {\r\n            let topPlace = 1;\r\n            const occuredNicknames = [];\r\n            const results = chart.results.map((res, index) => {\r\n              const isSecondOccurenceInResults = occuredNicknames.includes(res.nickname);\r\n              occuredNicknames.push(res.nickname);\r\n              if (index === 0) {\r\n                topPlace = 1;\r\n              } else if (\r\n                !isSecondOccurenceInResults &&\r\n                res.score !== _.get([index - 1, 'score'], chart.results)\r\n              ) {\r\n                topPlace += 1;\r\n              }\r\n              return {\r\n                ...res,\r\n                topPlace,\r\n                isSecondOccurenceInResults,\r\n              };\r\n            });\r\n            return (\r\n              <div\r\n                className=\"song-block\"\r\n                key={chart.song + chart.chartLabel}\r\n                ref={chartIndex === 0 ? leftResultRef : rightResultRef}\r\n              >\r\n                <div className=\"song-name\">\r\n                  {renderChartLabel(chart.chartType, chart.chartLevel)}\r\n                  <div>{chart.song}</div>\r\n                </div>\r\n                <div className=\"charts\">\r\n                  <div className=\"chart\">\r\n                    <div className=\"results\">\r\n                      <table>\r\n                        <tbody>\r\n                          {results.map((res, index) => {\r\n                            let placeDifference, newIndex;\r\n                            if (res.scoreIncrease && res.date === chart.latestScoreDate) {\r\n                              const prevScore = res.score - res.scoreIncrease;\r\n                              newIndex = _.findLastIndex(res => res.score > prevScore, results);\r\n                              placeDifference = newIndex - index;\r\n                            }\r\n                            const pp = _.getOr('', `[${res.id}].pp.ppFixed`, resultInfo);\r\n                            return (\r\n                              <tr\r\n                                key={res.score + res.nickname}\r\n                                className={classNames({\r\n                                  empty: !res.isExactDate,\r\n                                  latest: res.date === chart.latestScoreDate,\r\n                                  left: res.nickname === leftProfile.name,\r\n                                  right: res.nickname === rightProfile.name,\r\n                                })}\r\n                              >\r\n                                <td className=\"nickname\">\r\n                                  {res.nickname}\r\n                                  {!!placeDifference && (\r\n                                    <span className=\"change-holder up\">\r\n                                      <span>{placeDifference}</span>\r\n                                      <FaAngleDoubleUp />\r\n                                    </span>\r\n                                  )}\r\n                                </td>\r\n                                <td className=\"pp\">\r\n                                  {pp}\r\n                                  {pp && <span className=\"_grey\">pp</span>}\r\n                                </td>\r\n                                <td\r\n                                  className={classNames('judge', {\r\n                                    vj: res.isRank,\r\n                                    hj: res.isHJ,\r\n                                  })}\r\n                                >\r\n                                  {res.isRank && (\r\n                                    <div className=\"inner\">{res.isExactDate ? 'VJ' : 'VJ?'}</div>\r\n                                  )}\r\n                                  {res.isHJ && <div className=\"inner\">HJ</div>}\r\n                                </td>\r\n                                <td className=\"score\">\r\n                                  <span className=\"score-span\">\r\n                                    {res.scoreIncrease > res.score * 0.8 && '*'}\r\n                                    {numeral(res.score).format('0,0')}\r\n                                  </span>\r\n                                </td>\r\n                                <td className=\"grade\">\r\n                                  <div className=\"img-holder\">\r\n                                    {res.grade && res.grade !== '?' && (\r\n                                      <img\r\n                                        src={`${process.env.PUBLIC_URL}/grades/${res.grade}.png`}\r\n                                        alt={res.grade}\r\n                                      />\r\n                                    )}\r\n                                    {res.grade === '?' && null}\r\n                                  </div>\r\n                                </td>\r\n                                <td className=\"number miss\">{res.miss}</td>\r\n                                <td className=\"number bad\">{res.bad}</td>\r\n                                <td className=\"number good\">{res.good}</td>\r\n                                <td className=\"number great\">{res.great}</td>\r\n                                <td className=\"number perfect\">{res.perfect}</td>\r\n                                <td className=\"combo\">\r\n                                  {res.combo}\r\n                                  {res.combo ? 'x' : ''}\r\n                                </td>\r\n                                <td className=\"accuracy\">\r\n                                  {res.accuracy}\r\n                                  {res.accuracy ? '%' : ''}\r\n                                </td>\r\n                                <td\r\n                                  className={classNames('date', {\r\n                                    latest: res.date === chart.latestScoreDate,\r\n                                  })}\r\n                                >\r\n                                  {getTimeAgo(res.dateObject)}\r\n                                  {res.isExactDate ? '' : '?'}\r\n                                </td>\r\n                              </tr>\r\n                            );\r\n                          })}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(TrackerApp);\r\n","import React, { useEffect } from 'react';\r\nimport { Route, Redirect, Switch } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport localForage from 'localforage';\r\nimport _ from 'lodash/fp';\r\n\r\nimport 'react-responsive-ui/style.css';\r\nimport './App.scss';\r\n\r\nimport { routes } from 'constants/routes';\r\nimport { CHART_MIN_MAX } from 'constants/leaderboard';\r\n\r\nimport SongsTop from 'components/SongsTop/SongsTop';\r\nimport Leaderboard from 'components/Leaderboard/Leaderboard';\r\nimport Ranking from 'components/Ranking/Ranking';\r\nimport Profile from 'components/Profile/Profile';\r\nimport ProfileCompare from 'components/ProfileCompare/ProfileCompare';\r\nimport TopBar from 'components/Shared/TopBar/TopBar';\r\nimport Loader from 'components/Shared/Loader';\r\nimport LoginScreen from 'components/LoginScreen/LoginScreen';\r\nimport SocketTracker from 'components/SocketTracker/SocketTracker';\r\n\r\nimport { fetchResults, setFilter } from 'reducers/results';\r\nimport { fetchTracklist } from 'reducers/tracklist';\r\nimport { fetchUser } from 'reducers/user';\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    data: state.user.data,\r\n    isLoading: state.user.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  setFilter,\r\n  fetchResults,\r\n  fetchTracklist,\r\n  fetchUser,\r\n};\r\n\r\nfunction App(props) {\r\n  const { fetchUser, fetchTracklist, fetchResults, setFilter, data, isLoading } = props;\r\n\r\n  useEffect(() => {\r\n    localForage\r\n      .getItem('filter')\r\n      .then(filter => {\r\n        if (filter) {\r\n          setFilter({\r\n            ...filter,\r\n            chartRange: filter.chartRange && {\r\n              ...filter.chartRange,\r\n              range: _.every(\r\n                r => r >= CHART_MIN_MAX[0] && r <= CHART_MIN_MAX[1],\r\n                filter.chartRange.range\r\n              )\r\n                ? filter.chartRange.range\r\n                : CHART_MIN_MAX,\r\n            },\r\n          });\r\n        }\r\n      })\r\n      .catch(error => console.error('Cannot get filter from local storage', error));\r\n    fetchUser();\r\n  }, [fetchUser, fetchTracklist, fetchResults, setFilter]);\r\n\r\n  useEffect(() => {\r\n    if (data && data.player) {\r\n      fetchTracklist().then(() => {\r\n        fetchResults();\r\n      });\r\n    }\r\n  }, [data, fetchResults, fetchTracklist]);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"container\">\r\n        <Loader />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!data || !data.player) {\r\n    return <LoginScreen />;\r\n  }\r\n\r\n  if (process.env.REACT_APP_SOCKET) {\r\n    return <SocketTracker />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <TopBar />\r\n      <Route exact path=\"/\" render={() => <Redirect to={routes.leaderboard.path} />} />\r\n      <Route path={routes.leaderboard.path} component={Leaderboard} />\r\n      <Route path={routes.ranking.path} component={Ranking} />\r\n      <Route path={routes.profile.path}>\r\n        <Switch>\r\n          <Route path={routes.profile.path} exact component={Profile} />\r\n          <Route path={routes.profile.compare.path} exact component={ProfileCompare} />\r\n        </Switch>\r\n      </Route>\r\n      <Route path={routes.songs.path} component={SongsTop} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(App);\r\n","import { combineReducers } from 'redux';\r\n\r\nimport mostPlayed from './mostPlayed';\r\nimport mostPlayedMonth from './mostPlayedMonth';\r\nimport leastPlayed from './leastPlayed';\r\n\r\nexport default combineReducers({\r\n  mostPlayed,\r\n  mostPlayedMonth,\r\n  leastPlayed,\r\n});\r\n","import { combineReducers, createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport _ from 'lodash/fp';\r\n\r\nimport tracklist from 'reducers/tracklist';\r\nimport trackStats from 'reducers/trackStats';\r\nimport profiles from 'reducers/profiles';\r\nimport presets from 'reducers/presets';\r\nimport results from 'reducers/results';\r\nimport user from 'reducers/user';\r\nimport login from 'reducers/login';\r\nimport topPerSong from 'reducers/topPerSong';\r\n\r\nconst rootReducer = combineReducers({\r\n  topPerSong,\r\n  login,\r\n  presets,\r\n  profiles,\r\n  results,\r\n  trackStats,\r\n  tracklist,\r\n  user,\r\n});\r\n\r\nexport const store = createStore(\r\n  rootReducer,\r\n  window.__REDUX_DEVTOOLS_EXTENSION__ && process.env.NODE_ENV === 'development'\r\n    ? compose(\r\n        applyMiddleware(thunk),\r\n        window.__REDUX_DEVTOOLS_EXTENSION__({\r\n          stateSanitizer: state => ({\r\n            ...state,\r\n            results: {\r\n              ...state.results,\r\n              data: `big array, ${_.size(state.results.data)}`,\r\n              results: `big array, ${_.size(state.results.results)}`,\r\n              sharedCharts: 'big object',\r\n              profiles: _.mapValues(\r\n                pl => ({\r\n                  ...pl,\r\n                  resultsByGrade: '...',\r\n                  resultsByLevel: '...',\r\n                  rankingHistory: '...',\r\n                  ratingHistory: '...',\r\n                }),\r\n                state.results.profiles\r\n              ),\r\n            },\r\n          }),\r\n        })\r\n      )\r\n    : applyMiddleware(thunk)\r\n);\r\n","import 'promise-polyfill';\r\nimport 'whatwg-fetch';\r\nimport 'utils/polyfills';\r\n\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { HashRouter } from 'react-router-dom';\r\nimport { Provider } from 'react-redux';\r\n\r\nimport './index.scss';\r\nimport App from 'components/App';\r\n\r\nimport { store } from 'reducers';\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <HashRouter>\r\n      <App />\r\n    </HashRouter>\r\n  </Provider>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}