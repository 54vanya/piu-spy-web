{"version":3,"sources":["constants/routes.js","components/Shared/Loader/index.js","components/Shared/Input/Input.js","components/Shared/Toggle/Toggle.js","components/Shared/CollapsibleBar/index.js","components/Shared/Overlay/Overlay.js","components/Shared/ToggleButton/ToggleButton.js","constants/leaderboard.js","components/Leaderboard/ChartFilter.js","utils/fetch.js","reducers/top.js","constants/backend.js","utils/leaderboards.js","utils/colors.js","components/Leaderboard/selectors.js","components/Leaderboard/Leaderboard.js","components/Ranking/RankingList.js","components/Ranking/RankingFaq.js","components/Ranking/Ranking.js","components/Shared/TopBar/TopBar.js","components/App.js","reducers/index.js","index.js"],"names":["routes","path","faq","Loader","className","width","height","viewBox","xmlns","fill","cx","cy","r","attributeName","from","to","begin","dur","values","calcMode","repeatCount","fillOpacity","Input","props","state","value","_","isNil","defaultValue","bindAll","prevProps","this","setState","e","newValue","target","onChange","type","numericValue","Number","min","max","onBlur","omit","classNames","handleBlur","onInput","handleChange","React","Component","defaultProps","noop","Toggle","checked","id","uniqueId","htmlFor","children","CollapsibleBar","open","defaultOpen","title","onClick","PureComponent","POPPER_MODIFIERS","preventOverflow","enabled","padding","boundariesElement","PLACEMENT_ARROW_MAPPING","right","left","top","bottom","getArrowPlacement","placement","split","Overlay","isVisible","containerItemRef","createRef","renderPopper","bind","toggleOverlayVisibility","event","closest","hideOverlay","ref","style","arrowProps","outOfBoundaries","scheduleUpdate","hideWhenOutOfBounds","data-placement","overlayClassName","overlayItem","Fragment","ReactDOM","createPortal","container","document","body","modifiers","referenceElement","current","defaultTypes","listensToClickOutside","ToggleButton","active","onToggle","text","SORT","CHART_MIN_MAX","ChartFilter","filterValue","range","getOr","buttonText","t","step","renderTrack","onMouseDown","onTouchStart","display","borderRadius","background","getTrackBackground","colors","alignSelf","renderThumb","isDragged","backgroundColor","justifyContent","alignItems","boxShadow","Math","newMin","newMax","fetchJson","a","url","fetch","response","status","json","data","Error","console","error","Promise","reject","LOADING","SUCCESS","ERROR","SET_FILTER","RESET_FILTER","RANKING_CHANGE_SET","defaultFilter","showRank","initialState","isLoading","filter","transformBackendData","flow","get","map","item","song","track","chartLabel","chart_label","chartLevel","slice","chartType","mix","results","res","index","perfects","sqrt","toInteger","acc","floor","greats","goods","misses","bads","nickname","date","gained","dateObject","Date","grade","isExactDate","exact_gain_date","score","perfect","great","good","bad","miss","combo","max_combo","mods","mods_list","isRank","rank_mode","accuracy","latestScoreDate","reduce","latest","hasRankScore","some","orderBy","playerInfo","forEach","usedResults","includes","push","scoreIndex","enemyScores","length","defaultInfo","count","battleCount","countAcc","rating","grades","F","D","C","B","A","S","SS","SSS","totalScore","sumAccuracy","cloneDeep","replace","startingRating","enemyScore","r1","r2","R1","R2","E1","E2","S1","S2","k1pow","k2pow","dr1","dr2","ratingDiff","arr","Object","keys","key","name","round","ranking","remove","i","localForage","setItem","fetchTopScores","dispatch","getListOfNames","calculateRankingChanges","getState","all","getItem","lastChangedRanking","lastFetchedRanking","listNow","listLastFetched","listLastChanged","isEqual","listPrev","log","warn","TimeAgo","addLocale","ru","timeAgo","timeStyle","flavour","gradation","convenient","units","tooltipFormatterForBests","flexDirection","toLocaleDateString","nowDate","colorsArray","playersSelector","createSelector","flatMap","uniq","sortBy","toLower","label","filteredDataSelector","names","players","namesOr","playersOr","namesNot","playersNot","sortingType","protagonist","excludeAntagonists","defaultSorting","protagonistSorting","row","protIndex","findIndex","protScore","enemies","take","uniqBy","distanceFromProtagonist","dist","enemy","sortingFunctions","compact","chartRange","items","rows","filterCharts","showOnlyRank","showRankAndNorank","occuredNames","alreadyOccured","rowNames","every","size","matchSorter","topPlace","occuredNicknames","isSecondOccurenceInResults","sortingOptions","mapDispatchToProps","setFilter","resetFilter","Leaderboard","showItemsCount","curry","onRefresh","then","catch","placeholder","disabled","closeMenuOnSelect","classNamePrefix","isMulti","options","clearable","filteredData","canShowMore","visibleData","uniqueSelectedNames","message","renderSimpleSearch","renderFilters","renderSortings","isEmpty","chart","chartIndex","single","nameIndex","indexOf","empty","fontWeight","color","toFixed","vj","content","tooltipClassName","numeral","format","src","process","alt","strTimeAgo","dayDiff","moment","startOf","diff","getTimeAgo","connect","getGradeImg","RankingList","player","playerIndex","change","isString","RankingFaq","href","Ranking","exact","render","component","withRouter","TopBar","App","rootReducer","combineReducers","action","store","createStore","window","__REDUX_DEVTOOLS_EXTENSION__","compose","applyMiddleware","thunk","stateSanitizer","getElementById"],"mappings":"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","file":"static/js/main.a40d0b0e.chunk.js","sourcesContent":["export const routes = {\r\n  leaderboard: {\r\n    path: `/leaderboard`,\r\n  },\r\n  ranking: {\r\n    path: `/ranking`,\r\n    faq: {\r\n      path: '/ranking/faq',\r\n    },\r\n  },\r\n};\r\n","import React from 'react';\r\n\r\nimport './loader.scss';\r\n\r\nexport default function Loader() {\r\n  return (\r\n    <div className=\"loader\">\r\n      <svg\r\n        width=\"40\"\r\n        height=\"12\"\r\n        viewBox=\"0 0 120 30\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        fill=\"#eee\"\r\n      >\r\n        <circle cx=\"15\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"60\" cy=\"15\" r=\"9\" fillOpacity=\"0.3\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"9\"\r\n            to=\"9\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"9;15;9\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"0.5\"\r\n            to=\"0.5\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\".5;1;.5\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n        <circle cx=\"105\" cy=\"15\" r=\"15\">\r\n          <animate\r\n            attributeName=\"r\"\r\n            from=\"15\"\r\n            to=\"15\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"15;9;15\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n          <animate\r\n            attributeName=\"fill-opacity\"\r\n            from=\"1\"\r\n            to=\"1\"\r\n            begin=\"0s\"\r\n            dur=\"0.8s\"\r\n            values=\"1;.5;1\"\r\n            calcMode=\"linear\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        </circle>\r\n      </svg>\r\n    </div>\r\n  );\r\n}\r\n","/* eslint-disable react/no-deprecated */\r\n// imports from vendor deps\r\nimport React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash/fp';\r\n\r\n// imports from styles\r\nexport default class Input extends React.Component {\r\n  static propTypes = {\r\n    value: toBe.any,\r\n    defaultValue: toBe.any,\r\n    onChange: toBe.func,\r\n    onBlur: toBe.func,\r\n    type: toBe.string,\r\n    className: toBe.string,\r\n    trimOnBlur: toBe.bool,\r\n  };\r\n\r\n  static defaultProps = {\r\n    value: null,\r\n    type: 'text',\r\n    onChange: _.noop,\r\n    onBlur: _.noop,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      value: (!_.isNil(props.value) ? props.value : props.defaultValue) || '',\r\n    };\r\n    _.bindAll(['handleChange', 'handleBlur'], this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.value !== this.props.value) {\r\n      this.setState({ value: this.props.value });\r\n    }\r\n  }\r\n\r\n  handleChange(e) {\r\n    const newValue = e.target.value;\r\n    this.setState({ value: newValue }, () => this.props.onChange(newValue));\r\n  }\r\n\r\n  handleBlur(e) {\r\n    const { type } = this.props;\r\n    const { value } = this.state;\r\n    if (type === 'number') {\r\n      const numericValue = Number(value);\r\n      if (numericValue >= Number(e.target.min) && numericValue <= Number(e.target.max)) {\r\n        this.props.onBlur(numericValue, e);\r\n      } else {\r\n        this.setState({ value: this.props.value });\r\n        this.props.onBlur(this.props.value, e);\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { className } = this.props;\r\n\r\n    // HACK: This component uses onInput instead of onChange\r\n    // because IE11 fails to call onChange events when you paste/cut using context menu (RMB)\r\n    // We're using onInput because it works fine, and because for text input\r\n    // there's no difference between how onChange and onInput work\r\n    return (\r\n      <input\r\n        {..._.omit(['defaultValue', 'onChange'], this.props)}\r\n        className={classNames(className, 'text-input')}\r\n        value={this.state.value}\r\n        onBlur={this.handleBlur}\r\n        onInput={this.handleChange}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\n\r\nimport './toggle.scss';\r\n\r\n// imports from styles\r\nexport default class Toggle extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.id = _.uniqueId();\r\n  }\r\n\r\n  onChange = e => {\r\n    this.props.onChange(e.target.checked);\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"toggle-checkbox\">\r\n        <input\r\n          type=\"checkbox\"\r\n          className=\"toggle-checkbox-cb\"\r\n          id={this.id}\r\n          onChange={this.onChange}\r\n          checked={this.props.checked}\r\n        />\r\n        <label htmlFor={this.id} className=\"toggle\">\r\n          <span></span>\r\n        </label>\r\n        <label htmlFor={this.id} className=\"text-label\">\r\n          {this.props.children}\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { FaChevronRight } from 'react-icons/fa';\r\nimport classNames from 'classnames';\r\n\r\nimport './styles.scss';\r\n\r\nexport default class CollapsibleBar extends PureComponent {\r\n  static propTypes = {\r\n    className: toBe.string,\r\n    children: toBe.any,\r\n    title: toBe.any,\r\n    defaultOpen: toBe.bool,\r\n  };\r\n\r\n  constructor(props) {\r\n    super();\r\n    this.state = { open: props.defaultOpen || false };\r\n  }\r\n\r\n  render() {\r\n    const { children, title, className } = this.props;\r\n    const { open } = this.state;\r\n\r\n    return (\r\n      <div className={classNames('collapsible-bar', className, { open })}>\r\n        <div className=\"header\" onClick={() => this.setState(state => ({ open: !state.open }))}>\r\n          <div className=\"collapse-button\">\r\n            <FaChevronRight />\r\n          </div>\r\n          <div className=\"title\">{title}</div>\r\n        </div>\r\n        {children && <div className=\"collapsible-children\">{children}</div>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport toBe from 'prop-types';\r\nimport { Popper } from 'react-popper';\r\nimport classNames from 'classnames';\r\nimport listensToClickOutside from 'react-onclickoutside';\r\n\r\nimport './overlay.scss';\r\n\r\nconst POPPER_MODIFIERS = {\r\n  preventOverflow: {\r\n    enabled: true,\r\n    padding: 10,\r\n    boundariesElement: 'viewport',\r\n  },\r\n};\r\n\r\nconst PLACEMENT_ARROW_MAPPING = {\r\n  right: 'left',\r\n  left: 'right',\r\n  top: 'bottom',\r\n  bottom: 'top',\r\n};\r\n\r\nconst getArrowPlacement = placement => {\r\n  return placement && PLACEMENT_ARROW_MAPPING[placement.split('-')[0]];\r\n};\r\n\r\nclass Overlay extends React.PureComponent {\r\n  static propTypes = {\r\n    placement: toBe.string,\r\n    overlayItem: toBe.any,\r\n    hideWhenOutOfBounds: toBe.bool,\r\n  };\r\n\r\n  static defaultTypes = {\r\n    placement: 'bottom',\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      isVisible: false,\r\n    };\r\n    this.containerItemRef = React.createRef();\r\n    this.renderPopper = this.renderPopper.bind(this);\r\n    this.toggleOverlayVisibility = this.toggleOverlayVisibility.bind(this);\r\n  }\r\n\r\n  hideOverlay() {\r\n    this.setState({\r\n      isVisible: false,\r\n    });\r\n  }\r\n\r\n  toggleOverlayVisibility() {\r\n    this.setState({\r\n      isVisible: !this.state.isVisible,\r\n    });\r\n  }\r\n\r\n  handleClickOutside(event) {\r\n    const preventHiding = event && event.target.closest('.inner-popper-overlay'); // prevent overlays from hiding when a modal is opened within overlay\r\n\r\n    if (!preventHiding) {\r\n      this.hideOverlay();\r\n    }\r\n  }\r\n\r\n  renderPopper({ ref, style, placement, arrowProps, scheduleUpdate, outOfBoundaries }) {\r\n    const { children, hideWhenOutOfBounds } = this.props;\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        style={style}\r\n        data-placement={placement}\r\n        className={classNames(\r\n          'inner-popper-overlay',\r\n          `arrow-${getArrowPlacement(placement)}`,\r\n          this.props.overlayClassName,\r\n          { 'out-of-bounds': outOfBoundaries && hideWhenOutOfBounds }\r\n        )}\r\n      >\r\n        <div className=\"arrow-hider\">\r\n          <div className=\"arrow\" ref={arrowProps.ref} style={arrowProps.style} />\r\n        </div>\r\n        <div\r\n          className=\"inner-popper-content\"\r\n          // ref={ref => this.setupPopperContentRef(scheduleUpdate, ref)}\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { placement, overlayItem } = this.props;\r\n    const { isVisible } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <div\r\n          className=\"overlay-item\"\r\n          ref={this.containerItemRef}\r\n          onClick={this.toggleOverlayVisibility}\r\n        >\r\n          {overlayItem}\r\n        </div>\r\n        {isVisible &&\r\n          ReactDOM.createPortal(\r\n            <Popper\r\n              container={document.body}\r\n              modifiers={POPPER_MODIFIERS}\r\n              placement={placement}\r\n              referenceElement={this.containerItemRef.current}\r\n            >\r\n              {this.renderPopper}\r\n            </Popper>,\r\n            document.body\r\n          )}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default listensToClickOutside(Overlay);\r\n","import React from 'react';\r\nimport toBe from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nimport './toggle-button.scss';\r\n\r\nexport default class ToggleButton extends React.PureComponent {\r\n  static propTypes = {\r\n    text: toBe.string,\r\n    onToggle: toBe.func,\r\n    active: toBe.bool,\r\n  };\r\n\r\n  render() {\r\n    const { active, onToggle, text } = this.props;\r\n    return (\r\n      <div\r\n        className={classNames('toggle-button', { active: active })}\r\n        onClick={() => onToggle(!active)}\r\n      >\r\n        {text}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","export const SORT = {\r\n  DEFAULT: 'default',\r\n  PROTAGONIST: 'protagonist',\r\n};\r\n\r\nexport const CHART_MIN_MAX = [1, 28];\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\nimport { FaCaretLeft, FaCaretRight } from 'react-icons/fa';\r\nimport { Range, getTrackBackground } from 'react-range';\r\n\r\nimport Overlay from 'components/Shared/Overlay/Overlay';\r\nimport ToggleButton from 'components/Shared/ToggleButton/ToggleButton';\r\nimport Input from 'components/Shared/Input/Input';\r\n\r\nimport { CHART_MIN_MAX } from 'constants/leaderboard';\r\n\r\nexport default function ChartFilter({ filterValue, onChange }) {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filterValue);\r\n  const type = _.getOr(null, 'type', filterValue);\r\n  let buttonText = 'фильтр чартов';\r\n  if (filterValue) {\r\n    const t = type || '';\r\n    buttonText = range[0] === range[1] ? `${t}${range[0]}` : `${t}${range[0]} - ${t}${range[1]}`;\r\n    buttonText = 'чарты: ' + buttonText;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Overlay\r\n        overlayClassName=\"chart-range-overlay-outer\"\r\n        overlayItem={\r\n          <button className=\"filter-charts-button btn btn-sm btn-dark\">{buttonText}</button>\r\n        }\r\n      >\r\n        <div className=\"chart-range-overlay\">\r\n          <div className=\"buttons\">\r\n            <ToggleButton\r\n              text=\"S\"\r\n              active={!type || type === 'S'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  range,\r\n                  type: !active ? 'D' : null,\r\n                });\r\n              }}\r\n            />\r\n            <ToggleButton\r\n              text=\"D\"\r\n              active={!type || type === 'D'}\r\n              onToggle={active => {\r\n                onChange({\r\n                  range,\r\n                  type: !active ? 'S' : null,\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n          <Range\r\n            values={range}\r\n            step={1}\r\n            min={CHART_MIN_MAX[0]}\r\n            max={CHART_MIN_MAX[1]}\r\n            onChange={r => onChange({ type, range: r })}\r\n            renderTrack={({ props, children }) => (\r\n              <div\r\n                onMouseDown={props.onMouseDown}\r\n                onTouchStart={props.onTouchStart}\r\n                style={{\r\n                  ...props.style,\r\n                  height: '10px',\r\n                  display: 'flex',\r\n                  width: '100%',\r\n                }}\r\n              >\r\n                <div\r\n                  ref={props.ref}\r\n                  style={{\r\n                    height: '6px',\r\n                    width: '100%',\r\n                    borderRadius: '3px',\r\n                    background: getTrackBackground({\r\n                      values: range,\r\n                      colors: ['#ccc', '#337ab7', '#ccc'],\r\n                      min: CHART_MIN_MAX[0],\r\n                      max: CHART_MIN_MAX[1],\r\n                    }),\r\n                    alignSelf: 'center',\r\n                  }}\r\n                >\r\n                  {children}\r\n                </div>\r\n              </div>\r\n            )}\r\n            renderThumb={({ props, isDragged }) => (\r\n              <div\r\n                {...props}\r\n                style={{\r\n                  ...props.style,\r\n                  height: '12px',\r\n                  width: '12px',\r\n                  borderRadius: '6px',\r\n                  backgroundColor: '#FFF',\r\n                  display: 'flex',\r\n                  justifyContent: 'center',\r\n                  alignItems: 'center',\r\n                  boxShadow: '0px 2px 3px #AAA',\r\n                }}\r\n              >\r\n                <div\r\n                  style={{\r\n                    height: '6px',\r\n                    width: '6px',\r\n                    borderRadius: '3px',\r\n                    backgroundColor: isDragged ? '#337ab7' : '#CCC',\r\n                  }}\r\n                />\r\n              </div>\r\n            )}\r\n          />\r\n          <div className=\"inputs\">\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  type,\r\n                  range: [Math.max(range[0] - 1, CHART_MIN_MAX[0]), range[1]],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={CHART_MIN_MAX[0]}\r\n              max={Math.min(CHART_MIN_MAX[1], range[1])}\r\n              value={range[0]}\r\n              onBlur={value => {\r\n                onChange({ type, range: [value, range[1]] });\r\n              }}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMin = Math.min(range[0] + 1, CHART_MIN_MAX[1]);\r\n                onChange({\r\n                  type,\r\n                  range: [newMin, range[1] < newMin ? newMin : range[1]],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n            <div className=\"_flex-fill\" />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() => {\r\n                const newMax = Math.max(range[1] - 1, CHART_MIN_MAX[0]);\r\n                onChange({\r\n                  type,\r\n                  range: [range[0] > newMax ? newMax : range[0], newMax],\r\n                });\r\n              }}\r\n            >\r\n              <FaCaretLeft />\r\n            </button>\r\n            <Input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              min={Math.max(CHART_MIN_MAX[0], range[0])}\r\n              max={CHART_MIN_MAX[1]}\r\n              value={range[1]}\r\n              onBlur={value => onChange({ type, range: [range[0], value] })}\r\n            />\r\n            <button\r\n              className=\"btn btn-sm btn-dark\"\r\n              onClick={() =>\r\n                onChange({\r\n                  type,\r\n                  range: [range[0], Math.min(range[1] + 1, CHART_MIN_MAX[1])],\r\n                })\r\n              }\r\n            >\r\n              <FaCaretRight />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </Overlay>\r\n    </div>\r\n  );\r\n}\r\n","export const fetchJson = async ({ url }) => {\r\n  try {\r\n    const response = await fetch(url);\r\n    if (response.status >= 200 && response.status < 300) {\r\n      const data = await response.json();\r\n      return data;\r\n    } else {\r\n      throw Error('HTTP Status ' + response.status);\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n","import _ from 'lodash/fp';\r\nimport localForage from 'localforage';\r\n\r\nimport { fetchJson } from 'utils/fetch';\r\n\r\nimport { HOST } from 'constants/backend';\r\n\r\nconst LOADING = `TOP/LOADING`;\r\nconst SUCCESS = `TOP/SUCCESS`;\r\nconst ERROR = `TOP/ERROR`;\r\nconst SET_FILTER = `TOP/SET_FILTER`;\r\nconst RESET_FILTER = `TOP/RESET_FILTER`;\r\nconst RANKING_CHANGE_SET = `TOP/RANKING_CHANGE_SET`;\r\n\r\nconst defaultFilter = { showRank: true };\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  data: [],\r\n  filter: defaultFilter,\r\n};\r\n\r\nconst transformBackendData = _.flow(\r\n  _.get('top'),\r\n  _.values,\r\n  _.map(item => ({\r\n    song: item.track,\r\n    chartLabel: item.chart_label,\r\n    chartLevel: item.chart_label.slice(1),\r\n    chartType: item.chart_label.slice(0, 1),\r\n    mix: item.mix,\r\n    results: item.results.map((res, index) => {\r\n      const perfects = (Math.sqrt(res.perfects) * _.toInteger(item.chart_label.slice(1))) / 2;\r\n      const acc = perfects\r\n        ? Math.floor(\r\n            ((perfects * 100 + res.greats * 60 + res.goods * 30 + res.misses * -20) /\r\n              (perfects + res.greats + res.goods + res.bads + res.misses)) *\r\n              100\r\n          ) / 100\r\n        : null;\r\n      return {\r\n        nickname: res.nickname,\r\n        date: res.gained,\r\n        dateObject: new Date(res.gained),\r\n        grade: res.grade,\r\n        isExactDate: !!res.exact_gain_date,\r\n        score: res.score,\r\n        perfect: res.perfects,\r\n        great: res.greats,\r\n        good: res.goods,\r\n        bad: res.bads,\r\n        miss: res.misses,\r\n        combo: res.max_combo,\r\n        mods: res.mods_list,\r\n        isRank: !!res.rank_mode,\r\n        accuracy: acc < 0 ? 0 : acc,\r\n      };\r\n    }),\r\n  })),\r\n  _.map(song => {\r\n    return {\r\n      ...song,\r\n      latestScoreDate: song.results.reduce(\r\n        (latest, current) => (current.date > latest ? current.date : latest),\r\n        song.results[0].date\r\n      ),\r\n      results: song.results.map(res => ({\r\n        ...res,\r\n        hasRankScore: _.some({ nickname: res.nickname, isRank: true }, song.results),\r\n      })),\r\n    };\r\n  }),\r\n  _.orderBy(['latestScoreDate', 'song', 'chartLevel'], ['desc', 'asc', 'desc']),\r\n  data => {\r\n    const playerInfo = {};\r\n    data.forEach(song => {\r\n      const usedResults = [];\r\n      _.orderBy(['score'], ['desc'], song.results).forEach(score => {\r\n        if (!score.nickname.includes('???') && !_.some({ nickname: score.nickname }, usedResults)) {\r\n          // score.ratingDiff = 0;\r\n          usedResults.push(score);\r\n        }\r\n      });\r\n\r\n      usedResults.forEach((score, scoreIndex) => {\r\n        const enemyScores = usedResults.length > 1 ? usedResults.slice(scoreIndex + 1) : [];\r\n        const defaultInfo = {\r\n          count: 0,\r\n          battleCount: 0,\r\n          countAcc: 0,\r\n          rating: 1000,\r\n          grades: { F: 0, D: 0, C: 0, B: 0, A: 0, S: 0, SS: 0, SSS: 0 },\r\n          totalScore: { S: 0, D: 0 },\r\n          sumAccuracy: 0,\r\n        };\r\n        if (!playerInfo[score.nickname]) {\r\n          playerInfo[score.nickname] = _.cloneDeep(defaultInfo);\r\n        }\r\n\r\n        playerInfo[score.nickname].count++;\r\n        score.accuracy && playerInfo[score.nickname].countAcc++;\r\n        playerInfo[score.nickname].sumAccuracy += score.accuracy;\r\n        playerInfo[score.nickname].totalScore[song.chartType] += score.score;\r\n        playerInfo[score.nickname].grades[score.grade.replace('+', '')]++;\r\n        score.startingRating = playerInfo[score.nickname].rating;\r\n\r\n        enemyScores.forEach(enemyScore => {\r\n          // This is one match between two players\r\n          if (!playerInfo[enemyScore.nickname]) {\r\n            playerInfo[enemyScore.nickname] = _.cloneDeep(defaultInfo);\r\n          }\r\n          playerInfo[score.nickname].battleCount++;\r\n          playerInfo[enemyScore.nickname].battleCount++;\r\n\r\n          // Elo formula\r\n          const r1 = playerInfo[score.nickname].rating;\r\n          const r2 = playerInfo[enemyScore.nickname].rating;\r\n          const R1 = 10 ** (r1 / 400);\r\n          const R2 = 10 ** (r2 / 400);\r\n          const E1 = R1 / (R1 + R2);\r\n          const E2 = R2 / (R1 + R2);\r\n          const A = score.score;\r\n          const B = enemyScore.score;\r\n          // S1/S2 is the factor of winning\r\n          // S1 = 1  S2 = 0  -- player 1 wins\r\n          // S1 = 0.5  S2 = 0.5  -- draw\r\n          // I'm using difference in score to get this value, it ranges from 0 from 1\r\n          // Current formula assigns 100% win if you have at least ~15% more score than the other player\r\n          // 3.000 vs 3.500 score -- 0 / 1 win percentage -- clear win for player 2\r\n          // 3.000 vs 3.300 score -- 0.17 / 0.83 win percentage -- ranking is not affected as strongly as 0 / 1\r\n          // 3.000 vs 3.100 score -- 0.38 / 0.62 win percentage -- almost draw\r\n          let S1 = (A / (A + B) - 0.5) * 14 + 0.5;\r\n          let S2 = (B / (A + B) - 0.5) * 14 + 0.5;\r\n          S1 = Math.max(0, Math.min(1, S1)); // Set strict boundaries to [0, 1]\r\n          S2 = Math.max(0, Math.min(1, S2));\r\n          // K is the coeficient that decides how strongly this match affects rating\r\n          // Higher level -- affects more\r\n          // More playcount -- affects less (just to make first matches place people faster)\r\n          const k1pow = Math.min(1, playerInfo[score.nickname].battleCount / 150) * 0.5; // battlecount 0 -> 150 => results in 0 -> 0.5 value here\r\n          const k2pow = Math.min(1, playerInfo[enemyScore.nickname].battleCount / 150) * 0.5; // battlecount 0 -> 150 => results in 0 -> 0.5 value here\r\n          const K1 = Math.min(20, Math.max(4, song.chartLevel - 4)) ** (2.2 - k1pow) / 2;\r\n          const K2 = Math.min(20, Math.max(4, song.chartLevel - 4)) ** (2.2 - k2pow) / 2;\r\n          let dr1 = K1 * (S1 - E1);\r\n          let dr2 = K2 * (S2 - E2);\r\n          // Do not decrease rating if you have SSS - RIP zero-sum algorithm\r\n          dr1 = dr1 < 0 && score.grade === 'SSS' ? 0 : dr1;\r\n          dr2 = dr2 < 0 && enemyScore.grade === 'SSS' ? 0 : dr2;\r\n          // Recording this value for display\r\n          score.ratingDiff = (score.ratingDiff || 0) + dr1;\r\n          enemyScore.ratingDiff = (enemyScore.ratingDiff || 0) + dr2;\r\n          // if (score.nickname === 'grumd' || enemyScore.nickname === 'grumd') {\r\n          // console.log(\r\n          //   `${song.song} ${song.chartLabel} - ${score.nickname} / ${enemyScore.nickname} - ${\r\n          //     score.score\r\n          //   } / ${enemyScore.score} - E ${E1.toFixed(2)} / ${E2.toFixed(2)} - R ${S1.toFixed(\r\n          //     2\r\n          //   )}/${S2.toFixed(2)} - Rating ${r1.toFixed(2)} / ${r2.toFixed(2)} - ${dr1.toFixed(\r\n          //     2\r\n          //   )} / ${dr2.toFixed(2)} - K ${K1.toFixed(2)} ${K2.toFixed(2)}`\r\n          // );\r\n          // }\r\n\r\n          // Change rating as a result of this battle\r\n          playerInfo[score.nickname].rating = r1 + dr1;\r\n          playerInfo[enemyScore.nickname].rating = r2 + dr2;\r\n          // Rating floor\r\n          playerInfo[score.nickname].rating = Math.max(100, playerInfo[score.nickname].rating);\r\n          playerInfo[enemyScore.nickname].rating = Math.max(\r\n            100,\r\n            playerInfo[enemyScore.nickname].rating\r\n          );\r\n        });\r\n      });\r\n    });\r\n    const arr = Object.keys(playerInfo).map(key => ({\r\n      ..._.omit(['countAcc', 'sumAccuracy'], playerInfo[key]),\r\n      name: key,\r\n      accuracy:\r\n        playerInfo[key].countAcc > 0\r\n          ? Math.round((playerInfo[key].sumAccuracy / playerInfo[key].countAcc) * 100) / 100\r\n          : null,\r\n      rating: Math.round(playerInfo[key].rating),\r\n    }));\r\n    const ranking = _.orderBy(['rating'], ['desc'], _.remove(i => i.battleCount < 20, arr));\r\n    // console.log(ranking);\r\n\r\n    localForage.setItem('lastFetchedRanking', ranking);\r\n    return { data, ranking };\r\n  }\r\n);\r\n\r\nexport default function reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case LOADING:\r\n      return {\r\n        ...state,\r\n        isLoading: true,\r\n      };\r\n    case ERROR:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        error: action.error,\r\n      };\r\n    case SUCCESS:\r\n      return {\r\n        ...state,\r\n        isLoading: false,\r\n        ...transformBackendData(action.data),\r\n      };\r\n    case SET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: action.filter,\r\n      };\r\n    case RESET_FILTER:\r\n      return {\r\n        ...state,\r\n        filter: defaultFilter,\r\n      };\r\n    case RANKING_CHANGE_SET:\r\n      if (_.isEmpty(action.listPrev)) {\r\n        return state; // First time opening this thing and we didn't have any previous data\r\n      }\r\n      return {\r\n        ...state,\r\n        ranking: _.map(player => {\r\n          if (!action.listPrev.includes(player.name)) {\r\n            return { ...player, change: 'NEW' };\r\n          } else if (!action.listNow.includes(player.name)) {\r\n            // Should NEVER happen, idk if this is possible\r\n            return { ...player, change: '?' };\r\n          } else {\r\n            return {\r\n              ...player,\r\n              change: action.listPrev.indexOf(player.name) - action.listNow.indexOf(player.name),\r\n            };\r\n          }\r\n        }, state.ranking),\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport const fetchTopScores = () => {\r\n  return async dispatch => {\r\n    dispatch({ type: LOADING });\r\n    try {\r\n      const data = await fetchJson({\r\n        url: `${HOST}/top`,\r\n      });\r\n      dispatch({ type: SUCCESS, data });\r\n      return data;\r\n    } catch (error) {\r\n      dispatch({ type: ERROR, error });\r\n    }\r\n  };\r\n};\r\n\r\nexport const setFilter = filter => ({\r\n  type: SET_FILTER,\r\n  filter,\r\n});\r\nexport const resetFilter = () => ({\r\n  type: RESET_FILTER,\r\n});\r\n\r\nconst getListOfNames = _.map('name');\r\nexport const calculateRankingChanges = () => {\r\n  return async (dispatch, getState) => {\r\n    const { ranking } = getState().top;\r\n\r\n    try {\r\n      const [lastChangedRanking, lastFetchedRanking] = await Promise.all([\r\n        localForage.getItem('lastChangedRanking'),\r\n        localForage.getItem('lastFetchedRanking'),\r\n      ]);\r\n      const listNow = getListOfNames(ranking);\r\n      const listLastFetched = getListOfNames(lastFetchedRanking);\r\n      const listLastChanged = getListOfNames(lastChangedRanking);\r\n      if (!_.isEqual(listNow, listLastFetched)) {\r\n        // Between this fetch and last fetch there was a CHANGE in ranking\r\n        console.log('Ranking has changed, saving last one');\r\n        localForage.setItem('lastChangedRanking', lastFetchedRanking);\r\n        dispatch({ type: RANKING_CHANGE_SET, listNow, listPrev: listLastFetched });\r\n      } else {\r\n        dispatch({ type: RANKING_CHANGE_SET, listNow, listPrev: listLastChanged });\r\n      }\r\n      // console.log(listNow, listLastFetched, listLastChanged);\r\n    } catch (error) {\r\n      console.warn('Cannot get ranking from local storage', error);\r\n    }\r\n  };\r\n};\r\n","export const HOST = 'https://vps720616.ovh.net:5000';\r\n","import React from 'react';\r\nimport TimeAgo from 'javascript-time-ago';\r\nimport ru from 'javascript-time-ago/locale/ru';\r\nimport { convenient } from 'javascript-time-ago/gradation';\r\nimport moment from 'moment';\r\n\r\nTimeAgo.addLocale(ru);\r\nconst timeAgo = new TimeAgo('ru-RU');\r\n\r\nconst timeStyle = {\r\n  flavour: 'long',\r\n  gradation: convenient,\r\n  units: ['day', 'week', 'month'],\r\n};\r\nexport const tooltipFormatter = date => date.toLocaleDateString();\r\nexport const tooltipFormatterForBests = date => (\r\n  <div style={{ display: 'flex', alignItems: 'center', flexDirection: 'column' }}>\r\n    <div>точная дата взятия неизвестна</div>\r\n    <div>скор был записан с my best или machine best</div>\r\n    <div>дата записи: {date.toLocaleDateString()}</div>\r\n  </div>\r\n);\r\n\r\nconst nowDate = new Date();\r\nexport const getTimeAgo = date => {\r\n  const strTimeAgo = timeAgo.format(date, timeStyle);\r\n  if (!strTimeAgo) {\r\n    const dayDiff = moment(nowDate)\r\n      .startOf('day')\r\n      .diff(moment(date).startOf('day'), 'days');\r\n    return dayDiff === 0 ? 'сегодня' : dayDiff === 1 ? 'вчера' : '';\r\n  } else {\r\n    return strTimeAgo;\r\n  }\r\n};\r\n","export const colorsArray = [\r\n  '#FF6633',\r\n  '#66991A',\r\n  '#6666FF',\r\n  '#E6B333',\r\n  '#CC80CC',\r\n  '#E64D66',\r\n  '#4DB3FF',\r\n  '#99E6E6',\r\n  '#99FF99',\r\n  '#FFFF99',\r\n  '#FFB399',\r\n  '#809900',\r\n  '#00B3E6',\r\n  '#3366E6',\r\n  '#999966',\r\n  '#B34D4D',\r\n  '#80B300',\r\n  '#E6B3B3',\r\n  '#6680B3',\r\n  '#66664D',\r\n  '#FF99E6',\r\n  '#CCFF1A',\r\n  '#FF1A66',\r\n  '#33FFCC',\r\n  '#4D8000',\r\n  '#B33300',\r\n  '#991AFF',\r\n  '#E666FF',\r\n  '#1AB399',\r\n  '#E666B3',\r\n  '#33991A',\r\n  '#4D8066',\r\n  '#CC9999',\r\n  '#B3B31A',\r\n  '#00E680',\r\n  '#E6331A',\r\n  '#809980',\r\n  '#E6FF80',\r\n  '#1AFF33',\r\n  '#999933',\r\n  '#FF3380',\r\n  '#CCCC00',\r\n  '#66E64D',\r\n  '#4D80CC',\r\n  '#9900B3',\r\n  '#4DB380',\r\n  '#FF4D4D',\r\n];\r\n","import _ from 'lodash/fp';\r\nimport { createSelector } from 'reselect';\r\nimport matchSorter from 'match-sorter';\r\n\r\nimport { SORT, CHART_MIN_MAX } from 'constants/leaderboard';\r\n\r\nexport const playersSelector = createSelector(\r\n  state => state.top.data,\r\n  _.flow(\r\n    _.flatMap(_.get('results')),\r\n    _.map('nickname'),\r\n    _.uniq,\r\n    _.sortBy(_.toLower),\r\n    _.map(name => ({ label: name, value: name }))\r\n  )\r\n);\r\n\r\nconst filterCharts = (filter, rows) => {\r\n  const range = _.getOr(CHART_MIN_MAX, 'range', filter);\r\n  const type = _.getOr(null, 'type', filter);\r\n\r\n  const filtered = _.flow(\r\n    _.filter(row => {\r\n      return (\r\n        row.chartLevel >= range[0] &&\r\n        row.chartLevel <= range[1] &&\r\n        (!type || type === row.chartType)\r\n      );\r\n    })\r\n  )(rows);\r\n  return filtered;\r\n};\r\n\r\nconst getFilteredData = (data, filter) => {\r\n  const names = _.map('value', filter.players);\r\n  const namesOr = _.map('value', filter.playersOr);\r\n  const namesNot = _.map('value', filter.playersNot);\r\n  const sortingType = _.get('value', filter.sortingType);\r\n  const protagonist = _.get('value', filter.protagonist);\r\n  const excludeAntagonists = _.map('value', filter.excludeAntagonists);\r\n\r\n  const defaultSorting = [_.orderBy(['latestScoreDate'], ['desc'])];\r\n  const protagonistSorting = [\r\n    _.filter(row => _.map('nickname', row.results).includes(protagonist)),\r\n    _.map(row => {\r\n      const protIndex = _.findIndex({ nickname: protagonist }, row.results);\r\n      const protScore = row.results[protIndex].score;\r\n      const enemies = _.flow([\r\n        _.take(protIndex),\r\n        _.uniqBy('nickname'),\r\n        _.remove(res => excludeAntagonists.includes(res.nickname) || res.score === protScore),\r\n      ])(row.results);\r\n      const distance = Math.sqrt(\r\n        _.reduce((dist, enemy) => dist + (enemy.score / protScore - 0.99) ** 2, 0, enemies)\r\n      );\r\n      return {\r\n        ...row,\r\n        distanceFromProtagonist: distance,\r\n      };\r\n    }),\r\n    _.orderBy(['distanceFromProtagonist'], ['desc']),\r\n  ];\r\n  const sortingFunctions =\r\n    {\r\n      [SORT.DEFAULT]: defaultSorting,\r\n      [SORT.PROTAGONIST]: protagonistSorting,\r\n    }[sortingType] || defaultSorting;\r\n\r\n  return _.flow(\r\n    _.compact([\r\n      filter.chartRange && (items => filterCharts(filter.chartRange, items)),\r\n      !filter.showRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => !res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        filter.showOnlyRank &&\r\n        _.map(row => ({ ...row, results: _.filter(res => res.isRank, row.results) })),\r\n      filter.showRank &&\r\n        !filter.showOnlyRank &&\r\n        !filter.showRankAndNorank &&\r\n        _.map(row => {\r\n          const occuredNames = [];\r\n          return {\r\n            ...row,\r\n            results: _.filter(res => {\r\n              const alreadyOccured = occuredNames.includes(res.nickname);\r\n              occuredNames.push(res.nickname);\r\n              return !alreadyOccured;\r\n            }, row.results),\r\n          };\r\n        }),\r\n      (names.length || namesOr.length || namesNot.length) &&\r\n        _.filter(row => {\r\n          const rowNames = _.map('nickname', row.results);\r\n          return (\r\n            (!names.length || _.every(name => rowNames.includes(name), names)) &&\r\n            (!namesOr.length || _.some(name => rowNames.includes(name), namesOr)) &&\r\n            (!namesNot.length || !_.some(name => rowNames.includes(name), namesNot))\r\n          );\r\n        }),\r\n      _.filter(row => _.size(row.results)),\r\n      ...sortingFunctions,\r\n      filter.song && (items => matchSorter(items, filter.song, { keys: ['song'] })),\r\n      _.map(song => {\r\n        let topPlace = 1;\r\n        const occuredNicknames = [];\r\n        return {\r\n          ...song,\r\n          results: song.results.map((res, index) => {\r\n            const isSecondOccurenceInResults = occuredNicknames.includes(res.nickname);\r\n            occuredNicknames.push(res.nickname);\r\n            if (index === 0) {\r\n              topPlace = 1;\r\n            } else if (\r\n              !isSecondOccurenceInResults &&\r\n              res.score !== _.get([index - 1, 'score'], song.results)\r\n            ) {\r\n              topPlace += 1;\r\n            }\r\n            return {\r\n              ...res,\r\n              topPlace,\r\n              isSecondOccurenceInResults,\r\n            };\r\n          }),\r\n        };\r\n      }),\r\n    ])\r\n  )(data);\r\n};\r\n\r\nexport const filteredDataSelector = createSelector(\r\n  state => state.top.data,\r\n  state => state.top.filter,\r\n  getFilteredData\r\n);\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport _ from 'lodash/fp';\r\nimport Select from 'react-select';\r\nimport classNames from 'classnames';\r\nimport numeral from 'numeral';\r\nimport localForage from 'localforage';\r\nimport Tooltip from 'react-responsive-ui/modules/Tooltip';\r\nimport { FaRedoAlt, FaSearch } from 'react-icons/fa';\r\n\r\n// styles\r\nimport 'react-responsive-ui/style.css';\r\nimport './leaderboard.scss';\r\n\r\n// components\r\nimport Loader from 'components/Shared/Loader';\r\nimport Input from 'components/Shared/Input/Input';\r\nimport Toggle from 'components/Shared/Toggle/Toggle';\r\nimport CollapsibleBar from 'components/Shared/CollapsibleBar';\r\nimport ChartFilter from './ChartFilter';\r\n\r\n// constants\r\nimport { SORT, CHART_MIN_MAX } from 'constants/leaderboard';\r\n\r\n// reducers\r\nimport { fetchTopScores, setFilter, resetFilter, calculateRankingChanges } from 'reducers/top';\r\n\r\n// utils\r\nimport { tooltipFormatter, tooltipFormatterForBests, getTimeAgo } from 'utils/leaderboards';\r\nimport { colorsArray } from 'utils/colors';\r\nimport { playersSelector, filteredDataSelector } from './selectors';\r\n\r\n// code\r\nconst sortingOptions = [\r\n  {\r\n    label: 'новизне скоров',\r\n    value: SORT.DEFAULT,\r\n  },\r\n  {\r\n    label: 'отставанию от остальных',\r\n    value: SORT.PROTAGONIST,\r\n  },\r\n];\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    players: playersSelector(state),\r\n    filteredData: filteredDataSelector(state),\r\n    data: state.top.data,\r\n    filter: state.top.filter,\r\n    error: state.top.error,\r\n    isLoading: state.top.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchTopScores,\r\n  setFilter,\r\n  resetFilter,\r\n  calculateRankingChanges,\r\n};\r\n\r\nclass Leaderboard extends Component {\r\n  static propTypes = {\r\n    match: toBe.object,\r\n    data: toBe.array,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  state = { showItemsCount: 20 };\r\n\r\n  async componentDidMount() {\r\n    const { isLoading } = this.props;\r\n    if (!isLoading) {\r\n      await this.props.fetchTopScores();\r\n      this.props.calculateRankingChanges();\r\n    }\r\n    localForage\r\n      .getItem('filter')\r\n      .then(filter => {\r\n        if (filter) {\r\n          this.props.setFilter({\r\n            ...filter,\r\n            chartRange: filter.chartRange && {\r\n              ...filter.chartRange,\r\n              range: _.every(\r\n                r => r >= CHART_MIN_MAX[0] && r <= CHART_MIN_MAX[1],\r\n                filter.chartRange.range\r\n              )\r\n                ? filter.chartRange.range\r\n                : CHART_MIN_MAX,\r\n            },\r\n          });\r\n        }\r\n      })\r\n      .catch(error => console.error('Cannot get filter from local storage', error));\r\n  }\r\n\r\n  setFilter = _.curry((name, value) => {\r\n    const filter = { ...this.props.filter, [name]: value };\r\n    this.props.setFilter(filter);\r\n    localForage.setItem('filter', filter);\r\n  });\r\n\r\n  onRefresh = () => {\r\n    const { isLoading } = this.props;\r\n    if (!isLoading) {\r\n      this.props.fetchTopScores();\r\n    }\r\n  };\r\n\r\n  renderSimpleSearch() {\r\n    const { isLoading, filter } = this.props;\r\n    return (\r\n      <div className=\"simple-search\">\r\n        <div className=\"song-name _margin-right _margin-bottom\">\r\n          <Input\r\n            value={filter.song || ''}\r\n            placeholder=\"название песни...\"\r\n            className=\"form-control\"\r\n            onChange={this.setFilter('song')}\r\n          />\r\n        </div>\r\n        <div className=\"chart-range _margin-right _margin-bottom\">\r\n          <ChartFilter filterValue={filter.chartRange} onChange={this.setFilter('chartRange')} />\r\n        </div>\r\n        <div className=\"_flex-fill\" />\r\n        <div className=\"_flex-row _margin-bottom\">\r\n          <button\r\n            className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n            onClick={this.props.resetFilter}\r\n          >\r\n            <FaRedoAlt /> сбросить фильтры\r\n          </button>\r\n          <button\r\n            disabled={isLoading}\r\n            className=\"btn btn-sm btn-dark btn-icon\"\r\n            onClick={this.onRefresh}\r\n          >\r\n            <FaSearch /> обновить\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderFilters() {\r\n    const { players, filter } = this.props;\r\n\r\n    return (\r\n      <div className=\"filters\">\r\n        <div className=\"people-filters\">\r\n          <label className=\"label\">показывать чарты, которые сыграл:</label>\r\n          <div className=\"players-block\">\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">каждый из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'players', filter)}\r\n                onChange={this.setFilter('players')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и хоть один из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersOr', filter)}\r\n                onChange={this.setFilter('playersOr')}\r\n              />\r\n            </div>\r\n            <div className=\"_margin-right\">\r\n              <label className=\"label\">и никто из этих</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                isMulti\r\n                options={players}\r\n                value={_.getOr(null, 'playersNot', filter)}\r\n                onChange={this.setFilter('playersNot')}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Toggle\r\n            checked={_.getOr(false, 'showRank', filter)}\r\n            onChange={this.setFilter('showRank')}\r\n          >\r\n            показывать скоры на ранке\r\n          </Toggle>\r\n        </div>\r\n        {_.get('showRank', filter) && (\r\n          <>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showOnlyRank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showOnlyRank', value);\r\n                  if (_.get('showRankAndNorank', filter)) {\r\n                    this.setFilter('showRankAndNorank', false);\r\n                  }\r\n                }}\r\n              >\r\n                <strong>только</strong> на ранке\r\n              </Toggle>\r\n            </div>\r\n            <div>\r\n              <Toggle\r\n                checked={_.getOr(false, 'showRankAndNorank', filter)}\r\n                onChange={value => {\r\n                  this.setFilter('showRankAndNorank', value);\r\n                  if (_.get('showOnlyRank', filter)) {\r\n                    this.setFilter('showOnlyRank', false);\r\n                  }\r\n                }}\r\n              >\r\n                показывать лучшие скоры с ранком и без\r\n              </Toggle>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderSortings() {\r\n    const { players, filter } = this.props;\r\n    return (\r\n      <div className=\"sortings\">\r\n        <div>\r\n          <label className=\"label\">сортировать по</label>\r\n          <Select\r\n            placeholder=\"выберите сортировку\"\r\n            className=\"select\"\r\n            classNamePrefix=\"select\"\r\n            clearable={false}\r\n            options={sortingOptions}\r\n            value={_.getOr(sortingOptions[0], 'sortingType', filter)}\r\n            onChange={this.setFilter('sortingType')}\r\n          />\r\n        </div>\r\n        {_.get('sortingType.value', filter) === SORT.PROTAGONIST && (\r\n          <>\r\n            <div>\r\n              <label className=\"label\">протагонист (кого сравнивать с остальными):</label>\r\n              <Select\r\n                className={classNames('select players', {\r\n                  'red-border': !_.get('protagonist', filter),\r\n                })}\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                options={players}\r\n                value={_.getOr(null, 'protagonist', filter)}\r\n                onChange={this.setFilter('protagonist')}\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"label\">не учитывать в сравнении:</label>\r\n              <Select\r\n                closeMenuOnSelect={false}\r\n                className=\"select players\"\r\n                classNamePrefix=\"select\"\r\n                placeholder=\"игроки...\"\r\n                options={players}\r\n                isMulti\r\n                value={_.getOr([], 'excludeAntagonists', filter)}\r\n                onChange={this.setFilter('excludeAntagonists')}\r\n              />\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, filteredData, error, filter } = this.props;\r\n    const { showItemsCount } = this.state;\r\n\r\n    const canShowMore = filteredData.length > showItemsCount;\r\n    const visibleData = _.slice(0, showItemsCount, filteredData);\r\n\r\n    const uniqueSelectedNames = _.slice(\r\n      0,\r\n      colorsArray.length,\r\n      _.uniq(\r\n        _.compact([\r\n          _.get('sortingType.value', filter) === SORT.PROTAGONIST &&\r\n            _.get('protagonist.value', filter),\r\n          ..._.map('value', filter.players),\r\n          ..._.map('value', filter.playersOr),\r\n        ])\r\n      )\r\n    );\r\n\r\n    return (\r\n      <div className=\"leaderboard-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"search-block\">\r\n            {this.renderSimpleSearch()}\r\n            <CollapsibleBar title=\"фильтры\">{this.renderFilters()}</CollapsibleBar>\r\n            <CollapsibleBar title=\"сортировка\">{this.renderSortings()}</CollapsibleBar>\r\n          </div>\r\n          {isLoading && <Loader />}\r\n          <div className=\"top-list\">\r\n            {_.isEmpty(filteredData) && !isLoading && 'ничего не найдено'}\r\n            {visibleData.map((chart, chartIndex) => {\r\n              return (\r\n                <div className=\"song-block\" key={chart.song + chart.chartLabel}>\r\n                  <div className=\"song-name\">\r\n                    <div\r\n                      className={classNames('chart-name', {\r\n                        single: chart.chartType === 'S',\r\n                      })}\r\n                    >\r\n                      <span className=\"chart-letter\">{chart.chartType}</span>\r\n                      <span className=\"chart-number\">{chart.chartLevel}</span>\r\n                    </div>\r\n                    <div>{chart.song}</div>\r\n                  </div>\r\n                  <div className=\"charts\">\r\n                    <div className=\"chart\">\r\n                      <div className=\"results\">\r\n                        <table>\r\n                          {chartIndex === 0 && (\r\n                            <thead>\r\n                              <tr>\r\n                                <th className=\"place\"></th>\r\n                                <th className=\"nickname\"></th>\r\n                                <th className=\"rank\"></th>\r\n                                <th className=\"score\">score</th>\r\n                                <th className=\"grade\"></th>\r\n                                <th className=\"number\">miss</th>\r\n                                <th className=\"number\">bad</th>\r\n                                <th className=\"number\">good</th>\r\n                                <th className=\"number\">great</th>\r\n                                <th className=\"number\">perfect</th>\r\n                                <th className=\"combo\">combo</th>\r\n                                <th className=\"accuracy\">accuracy</th>\r\n                                <th className=\"date\"></th>\r\n                              </tr>\r\n                            </thead>\r\n                          )}\r\n                          <tbody>\r\n                            {chart.results.map(res => {\r\n                              const nameIndex = uniqueSelectedNames.indexOf(res.nickname);\r\n                              return (\r\n                                <tr\r\n                                  key={res.score + res.nickname}\r\n                                  className={classNames({ empty: !res.isExactDate })}\r\n                                >\r\n                                  <td className=\"place\">\r\n                                    {res.isSecondOccurenceInResults ? '' : `#${res.topPlace}`}\r\n                                  </td>\r\n                                  <td\r\n                                    className=\"nickname\"\r\n                                    style={\r\n                                      nameIndex > -1\r\n                                        ? { fontWeight: 'bold', color: colorsArray[nameIndex] }\r\n                                        : {}\r\n                                    }\r\n                                  >\r\n                                    {res.nickname}\r\n                                    {/* <span>\r\n                                      {' '}\r\n                                      {Math.round(res.startingRating)}{' '}\r\n                                      {res.ratingDiff && Math.round(res.ratingDiff)}\r\n                                    </span> */}\r\n                                    {_.get('sortingType.value', filter) === SORT.PROTAGONIST &&\r\n                                      res.nickname === _.get('protagonist.value', filter) &&\r\n                                      chart.distanceFromProtagonist > 0 && (\r\n                                        <span className=\"protagonist-diff\">\r\n                                          {' '}\r\n                                          -{(chart.distanceFromProtagonist * 100).toFixed(1)}%\r\n                                        </span>\r\n                                      )}\r\n                                  </td>\r\n                                  <td className={classNames('rank', { vj: res.isRank })}>\r\n                                    {res.isRank &&\r\n                                      (res.isExactDate ? (\r\n                                        'VJ'\r\n                                      ) : (\r\n                                        <Tooltip\r\n                                          content={\r\n                                            <>\r\n                                              <div>\r\n                                                наличие ранка на этом результате было угадано,\r\n                                                основываясь на скоре\r\n                                              </div>\r\n                                            </>\r\n                                          }\r\n                                          tooltipClassName=\"timeago-tooltip\"\r\n                                        >\r\n                                          VJ?\r\n                                        </Tooltip>\r\n                                      ))}\r\n                                  </td>\r\n                                  <td className=\"score\">{numeral(res.score).format('0,0')}</td>\r\n                                  <td className=\"grade\">\r\n                                    <div className=\"img-holder\">\r\n                                      {res.grade && res.grade !== '?' && (\r\n                                        <img\r\n                                          src={`${process.env.PUBLIC_URL}/grades/${res.grade}.png`}\r\n                                          alt={res.grade}\r\n                                        />\r\n                                      )}\r\n                                      {res.grade === '?' && null}\r\n                                    </div>\r\n                                  </td>\r\n                                  <td className=\"number miss\">{res.miss}</td>\r\n                                  <td className=\"number bad\">{res.bad}</td>\r\n                                  <td className=\"number good\">{res.good}</td>\r\n                                  <td className=\"number great\">{res.great}</td>\r\n                                  <td className=\"number perfect\">{res.perfect}</td>\r\n                                  <td className=\"combo\">\r\n                                    {res.combo}\r\n                                    {res.combo ? 'x' : ''}\r\n                                  </td>\r\n                                  <td className=\"accuracy\">\r\n                                    {res.accuracy}\r\n                                    {res.accuracy ? '%' : ''}\r\n                                  </td>\r\n                                  <td\r\n                                    className={classNames('date', {\r\n                                      latest: res.date === chart.latestScoreDate,\r\n                                    })}\r\n                                  >\r\n                                    <Tooltip\r\n                                      content={\r\n                                        res.isExactDate\r\n                                          ? tooltipFormatter(res.dateObject)\r\n                                          : tooltipFormatterForBests(res.dateObject)\r\n                                      }\r\n                                      tooltipClassName=\"timeago-tooltip\"\r\n                                    >\r\n                                      {getTimeAgo(res.dateObject)}\r\n                                      {res.isExactDate ? '' : '?'}\r\n                                    </Tooltip>\r\n                                  </td>\r\n                                </tr>\r\n                              );\r\n                            })}\r\n                          </tbody>\r\n                        </table>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n            {!isLoading && canShowMore && (\r\n              <button\r\n                className=\"btn btn-sm btn-primary\"\r\n                onClick={() =>\r\n                  this.setState(state => ({ showItemsCount: state.showItemsCount + 10 }))\r\n                }\r\n              >\r\n                show more...\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Leaderboard);\r\n","import React from 'react';\r\nimport _ from 'lodash/fp';\r\nimport numeral from 'numeral';\r\nimport { GiQueenCrown } from 'react-icons/gi';\r\nimport { FaAngleDoubleUp, FaAngleDoubleDown } from 'react-icons/fa';\r\n\r\nimport Loader from 'components/Shared/Loader';\r\n\r\nconst getGradeImg = grade => (\r\n  <img src={`${process.env.PUBLIC_URL}/grades/${grade}.png`} alt={grade} />\r\n);\r\n\r\nexport default function RankingList({ ranking, isLoading }) {\r\n  return (\r\n    <div className=\"ranking-list\">\r\n      {_.isEmpty(ranking) && !isLoading && 'ничего не найдено'}\r\n      <table>\r\n        <thead>\r\n          <tr>\r\n            <th className=\"place\"></th>\r\n            <th className=\"change\"></th>\r\n            <th className=\"name\">name</th>\r\n            <th className=\"rating\">elo</th>\r\n            <th className=\"total-score\">total score</th>\r\n            <th className=\"grades sss\">{getGradeImg('SSS')}</th>\r\n            <th className=\"grades ss\">{getGradeImg('SS')}</th>\r\n            <th className=\"grades s\">{getGradeImg('S')}</th>\r\n            <th className=\"grades a\">{getGradeImg('A+')}</th>\r\n            <th className=\"grades b\">{getGradeImg('B')}</th>\r\n            <th className=\"grades c\">{getGradeImg('C')}</th>\r\n            <th className=\"grades d\">{getGradeImg('D')}</th>\r\n            <th className=\"grades f\">{getGradeImg('F')}</th>\r\n            <th className=\"playcount\">scores</th>\r\n            <th className=\"accuracy\">accuracy</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {ranking.map((player, playerIndex) => {\r\n            return (\r\n              <tr className=\"player\" key={player.name}>\r\n                <td className=\"place\">\r\n                  {playerIndex === 0 ? <GiQueenCrown /> : `#${playerIndex + 1}`}\r\n                </td>\r\n                <td className=\"change\">\r\n                  {player.change > 0 && (\r\n                    <div className=\"change-holder up\">\r\n                      <span>{player.change}</span>\r\n                      <FaAngleDoubleUp />\r\n                    </div>\r\n                  )}\r\n                  {player.change < 0 && (\r\n                    <div className=\"change-holder down\">\r\n                      <span>{-player.change}</span>\r\n                      <FaAngleDoubleDown />\r\n                    </div>\r\n                  )}\r\n                  {!!player.change && _.isString(player.change) && (\r\n                    <div className=\"change-holder text\">\r\n                      <span>{player.change}</span>\r\n                    </div>\r\n                  )}\r\n                </td>\r\n                <td className=\"name\">{player.name}</td>\r\n                <td className=\"rating\">{player.rating}</td>\r\n                <td className=\"total-score\">\r\n                  <div>S: {numeral(player.totalScore.S).format('0,0')}</div>\r\n                  <div>D: {numeral(player.totalScore.D).format('0,0')}</div>\r\n                </td>\r\n                <td className=\"grades sss\">{player.grades.SSS}</td>\r\n                <td className=\"grades ss\">{player.grades.SS}</td>\r\n                <td className=\"grades s\">{player.grades.S}</td>\r\n                <td className=\"grades a\">{player.grades.A}</td>\r\n                <td className=\"grades b\">{player.grades.B}</td>\r\n                <td className=\"grades c\">{player.grades.C}</td>\r\n                <td className=\"grades d\">{player.grades.D}</td>\r\n                <td className=\"grades f\">{player.grades.F}</td>\r\n                <td className=\"playcount\">{player.count}</td>\r\n                <td className=\"accuracy\">{player.accuracy ? `${player.accuracy}%` : ''}</td>\r\n              </tr>\r\n            );\r\n          })}\r\n        </tbody>\r\n      </table>\r\n      {isLoading && <Loader />}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function RankingFaq() {\r\n  return (\r\n    <div className=\"faq\">\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Как считается рейтинг?</div>\r\n        <div className=\"answer\">\r\n          A: Используется <a href=\"https://en.wikipedia.org/wiki/Elo_rating_system\">рейтинг Эло</a>,\r\n          широко используемый в шахматах и других играх, слегка модицированный под условия игры на\r\n          пампе. Средний рейтинг - 1000. Коэффициент К зависит от уровня чарта (более сложные чарты\r\n          сильнее влияют на рейтинг). Количество очков влияет на заработанный рейтинг (маленький\r\n          отрыв от противника не даст так много очков как большой отрыв).\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Система Эло используется для игр 1 на 1, как она используется на пампе, где на одном\r\n          чарте играет много игроков?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: Рекорды на одном чарте делятся на несколько игр 1 на 1. Если есть 3 игрока: A, B, C; то\r\n          считается, что было 3 отдельные игры: A vs B, A vs C, B vs C.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Учитываются ли рекорды на ранке в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: Да. Как минимум потому что у нас есть много рекордов, взятых с машин бестов, и мы не\r\n          знаем наверняка, на ранке они или нет. Если у игрока в топе есть два скора - на ранке и\r\n          без ранка, используется тот, где больше очков.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Почему меня нет в рейтинге?</div>\r\n        <div className=\"answer\">\r\n          A: В таблицу попадают только те, у кого есть хотя бы 20 игр 1 на 1. Первые 20 игр\r\n          используются для определения изначального рейтинга.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Почему суммарное количество оценок S-A-B не совпадает с общим количеством скоров?\r\n        </div>\r\n        <div className=\"answer\">A: Не для каждого результата известна оценка.</div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">\r\n          Q: Если у меня есть несколько рекордов на А, несколько на А+, как считается суммарное\r\n          количество грейдов в таблице?\r\n        </div>\r\n        <div className=\"answer\">\r\n          A: В каждой колонке учитываются обе буквы - и треснутые, и с удержанным лайфом. То есть и\r\n          А, и А+ идут в колонку А. Точно так же для B, C, D.\r\n        </div>\r\n      </div>\r\n      <div className=\"question-answer\">\r\n        <div className=\"question\">Q: Убери аккураси из таблицы!</div>\r\n        <div className=\"answer\">A: Грем, это секция для вопросов.</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Component } from 'react';\r\nimport toBe from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { FaSearch, FaQuestionCircle } from 'react-icons/fa';\r\nimport { Link, Route, withRouter } from 'react-router-dom';\r\n\r\n// styles\r\nimport 'react-responsive-ui/style.css';\r\nimport './ranking.scss';\r\n\r\n// components\r\nimport RankingList from './RankingList';\r\nimport RankingFaq from './RankingFaq';\r\n\r\n// constants\r\nimport { routes } from 'constants/routes';\r\n\r\n// reducers\r\nimport { fetchTopScores, calculateRankingChanges } from 'reducers/top';\r\n\r\n// utils\r\n\r\n// code\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    ranking: state.top.ranking,\r\n    error: state.top.error,\r\n    isLoading: state.top.isLoading,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  fetchTopScores,\r\n  calculateRankingChanges,\r\n};\r\n\r\nclass Ranking extends Component {\r\n  static propTypes = {\r\n    ranking: toBe.array,\r\n    error: toBe.object,\r\n    isLoading: toBe.bool.isRequired,\r\n  };\r\n\r\n  static defaultProps = {\r\n    ranking: [],\r\n  };\r\n\r\n  async componentDidMount() {\r\n    const { isLoading } = this.props;\r\n    if (!isLoading) {\r\n      await this.props.fetchTopScores();\r\n      this.props.calculateRankingChanges();\r\n    }\r\n  }\r\n\r\n  onRefresh = async () => {\r\n    const { isLoading } = this.props;\r\n    if (!isLoading) {\r\n      await this.props.fetchTopScores();\r\n      this.props.calculateRankingChanges();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { isLoading, ranking, error } = this.props;\r\n\r\n    return (\r\n      <div className=\"ranking-page\">\r\n        <div className=\"content\">\r\n          {error && error.message}\r\n          <div className=\"top-controls\">\r\n            <div className=\"_flex-fill\" />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.path}\r\n              render={() => (\r\n                <>\r\n                  <button\r\n                    disabled={isLoading}\r\n                    className=\"btn btn-sm btn-dark btn-icon _margin-right\"\r\n                    onClick={this.onRefresh}\r\n                  >\r\n                    <FaSearch /> обновить\r\n                  </button>\r\n                  <Link to={routes.ranking.faq.path}>\r\n                    <button className=\"btn btn-sm btn-dark btn-icon\">\r\n                      <FaQuestionCircle /> faq\r\n                    </button>\r\n                  </Link>\r\n                </>\r\n              )}\r\n            />\r\n            <Route\r\n              exact\r\n              path={routes.ranking.faq.path}\r\n              render={() => (\r\n                <Link to={routes.ranking.path}>\r\n                  <button className=\"btn btn-sm btn-dark btn-icon\">назад</button>\r\n                </Link>\r\n              )}\r\n            />\r\n          </div>\r\n          <Route\r\n            exact\r\n            path={routes.ranking.path}\r\n            render={() => <RankingList ranking={ranking} isLoading={isLoading} />}\r\n          />\r\n          <Route exact path={routes.ranking.faq.path} component={RankingFaq} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withRouter(Ranking));\r\n","import React, { Component } from 'react';\r\n// import toBe from 'prop-types';\r\n// import classNames from 'classnames';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nimport './top-bar.scss';\r\n\r\nimport { routes } from 'constants/routes';\r\n\r\nclass TopBar extends Component {\r\n  static propTypes = {};\r\n\r\n  render() {\r\n    return (\r\n      <header className=\"top-bar\">\r\n        <nav>\r\n          <ul>\r\n            <li>\r\n              <NavLink exact to={routes.leaderboard.path}>\r\n                leaderboard\r\n              </NavLink>\r\n            </li>\r\n            <li>\r\n              <NavLink exact to={routes.ranking.path}>\r\n                ranking\r\n              </NavLink>\r\n            </li>\r\n          </ul>\r\n        </nav>\r\n      </header>\r\n    );\r\n  }\r\n}\r\n\r\nexport default TopBar;\r\n","import React, { Component } from 'react';\nimport { Route, Redirect } from 'react-router-dom';\n\nimport './App.scss';\n\nimport { routes } from 'constants/routes';\n\nimport Leaderboard from 'components/Leaderboard/Leaderboard';\nimport Ranking from 'components/Ranking/Ranking';\nimport TopBar from 'components/Shared/TopBar/TopBar';\n\nclass App extends Component {\n  render() {\n    return (\n      <div className=\"container\">\n        <TopBar />\n        <Route exact path=\"/\" render={() => <Redirect to={routes.leaderboard.path} />} />\n        <Route path={routes.leaderboard.path} component={Leaderboard} />\n        <Route path={routes.ranking.path} component={Ranking} />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import { combineReducers, createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\n\r\nimport top from 'reducers/top';\r\n\r\nconst rootReducer = combineReducers({\r\n  top,\r\n});\r\n\r\nexport const store = createStore(\r\n  rootReducer,\r\n  window.__REDUX_DEVTOOLS_EXTENSION__\r\n    ? compose(\r\n        applyMiddleware(thunk),\r\n        window.__REDUX_DEVTOOLS_EXTENSION__({\r\n          stateSanitizer: state => ({\r\n            ...state,\r\n          }),\r\n        })\r\n      )\r\n    : applyMiddleware(thunk)\r\n);\r\n","// import 'promise-polyfill';\n// import 'whatwg-fetch';\n// import 'utils/polyfills';\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\nimport { Provider } from 'react-redux';\n\nimport './index.scss';\nimport App from 'components/App';\nimport { store } from 'reducers';\n\nReactDOM.render(\n  <Provider store={store}>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </Provider>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}